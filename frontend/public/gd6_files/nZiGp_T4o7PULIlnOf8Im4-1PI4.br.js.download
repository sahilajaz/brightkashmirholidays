(function(){var t={L_CloseTask_Text:"Close",L_Landmark_CardsContainer_Aria_Label:"Search results, directions or favourites",L_Landmark_WelcomeContainer_Aria_Label:"Welcome to Bing Maps - explore nearby",L_Menu_Print_Link_Text:"Print",L_Menu_Share_Link_Text:"Share",L_Menu_ListView_Link_Text:"See all cards",L_TaskCardMoreMenuText:"More",L_CardLayoutExpandCollapse_Text:"Expand/Collapse Cards",SearchThisStoreText:"Search this store",HotelCategory:"Hotels",HotelQuery:"Hotels",AttractionsCategory:"Attractions",AttractionsQuery:"Things to do",RestaurantsCategory:"Eat & Drink",RestaurantsQuery:"Restaurants",HouseCategory:"Property",HouseQuery:"Houses for sale",LocalGuideCategory:"Local Guide",L_CollapseButton_Tip:"Collapse to view more map",L_ExpandButton_Tip:"Expand to view more content",BackToTop:"Back To Top"},n=window.$MicrosoftMaps8,i;n.ResourceManager?n.ResourceManager.init("TaskFramework",t):(i=n.ResourcesObject=n.ResourcesObject||{},i.TaskFramework=t)})(),function(){var rt,nt,ai,vi,yi,pi,wi,c,bi,dt,ki,di,gi,ht,nr,tr,ni;try{var i=Microsoft.Maps,u=i.Internal,l=u.__assign,f=u.__extends,ii=u.__spreadArray,h=i.globalConfig,er=u.coreConfig,s=h.features,kf=s.advertising,df=s.autosuggest,gf=s.calendar,ne=s.collections,te=s.directions,ie=s.feedback,re=s.flyover,ue=s.landmarks3D,fe=s.map3D,lt=s.richMapsInfobox,ee=s.labels,or=s.layerManager,p=s.localGuide,ri=s.localSearch,oe=s.mapDelay,se=s.optIn,he=s.print,ut=s.sharing,ce=s.streetside,le=s.birdseye,ui=s.taskBar,t=s.taskFramework,ae=s.trafficControl,ve=s.traffic,sr=s.trafficExperiences,ye=s.transit,pe=s.travel,we=s.xsr,fi=atlas.math,y=atlas.data,be=atlas.layer,ke=atlas.Pixel,de=atlas.data.BoundingBox,ei=u.AzureMapEvents,ft=u.AzureMapInteractions,et=u.Binding,ge=u.BoundsAccumulator,no=u.Debug,n=u.Gimme,e=u.AtlasHelper,d=u.EntityHelper,o=u.Helper,hr=u.LocationRectHelper,to=u.LocalStorageCache,cr=u.LruCache,io=u.MapMath,oi=u.Network,r=u.JSEvent,lr=u.ObjectWithId,ar=u.Observable,si=u.ObservableCollection,at=u.ObservableObject,ro=u.Overlay,vr=u.PyramidTileSpatialIndex,uo=u.TaskDataHandlerHelper,fo=u.TileSystemHelper,vt=u.PerfV2Logger,eo=u.VectorMath,b=u.TimeoutWrapper,oo=i.Anchor,hi=i.BingMapStyle,yr=i.Color,so=i.globalContainer,ho=u.InstrumentationBase,co=i.LatLonCrs,yt=i.Location,lo=i.LatLonEncoder,pr=u.ObservableObjectChangedArgs,wr=i.Point,ao=i.Rectangle,vo=i.ResourceManager,br=i.SimpleAreaPrimitive,yo=i.SimpleLinePrimitive,kr=i.SimplePointPrimitive,dr=i.Size,v=i.GlobalDataEventHandler,po=i.HomeOrWorkEnabledLocalSearchEntity,gr=u.BaseViewModel,nu=u.BootstrapView,ci=u.Control,tt=u.ContentControl,a=u.ControlTemplate,pt=u.ElementSizeHelper,tu=u.InteractionEventArgs,wo=u.LocalSearchEntity,d=u.EntityHelper,iu=u.RoutePushpin,li=u.PoiAnimation,ru=u.SDSData,bo=u.TrafficPrimitiveLayerManager,uu=u.TaskData,fu=uu.TravelAttractionEntity,g=i.ResourceManager.TaskFramework,eu='<div class="autosOverflowContainer" style:display="{TemplateBinding task Converter=isAutosTask}">    <div class="shoppingHeader">        <div class="panelTitleContainer">            <TextBlock Text="{TemplateBinding task.PanelTitle}" />        <\/div>        <div class="bm_cardClose">            <a class="bm_cardCloseButton" href="#" event:click="onCloseOverflowClick" data-tag="{TemplateBinding Stack.OverflowTask.id}" role="button" aria-label="{StaticBinding resources.L_CloseTask_Text}" />        <\/div>        <div class="shoppingSearchControl">            <div class="shoppingSearchboxContainer">                <input class="shoppingSearchbox" value="{TemplateBinding searchText Mode=TwoWay}" event:keydown="onSearchKeyPressed" type="search" role="combobox" placeholder="{StaticBinding resources.SearchThisStoreText}" />                <a class="shoppingSearchButton" href="#" event:click="onProductSearchClick" role="button" aria-label="{StaticBinding resources.SearchThisStoreText}" />            <\/div>        <\/div>    <\/div>    <iframe src="{TemplateBinding autosUrl}" frameborder="0" id="autoDealersIFrame" /><\/div>',ou='<div>    <ResponsiveCardLane Content="{Binding $self$}" IsHidden="{Binding HideLeftLane Mode=TwoWay}" LeftLaneTask="{Binding FocusedStack.FirstTask}" SlideoutTask="{Binding slideoutTask}" LaneWidth="{StaticBinding FocusedStack.FirstTask.CurrentWidth Mode=TwoWay}" OriginalWidth="{StaticBinding FocusedStack.FirstTask.RecommendedWidth}" event:toggleCardLane="onToggleCardLane" Map="{Binding map}">        <ResponsiveCardLane.ContentTemplate>            <DataTemplate>                <div class="{Binding $self$ Converter=customScrollbarRootClass}">                    <div class="stickyFiltersRoot bold" style:width="{StaticBinding FocusedStack.FirstTask.CurrentWidth Converter=getWidthString}">                        <div class="{StaticBinding FocusedStack.FirstTask.HasTitleEnrichment Converter=boolToTitleBarClass}" event:click="onTitleBarClick" style:display="{StaticBinding FocusedStack.FirstTask Converter=displayTitleBar}">                            <div class="cardTitleText">                                <div class="title" tabindex="-1">                                    <h2>                                        <TextBlock Text="{StaticBinding FocusedStack.FirstTask.Title}" />                                    <\/h2>                                <\/div>                            <\/div>                            <TitleEnrichmentControl Task="{StaticBinding FocusedStack.FirstTask}" Enrichment="{StaticBinding FocusedStack.FirstTask.TitleEnrichment}">                            <\/TitleEnrichmentControl>                            <TaskSettingsControl Task="{StaticBinding FocusedStack.FirstTask Mode=TwoWay}" HasCardSettings="{StaticBinding FocusedStack.FirstTask.HasCardSettings Mode=TwoWay}" CardSettings="{StaticBinding FocusedStack.FirstTask.CardSettings Mode=TwoWay}"><\/TaskSettingsControl>                            <a href="#" class="panelClose" aria-label="{StaticBinding resources.L_CloseTask_Text}" role="button" data-task="{StaticBinding FocusedStack.FirstTask.id Converter=closeTaskByIdFromHeader}">                                <div class="icon"><\/div>                            <\/a>                        <\/div>                        <FiltersControl Task="{StaticBinding FocusedStack.FirstTask}" Filters="{StaticBinding FocusedStack.FirstTask.Filters}" Width="{StaticBinding FocusedStack.FirstTask.CurrentWidth}">                        <\/FiltersControl>                    <\/div>                    <div class="{Binding $self$ Converter=customScrollbarOuterContainerClass}">                        <div class="positioning" style:display="{Binding $self$ Converter=customScrollbarPositioningStyle}">                            <div class="custom-scrollbar">                                <div class="custom-scroll-handle">                                    <div />                                <\/div>                            <\/div>                        <\/div>                        <div class="{Binding $self$ Converter=customScrollbarInnerContainerClass}">                            <div class="{Binding $self$ Converter=customScrollbarContentWrapperClass}">                                <div class="panelWrapper multi">                                    <div class="bm_waitlayer"><\/div>                                    <ItemsControl ItemsSource="{Binding stacks}">                                        <ItemsControl.Template>                                            <DataTemplate>                                                <div class="cardCol panelContent" data-containerAreaType="cardsContainer" role="main" aria-label="{StaticBinding FocusedStack.FirstTask.Title}">                                                    <ItemsPresenter />                                                <\/div>                                            <\/DataTemplate>                                        <\/ItemsControl.Template>                                        <ItemsControl.ItemTemplate>                                            <DataTemplate>                                                <div class="cardWrapper expand taskCardLane" style:width="{StaticBinding FocusedStack.FirstTask.CurrentWidth Converter=getWidthString}">                                                    <SingleTaskCard LayoutMetrics="{StaticBinding layoutMetrics}" Stack="{Binding $self$}" Task="{Binding firstTask}" event:click="onTaskCardClick" event:titleMouseEnter="onTitleMouseOver" event:titleMouseLeave="onTitleMouseLeave" />                                                <\/div>                                            <\/DataTemplate>                                        <\/ItemsControl.ItemTemplate>                                    <\/ItemsControl>                                <\/div>                            <\/div>                        <\/div>                        <div id="backToTop" class="hide btt-container" aria-label="{StaticBinding resources.BackToTop}">                            <button type="button" class="btt-btn" event:click="onBackToTopClick">                                <div class="btt-icon"><\/div><TextBlock Text="{Binding resources.BackToTop}" />                            <\/button>                        <\/div>                    <\/div>                <\/div>            <\/DataTemplate>        <\/ResponsiveCardLane.ContentTemplate>    <\/ResponsiveCardLane>    <ResponsiveCardLane Content="{Binding $self$}" IsHidden="{Binding slideoutTask Converter=slideoutToIsHidden}" IsSlideoutLane="true" LeftLaneTask="{Binding FocusedStack.FirstTask}" SlideoutTask="{Binding slideoutTask}" LaneWidth="{StaticBinding slideoutTask.CurrentWidth Mode=TwoWay}" OriginalWidth="{StaticBinding slideoutTask.RecommendedWidth}" event:toggleCardLane="onToggleCardLane" Map="{Binding map}">        <ResponsiveCardLane.ContentTemplate>            <DataTemplate>                <div class="{Binding $self$ Converter=customScrollbarSlideoutRootClass}" style:display="{StaticBinding FocusedStack.OverflowTask Converter=taskExistsToDisplayNone}">                    <div class="stickyFiltersRoot bold slideout" style:width="{StaticBinding slideoutTask.CurrentWidth Converter=getWidthString}" style:display="{StaticBinding slideoutTask Converter=displayTitleBar}">                        <div data-tag="backBtnContainer" class="boldUXBack">                            <a href="#" title="{StaticBinding slideoutTask.BackButtonText}" data-task="{StaticBinding slideoutTask.id Converter=closeTaskByIdFromHeader}" class="commonButton backArrowButton overlayButton" style:display="{StaticBinding slideoutTask Converter=displayBackButton}">                                <div class="overlayBackButtonText">                                    <TextBlock Text="{StaticBinding slideoutTask.BackButtonText}" />                                <\/div>                            <\/a>                        <\/div>                        <div class="{StaticBinding slideoutTask.HasTitleEnrichment Converter=boolToTitleBarClass}" event:click="onTitleBarClick">                            <div class="cardTitleText">                                <div class="title" tabindex="-1">                                    <h2>                                        <TextBlock Text="{StaticBinding slideoutTask.Title}" />                                    <\/h2>                                <\/div>                            <\/div>                            <a href="#" class="panelClose" aria-label="{StaticBinding resources.L_CloseTask_Text}" role="button" style:display="{StaticBinding slideoutTask Converter=hideCloseButton}" data-task="{StaticBinding slideoutTask.id Converter=closeTaskByIdFromHeader}">                                <div class="icon"><\/div>                            <\/a>                        <\/div>                        <FiltersControl Task="{StaticBinding slideoutTask}" Filters="{StaticBinding slideoutTask.Filters}" Width="{StaticBinding slideoutTask.CurrentWidth}">                        <\/FiltersControl>                    <\/div>                    <div class="{Binding $self$ Converter=customScrollbarOuterContainerClass}">                        <div class="positioning" style:display="{Binding $self$ Converter=customScrollbarPositioningStyle}">                            <div class="custom-scrollbar">                                <div class="custom-scroll-handle">                                    <div />                                <\/div>                            <\/div>                        <\/div>                        <div class="{Binding $self$ Converter=customScrollbarInnerContainerClass}">                            <div class="{Binding $self$ Converter=customScrollbarContentWrapperClass}">                                <div class="{Binding $self$ Converter=customScrollbarSlideContainerClass}">                                    <div class="panelWrapper multi leftPanel noScroll slide">                                        <div class="bm_waitlayer"><\/div>                                        <div class="{StaticBinding HideLeftLane Converter=getSlideoutClass}" data-containerAreaType="cardsContainer" role="complementary" aria-label="{StaticBinding SlideoutTask.Title}">                                            <div class="cardWrapper expand">                                                <SingleTaskCard LayoutMetrics="{StaticBinding focusedStack.layoutMetrics}" Stack="{StaticBinding FocusedStack}" Task="{StaticBinding SlideoutTask}" />                                            <\/div>                                        <\/div>                                    <\/div>                                <\/div>                            <\/div>                        <\/div>                    <\/div>                <\/div>            <\/DataTemplate>        <\/ResponsiveCardLane.ContentTemplate>    <\/ResponsiveCardLane>    <OverflowCard ClassName="bm_scrollbarMask overflowTaskPanel"                  Stack="{StaticBinding FocusedStack}"                  OverflowTask="{StaticBinding FocusedStack.OverflowTask}"                  LayoutMetrics="{StaticBinding FocusedStack.layoutMetrics}" /><\/div>',su='<div class="{TemplateBinding task Converter=getAreaClass}" style:display="{TemplateBinding filters Converter=noFiltersToDisplayNone}">    <ContentPresenter content=\'FilterContent\' />    <div class="bm_filterExpando" event:click="onExpandoClick" event:keydown="onExpandoKeydown" tabindex="0">        <span class="bm_selectedCount" style:display="{TemplateBinding selectedCount Converter=zeroToDisplayNone}">            <TextBlock Text="{TemplateBinding selectedCount}" />        <\/span>        <span class="bm_chevronIcon">        <\/span>    <\/div><\/div>',hu='<div class="bm_scrollbarMask">    <div class="custom-scroll">        <div class="outer-container">            <div class="positioning">                <div class="custom-scrollbar">                    <div class="custom-scroll-handle">                        <div />                    <\/div>                <\/div>            <\/div>            <div class="inner-container">                <div class="content-wrapper">                    <div class="panelWrapper multi select">                        <div class="bm_waitlayer"><\/div>                        <ItemsControl ItemsSource="{Binding stacks}">                            <ItemsControl.Template>                                <DataTemplate>                                    <div data-containerAreaType="cardsContainer" class="panelContent" role="main" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">                                        <ItemsPresenter />                                    <\/div>                                <\/DataTemplate>                            <\/ItemsControl.Template>                            <ItemsControl.ItemTemplate>                                <DataTemplate>                                    <div class="cardWrapper">                                        <!-- The original solution was to use disabled="{Binding $self$ Converter=shouldStackBeDisabled}". But during debugging it turned out that the converter for the special $self$ object is being called on                                        _every_  $self$ property change, not just the one I bind to. Since the converter is heavy I am moving this assignment to the stackChanged event. -->                                        <SelectionTaskCard LayoutMetrics="{StaticBinding layoutMetrics}" Stack="{Binding $self$}" event:click="onTaskCardClick" event:touchend="onTaskClick" ignoreTaskFadeProperty="true">                                            <SelectionTaskCard.Template>                                                <DataTemplate>                                                    <div class="{TemplateBinding cssClass}" data-taskid="{TemplateBinding Stack.id}" style="visibility:hidden">                                                        <div class="cardFace selectionMode sideA front" data-subTaskId="{TemplateBinding sideATask.id}">                                                        <\/div>                                                        <div class="cardFace selectionMode sideB back" data-subTaskId="{TemplateBinding sideBTask.id}">                                                        <\/div>                                                    <\/div>                                                <\/DataTemplate>                                            <\/SelectionTaskCard.Template>                                        <\/SelectionTaskCard>                                    <\/div>                                <\/DataTemplate>                            <\/ItemsControl.ItemTemplate>                        <\/ItemsControl>                        <ContainerControl containerClass="selectionCardClass" controlName="{Binding selectionModeControlName}" controlRef="{Binding selectionControl Mode=TwoWay}" />                    <\/div>                <\/div>            <\/div>        <\/div>    <\/div><\/div>',cu='<div class="panelWrapper multi select">    <div class="bm_waitlayer"><\/div>\t<ItemsControl ItemsSource="{Binding stacks}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<div data-containerAreaType="cardsContainer" class="panelContent" role="main" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">\t\t\t\t\t<ItemsPresenter />\t\t\t\t<\/div>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<div class="cardWrapper">\t\t\t\t\t<!-- The original solution was to use disabled="{Binding $self$ Converter=shouldStackBeDisabled}". But during debugging it turned out that the converter for the special $self$ object is being called on\t\t\t\t\t_every_  $self$ property change, not just the one I bind to. Since the converter is heavy I am moving this assignment to the stackChanged event. -->                    <SelectionTaskCard LayoutMetrics="{StaticBinding layoutMetrics}" Stack="{Binding $self$}" event:click="onTaskCardClick" event:touchend="onTaskClick" ignoreTaskFadeProperty="true" >                        <SelectionTaskCard.Template>                            <DataTemplate>                                <div class="{TemplateBinding cssClass}" data-taskid="{TemplateBinding Stack.id}" style="visibility:hidden">                                    <div class="cardFace selectionMode sideA front" data-subTaskId="{TemplateBinding sideATask.id}">                                     <\/div>                                    <div class="cardFace selectionMode sideB back" data-subTaskId="{TemplateBinding sideBTask.id}">                                    <\/div>                                <\/div>                            <\/DataTemplate>                        <\/SelectionTaskCard.Template>                    <\/SelectionTaskCard>\t\t\t\t<\/div>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>    <ContainerControl containerClass="selectionCardClass" controlName="{Binding selectionModeControlName}" controlRef="{Binding selectionControl Mode=TwoWay}"/><\/div>',lu='<div class="{StaticBinding ClassName}" style:display="{StaticBinding OverflowTask Converter=taskExistsToDisplay}">    <ShoppingTaskContainer LayoutMetrics="{StaticBinding LayoutMetrics}" Stack="{StaticBinding Stack}" Task="{StaticBinding OverflowTask}" />    <AutosTaskContainer LayoutMetrics="{StaticBinding LayoutMetrics}" Stack="{StaticBinding Stack}" Task="{StaticBinding OverflowTask}" />    <iframe frameborder="0" id="WoWIFrame" src="{StaticBinding OverflowTask Converter=taskExistsToWoWRequestUrl}" style:display="{StaticBinding ShowWoWIframe Converter=boolToDisplay}"/><\/div>',au='<div class="bm_scrollbarMask" style:display="{TemplateBinding IsHidden Converter=hideLeftLane}" aria-hidden="{TemplateBinding IsHidden}">    <ContentPresenter />    <div class="collapseSlideout" style:display="{TemplateBinding SlideoutTask Converter=displayExpandCollapse}">        <div style:display="{TemplateBinding ShowExpandButton Converter=boolToDisplay}">            <a class="resizeButton show" href="#" data-tag="toggleButtonShow" title="{TemplateBinding resources.L_ExpandButton_Tip}" aria-label="{TemplateBinding resources.L_CardLayoutExpandCollapse_Text}" role="button" event:click="toggleShowClick"><\/a>        <\/div>        <div style:display="{TemplateBinding IsCardlaneCollapsed Converter=boolToNotDisplay}">            <a class="resizeButton hide" href="#" data-tag="toggleButtonHide" title="{TemplateBinding resources.L_CollapseButton_Tip}" aria-label="{TemplateBinding resources.L_CardLayoutExpandCollapse_Text}" role="button" event:click="toggleHideClick"><\/a>        <\/div>    <\/div><\/div>',vu='<div class="custom-scroll" style:display="{TemplateBinding task Converter=isShoppingTask}">    <div class="shoppingHeader">        <div class="panelTitleContainer">            <TextBlock Text="{TemplateBinding task.PanelTitle}" />        <\/div>        <div class="bm_cardClose">            <a class="bm_cardCloseButton" href="#" event:click="onCloseOverflowClick" data-tag="{TemplateBinding Stack.OverflowTask.id}" role="button" aria-label="{StaticBinding resources.L_CloseTask_Text}" />        <\/div>        <div class="shoppingSearchControl">            <div class="shoppingSearchboxContainer">                <input class="shoppingSearchbox" value="{TemplateBinding searchText Mode=TwoWay}" event:keydown="onSearchKeyPressed" type="search" role="combobox" placeholder="{StaticBinding resources.SearchThisStoreText}" />                <a class="shoppingSearchButton" href="#" event:click="onProductSearchClick" role="button" aria-label="{StaticBinding resources.SearchThisStoreText}" />            <\/div>            <div class="shop_asbox" style:display="{TemplateBinding ShowAutosuggest Converter=boolToDisplay}">                <ul class="shop_aslist">                <\/ul>            <\/div>        <\/div>    <\/div>    <div class="outer-container">        <div class="positioning">            <div class="custom-scrollbar">                <div class="custom-scroll-handle">                    <div><\/div>                <\/div>            <\/div>        <\/div>        <div class="bm_waitlayer" style:display="{TemplateBinding task.ShowWaitLayer Converter=boolToDisplay}"><\/div>        <div class="inner-container">            <div class="content-wrapper">                <div class="panelWrapper multi noScroll">                    <div class="cardCol slidecard panelContent" data-containerAreaType="cardsContainer" role="complementary" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">                        <div class="cardWrapper expand">                            <div class="taskCard overflow focus" data-taskId="{TemplateBinding dataTaskId}" data-subTaskId="{TemplateBinding task.id}">                                <div class="contentRoot" data-containerareatype="taskArea">                                    <ContentPresenter content="cardContent" />                                <\/div>                            <\/div>                        <\/div>                    <\/div>                <\/div>            <\/div>        <\/div>    <\/div><\/div>',yu='<div class="{TemplateBinding cssClass}" data-taskId="{TemplateBinding dataTaskId}" data-subTaskId="{TemplateBinding task.id}" style:width="{TemplateBinding task.CurrentWidth Converter=getWidthString}">    <div class="cardFace front">        <a class="focusDummy" tabindex="-1" title="{TemplateBinding cardTitle}"><\/a>        <div class="cardContent">            <div class="contentRoot" data-containerareatype="taskArea">                <div class="{TemplateBinding closeIconClass Converter=getCloseCardIconClass}" style:display="{TemplateBinding isDetailsCard Converter=boolToDisplay}">                    <a class="bm_cardCloseButton" role="button" href="#" data-task="{TemplateBinding task.id Converter=closeTaskById}" data-tag="DetailCardClose" aria-label="{StaticBinding resources.L_CloseTask_Text}" />                <\/div>                <ContentPresenter content="cardContent" />            <\/div>        <\/div>    <\/div><\/div>',pu='<div style:display="{Binding HasCardSettings Converter=boolToDisplayNone}" class="bm_taskSettings">    <ContentPresenter content="CardSettings" /><\/div>',wu="<div class=\"bm_titleAugment\">    <ContentPresenter content='TitleAugmentation' /><\/div>";"use strict";var wt=function(i){function u(u){var f=i.call(this)||this,e;return f._map=u,f.serializableObjectChanged=new r,f.primitiveInteracted=new r,f.launchOverflowTask=new r,f.resizeCard=new r,f.resizeCompleted=new r,f.toggleCompleted=new r,e=f._privates,e.defineProperty("percentLoaded"),e.defineProperty("title"),e.defineProperty("recommendedWidth"),e.defineProperty("currentWidth",function(n,t){f._onWidthChanged(n,t)}),e.defineProperty("filters"),e.defineProperty("titleEnrichment"),e.defineProperty("hasTitleEnrichment"),e.defineProperty("cardSettings"),e.defineProperty("hasCardSettings"),e.defineProperty("disableExpansion"),e.defineProperty("backButtonText"),e.defineProperty("mapPrimitives",function(n,t){return f._onPrimitivesChanged(t)},null,{defaultValue:[]}),f.panelRoot=n(document.createElement("div")).set_attr("id",f.id),f.setTitleEnrichment(n(document.createElement("div"))[0]),f.setHasTitleEnrichment(!1),f.setCardSettings(n(document.createElement("div"))[0]),f.setHasCardSettings(!1),f.disposables=[],f._eventsInitialized=!1,f.setRecommendedWidth(t.defaultCardWidth),f.setCurrentWidth(t.defaultCardWidth),f.setDisableExpansion(!1),f._richInfoboxEnabled=lt===null||lt===void 0?void 0:lt.isEnabled,f}return f(u,i),u.prototype.isHidden=function(){return this.displayState&&this.displayState.isHidden},u.getImpressionGuid=function(n){var r,t,i;return n&&(t=n.select("div[data-ig]"),t&&t.length>0&&(i=t[0].getAttribute("data-ig"),i&&(r=i))),r},u.getMasterImpressionGuid=function(){var n;return h.dynamicProperties&&h.dynamicProperties.mapsIG&&(n=h.dynamicProperties.mapsIG),n},u.prototype.activate=function(n,t,i,r,u){var f=this,e;this._map=n;e=vt.getStartTime("SearchRequest",!0);vt.setStartTime(this.id,e);this._eventsInitialized||(this.poiManager&&this.disposables.push(this.poiManager.poiViewStateChanged.add(function(n){f._onPoiViewStateChanged(n)})),this._eventsInitialized=!0);u&&this._setDeserializedView(t);n&&(this._mapTemplateSelector=n.getTemplateSelector(),this._mapTemplateSelector&&this._mapTemplateSelector.selectorReady().then(function(){f.changed.invoke({name:"iconClass"})}));this._logAdsRLinkUrl(t&&t.adsRLinkUrl)},u.prototype.setDisplayState=function(n){this.displayState=l(l({},this.displayState||{}),n);this._setMapLayerZIndex(st.getZOrderOfTaskPrimitives(this.displayState));this.poiManager&&this.poiManager.setTaskDisplayState(n);this.changed.invoke(new pr(this,"displayState",null,n));sj_evt&&this.displayState.prominence===1&&n.cardTitleHoveringState!==1&&n.cardTitleHoveringState!==2&&!this.displayState.pendingRemoval&&(o._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&this.displayState.stackOrder===1&&sj_evt.fire("TaskActivated",{id:this.id,IG:u.getImpressionGuid(this.panelRoot)}),sj_evt.fire("TaskDisplayed",this.id))},u.prototype.deactivate=function(){this.poiManager&&(this.poiManager.dispose(),this.poiManager=null);e._clearDisposables(this.disposables);o._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.fire("TaskDeactivated",{id:this.id,IG:u.getImpressionGuid(this.panelRoot)});this.setCurrentWidth(0)},u.prototype.serialize=function(){throw new Error("serialize not implemented");},u.prototype.deserialize=function(){},u.prototype.canColorFade=function(){return t.canCardColorFade},u.prototype.hasDefaultFocusElement=function(){return!1},u.prototype.getContent=function(){return this.panelRoot&&this.panelRoot[0]},u.prototype.appendControl=function(n){this.panelRoot.append(n);this.changed.invoke()},u.prototype.addControl=function(n){this.panelRoot.clear();this.appendControl(n)},u.prototype.process=function(){},u.prototype.processCallback=function(){},u.prototype.getMenuList=function(){var n=this,i=[];return(ut===null||ut===void 0?void 0:ut.isEnabled)&&!ut.disableOutboardSharing&&this.isSharable()&&i.push({name:g.L_Menu_Share_Link_Text,handler:function(){return n._share()},cssClass:"menuShareItem",instData:this.getInstData("Share")}),this.hasPrintContent()&&i.push({name:g.L_Menu_Print_Link_Text,handler:function(){v.invokeHandler("data-print",{source:2,taskType:n.type,taskId:n.id,data:n.getPrintInstrumentationData()})},cssClass:"menuPrintItem",instData:this.getInstData("Print")}),t.enableListView&&i.push({name:g.L_Menu_ListView_Link_Text,handler:function(){v.invokeHandler("data-layout",{action:"updateLayout",state:{layoutType:"listView"}})},cssClass:"menuSeeAllItem",instData:this.getInstData("ListView")}),i},u.prototype.getPrintInstrumentationData=function(){return null},u.prototype.getCardIconInfo=function(){throw new Error("Not implemented");},u.prototype.hasPrintContent=function(){return!1},u.prototype.getPrintContent=function(){return null},u.prototype.disableFeatureClick=function(){return!1},u.prototype._onPoiViewStateChanged=function(n){if(n&&n.oldValue&&n.newValue===4){var t={action:"focus",id:this.id};v.invokeHandler("data-task",t)}},u.prototype.setCloseButtonClass=function(){var r=this.panelRoot,t,i,e,o,s,h,c,a;if(r.length>0&&(t=n(".bm_cardClose"),t.length>0)){i=r.select(".b_subModule.noborder");i.length===0&&(i=r.select(".wpc_module"));var f=i.length>0&&i.parent(),u=f&&f.length>0&&f[0].firstElementChild,l=!0;u&&u.classList&&(u.classList.contains("b_subModule")||u.classList.contains("wpc_module"))&&i.length>0&&i[0].childElementCount>0&&(e=i.select(".mapActionsModule"),l=!e||e.length===0);l?t.add_class("collage"):t.remove_class("collage");o=n(".sponad-taskpane");s=n(".faketab",r[0]);o&&o.length>0||s&&s.length>0?t.add_class("sponad"):t.remove_class("sponad");h=!1;c=r.select(".b_wftp.overlay-taskpane");c.length>0&&(a=c.select(".b_img_carousel:first-child .cico"),a.length===0&&(h=!0));h?(t.add_class("bm_no-images-layout"),r.add_class("bm_no-images-layout")):(t.remove_class("bm_no-images-layout"),r.remove_class("bm_no-images-layout"))}},u.prototype._onPrimitivesChanged=function(n){this.poiManager&&this.poiManager.setPrimitives(n)},u.prototype._canRenderPrimitives=function(n,t){var r,u;if(o._shouldDisableLoadingForRUBRegion()&&n.fromSharing&&t)for(r=0,u=t.length;r<u;r++){var i=t[r],f=i&&i.geometry&&i.geometry.y,e=i&&i.geometry&&i.geometry.x;if(f&&e&&o._shouldDisableShareForPoint(i.geometry.y,i.geometry.x))return!1}return!0},u.prototype.isReportable=function(){return!1},u.prototype.isSharable=function(){return!1},u.prototype._setMapLayerZIndex=function(n){n&&this.poiManager&&this.poiManager.setZIndex(n)},u.prototype.shouldResize=function(){return!1},u.prototype.getSupportedSize=function(){return[]},u.prototype.getSlideoutSupportedSize=function(){return[]},u.prototype._share=function(){v.invokeHandler("data-share",{action:"shareTasks",taskIds:[this.id],entryPoint:"TaskCard"})},u.prototype.getInstData=function(n){return{logData:{feature:"CD",action:"C",data:{TT:this.type,TID:this.id,MI:n}}}},u.prototype.getCardIcons=function(n){if(!this._cardIcons&&this._mapTemplateSelector){var t=this._mapTemplateSelector.getBucketForCategory(n);t&&t!=="334"&&(this._cardIcons=[this._buildCardIcon(yr.white,t),this._buildCardIcon(null,t),this._buildCardIcon(u._decayedCardIconColor,t),this._buildCardIcon(null,t)])}return this._cardIcons},u.prototype.getIconColorAndClassName=function(n){n(null,null)},u.prototype._buildCardIcon=function(n,t,i){var r,u,f;return this._mapTemplateSelector&&(u=h.isMobile?40:28,f=h.isMobile?48:36,r=o._createElement("div"),r.set_style({width:u+"px",height:f+"px","padding-top":"4px"}),this._mapTemplateSelector.getIconTemplate(function(n){var t=n&&n.icon,u=n&&n.iconColor;t&&r.append(t.renderIcon());i&&i(u)},t,!1,n,u,f)),r},u.prototype._overrideGlinkPing=function(){u._glinkPingProxy||(u._glinkPingProxy=u._glinkOverride,u._originalglinkPing=window.si_ct);window.si_ct=u._glinkPingProxy},u.prototype._onWidthChanged=function(){},u.prototype._hideInfobox=function(){var n=this._infobox;this._richInfoboxEnabled&&n&&!n.preventAutoClose?n.dispose():n&&n.getOptions().visible&&!n.preventAutoClose&&n.setOptions({visible:!1,delayTime:800})},u.prototype._getMainUrlFormCode=function(){var n=e._getUrlParam(window.location,"FORM");return n?n:null},u.prototype.close=function(){var n=this;setTimeout(function(){v.invokeHandler("data-task",{action:"removeStackForTask",id:n.id})},1e3)},u.prototype._createUrlWithMainFormCode=function(n){var t,i;return(n&&n.toLowerCase().indexOf("mcig")<0&&(t=h.dynamicProperties.mapsIG,t&&(n+="&MCIG="+t)),i=this._getMainUrlFormCode(),i&&n&&n.toLowerCase().indexOf("&form")<0)?n+"&FORM="+i:n},u._removeCardPrimerBase=function(){if(er.enablePoiPrimer){var t=n(".cardPrimer");t&&t.length>0&&!u._removeCardPrimerTimerBase&&(u._removeCardPrimerTimerBase=b.setTimeout(function(){u._removeCardPrimerTimerBase=null;!ri.showContentFirstForPermalinks||e._getUrlParam(window.location,"disablecf")==="1"?t&&t.removeFromParent():t.set_style({display:"none"})},500))}},u._glinkOverride=function(){for(var r,n,f,i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];for(n=i[0];n&&n.getAttribute;){if(f=n.getAttribute("data-ig"),f){r=_G.IG;_G.IG=f;break}n=n.parentElement}u._originalglinkPing.apply(u,i);r&&(_G.IG=r)},u.prototype._logAdsRLinkUrl=function(n){n&&sj_ajax&&sj_ajax(decodeURIComponent(n))},u.prototype._setDeserializedView=function(n){var t,f,i;if(this.poiManager){var o=window.location.href,s=e._getUrlParam(o,"cp",!0),h=e._getUrlParam(o,"lvl",!0),r=void 0,u=void 0;s&&(t=s.split("~"),t&&t.length>0&&(r=parseFloat(t[0]),u=parseFloat(t[1])));f=e.convertZoom(parseFloat(h),1);i=void 0;isNaN(r)||isNaN(u)||isNaN(f)?n&&n.mapBounds&&(i=this._map.getCameraForBounds(n.mapBounds)):i={center:[u,r],zoom:f};i&&this.poiManager.setDeserializedView(i)}},u._decayedCardIconColor="#919191",u._defaultInfoBoxOptions={anchor:"bottom-left",visible:!0},u}(at),bt=function(n){function t(t){var i=n.call(this)||this;return i._options=t,i}return f(t,n),t.prototype.getOptions=function(){return this._options},t}(wt),kt=function(n){function t(t){var i=n.call(this,t)||this;return i._privates.defineProperty("panelTitle"),i.id="autosOverflow",i._autosOverflowTaskOptions=t,i.setPanelTitle(t.title),i}return f(t,n),t.prototype.getOptions=function(){return this._autosOverflowTaskOptions},t.prototype.getCardIconInfo=function(){return{iconClass:""}},t}(bt),it=function(){function t(t,i,r){this._layouts={};this._map=t;this._taskManager=i;this._controlTemplateFactory=r;this._layoutContainer=n("[".concat("data-tasklayout","]"),t.shellContainerElement);try{this._taskLayoutData=JSON.parse(this._layoutContainer.get_attr("data-tasklayout"))}catch(f){this._taskLayoutData={}}var u=this._taskLayoutData.defaultLayout||"MultiCardLeftLayout";this.activateLayout(u)}return t.registerLayout=function(n,i){t._registeredLayouts[n]=i},t.prototype._getLayout=function(n){if(!n)return null;if(!this._layouts[n]){var i=t._registeredLayouts[n];i&&(this._layouts[n]=new i(this._controlTemplateFactory))}return this._layouts[n]},t.prototype.activateLayout=function(n){var t=this._getLayout(n);t||(t=this._getLayout("FullMapLayout"));t&&t!==this._layout&&(this._layout&&this._layout.deactivate(),this._layout=t,sj_evt&&sj_evt.fire("layoutChanged",n),t.activate(this._layoutContainer,this._taskManager,u.coreConfig,this._map,this._taskLayoutData.cardPrimerShown))},t.prototype.updateLayout=function(n){this._layout&&this._layout.update&&this._layout.update(n)},t.prototype._updateLayoutContainerBackground=function(n,t){var i="Dark",r="Light";this._layout&&this._layout.update&&this._layout.update({mapTypeId:t});switch(t){case"r":n.remove_class(i);n.add_class(r);return;case"be2":case"a":n.remove_class(r);n.add_class(i);return;default:n.remove_class(i);n.add_class(r)}},t._registeredLayouts={},t}(),ot=function(n){function t(t){var i=n.call(this,t)||this,u=i._privates;return u.defineProperty("panelTitle"),u.defineProperty("showWaitLayer"),i.id="overflow",i._shoppingOverflowTaskoptions=t,i.setPanelTitle(t.title),i._loadContent(i._getInitialLoadingUrl(),!0),i._requeryHandler=function(n){n&&i.handleShoppingPanelRequery(n)},i._expandHandler=function(n){var t=n&&n.length>1&&n[1];i.heightExpanded.invoke(t)},i.newContentAdded=new r,i.heightExpanded=new r,sj_evt.bind("shoppingPanelRequery",i._requeryHandler),i}return f(t,n),t.prototype.getOptions=function(){return this._shoppingOverflowTaskoptions},t.prototype._loadContent=function(n,t){var i=this,u,r,f,e;n.indexOf("{0}")!==-1&&(u=this._getFormCode(),n=n.replace("{0}",u));r="entrypoint=local";n.toLowerCase().indexOf(r)===-1&&(n+="&".concat(r));f=function(t){try{i.panelRoot.clear();sj_appHTML(i.panelRoot[0],t);sj_evt.unbind("shoppingPanelRequery",i._requeryHandler);sj_evt.bind("shoppingPanelRequery",i._requeryHandler);sj_evt.unbind("shopexpandopen",i._expandHandler);sj_evt.bind("shopexpandopen",i._expandHandler);sj_evt.unbind("shopexpandclose",i._expandHandler);sj_evt.bind("shopexpandclose",i._expandHandler);sj_evt.fire("onPP");i.newContentAdded.invoke();i.setShowWaitLayer(!1);n!==i._shoppingOverflowTaskoptions.currentUrl&&(i._shoppingOverflowTaskoptions.currentUrl=n,i.serializableObjectChanged.invoke({magnitude:2}));window.scrollTo(0,0)}finally{}};t||this.setShowWaitLayer(!0);e=oi.downloadGeneric(n,"shoppingLayer",f,null,function(){},null,null,vt.getLogKeyFromUrl(n))},t.prototype.makeProductsSearch=function(n){var t=this._shoppingOverflowTaskoptions.productSearchUrl,i;t&&(i=t.indexOf("{1}")===-1?this._shoppingOverflowTaskoptions.productSearchUrl.replace("&q=&","&q="+encodeURIComponent(n)+"&"):this._shoppingOverflowTaskoptions.productSearchUrl.replace("{1}",encodeURIComponent(n)),this._loadContent(i))},t.prototype.getCardIconInfo=function(){return{iconClass:""}},t.prototype.handleShoppingPanelRequery=function(n){n.length>1&&this._loadContent(n[1])},t.prototype._getFormCode=function(){switch(this._shoppingOverflowTaskoptions.entryPoint){case 0:return t._serpDetailsFormCode;case 1:return t._oneMapDetailsFormCode;default:return""}},t.prototype._getInitialLoadingUrl=function(){if(this._shoppingOverflowTaskoptions.currentUrl)return this._shoppingOverflowTaskoptions.currentUrl;if(this._shoppingOverflowTaskoptions.productRootKeyword&&this._shoppingOverflowTaskoptions.productSearchUrl){var n=this._shoppingOverflowTaskoptions.productSearchUrl.replace("{1}",encodeURIComponent(this._shoppingOverflowTaskoptions.productRootKeyword));return h.testHooksEnabled&&(n+="&bag=VP_Maps.MapsAnswer.shoppingPanel_pressureCookers"),n}return h.testHooksEnabled&&(this._shoppingOverflowTaskoptions.loadingUrl+="&bag=VP_Maps.MapsAnswer.shoppingPanel_bestBuy"),this._shoppingOverflowTaskoptions.loadingUrl},t._serpDetailsFormCode="LTPSHP",t._oneMapDetailsFormCode="MAPSHP",t}(bt),bu=function(){function u(n,t,i,u){this._suppressSerialization=!1;this._disableLocalGuideAutoActivation=!1;this._container=n;this._map=t;this.secondaryTaskAdded=new r;this.newStackListCreated=new r;this.stackAdded=new r;this.stackFocusing=new r;this.stackFocused=new r;this.stackCollapsed=new r;this.stackRemoved=new r;this.stackRemoving=new r;this.stacksReset=new r;this.deserializationCompleted=new r;this._createStackList();this._stackMap={};this._taskStackMap={};this._taskActivateQueue=[];this._hiddenTasks=[];this._index=0;this.isDeserializingTasks=!1;this._isActivatingTask=!1;this.isOverlayClosing=!1;this.serializableObjectChanged=new r;u&&u.register("TaskManager",this)}return u.prototype.getFocusedStack=function(){return this._focusedStack},u.prototype._preTaskActivationTasks=function(n,t){if(Microsoft.Maps.FeedbackTask&&n instanceof Microsoft.Maps.FeedbackTask){var i=n.getMapsFeedback();i?i.takeScreenShot().then(function(n){i.setScreenShot(n);t()}).catch(t):t()}else t()},u.prototype.activateTask=function(n,r,f,e){var o=this,s,h;if(n){if(this._isActivatingTask){this._taskActivateQueue.push({task:n,taskState:r,taskActivateOptions:f});return}if(r&&f&&f.parentId&&(r.parentTaskId=f.parentId),s=this.getStackForTask(f&&f.parentId),h=!s,this.getStackForTask(n.id)){this.focusTask(n.id,r);return}this._isActivatingTask=!0;this._preTaskActivationTasks(n,function(){var c,l,a,v,y;o._logEntryPointInstrumentationData(r);r&&r.disableHistoryPointCreation||o._newHistoryPoint();n.id=o._parseId(n.id)||o._generateId(n.type);c=o.getFocusedStack();l=t.enableTaskStackPruning&&h&&o._getListingTaskStackToBePruned();c&&c!==s&&c.displayState.activationState!==4&&c.setDisplayState({activationState:2});try{e||n.activate(o._map,r)}catch(p){a=i.logger;a&&(v={feature:"MC",action:"WRN",data:{errorMessage:"task activation exception: "+p.toString()}},a.logObject(v))}h&&(s=new rt(o._generateId("ts")),o._attachStackEvents(s),o._stacks.insert(s),o._stackMap[s.id]=s);s.addTask(n,!h&&f&&f.parentId,f===null||f===void 0?void 0:f.saveSlideoutTask);o._taskStackMap[n.id]={stack:s,task:n};y={colorIndex:f&&f.taskColorIndex?f.taskColorIndex:o._getColorIndex(s,n),groupName:f&&f.groupName?f.groupName:o._getGroupName(s,n)};s.setDisplayState(y);var w=f&&f.activationState===3,b=r&&r.entryPoint==="Permalink"&&o._getParameterByName("HideTask"),k=function(){var r,t,i;o._setFocusedStack(s);r=u.getTaskType(n.id);sj_evt.fire("focusChanged",r);o._isActivatingTask=!1;t=o._taskActivateQueue.pop();t&&o.activateTask(t.task,t.taskState,t.taskActivateOptions);w&&o.collapseStack(s,n);b&&(i=o._responsiveCardLane,i&&i.collapseCardLane());l&&o._removeStackHelper(l,!0,!0)},d=h?o.stackAdded:o.secondaryTaskAdded;d.invoke({task:n,stack:s,resume:k});o._responsiveCardLane=n.responsiveCardLane;o._logData("A",{TT:n.type,TID:n.id,SID:s.id})})}},u.prototype.manageHiddenTask=function(n){n&&(n.id=this._parseId(n.id)||this._generateId(n.type),this._taskStackMap[n.id]={stack:null,task:n})},u.prototype.focusTask=function(n,t){var r=this,i=this.getStackForTask(n),f;i&&(f=function(){var f=r.getFocusedStack(),o,s,e;f&&f.id!==i.id&&f.displayState.activationState!==4&&f.setDisplayState({activationState:2});t&&(o=i.getTask(n),o.activate(r._map,t));s=i.getForegroundTask();s.id!==n&&i.focusTask(n);f!==i&&r._setFocusedStack(i);r.stackFocused.invoke({stack:i});e=u.getTaskType(n);sj_evt.fire("focusChanged",e);r._logData("F",{TT:e,TID:n,SID:i.id})},this.stackFocusing.hasHandlersRegistered()?this.stackFocusing.invoke({stack:i,resume:f}):f())},u.prototype.toggleStack=function(n){var t,i;n&&(t=n.getForegroundTask(),this._focusedStack!==n?(o._getIsSlideCardEnabled()||(i=n.getForegroundTask()&&n.getForegroundTask().type==="LocalDetailsTask",i&&n.getAllTasks().length===2&&sj_evt.fire("HideContextualTaskbar")),this.focusTask(t.id)):this.collapseStack(n,t))},u.prototype.removeStackForTask=function(n){return this._removeStackHelper(this.getStackForTask(n))},u.prototype.removeTaskAndReseatChild=function(t){var i=this.getStackForTask(t),u;if(i)if(i.getAllTasks().length>1){if(u=i.getForegroundTask(),u.id===t){this.removeTask(t);return}if(u.type==="TrafficFlipTask"||u.type==="DirectionsFlipTask"||i!==this.getFocusedStack()){this._removeStackHelper(i);return}i.removeChildren(t,!0);i.removeAllTasks();sj_evt&&sj_evt.fire("OnTaskStackRemoved",i);u.changed=new r;this._taskStackMap[u.id]={stack:i,task:u};i.addTask(u,null);i.FirstTask=u;i.changed.invoke({sender:i,name:"FirstTask",oldValue:null,newValue:u});this._newHistoryPoint();this._stacks.changed.invoke();this._logData("A",{TT:u.type,TID:u.id,SID:i.id});u&&sj_evt&&sj_evt.fire("OnCardFocus",n(document).select("[data-subtaskid='".concat(u.id,"']")))}else this._removeStackHelper(i)},u.prototype.removeTaskStack=function(n){return this._removeStackHelper(this._getStack(n))},u.prototype.collapseStack=function(n,t){t&&n&&(n.setDisplayState({activationState:3}),this.stackCollapsed.invoke({stack:n,task:t}),this._logData("CL",{TT:u.getTaskType(t.id),TID:t.id,SID:n.id}))},u.prototype.removeAllStacks=function(n){var i,t;if(n===void 0&&(n=!0),this._stacks){for(i=[],t=0;t<this._stacks.length;t++)i.push(this._stacks[t]);for(t=0;t<i.length;t++)this._removeStackHelper(i[t],!0);n&&this._clearHistory()}},u.prototype.removeHiddenTasks=function(){var n,t;if(this._hiddenTasks)for(n=this._hiddenTasks.length-1;n>=0;n--)t=this._hiddenTasks.pop(),t.dispose()},u.prototype._raiseSerializationChanged=function(n){this._suppressSerialization||this.serializableObjectChanged.invoke(n)},u.prototype._removeStack=function(n){var r=this,t=n.getFirstTask(),i;(t===null||t===void 0?void 0:t.type)==="LocalGuideTask"&&(this._disableLocalGuideAutoActivation=!0);i=localStorage===null||localStorage===void 0?void 0:localStorage.getItem("LGPGLYT");!i||i!=="hide"||t&&t.type==="LocalGuideL2Task"||(this._disableLocalGuideAutoActivation=!0);n.removeAllTasks();this._stacks.remove(n);delete this._stackMap[n.id];!(p===null||p===void 0?void 0:p.isEnabled)||p.showLessLocalGuide||this.isOverlayClosing||this._disableLocalGuideAutoActivation||this._stacks.length===0&&this._container.instanceAsync("LocalGuideTask",function(n){r.activateTask(n,{taskTitle:n.getTitle()},{activationState:1})})},u.prototype._removeStackHelper=function(n,t,i){var u=this,e,r,f;n&&(this._suppressSerialization=t,this._newHistoryPoint(),e=n===this._focusedStack,i||this._findNewFocusedStackOnRemoval(n,!t),e&&(this._focusedStack=null),r=n.getForegroundTask(),f=function(){u._suppressSerialization=t;u._removeStack(n);u.stackRemoved.invoke({stack:n,disableFindingFocusedStack:i});u._suppressSerialization=!1;r.stackId=null},!this.stackRemoving.hasHandlersRegistered()||r.isHidden()||this.isOverlayClosing?f():this.stackRemoving.invoke({stack:n,resume:f}),this._suppressSerialization=!1,this._logData("R",{TT:r.type,TID:r.id,SID:n.id}))},u.prototype.removeTaskOrStackIfNotForeground=function(n){var t=this.getStackForTask(n);t&&t.displayState&&t.displayState.activationState!==1?this.removeTaskStack(t.id):this.removeTask(n)},u.prototype.removeTask=function(n){var u,i=this.getStackForTask(n),r=i&&i.getTask(n),f;i&&r&&(this._newHistoryPoint(),f=t.supressViewChangeForClosingSlideoutTask&&((u=i.displayState)===null||u===void 0?void 0:u.activationState)===1&&i.getAllTasks().length===2&&i.getForegroundTask()===r,this._removeTask(i,r),i.getForegroundTask()?(this.focusTask(i.getForegroundTask().id),this.updateProminences(null,null,null,f)):(this._findNewFocusedStackOnRemoval(i),this._removeStack(i),this.stackRemoved.invoke({stack:i})),this._logData("D",{TT:r.type,TID:r.id,SID:i.id}))},u.prototype._logEntryPointInstrumentationData=function(n){if(n&&!n.entryPointInstrumented&&n.mapsEntryPointState){var t={logData:{feature:"TM",action:"EntryPointInst",data:n.mapsEntryPointState},impressionGuid:h.dynamicProperties.mapsIG};v.invokeHandler("data-instrumentation",t);n.entryPointInstrumented=!0}},u.prototype._getParameterByName=function(n,t){t=t||window.location.search;n=n.replace(/[[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return!i||i.length<=2||!i[2]?"":decodeURIComponent(i[2].replace(/\+/g," "))},u.prototype._removeTask=function(n,t){t&&n.removeTask(t.id)},u.prototype._findNewFocusedStackOnRemoval=function(n,t){if(n.setDisplayState({pendingRemoval:!0},t),n===this._focusedStack){var i=this._stacks.indexOf(n);n=i<this._stacks.length-1?this._stacks[i+1]:i>0?this._stacks[i-1]:null}else this.updateProminences()},u.prototype.getStacks=function(){return this._stacks},u.prototype.getStackById=function(n){for(var i,t=0,r=this._stacks.length;t<r;t++)if(i=this._stacks[t],i.id===n)return i;return null},u.prototype.getTaskById=function(n){var t=this._taskStackMap[n];return t&&t.task},u.prototype.getTaskByType=function(n){for(var i=[],t=0,r=this._stacks.length;t<r;t++)this._stacks[t].getTasksByType(n,i);return i},u.prototype.getHiddenTaskByType=function(n){for(var i=[],t=0;t<this._hiddenTasks.length;t++)this._hiddenTasks[t].type===n&&i.push(this._hiddenTasks[t]);return i},u.prototype.getHiddenTaskById=function(n){for(var i=null,t=0;t<this._hiddenTasks.length;t++)if(this._hiddenTasks[t].id===n){i=this._hiddenTasks[t];break}return i},u.prototype.addHiddenTask=function(n){this._hiddenTasks.push(n);n.displayState||(n.displayState={});n.displayState.isHidden=!0},u.prototype.getPreviousTaskByStack=function(n){var i=this._taskStackMap[n],t,r,u;if(i)for(t=0,r=this._stacks.length;t<r;t++)if(u=this._stacks[t],u===i.stack&&t>0)return this._stacks[t-1].getForegroundTask();return null},u.getTaskType=function(n){if(!n)return null;var t=n.split(u._separator);return t&&t.length>0&&t[0]},u.prototype.serialize=function(n,t,i){var r={stacks:[]},o=0,u,s,f,e,h;if(i)for(u=0,s=this._stacks.length;u<s;u++)f=this._stacks[u],f===this._focusedStack&&(e=f.serialize(n,t),r.stacks.push(e),r.focusedStackIndex=0);else{for(u=0,s=this._stacks.length;u<s;u++)f=this._stacks[u],e=f.serialize(n,t),e?(r.stacks.push(e),f===this._focusedStack&&(r.focusedStackIndex=o),o++):f===this._focusedStack&&(r.focusedStackIndex=o>0?o-1:0);n&&(h=this._responsiveCardLane,h&&h.getIsCardlaneCollapsed()&&(r.isCardLaneCollapsed=!0),r.isFocusedStackInCollapsedState=r.stacks.length>1);p.reduceMapResizes&&(r.disableLocalGuideAutoActivation=this._disableLocalGuideAutoActivation)}return r},u.prototype.deserialize=function(i){var r=this,w=e._isMapsOverlay(),f,k,d,s,l,y;if(!w||h.dynamicProperties.mapsOverlayProcessingPermalink||this._stacks.length!==0){if(f=i||{},w&&!f.stacks){this.isOverlayClosing=!0;this.removeAllStacks();return}var b=this._stackMap,a=this._taskStackMap,c=[];this._stackMap={};k=this._stackMap;this._taskStackMap={};d=this._taskStackMap;s=0;this.isDeserializingTasks=!0;var g=function(n,t,i,u){var o;n.id=u.id;var f=u.state,s=n.serialize(),h=JSON.stringify(s)!==JSON.stringify(f);f.mapBounds=e.convertMapBoundsOrder(f.mapBounds,1);h&&(r._logEntryPointInstrumentationData(f),n.activate(r._map,f,null,u.ds,!0));t.setTaskAt(n,i);d[n.id]={stack:t,task:n};rt.setTaskDisplayState(n,u.ds||{});o=t.displayState;typeof t.displayState.colorIndex!="number"&&(o={colorIndex:r._getColorIndex(t,n,c),groupName:r._getGroupName(t,n)});t.setDisplayState(o)},nt=function(n,t){return t&&t.state?o._overrideTasktypeBasedOnCategory(n,t.state):n},v=function(){for(var n,t,e,o,i=0,u=Object.keys(a);i<u.length;i++){var s=u[i],h=a[s],l=h.task;l.deactivate()}for(n=0;n<c.length;n++)t=c[n],t.setForegroundTask(),r._attachStackEvents(t),t.displayState.prominence||n===f.focusedStackIndex||r.updateProminences(null,t,c);r._createStackList(c);e=f.focusedStackIndex?f.focusedStackIndex:0;o=r._stacks.length&&r._stacks[e]||null;e!==0&&r._stacks.length&&r._stacks[0].setDisplayState({activationState:2});r._setFocusedStack(o);f.isFocusedStackInCollapsedState&&o.setDisplayState({activationState:3});r.stacksReset.invoke();r.isDeserializingTasks=!1;p.reduceMapResizes&&(r._disableLocalGuideAutoActivation=f.disableLocalGuideAutoActivation);r.deserializationCompleted.invoke()},tt=function(n,t,i){var e=i.id=r._parseId(i.id),h=i.type,c=a[e],o,f;if(delete a[e],c&&(o=c.task),o)g(o,n,t,i);else{if(f=u.getTaskType(e),!f)if(h)f=h+"Task",i.id=r._generateId(f);else return;f=nt(f,i);s++;var y=function(r){g(r,n,t,i);s--;s||v()},p=function(){s--;s||v()},l=function(){r._container.instanceAsync(f,y,undefined,undefined,p)};f==="LocalGuideTask"||f==="LocalGuideL2Task"||f==="TrafficTask"?r._map.getAzureMap().mapFirstIdle.then(l):l()}},it=function(n){var f=n.id=r._parseId(n.id)||r._generateId("ts"),t=b[f],u,i,e;if(delete b[f],t&&t.dispose(),t=new rt,t.deserialize(n),t.setDisplayState(n.ds),u=n.tasks,u)for(i=0;i<u.length;i++)e=u[i],tt(t,i,e);c.push(t);k[f]=t};t.showLoadingSkeleton&&this._addSkeletonMarkerIfListAndDetails(f);f&&f.stacks&&f.stacks.length>0&&f.focusedStackIndex<f.stacks.length&&(l=f.stacks[f.focusedStackIndex],l&&l.tasks&&l.tasks.length>0&&l.tasks[l.tasks.length-1].type!=="LocalGuideTask"&&(y=n(".nonajaxLGCardPrimer"),y&&y.removeFromParent()));f.stacks&&f.stacks.forEach(it);s||v()}},u.prototype._attachStackEvents=function(n){var t=this,i=function(n){for(var i,r=0,u=n;r<u.length;r++){if(i=u[r],i.isSavedSlideoutTask)return;rt.setTaskDisplayState(i,{activationState:2,pendingRemoval:!0});delete t._taskStackMap[i.id];i.deactivate()}};n.tasksRemoved.add(i);n.serializableObjectChanged.add(function(n){t._raiseSerializationChanged(n)})},u.prototype._addSkeletonMarkerIfListAndDetails=function(t){var i,r;t&&t.stacks&&t.stacks.length>0&&t.focusedStackIndex<t.stacks.length&&(i=t.stacks[t.focusedStackIndex],i&&i.tasks&&i.tasks.length>1&&(r=n(".bm_loadSkeleton.taskLayoutSkeletonContainer.bm_l2NavLeft .bm_skCombinedWrapper"),r.has_class("bm_skSlideCard")||r.add_class("bm_skSlideCard")))},u.prototype._createStackList=function(n){var t=this;this._stacks=new si(n);this._stacks.changed.add(function(){t._raiseSerializationChanged()});this.newStackListCreated.invoke()},u.prototype._generateId=function(n){if(!n||n.indexOf(u._separator)>=0)throw new Error("Invalid type");var t=this._index++;return n+u._separator+t.toString()},u.prototype._newHistoryPoint=function(){this._raiseSerializationChanged({magnitude:2})},u.prototype._clearHistory=function(){this._raiseSerializationChanged({magnitude:2,clearHistory:!0})},u.prototype._parseId=function(n){if(n&&n.indexOf(u._separator)>-1){var t=n.split(u._separator);return t&&t.length===2&&(this._index=Math.max(~~t[1]+1,this._index)),n}return null},u.prototype._getStack=function(n){for(var i,r=this._stacks,t=0,u=r.length;t<u;t++)if(i=r[t],i.id===n)return i;return null},u.prototype.getStackForTask=function(n){var t=n&&this._taskStackMap[n];return t&&t.stack},u.prototype._setFocusedStack=function(t){var u,i,r;t||(u=this._focusedStack);this._focusedStack=t;t&&((p===null||p===void 0?void 0:p.isSlideCardEnabled)&&(i=t.getFirstTask(),r=n(".taskLayoutContainer"),i&&i.type==="LocalGuideTask"?r.add_class("bm_localGuide"):r.remove_class("bm_localGuide")),t.setDisplayState({activationState:1}));this.updateProminences(u)},u.prototype.updateProminences=function(n,i,r,u){function c(n,i,r,u){if(u===void 0&&(u=!1),n.displayState.activationState===4)n.setDisplayState({prominence:3});else if(n.displayState.groupName===(i===null||i===void 0?void 0:i.displayState.groupName)&&!n.displayState.pendingRemoval){var f=r;t.disableSecPromListPois&&u&&n.getAllTasks()[0].type===l&&i.getAllTasks()[0].type===l&&f++;n.setDisplayState({prominence:f});r++}return r}var l="LocalListingTask",o=i?i:this.getFocusedStack(),e;if(o&&o.displayState.activationState!==4){var h=r?r:this._stacks,a=h.indexOf(o),f=void 0,v=void 0,s=void 0;for(o.setDisplayState({activationState:1,prominence:1,suppressViewChange:u}),e=!0,f=a-1,s=2;f>=0;f--)s=c(h[f],o,s,e),e&&(e=!1);for(e=!0,f=a+1,v=h.length,s=2;f<v;f++)s=c(h[f],o,s,e),e&&(e=!1)}else n&&c(n,null,null)},u.prototype.IsLocalGuideAutoActivationDisabled=function(){return this._disableLocalGuideAutoActivation},u.prototype._getColorIndex=function(n,t,i){var r=this;return this._getDisplayProperty(n,t,"colorIndex",function(){for(var f,n,e=t.displayState.groupName?3:1,o=t.displayState.groupName?t.displayState.groupName:"Default",u=i?0:r._stacks.length-1;i?u<i.length:u>=0;i?u++:u--)if(f=i?i[u]:r._stacks[u],n=f.displayState.colorIndex,n>=1&&n<=3&&f.displayState.groupName===o){e=o==="Default"?n<3?n+1:1:n>1?n-1:3;break}return e})},u.prototype._getDisplayProperty=function(n,t,i,r){var f=n.displayState[i],u=t&&t.displayState&&t.displayState[i];return f===undefined&&((u===null||u===undefined)&&(u=r()),f=u),f},u.prototype._getGroupName=function(n,t){return this._getDisplayProperty(n,t,"groupName",function(){return"Default"})},u.prototype._logData=function(n,t){var i={logData:{feature:"TM",action:n,data:t},isMapsAction:n==="A",impressionGuid:h.dynamicProperties.mapsIG};v.invokeHandler("data-instrumentation",i)},u.prototype._getListingTaskStackToBePruned=function(){for(var r,n,t,i=0;i<this._stacks.length;i++)if((r=this._stacks[i],n=r.getForegroundTask(),!(n.displayState.stackOrder>1)&&!n.displayState.suppressPruning)&&((t=Microsoft===null||Microsoft===void 0?void 0:Microsoft.Maps)===null||t===void 0?void 0:t.Local)&&n instanceof Microsoft.Maps.Local.LocalListingTask)return r;return null},u._separator="$$",u}(),st;(function(n){function t(n){var t;return n&&(n.cardTitleHoveringState===1?t=8900:n.activationState===1?t=8700:n.prominence===1?t=8500:n.prominence===2?t=8300:n.prominence===3&&(t=8100),n.stackOrder&&t&&(t+=n.stackOrder)),t}n.getZOrderOfTaskPrimitives=t})(st||(st={}));rt=function(t){function i(n){var i=t.call(this)||this,u;return i.id=n,i.displayState={},i._handlers={},i.serializableObjectChanged=new r,i.tasksRemoved=new r,i.taskAdded=new r,i.overflowTaskAdded=new r,i.stackSelected=new r,i.onHiddenStateChanged=new r,i._tasks=[],i.flipAnimationCompleted=new r,u=i._privates,u.defineProperty("foregroundTask",function(){i.serializableObjectChanged.invoke()},null,{isPrivate:!0,defaultValue:null}),u.defineProperty("isSelected",function(n,t){n!==null&&n!==undefined&&i.stackSelected.invoke({stack:i,isSelected:t})}),u.defineProperty("isLocked",null,null,{defaultValue:!1}),u.defineProperty("overflowTask",function(n,t){i._overflowTaskChanged(n,t)}),i}return f(i,t),i.prototype.addTask=function(n,t,i){var r,u;if(!n)throw new Error("Invalid task passed to TaskStack.addTask");if(this._getTaskIndex(n.id)>=0)throw new Error("Attempt to add task to stack that already contains it");if(r=0,t){if(u=this._getTaskIndex(t),u<0)throw new Error("Invalid parentId passed to TaskStack.addTask");r=u+1;i&&(this._savedSlideoutTask=this._tasks[r],this._tasks[r].isSavedSlideoutTask=!0,this._tasks[r].setDisplayState({activationState:2}))}this._pruneStack(r);this.setTaskAt(n,r);this.setForegroundTask();this.taskAdded.invoke(n)},i.prototype.dispose=function(){t.prototype.dispose.call(this);this._pruneStack(0,!0)},i.prototype.focusTask=function(n){var t,i=this._getTaskIndex(n);i>=0?(this._pruneStack(i+1),this.setForegroundTask()):n===((t=this._savedSlideoutTask)===null||t===void 0?void 0:t.id)&&(this._savedSlideoutTask.isSavedSlideoutTask=!1,this._savedSlideoutTask.setDisplayState({activationState:1}),this._pruneStack(1),this.setTaskAt(this._savedSlideoutTask,1),this.setForegroundTask(),this._savedSlideoutTask=null)},i.prototype.getTask=function(n){var t=this._getTaskIndex(n);return t>=0?this._tasks[t]:null},i.prototype.getAllTasks=function(){return this._tasks},i.prototype.removeAllTasks=function(){this._pruneStack(0);this.setForegroundTask()},i.prototype.removeTask=function(n){var t=this._getTaskIndex(n);this._savedSlideoutTask&&t===1&&n!==this._savedSlideoutTask.id&&(this._savedSlideoutTask.deactivate(),this._savedSlideoutTask=null);t>=0&&(this._pruneStack(t),this.setForegroundTask())},i.prototype.removeChildren=function(n,t){var i=this._getTaskIndex(n);i>=0&&this._pruneStack(i+1,t)},i.prototype.setForegroundTask=function(){var n=this._tasks.length>0?this._tasks[this._tasks.length-1]:null,t=n&&n;t&&this._tasks.length>1&&(n.type==="FeedbackTask"||t.getCurrentWidth&&t.getCurrentWidth()===944)&&this._adjustLeftRail(this._tasks.length===3);this._privates.setForegroundTask(n)},i.prototype.setTaskAt=function(n,t){var r=this;this._addSerializationHandlers(n);this._tasks[t]=n;n.stackId=this.id;n instanceof wt&&n.launchOverflowTask.add(function(n){r._createOverflowTask(n)});i.setTaskDisplayState(n,{stackOrder:t+1})},i.prototype.getTasksByType=function(n,t){this._tasks.forEach(function(i){i&&i.type===n&&t.push(i)})},i.prototype.getFirstTask=function(){var n,t;return this._tasks.length!==0?(n=this._tasks.length-1,n>0)?(t=this._tasks[n],t.noSlideout?t:this._tasks[n-1]):this._tasks[0]:null},i.prototype.setDisplayState=function(n,t){var u,r;for(t===void 0&&(t=!0),typeof n.isHidden!="undefined"&&n.isHidden!==this.displayState.isHidden&&this.onHiddenStateChanged.invoke(n.isHidden),this.displayState=l(l({},this.displayState),n),u=n.activationState===1,u&&(n.activationState=2,n.suppressViewChange=!0),r=0;r<this._tasks.length;r++){if(u&&r===this._tasks.length-1){n.activationState=1;n.suppressViewChange=this.displayState.suppressViewChange;i.setTaskDisplayState(this._tasks[r],n,t);break}i.setTaskDisplayState(this._tasks[r],n,t)}t&&this.serializableObjectChanged.invoke({magnitude:0})},i.setTaskDisplayState=function(n,t,i){return i===void 0&&(i=!0),n&&n.setDisplayState&&n.setDisplayState(t,i),!!n},i.prototype.serialize=function(n,t){function e(i,r){var f=!1;return i&&(!r||r&&i.isSharable())&&(u.tasks.push({id:i.id,ds:i.displayState,type:i.type.replace("Task",""),state:i.serialize(n,t)}),f=!0),f}var i=!1,u={id:this.id,ds:this.displayState,tasks:[]},r,f;if(t&&t===2)this._tasks&&this._tasks.length>0&&(i=i||e(this._tasks[this._tasks.length-1],!0));else{for(r=0;r<this._tasks.length;r++)e(this._tasks[r],!1);i=!0}return f=this.getOverflowTask(),f&&(u.overflowTaskOptions=f.getOptions()),i?u:null},i.prototype.deserialize=function(n){if(this.id&&this.id!==n.id)throw new Error("Attempt to deserialize into incorrect task stack");n.overflowTaskOptions&&this._createOverflowTask(n.overflowTaskOptions);this.id=n.id},i.prototype._addSerializationHandlers=function(n){var t=this;n&&!this._handlers[n.id]&&n.serializableObjectChanged&&(this._handlers[n.id]=n.serializableObjectChanged.add(function(n){t.serializableObjectChanged.invoke(n)}))},i.prototype._removeSerializationHandlers=function(n){var t=n&&this._handlers[n.id];t&&(t.dispose(),delete this._handlers[n.id])},i.prototype._getTaskIndex=function(n){for(var i=-1,t=0,r=this._tasks.length;t<r;t++)if(this._tasks[t].id===n){i=t;break}return i},i.prototype._pruneStack=function(n,t){var u=this,i,r;n>=0&&n<this._tasks.length&&(i=this._tasks.splice(n),i.forEach(function(n){u._removeSerializationHandlers(n)}),t||this.tasksRemoved.invoke(i),r=this.getOverflowTask(),n>0&&r&&(r.deactivate(),this.setOverflowTask(null)))},i.prototype._overflowTaskChanged=function(n,t){this.overflowTaskAdded.invoke(t);!t&&n&&this._removeSerializationHandlers(n)},i.prototype._createOverflowTask=function(n){var t=null;n.taskType===0?t=new ot(n):n.taskType===1&&(t=new kt(n));this.setOverflowTask(t);this._addSerializationHandlers(t)},i.prototype._adjustLeftRail=function(t){var e=t?this._tasks[1]:this._tasks[0],u,i,o,f,r;if(e.getCurrentWidth&&(u=e.getCurrentWidth(),i=n("div[data-subtaskid="+this._tasks[0].id+"]"),i.length>0)){if(this._tasks.length>1)for(o=i.getParent().getParent(),f=o[0].children,r=0;r<f.length;r++)n(f[r]).set_style({width:u+"px"});i.getParent().set_style({width:u+"px"})}},i}(at);nt=function(i){function u(n,t){var u=i.call(this)||this,f=u._privates,e;return f.defineProperty("cssClass"),f.defineProperty("closeIconClass"),f.defineProperty("task",function(n,t){u._onTaskChanged(n,t)}),f.defineProperty("stack",function(n,t){u._onStackChanged(n,t)}),f.defineProperty("dataTaskId"),f.defineProperty("cardTitle"),f.defineProperty("titleBarRole",null,null,{defaultValue:"button"}),f.defineProperty("isListCard"),f.defineProperty("isDetailsCard"),f.defineProperty("layoutMetrics"),u._emptyCardContent=document.createElement("div"),u.setIsListCard(!0),u.setIsDetailsCard(!1),u.setCloseIconClass("bm_cardClose"),u.click=new r,u.titleMouseEnter=new r,u.titleMouseLeave=new r,u.rendered.add(function(){u._onRendered()}),n||(n=yu),e={resources:g,stringToDisplay:function(n){return n?"block":"none"},boolToDisplay:function(n){return n?"":"none"},closeTaskById:function(n){return JSON.stringify({id:n,action:"removeTaskAndReseatChild"})},onTitleBarClick:function(n){u._onTitleBarClick(n)},onTitleMouseEnter:function(n){u.titleMouseEnter.invoke(n)},onTitleMouseLeave:function(n){u.titleMouseLeave.invoke(n)},getWidthString:function(n){return n?n+"px":""},getCloseCardIconClass:function(n){return n!=="bm_cardClose"?n+" bm_cardClose":"bm_cardClose"}},t&&(e=l(l({},e),t)),u.setTemplate(new a(n,e)),u}return f(u,i),u.prototype._onRendered=function(){c.setFocusToTitle(this.getStack(),n(this.getRootElement()));var t=this.getTask();this._setTaskTitleState(t)},u.prototype.getCardContent=function(){if(this.getTask()){var n=this.getLayoutMetrics();return this.getTask().getContent(n)}return this._emptyCardContent},u.prototype._getCardClass=function(t){var i,r;return t?(i=c._replaceCardClass(t.id,n(this.getRootElement()),""),t&&t.displayState&&(r=t.displayState.prominence,i+=r===1||typeof r=="undefined"?" focus":" collapsed hidden"),i):undefined},u.prototype._getCardTitle=function(){return n(".front .".concat("cardTitleText"),this.getRootElement())},u.changeStackFocusState=function(t,i){if(t&&(t.getIsLocked()||t.getIsSelected())&&(i=1),t){var u=n('[data-taskid="'.concat(t.id,'"]')),r=u.select(".titleBar");i===1?r.add_class("unfocused"):r.remove_class("unfocused")}},u.prototype._onTaskChanged=function(i,r){var f=this,e,h,s;i&&!r&&(h=i.getCurrentWidth()||t.defaultCardWidth,sj_evt.fire("TaskCardRemoving",h));this._setDataTaskId();i&&r&&i.type==="LocalListingTask"?o._getIsSlideCardEnabled()||r.type!=="LocalDetailsTask"||sj_evt&&sj_evt.fire("HideContextualTaskbar"):i&&r&&r.type==="LocalListingTask"&&sj_evt&&sj_evt.fire("ShowContextualTaskbar");r&&(this._taskContentsChanged&&this._taskContentsChanged.dispose(),this.disposables.push(this._taskContentsChanged=r.changed.add(function(n){var i=n&&n.name,t;i==="title"?f.setCardTitle(r.getTitle()):i==="displayState"&&n.newValue&&n.newValue.prominence&&(f.setCssClass(f._getCardClass(f.getStack())),t=n.newValue.prominence,t===1?u.changeStackFocusState(f.getStack(),0):t!==2&&u.changeStackFocusState(f.getStack(),3))})),this.setCardTitle(r.getTitle()),this.setTitleBarRole(n(this.getRootElement()).get_ancestor(2).has_class("slidecard")?"":"button"),this._setTaskTitleState(r),s=(e=r.getCardIconInfo())===null||e===void 0?void 0:e.closeIconClass,s&&this.setCloseIconClass(s))},u.prototype._onStackChanged=function(n,t){this._setDataTaskId();this.setCssClass(this._getCardClass(t))},u.prototype._setDataTaskId=function(){var n=this.getTask(),t=this.getStack();this.setDataTaskId(n&&n.id&&t&&t.id)},u.prototype._onTitleBarClick=function(n){n.preventDefault()},u.prototype._setTaskTitleState=function(t){var r,u,f,i;t&&t.id&&t.id.length>0&&(r=t.id,t.type==="ItineraryDetailsTask"?(this.setIsDetailsCard(!0),this.setIsListCard(!1),u=t,o.itineraryCloseButtonHandler(u,r)):r.indexOf("Detail")>-1||t.type==="TransitLineTask"?(this.setIsDetailsCard(!0),this.setIsListCard(!1)):t.type==="FeedbackTask"?(f=n("div[data-subtaskid="+r+"]"),i=n(".feedbackBackButton",f[0]),i.length>0&&i.get_style("display").indexOf("none")>-1?(this.setIsDetailsCard(!0),this.setIsListCard(!1)):i.length>0&&i.get_style("display").indexOf("none")===-1?(this.setIsDetailsCard(!1),this.setIsListCard(!1)):(this.setIsDetailsCard(!1),this.setIsListCard(!0))):(this.setIsDetailsCard(!1),this.setIsListCard(!0)))},u}(tt);a.registerControl("SingleTaskCard",nt);ai=function(n){function t(){var t=n.call(this,eu,{onCloseOverflowClick:function(n){t._onCloseOverflowClick(n)},onProductSearchClick:function(n){t._onSearchClick(n)},onSearchKeyPressed:function(n){t._onSearchKeyPressed(n)},isAutosTask:function(n){return n&&n instanceof kt?"":"none"}})||this,i;return t._autosPanelClickLogged=!1,i=t._privates,i.defineProperty("autosUrl"),i.defineProperty("searchText"),t}return f(t,n),t.prototype._onTaskChanged=function(t,i){if(n.prototype._onTaskChanged.call(this,t,i),this.setSearchText(""),i instanceof kt){var r=i.getOptions();r&&(this._setLoadingUrl(r),this._logInstEventsForAutoPanel())}},t.prototype._onCloseOverflowClick=function(n){var t,i;n&&(n.preventDefault(),n.stopPropagation(),t=this.getStack(),t&&(this._logAction("CLS"),i=t.getOverflowTask(),i&&i.deactivate(),this.setSearchText(""),t.setOverflowTask(null),t.serializableObjectChanged.invoke()))},t.prototype._onSearchClick=function(n){n.preventDefault();n.stopPropagation();this._initiateShoppingSearch()},t.prototype._onSearchKeyPressed=function(n){var t=n.keyCode;t&&t===13&&this._initiateShoppingSearch()},t.prototype._initiateShoppingSearch=function(){var t=this.getSearchText(),i,n,r;t&&(i=this.getTask(),n=i.getOptions(),n&&n.queryTemplateUrl&&(r=n.queryTemplateUrl.replace("{0}",encodeURIComponent(t))+"&FORM=BLMCLS",this._setAutosUrlInternal(r)),this._logAction("SRCH"))},t.prototype._logAction=function(n){var i=this.getTask(),t=i.getOptions(),r={logData:{feature:"AUTOS",action:n},impressionGuid:t&&t.impressionGuid};v.invokeHandler("data-instrumentation",r)},t.prototype._setLoadingUrl=function(n){if(n){var i=n.formCode||"BLSTBV",t=null;n.productRootKeyword&&n.queryTemplateUrl?(t=n.queryTemplateUrl.replace("{0}",encodeURIComponent(n.productRootKeyword)),i="BLMCLS"):n.redirectUrl&&(t=n.redirectUrl);t&&this._setAutosUrlInternal(t+"&FORM="+i)}},t.prototype._logInstEventsForAutoPanel=function(){var n=this,i=_d.getElementById("autoDealersIFrame"),t;i&&(this._logAction("AutosPanelShown"),this._autosPanelClickLogged=!1,t=function(t){for(var r=["bing.com","msn.com"],u=t&&t.origin,i=0;i<r.length;i++)if(u&&u.indexOf(r[i])>=0&&t&&t.data&&t.data.toLocaleLowerCase&&t.data.toLocaleLowerCase()==="autos panel clicked"&&!n._autosPanelClickLogged){n._logAction("AutosPanelClicked");n._autosPanelClickLogged=!0;break}},window.addEventListener("message",function(n){t(n)}))},t.prototype._setAutosUrlInternal=function(n){this.setAutosUrl(n+"&wcp=true")},t}(nt);a.registerControl("AutosTaskContainer",ai);vi=function(t){function r(){var n=t.call(this)||this,i=n._privates;return i.defineProperty("filters",function(){n._onFiltersChange()}),i.defineProperty("task",function(){n.setIsExpanded(!1);n.setSelectedCount(0)}),i.defineProperty("width",function(t,i){n._widthChanged(t,i)}),i.defineProperty("isExpanded"),i.defineProperty("selectedCount"),n._resetFilterHandler=function(){n._setFilterDisplayClasses()},n._scrollHandler=function(t){t&&n.getIsExpanded()&&n.onExpandoClick(null)},sj_evt.bind("resetFilterDisplay",n._resetFilterHandler),sj_evt.bind("customScrolled",n._scrollHandler),sj_evt.bind("nonCustomScrolled",n._scrollHandler),n}return f(r,t),r.prototype.dispose=function(){sj_evt.unbind("resetFilterDisplay",this._resetFilterHandler);sj_evt.unbind("customScrolled",this._scrollHandler);t.prototype.dispose.call(this)},r.prototype.getFilterContent=function(){var n=this.getFilters();return n&&n.length?n[0]:document.createElement("div")},r.prototype.onExpandoClick=function(){var t=n(this.getRootElement()),r=t.select(".filterTabBar"),i=r&&r.length?r:t.select(".bm_filterBar"),u=t.select(".bm_filterExpando");this.getIsExpanded()?(t.remove_class("expanded"),u.set_style({order:this._expandoOrder}),this._setSelectedFilterCount()&&this._checkForHiddenExpando(u,i[0],t[0],i[0].children)):(t.add_class("expanded"),i.length>0&&u.set_style({order:i[0].childElementCount}));this.setIsExpanded(!this.getIsExpanded())},r.prototype.onExpandoKeydown=function(n){if(n.which===13)this.onExpandoClick(n)},r.prototype.zeroToDisplayNone=function(n){return n>0?"inline-block":"none"},r.prototype.noFiltersToDisplayNone=function(n){return!n||n.length===0?"none":""},r.prototype.getAreaClass=function(n){return"bm_filterArea"+(n instanceof i.Local.HouseListingTask?" advanceFilters":"")},r.prototype._setSelectedFilterCount=function(){var e=n(".bm_filterBar",this.getRootElement()),r,t,i,u,f,o;if(e.length===0)return!1;for(r=e[0].children,t=0,i=0;i<r.length;i++)(u=r[i],parseInt(u.style.order)<this._expandoOrder)||(f=n(u),(f.has_class("bm_filterSelected")||f.select(".adv_clicked").length>0)&&t++);return o=this.getSelectedCount(),this.setSelectedCount(t),o===0&&t>0},r.prototype._onFiltersChange=function(){this.setTemplate(new a(su,this));this._filtersClassesSet=!1;var n=this.getTask();n&&n.type==="LocalListingTask"&&n.registerFilters.invoke()},r.prototype._setFilterDisplayClasses=function(t){var o=this.getTask(),c=NaN,e,h,v,u;o&&o.type==="LocalListingTask"&&(c=this._computeRowCount(o));var i=n(this.getRootElement()),s=i.select(".filterTabBar"),r=s&&s.length?s:i.select(".bm_filterBar");if(i.length>0&&r.length>0&&i[0].clientHeight>0&&i[0].clientHeight<r[0].clientHeight&&!this._filtersClassesSet){var f=r[0].children,l=0,a=0;for(e=0;e<f.length;e++)if(h=f[e],h.offsetTop>a&&(l++,a=h.offsetTop,l>c)){this._expandoOrder=e;break}this._setFiltersOrders(f);v=r.select(".bm_filterExpando");t||v.removeFromParent();u=i.select(".bm_filterExpando");u.add_class("visible");u.removeFromParent();r.append(u);u.set_style({order:this._expandoOrder});this._checkForHiddenExpando(u,r[0],i[0],f);this.getIsExpanded()?(n(this.getRootElement()).add_class("expanded"),u.set_style({order:r[0].childElementCount})):this._setSelectedFilterCount()&&this._checkForHiddenExpando(u,r[0],i[0],f);this._filtersClassesSet=!0}else this.setSelectedCount(0)},r.prototype._checkForHiddenExpando=function(n,t,i,r){n.length>0&&n[0].offsetTop-t.offsetTop>i.offsetHeight-16&&(this._expandoOrder-=1,n.set_style({order:this._expandoOrder}),this._setFiltersOrders(r))},r.prototype._setFiltersOrders=function(t){for(var i=0;i<t.length;i++)t[i].className.indexOf("bm_filterExpando")===-1&&n(t[i]).set_style({order:i+(i>=this._expandoOrder?1:0)})},r.prototype._computeRowCount=function(t){var u=t.viewModel.getResponseContainer(),f=u.select("div.bm_2col").length>0||u.select("div.bm_cardWidth_360").length>0||u.select("div.bm_cardWidth_416").length>0,r=n(this.getRootElement());return(r.remove_class("twoRows"),r.remove_class("threeRows"),this._isSingleColumn()&&t instanceof i.Local.HotelsListingTask)?(r.add_class("threeRows"),3):f||t instanceof i.Local.HotelsListingTask?(r.add_class("twoRows"),2):1},r.prototype._widthChanged=function(t,i){if(i&&t&&t!==i){this._filtersClassesSet=!1;var r=n(this.getRootElement()),u=r.select(".bm_filterExpando");u.remove_class("visible");u.removeFromParent();r.append(u);this.setIsExpanded(!1);r.remove_class("expanded");i<=240?r.add_class("singleCol"):r.remove_class("singleCol");this._setFilterDisplayClasses(!0)}},r.prototype._isSingleColumn=function(){var t=n(this.getRootElement());return t.has_class("singleCol")},r}(tt);a.registerControl("FiltersControl",vi);yi=function(n){function t(){var t=n.call(this)||this,i=t._privates;return i.defineProperty("stack"),i.defineProperty("overflowTask",function(n,i){t._onOverflowTaskChanged(n,i)}),i.defineProperty("layoutMetrics"),i.defineProperty("className"),i.defineProperty("showWoWIframe"),t.setTemplate(new a(lu,t)),t.setShowWoWIframe(!1),t._isNpsSurveyClosed=!1,t._subscribeToWoWIframe(),t}return f(t,n),t.prototype.taskExistsToDisplay=function(n){return n?"":"none"},t.prototype.taskExistsToWoWDisplay=function(n){return h.features.taskFramework.showWoW?this.taskExistsToDisplay(n):"none"},t.prototype.taskExistsToWoWRequestUrl=function(n){return h.features.taskFramework.showWoW?n?this._formatWoWRequestUrl():"about:blank":"about:blank"},t.prototype._formatWoWRequestUrl=function(){var t=h.features.taskFramework.woWRequestUrl,n=h.dynamicProperties;return t.replace("{lang}",n.uiLanguage).replace("{ig}",n.impressionGuid).replace("{isAAD}",n.isAADAuthenticated?"true":"false").replace("{cid}",n.clientId)},t.prototype._subscribeToWoWIframe=function(){var n=this,t=function(t){t.origin.indexOf("services.bingapis.com")>=0&&t.data.closeNPSSurvey&&(n._isNpsSurveyClosed=!0,n.setShowWoWIframe(!1))};window.addEventListener("message",function(n){t(n)},!1)},t.prototype._onOverflowTaskChanged=function(n,t){h.features.taskFramework.showWoW&&this.setShowWoWIframe(!this._isNpsSurveyClosed&&!!t)},t}(ci);a.registerControl("OverflowCard",yi);pi=function(n){function t(){var t=n.call(this)||this;return t._privates.defineProperty("promptText"),t}return f(t,n),t}(ci);wi=function(u){function s(){var n=u.call(this)||this,t=n._privates;return t.defineProperty("isHidden"),t.defineProperty("isSlideoutLane",function(t,i){n._onSetSlideout(i)}),t.defineProperty("isSlideoutCollapsed"),t.defineProperty("isCardlaneCollapsed"),t.defineProperty("showExpandButton"),t.defineProperty("useMapPeek"),t.defineProperty("laneWidth",function(t,i){n._onLaneWidthChanged(t,i)}),t.defineProperty("originalWidth"),t.defineProperty("leftLaneTask",function(t,i){n._onLeftLaneTaskChanged(t,i)}),t.defineProperty("slideoutTask",function(t,i){n._onSlideoutTaskChanged(t,i)}),t.defineProperty("map",function(t,i){n._onSetMap(i)}),n.resources=g,n.setLaneWidth(0),n.toggleCardLane=new r,n.setTemplate(new a(au,n)),n._resizeHandler=function(){n._determineResize()},n._detailsFromListHandler=function(){n._updateDetailsWidth()},sj_evt.bind("ResultsOverlayActivating",function(){s._updateOverlayLoadedOnNextLeftLaneTaskChange=!0}),sj_evt.bind("LargeMapHidden",function(){s._overlayLoaded=!1;s._updateOverlayLoadedOnNextLeftLaneTaskChange=!1}),n}return f(s,u),s.prototype.hideLeftLane=function(n){return n?"none":""},s.prototype.displayExpandCollapse=function(n){return n&&this.getIsSlideoutLane()||!n&&!this.getIsSlideoutLane()?"":"none"},s.prototype.toggleShowClick=function(n){var u=this,r,i,t;n.stopPropagation();n.preventDefault();s._wideCardTipCurrentlyShowing&&s._tip.removeTip();this.getIsSlideoutCollapsed()&&!this.getIsCardlaneCollapsed()?(this.setIsSlideoutCollapsed(!1),this.setLaneWidth(this.getOriginalWidth()),s._userPrefersNarrow=!1,i=this.getSlideoutTask(),i?(this._afterResized(!0),i.resizeCard.invoke(),i.toggleCompleted.invoke("EXP")):(this._afterResized(!1),this.getLeftLaneTask().resizeCard.invoke(),this.getLeftLaneTask().toggleCompleted.invoke("EXP"))):(r=this.getLeftLaneTask(),r&&r.toggleCompleted.invoke("EXP"),i=this.getSlideoutTask(),i&&i.toggleCompleted.invoke("EXP"),r&&r.getRecommendedWidth()===944&&r.getCurrentWidth()===464&&!this.getIsCardlaneCollapsed()?(this.setLaneWidth(944),r.setCurrentWidth(944),this._afterResized(!1),this.setShowExpandButton(!1)):this.toggleCardLane.invoke(),this.setIsCardlaneCollapsed(!1));t=this.getSlideoutTask();t?t.resizeCompleted.addOne(function(){return u._updateMapView(t)}):(t=this.getLeftLaneTask(),(t.getRecommendedWidth()!==t.getCurrentWidth()||t.getCurrentWidth()===944)&&t.resizeCompleted.addOne(function(){return u._updateMapView(t)}));this.setShowExpandButton(this._enableExpandButton(t))},s.prototype.toggleHideClick=function(n){var u=this,r,i,t;n&&n.stopPropagation();n&&n.preventDefault();(s._collapseTipShown||this.getLaneWidth()>=944)&&typeof s._updateMapViewInvoked=="undefined"&&(s._updateMapViewInvoked=0);s._wideCardTipCurrentlyShowing&&s._tip.removeTip();this.getLaneWidth()>=944?(this.setIsSlideoutCollapsed(!0),this.setLaneWidth(464),i=this.getSlideoutTask(),this._afterResized(typeof i!="undefined"&&i!==null),s._userPrefersNarrow=!0,r=this.getLeftLaneTask(),r&&r.toggleCompleted.invoke("CLP"),i&&i.toggleCompleted.invoke("CLP")):(r=this.getLeftLaneTask(),r&&r.toggleCompleted.invoke("CLP"),i=this.getSlideoutTask(),i&&i.toggleCompleted.invoke("CLP"),this.toggleCardLane.invoke(),this.setIsCardlaneCollapsed(!0));t=this.getSlideoutTask();t?t.resizeCompleted.addOne(function(){return u._updateMapView(t)}):(t=this.getLeftLaneTask(),t.getRecommendedWidth()!==t.getCurrentWidth()&&t.resizeCompleted.addOne(function(){return u._updateMapView(t)}));this.setShowExpandButton(this._enableExpandButton(t))},s.prototype.collapseCardLane=function(){this.toggleHideClick(null)},s.prototype._onLeftLaneTaskChanged=function(n,t){!this.getIsSlideoutLane()&&t&&(t.responsiveCardLane=this,!e._isMapsOverlay()||s._overlayLoaded?t.getRecommendedWidth()===944?this._updateSingleEntityBoldCardWidth(t):!t.shouldResize()&&t.getRecommendedWidth()?(this.setLaneWidth(t.getRecommendedWidth()),t.setCurrentWidth(t.getRecommendedWidth())):t.resizeCard.addOne(this._resizeHandler):t.getRecommendedWidth()===944?(s._overlayLoaded=!0,this._updateSingleEntityBoldCardWidth(t)):t.resizeCard.addOne(this._resizeHandler),n&&(s._invokeResizeOnSlideoutChange=!0));t&&(this.setIsCardlaneCollapsed(!1),this.setShowExpandButton(this._enableExpandButton(t)));s._updateOverlayLoadedOnNextLeftLaneTaskChange&&(s._overlayLoaded=!0)},s.prototype._onSlideoutTaskChanged=function(n,t){var c=this,r=!1,u,h,f;this.getIsSlideoutLane()?!n&&t?!e._isMapsOverlay()||s._overlayLoaded?(t.resizeCard.addOne(this._detailsFromListHandler),r=!0):(s._overlayLoaded=!0,t.resizeCompleted.addOne(function(){return c._updateMapView(t)}),h=this.getLeftLaneTask(),f=this._getLeftLaneSize(h,t),f===0?(o.setLeftLaneHidden(!0),t instanceof i.Local.LocalDetailsTask&&t.addBackToListBtn(),this._updateCardPrimerPosition(f),this._updateSingleEntityBoldCardWidth(t)):this._updateDetailsWidth()):t&&(t.resizeCard.addOne(this._detailsFromListHandler),r=!0,this.setShowExpandButton(this._enableExpandButton(t))):(n&&n.resizeCard.remove(this._resizeHandler),t&&t.resizeCard.add(this._resizeHandler),!n&&t&&(u=this._getLeftLaneSize(this.getLeftLaneTask(),t),u===0&&(this.setIsHidden(!0),o.setLeftLaneHidden(!0),this._updateCardPrimerPosition(u))));this.getIsSlideoutLane()&&t&&s._invokeResizeOnSlideoutChange&&!r&&(t.resizeCard.invoke(),s._invokeResizeOnSlideoutChange=!1);this.getIsSlideoutLane()&&t&&(t.responsiveCardLane=this);n&&!t&&(this.getIsSlideoutLane()?(this.setIsSlideoutCollapsed(!1),this.setShowExpandButton(!1)):(this.setLaneWidth(this.getOriginalWidth()),this.setIsHidden(!1),o.setLeftLaneHidden(!1)))},s.prototype._enableExpandButton=function(n){if(this.getIsCardlaneCollapsed())return!0;if(n.getDisableExpansion())return!1;if(this.getIsSlideoutLane()&&this.getIsSlideoutCollapsed()||!this.getIsSlideoutLane()){var t=this.getIsSlideoutLane()?this.getSlideoutTask():this.getLeftLaneTask();return t&&t.getRecommendedWidth()>=944&&t.getCurrentWidth()===464}return!1},s.prototype._determineResize=function(){var c=this;s._invokeResizeOnSlideoutChange=!1;var t=this.getSlideoutTask(),i=this.getLeftLaneTask(),r=i.getRecommendedWidth(),u=i.getCurrentWidth();if(r===944)this._updateSingleEntityBoldCardWidth(i);else if(i.setCurrentWidth(r),t){t.resizeCompleted.addOne(function(){return c._updateMapView(t)});var l=n("body")[0].clientWidth,f=l-s.listPlusDetailsMinMapWidth-s.listingCardPadding-s.detailsCardPadding,e=t.getSupportedSize(),h=Math.max.apply(Math,e),a=Math.min.apply(Math,e);if(u+h<f&&h===944)return;u+a<f?t.setDisableExpansion(!0):(t.setDisableExpansion(!0),this.setIsHidden(!0),o.setLeftLaneHidden(!0))}},s.prototype._updateSingleEntityBoldCardWidth=function(i){var f=this,u,r;s._invokeResizeOnSlideoutChange=!1;u=n("body")[0].clientWidth;r=u-s.singleEntityMinMapWidth-s.detailsCardPadding;r<944||s._userPrefersNarrow||i.getDisableExpansion()||i.getRecommendedWidth()<944?(this.setLaneWidth(464),i.setCurrentWidth(464),this._afterResized(!1),i.getDisableExpansion()||i.setDisableExpansion(r<944||i.getRecommendedWidth()<944),this.setShowExpandButton(!i.getDisableExpansion())):(this.setLaneWidth(944),i.setCurrentWidth(944),this._afterResized(!1),this.setShowExpandButton(!1));i.resizeCompleted.addOne(function(){f._updateMapView(i);t.fixSharedMapView&&i.poiManager&&i.poiManager.disableComputingMapViewForLoadingOnly&&(i.poiManager.disableComputingMapViewForLoadingOnly=!1)})},s.prototype._updateDetailsWidth=function(){s._invokeResizeOnSlideoutChange=!1;var n=this.getSlideoutTask();n&&(s._userPrefersNarrow||n.getDisableExpansion())&&n.getRecommendedWidth()>=944?(this.setLaneWidth(464),n.setCurrentWidth(464),this._afterResized(!0),this.setIsSlideoutCollapsed(!0),this.setShowExpandButton(!n.getDisableExpansion())):(this.setIsSlideoutCollapsed(!1),this.setShowExpandButton(!1))},s.prototype._getLeftLaneSize=function(t,i){var r=t.getCurrentWidth(),e=n("body")[0].clientWidth,u=e-s.listPlusDetailsMinMapWidth-s.listingCardPadding-s.detailsCardPadding,f=t.getSlideoutSupportedSize(),o=Math.max.apply(Math,f),h=Math.min.apply(Math,f);return r+o<u?r:r+h<u?(i.setDisableExpansion(!0),r):0},s.prototype._afterResized=function(i){var r=i?this.getSlideoutTask():this.getLeftLaneTask(),u=n("#"+r.resizableComponentId),f;u.length>0&&(f=o._getWaterfallResizeEventName(t,r.resizableComponentId),sj_evt.fire(f,u[0]));sj_evt.fire("slideoutScroll",null)},s.prototype._onSetSlideout=function(n){n&&t.isNarrowFirst&&(s._userPrefersNarrow=!0)},s.prototype._onSetMap=function(t){var r,i=this;this.getIsSlideoutLane()&&(r=this.disposables).push.apply(r,ei.handleUserActions(t.getAzureMap(),function(){var t,o;if(!s._mapTipShown){var f=i._getVisibleMapWidth(),r=i.getSlideoutTask(),e=i.getLeftLaneTask(),u=0;r?u=r.getCurrentWidth():e&&(u=e.getCurrentWidth());!s._wideCardTipCurrentlyShowing&&s._collapseTipShown&&!s._mapTipShown&&f!==-1&&f<300&&u===944&&(t=n(".resizeButton.hide"),t.length>0&&(o=r?t.length-1:0,i._buildTip("L_CollapseButton_Tip",t[o],!1),s._mapTipShown=!0))}}))},s.prototype._onLaneWidthChanged=function(n,t){var i=t,r;this.getIsSlideoutLane()&&(i=this.getLeftLaneTask().getCurrentWidth()+t);typeof i!="number"||isNaN(i)||(r=this.getMap(),r&&r.setViewPadding({left:i===0?0:i+32}))},s.prototype._updateMapView=function(i){var r,u,e,f;s._overlayLoaded=!0;s._invokeResizeOnSlideoutChange=!1;r=i.displayState&&i.displayState.stackOrder===2&&!this.getIsHidden();(r||i.getRecommendedWidth()!==i.getCurrentWidth()||i.getCurrentWidth()===944)&&((i.getRecommendedWidth()===944||i.getCurrentWidth()===484)&&i.poiManager&&i.poiManager.refreshMap(!0),t.isNarrowFirst&&typeof s._updateMapViewInvoked=="undefined"&&!i.getDisableExpansion()?s._updateMapViewInvoked=1:t.isMapPeek&&s._updateMapViewInvoked===0&&!i.getDisableExpansion()&&(s._updateMapViewInvoked=1),s._collapseTipShown||i.getCurrentWidth()!==944?!s._expandTipShown&&s._updateMapViewInvoked&&i.getCurrentWidth()===464&&i.getRecommendedWidth()===944&&(e=n(".resizeButton.show"),e.length>0&&(f=r?e.length-1:0,this._buildTip("L_ExpandButton_Tip",e[f],!0),s._wideCardTipCurrentlyShowing=!0,s._expandTipShown=!0)):(u=n(".resizeButton.hide"),u.length>0&&(f=r?u.length-1:0,this._buildTip("L_CollapseButton_Tip",u[f],!0),s._wideCardTipCurrentlyShowing=!0,s._collapseTipShown=!0)),typeof s._updateMapViewInvoked!="undefined"&&s._updateMapViewInvoked++)},s.prototype._getVisibleMapWidth=function(){if(!this.getSlideoutTask()||!this.getLeftLaneTask())return-1;var t=n("body")[0].clientWidth,i=o.getVerticalTaskBarWidth()+this.getSlideoutTask().getCurrentWidth()+this.getLeftLaneTask().getCurrentWidth();return t-i-60},s.prototype._buildTip=function(t,i,r){var u=this.getMap().getContainer().instance("UserTipControl",{title:null,messages:[this.resources[t]],noFade:!1,clickAwayToClose:r,isDark:!0,isLinkMessage:!1,tipTemplate:null,tipDisplayTime:7e3}),f,e;u.setShowClose(!1);u.setShowBeak(!0);u.setCustomCssOverride("signinmessage");this.disposables.push(u.tipRemoved.add(function(){s._tip=null;s._wideCardTipCurrentlyShowing=!1}));s._tip&&s._tip.removeTip();s._tip=u;f=n(i).get_absolute_pos();e=n(u.getRootElement());e.set_style({top:f.y-f.height+10,left:f.x+f.width+10});this.getMap().getRootElement().getParent().append(e);e.select(".tooltipBeak").set_style({transform:"rotate(-90deg)",top:f.height/2+"px",left:-(e.get_size().width+5)+"px"})},s.prototype._updateCardPrimerPosition=function(t){var r=t===0?t:t+32,i=n(".taskLayoutSkeletonContainer.bm_l2NavLeft");i&&i.length>0&&i.set_style({left:r+"px"})},s.listingCardPadding=36,s.detailsCardPadding=24,s.listPlusDetailsMinMapWidth=300,s.singleEntityMinMapWidth=300,s._userPrefersNarrow=!1,s._invokeResizeOnSlideoutChange=!1,s._updateOverlayLoadedOnNextLeftLaneTaskChange=!1,s._overlayLoaded=!1,s}(tt);a.registerControl("ResponsiveCardLane",wi);c=function(i){function u(){var n=i.call(this)||this,u=n._privates;return u.defineProperty("stack",function(t,i){return n._onStackChanged(i)}),u.defineProperty("sideATask",function(t,i){return n._onSideAChanged(t,i)},null,{isPrivate:!0}),u.defineProperty("sideBTask",function(t,i){return n._onSideBChanged(t,i)},null,{isPrivate:!0}),u.defineProperty("sideATitle"),u.defineProperty("sideBTitle"),u.defineProperty("cssClass"),u.defineProperty("sideATitleID"),u.defineProperty("sideBTitleID"),u.defineProperty("isListCard"),u.defineProperty("isDetailsCard"),u.defineProperty("layoutMetrics"),n.click=new r,n.touchstart=new r,n.touchmove=new r,n.touchend=new r,n._isNewActionBarButtons=t.enableNewActionBarButtons,n.setIsListCard(!0),n.setIsDetailsCard(!1),n.rendered.add(function(){n._onRendered()}),n.setTemplate(new a("<div><ContentPresenter /><\/div>")),sj_evt.bind("BirdsEyeDeactivated",function(){n._showOrHideContextualTaskBar(n.getSideATask(),n.getSideBTask())}),n}return f(u,i),u.prototype._onClick=function(){},u.prototype._onTouchstart=function(n){this.touchstart.invoke({event:n,card:this,panel:this._getPanelWrapper()})},u.prototype._onTouchmove=function(n){this.touchmove.invoke({event:n,card:this,panel:this._getPanelWrapper()})},u.prototype._onTouchend=function(n){this.touchend.invoke({event:n,card:this,panel:this._getPanelWrapper()})},u.prototype._getContent=function(n){var t=this.getLayoutMetrics();return n&&t&&n.getContent(t)},u.prototype.getSideAContent=function(){return this._getContent(this.getSideATask())},u.prototype.getSideBContent=function(){return this._getContent(this.getSideBTask())},u.prototype._flipCard=function(){var e=this,r=this.getStack(),i=r&&r.getForegroundTask(),o,s,v,y,w,p;if(!i){sj_evt.fire("OnAllTaskStacksRemoved");return}if(!this.getSideATask()&&!this.getSideBTask()){this._privates.setSideATask(i);this._setCardFaces(!0);return}o=!this.isSideAFront;o?(this._privates.setSideATask(i),s=this.getSideBTask()):(this._privates.setSideBTask(i),s=this.getSideATask());var b=s&&s.displayState.stackOrder||0,k=Math.min(Math.max(i.displayState.stackOrder-b,-1),1),f=n(this.getRootElement()),c=f.select(".cardFace.front"),h=f.select(".cardFace.back"),l=null,a={"backface-visibility":"hidden",visibility:"visible",outline:"none"};if(n.Browser.is_edge&&t.edgeFlipCardAnimationFix&&(a.outline="1px solid transparent"),c.set_style(a),h.set_style(a),l=function(){var s,t,i,n;for(e._setCardFaces(o),o?e._privates.setSideBTask(null):e._privates.setSideATask(null),c.set_style({transform:"",visibility:"visible"}),h.set_style({transform:"",visibility:"","backface-visibility":""}),r.flipAnimationCompleted.invoke(),u.setFocusToTitle(r,f),s=r.getAllTasks(),t=0;t<s.length;t++)i=s[t],n=i&&i.displayState,n&&n.prominence===1&&n.activationState===1&&n.animationState===1&&e._setTaskTitleState(i,!0)},v=ar.getValue(i,"percentLoaded"),y=i,y.changed&&typeof v=="number"&&v!==1&&(h.set_style({height:c[0].clientHeight+"px"}),w=y.changed.add(function(n){n&&n.name==="percentLoaded"&&n.newValue===1&&(w.dispose(),h.set_style({height:""}))})),!k||r.displayState.activationState!==1){l();return}if(p=this._getPanelWrapper(),p&&p.has_class("leftPanel")){var d=this._panelWrapper.get_size(),g=this._panelWrapper.get_scroll_pos(),nt=f.get_relative_pos();f.set_style({"perspective-origin":"50% "+(d.height/2-(nt.y-g.y))+"px"})}l()},u.prototype._onStackChanged=function(n){var t=this;this._stackChanged&&this._stackChanged.dispose();n&&(this._stackChanged=n.changed.add(function(n){n.name==="foregroundTask"&&t._flipCard()}));this._privates.setSideBTask(null);this._privates.setSideATask(n&&n.getForegroundTask());this._setCardFaces(!0)},u.prototype._showOrHideContextualTaskBar=function(n,t){var i=this.getStack(),e,u,f,r,o,s,h;if(i&&(e=i.displayState&&i.displayState.activationState,e===1)){for(u=i.getAllTasks(),f=!1,r=0,o=u.length;r<o;r++)if(u[r].type==="LocalListingTask"){f=!0;break}f?(s=n&&n.type==="LocalListingTask",h=t&&t.type==="LocalListingTask",s||h?sj_evt.fire("ShowContextualTaskbar"):sj_evt.fire("HideContextualTaskbar")):sj_evt.fire("ShowContextualTaskbar")}},u.prototype._onSideAChanged=function(n,t){var i=this;n&&n.changed.remove(this._setSideATaskChanged);t&&(this.disposables.push(t.changed.add(function(n){return i._setSideATaskChanged(t,n)})),this.setSideATitle(t.getTitle()),this.setCssClass(this._getCardClass(this.getStack())));this._showOrHideContextualTaskBar(t,this.getSideBTask())},u.prototype._onSideBChanged=function(n,t){var i=this;n&&n.changed.remove(this._setSideBTaskChanged);t&&(this.disposables.push(t.changed.add(function(n){return i._setSideBTaskChanged(t,n)})),this.setSideBTitle(t.getTitle()),this.setCssClass(this._getCardClass(this.getStack())));this._showOrHideContextualTaskBar(this.getSideATask(),t)},u.prototype._setSideATaskChanged=function(n,t){t&&t.name==="title"&&this.setSideATitle(n.getTitle());this._updateCardClass(t);this._setTaskTitleState(n)},u.prototype._setSideBTaskChanged=function(n,t){t&&t.name==="title"&&this.setSideBTitle(n.getTitle());this._updateCardClass(t);this._setTaskTitleState(n,!0)},u.prototype._updateCardClass=function(n){n&&n.name==="displayState"&&n.newValue&&n.newValue.prominence&&(this.setCssClass(this._getCardClass(this.getStack())),this._showOrHideContextualTaskBar(this.getSideATask(),this.getSideBTask()))},u.prototype._setCardFaces=function(t){var i=n(this.getRootElement()),r=t?u.SideASelector:u.SideBSelector,f=t?u.SideBSelector:u.SideASelector;i.select(r).swap_class("back","front");i.select(f).swap_class("front","back");this.isSideAFront=t},u.prototype._getPanelWrapper=function(){if(!this._panelWrapper){var t=n(this.getRootElement());do if(t=t.get_ancestor(1),t.has_class("panelWrapper")){this._panelWrapper=t;break}while(t[0])}return this._panelWrapper},u.prototype._getCardTitle=function(){return n(".front .".concat("cardTitleText"),this.getRootElement())},u.prototype._onRendered=function(){var t=this,i=n(this.getRootElement());i.add_event("click",function(n){t._onClick(n)},!0).add_event("touchstart",function(n){t._onTouchstart(n)},!0).add_event("touchmove",function(n){t._onTouchmove(n)},!0).add_event("touchend",function(n){t._onTouchend(n)},!0);u.setFocusToTitle(this.getStack(),i)},u.prototype._getCardClass=function(t){return t?u._replaceCardClass(t.id,n(this.getRootElement()),""):""},u._getCardCssClassForTask=function(n,t){var i=t.select("[data-taskId='"+n+"']");return i?i.get_attr("class"):null},u._replaceCardClass=function(n,t,i){var e=u._getCardCssClassForTask(n,t),r=e?e:"taskCard",f=u._taskCardRegex.exec(r);return f&&f.length===1&&(r=r.replace(f[0],i)),r.trim()},u.setFocusToTitle=function(t,i){var r=t&&t.getForegroundTask(),c,s,e,f,o,h;if(r&&(r.type!=="LocalGuideTask"&&r.type!=="LocalGuideL2Task"||u.taskHasBeenInitialized)&&(c=r&&r.hasDefaultFocusElement&&r.hasDefaultFocusElement(),!c&&r))if(t.getAllTasks().length>1){if(s=n(".cardCol.slidecard.panelContent"),s.length>0)u._focusDetailCloseBtn(s);else if(i&&i.length>0)for(e=i[0].children,f=0;f<e.length;f++)e[f].classList.contains("front")&&u._focusDetailCloseBtn(n(e[f]))}else r.id.toLowerCase().indexOf("detail")>-1||r.id.toLowerCase().indexOf("poly")>-1?this._focusDetailCloseBtn(i):(o=n(".titleBar",i[0]),o.length===0&&(o=n(".titleBar")),h=n(".title",o[0]),h.length>0&&h[0].focus())},u._focusDetailCloseBtn=function(t){for(var u,r=t.select(".bm_cardCloseButton"),i=0;i<r.length;i++)if(u=n(r[i].parentElement),u.get_style("display")!=="none"){r[i].focus();return}},u.prototype._setTaskTitleState=function(t,i){var f,l,a,v,s,y;if(i===void 0&&(i=!1),t&&t.displayState&&t.displayState.activationState===1&&t.displayState.prominence===1&&t.displayState.animationState===1){var r=t&&t.id,e=n(".taskCard"),u=e;for(f=0;f<e.length;f++)if(e[f].classList.contains("focus")){u=n(e[f]);break}var h=u.select(".cardFace.sideA"),p=u.select(".cardFace.sideB"),c=h.has_class("front")?h:p;r=c.get_attr("data-subtaskid");r.length>0&&(r.indexOf("Feedback")>-1?(l=n(".feedbackBackButton",c[0]),l.length>0?(this.setIsDetailsCard(!1),this.setIsListCard(!1)):(this.setIsDetailsCard(!1),this.setIsListCard(!0))):r.indexOf("ItineraryDetails")>-1?(this.setIsDetailsCard(!0),this.setIsListCard(!1),a=t,o.itineraryCloseButtonHandler(a,r)):r.indexOf("Detail")>-1||r.indexOf("TransitLine")>-1?(this.setIsDetailsCard(!0),this.setIsListCard(!1),v=n(".backArrowButton.overlayButton",u[0]),s=n(".bm_cardClose",u[0]),v.length>0&&s.length>0?s.add_class("itin"):s.remove_class("itin")):r.indexOf("Collections")>-1?(y=n(".collectionBack"),i||y.length>0?(this.setIsDetailsCard(!1),this.setIsListCard(!1)):(this.setIsDetailsCard(!1),this.setIsListCard(!0))):(this.setIsDetailsCard(!1),this.setIsListCard(!0)))}else this.setIsDetailsCard(!1),this.setIsListCard(!1)},u.GrayedOutStyle="ac9",u.SideASelector=".cardFace.sideA",u.SideBSelector=".cardFace.sideB",u.taskHasBeenInitialized=!1,u._taskCardRegex=new RegExp("ac[0-9]"),u}(tt);a.registerControl("TaskCard",c);bi=function(t){function r(){var n=t.call(this)||this;return n._privates.defineProperty("disabled",function(t,i){var r=n.getStack();r.displayState.activationState=4;r.setIsLocked(i);n.setCssClass(n._getCardClass(r))},null,{defaultValue:!1}),n._isChangePublicInProgress=!1,n}return f(r,t),r.prototype._clickHandler=function(n){var u=this,r,t;if(n&&n.stopPropagation(),r=this.getStack(),t=r.getForegroundTask(),t.type.toLowerCase()==="collectionstask")if(t.isSharable()){if(t.isPublicCollection&&!t.isPublicCollection()&&!this._isChangePublicInProgress){n.preventDefault();r.setIsLocked(!0);r.setIsSelected(!1);this._isChangePublicInProgress=!0;t.makePublic&&t.makePublic(function(n){u._isChangePublicInProgress=!1;r.setIsLocked(!1);n?(u._flipCheckBox(null,!0),u._showMadePublicPrompt()):(u._flipCheckBox(null,!1),u._showPrompt(i.ResourceManager.Collections.L_MakePublicFail_Text))});return}}else n.preventDefault(),this._showPrompt(i.ResourceManager.Collections.L_ShareOnlySpecificCollection_Text);this.getDisabled()||r.getIsLocked()||this._flipCheckBox(n)},r.prototype._onStackChanged=function(n){t.prototype._onStackChanged.call(this,n);var i=n.getForegroundTask();this.setDisabled(!(i.isSharable&&i.isSharable()))},r.prototype._onRendered=function(){var u=this;t.prototype._onRendered.call(this);var i=n(this.getRootElement()),f=i.select("input"),r=function(n){u._clickHandler(n)};i.add_event("click",r,!0);f.add_event("pointerdown",r,!0);nt.changeStackFocusState(this.getStack(),1)},r.prototype._getCardClass=function(n){var i=t.prototype._getCardClass.call(this,n),u,f;return n=this.getStack(),this.getDisabled()||!n.getIsSelected()?i=r._getGrayedOutCss(i):(u=n.getForegroundTask(),f=u&&u.canColorFade&&u.canColorFade(),f&&n.displayState.activationState===4&&(i=r._getGrayedOutCss(i))),i},r._getGrayedOutCss=function(n){return r._styleParsingRegex.test(n)?n.replace(r._styleParsingRegex,c.GrayedOutStyle):n+" "+c.GrayedOutStyle},r.prototype._showMadePublicPrompt=function(){var t=this,r=this.isSideAFront?this.getSideATitle():this.getSideBTitle(),u=i.ResourceManager.Collections.L_MakePublicSuccess_Text.replace("{0}",r);this._showPrompt(u,{undoClick:function(r){r.preventDefault();var u=t.getStack().getForegroundTask();t._isChangePublicInProgress=!0;n(".undoLink",t._currentPrompt.getRootElement()).add_class("nonClickable");u&&u.makePrivate&&u.makePrivate(function(n){t._isChangePublicInProgress=!1;n?(t._flipCheckBox(null,!1),t._closeCurrentPrompt()):t._showPrompt(i.ResourceManager.Collections.L_UndoFail_Text)})}},'<a href="#" class="undoLink" event:click="undoClick"><TextBlock text="{StaticBinding resources.L_Undo_Text}" /><\/a>')},r.prototype._showPrompt=function(t,u,f){var p=this,e,s,h,o,l,v,w,y;if(this._closeCurrentPrompt(),e=new pi,s={closeClick:function(){p._closeCurrentPrompt()},resources:i.ResourceManager.Collections},u)for(h=Object.keys(u),o=h.length-1;o>=0;o--)l=h[o],s[l]=u[l];e.setTemplate(new a(r._promptControlTemplate.replace("{0}",f?f:""),s));v=n(e.getRootElement());document.body.appendChild(v[0]);w=n("".concat(this.isSideAFront?c.SideASelector:c.SideBSelector," input[type=checkbox]"),this.getRootElement());y=w.get_absolute_pos();v.set_style({top:y.y+"px",left:y.x+30+"px"});e.setPromptText(t);b.setTimeout(function(){p._closeCurrentPrompt()},5e3);this._currentPrompt=e},r.prototype._closeCurrentPrompt=function(){this._currentPrompt&&(this._currentPrompt.dispose(),n(this._currentPrompt.getRootElement()).removeFromParent(),this._currentPrompt=null)},r.prototype._flipCheckBox=function(t,i){var e=n("".concat(this.isSideAFront?c.SideASelector:c.SideBSelector," input[type=checkbox]"),this.getRootElement()),r=e[0],u=this.getStack(),f;i!==undefined?u.setIsSelected(i):t&&t.target!==r&&(f=!r.checked,u.setIsSelected(f))},r._styleParsingRegex=new RegExp("ac\\d+","gi"),r._promptControlTemplate='<div class="collectionsMakePublicPrompt"><div class="close" event:click="closeClick">X<\/div><div class="prompt"><TextBlock text="{TemplateBinding promptText}" /><span> <\/span>{0}<\/div><\/div >',r}(c);a.registerControl("SelectionTaskCard",bi);dt=function(){function n(n,t,i,r,u,f,e){var o=this,s;this._highlightClassNameDefault="sa_hlgt";this._initialized=!1;s=i&&i.children.length>0?i.children[0]:null;t&&s&&n&&r&&u&&(this._autosuggestEndpoint=n,this._autoSuggestList=s,this._autosuggestBox=i,this._highlightClassName=e?e:this._highlightClassNameDefault,this._searchBox=t,this.setSearchText=r,this.getSearchText=u,this._initiateSearchCallback=f,this._windowClickAwayEventHandler=function(n){o&&b.setTimeout(function(){n&&n.currentTarget!==o._searchBox&&o.showAutosuggest(!1)},1)},this._initialized=!0)}return n.prototype.OnKeyPressed=function(n,t){var i=this;if(n&&n.keyCode)switch(n.keyCode){case 13:this.showAutosuggest(!1);break;case 38:this._highlightAutoSuggest(!0);break;case 40:this._highlightAutoSuggest(!1);break;default:(t||this._autosuggestEndpoint)&&b.setTimeout(function(){i._sendAutoSuggest(t||i._autosuggestEndpoint)})}},n.prototype.showAutosuggest=function(n){this._setClickAwayHandler(n);this._autosuggestBox&&(this._autosuggestBox.style.display=n?"block":"none")},n.prototype._highlightAutoSuggest=function(n){var i,t,r;this._initialized&&(this._autoSuggestList.childElementCount>0?(this._currentSuggestionIndex>-1&&this._currentSuggestionIndex<this._autoSuggestList.childElementCount&&(i=this._autoSuggestList.childNodes[this._currentSuggestionIndex],i&&i.classList.remove(this._highlightClassName)),n?(--this._currentSuggestionIndex,this._currentSuggestionIndex<-1&&(this._currentSuggestionIndex=this._autoSuggestList.childElementCount-1)):(++this._currentSuggestionIndex,this._currentSuggestionIndex>=this._autoSuggestList.childElementCount&&(this._currentSuggestionIndex=-1)),this._currentSuggestionIndex>-1&&this._currentSuggestionIndex<this._autoSuggestList.childElementCount?(t=this._autoSuggestList.childNodes[this._currentSuggestionIndex],t&&(t.classList.add(this._highlightClassName),this.setSearchText&&this.setSearchText(t.getAttribute("query")||t.innerText||""))):this._currentSuggestionIndex===-1&&this.getSearchText&&this.setSearchText&&(r=this.getSearchText(),this.setSearchText(""),this.setSearchText(r))):this._currentSuggestionIndex=-1)},n.prototype._sendAutoSuggest=function(n){var f=this,i,r,u,t;this._currentSuggestionIndex=-1;this._initialized&&(i=this._searchBox,r=i&&i.value&&i.value.length>0?i.value:"",r&&n&&n.indexOf("{1}")>-1?(u=n.replace("{1}",encodeURIComponent(r)),t=sj_gx(),t.open("GET",u,!0),t.onreadystatechange=function(){f._processAutosuggestions(t)},t.send(),this._autoSuggestRequest=t):(this._autoSuggestList.innerHTML="",this.showAutosuggest(!1)))},n.prototype._processAutosuggestions=function(n){var f=this,r,t,i,u;if(n.readyState===4&&n.status===200){this._autoSuggestRequest=null;try{if(r=!1,n.responseText&&n.responseText.length&&(t=sj_ce("div"),t.innerHTML=n.responseText,t.firstChild&&(this._autoSuggestList.innerHTML=t.firstChild.innerHTML,this._autoSuggestList.childElementCount>0))){for(i=0;i<this._autoSuggestList.childElementCount;i++)u=this._autoSuggestList.childNodes[i],u&&(r=!0,u.addEventListener("click",function(n){f._autosuggestClickHandler(n)}));this.showAutosuggest(!0)}r||(this._autoSuggestList.innerHTML="",this.showAutosuggest(!1))}catch(e){}}},n.prototype._autosuggestClickHandler=function(n){if(n){n.preventDefault();this.showAutosuggest(!1);var t=n.currentTarget&&n.currentTarget.getAttribute("query")||n.target&&n.target.innerText||"";this.setSearchText(t);n.currentTarget&&this._initiateSearchCallback&&this._initiateSearchCallback()}},n.prototype.abortCurrentAutosuggestRequest=function(){return this._autoSuggestRequest?(this._autoSuggestRequest.abort(),this._autoSuggestRequest=null,!0):!1},n.prototype._setClickAwayHandler=function(n){var t=this;n?b.setTimeout(function(){window.addEventListener("click",t._windowClickAwayEventHandler)},1):window.removeEventListener("click",this._windowClickAwayEventHandler)},n}();ki=function(i){function r(){var n=this,r={onCloseOverflowClick:function(t){n._onCloseOverflowClick(t)},onProductSearchClick:function(t){n._onSearchClick(t)},onSearchKeyPressed:function(t){n._onSearchKeyPressed(t)},isShoppingTask:function(n){return n&&n instanceof ot?"":"none"}},t;return n=i.call(this,vu,r)||this,t=n._privates,t.defineProperty("searchText"),n._scrollToTopHandler=function(){n._scrollToTop()},n._updateScrollHandler=function(t){n._updateScrollHeight(t)},n.ShowAutosuggest=!1,n}return f(r,i),r.prototype._onTaskChanged=function(n,t){i.prototype._onTaskChanged.call(this,n,t);var r=null,u=null;n instanceof ot&&(r=n);t instanceof ot&&(u=t);this.setSearchText("");r&&(r.newContentAdded.remove(this._scrollToTopHandler),r.heightExpanded.remove(this._updateScrollHandler));u&&(u.newContentAdded.add(this._scrollToTopHandler),u.heightExpanded.add(this._updateScrollHandler));t instanceof bt?document.body.classList.add("overflowOpen"):document.body.classList.remove("overflowOpen")},r.prototype._initCustomScroll=function(){t.customScrollbar&&!this._customScroll&&(this._customScroll=new ht(n(this.getRootElement())))},r.prototype._scrollToTop=function(){this._initCustomScroll();this._customScroll&&this._customScroll.componentDidMount()},r.prototype._updateScrollHeight=function(n){this._customScroll&&this._customScroll.scrollToTarget(n)},r.prototype._onCloseOverflowClick=function(n){var t,i,r;n&&(n.preventDefault(),n.stopPropagation(),t=this.getStack(),t&&(i=t.getOverflowTask(),r=i&&i.getOptions(),i&&i.deactivate(),this.setSearchText(""),t.setOverflowTask(null),t.serializableObjectChanged.invoke(),this._logAction("CLS",r&&r.impressionGuid)))},r.prototype._onSearchClick=function(n){n.preventDefault();n.stopPropagation();this._initiateShoppingSearch()},r.prototype._onSearchKeyPressed=function(t){var r=this,i=t.keyCode;if(i){if(!this._shoppingAutosuggest){var f=n(".shop_asbox",this.getRootElement()),s=f.length>0&&f[0],e=n(".shoppingSearchboxContainer .shoppingSearchbox"),o=this.getTask(),u=o&&o.getOptions();u&&u.autosuggestEndpoint&&(this._shoppingAutosuggest=new dt(u.autosuggestEndpoint,e.length>0?e[0]:null,s,function(n){r.setSearchText(n)},function(){return r.getSearchText()},function(){r._initiateShoppingSearch()}))}this._shoppingAutosuggest&&this._shoppingAutosuggest.OnKeyPressed(t);i===13?this._initiateShoppingSearch():(i===38||i===40)&&t.preventDefault()}},r.prototype._initiateShoppingSearch=function(){var t=this.getSearchText(),n,i;t&&(this._shoppingAutosuggest.abortCurrentAutosuggestRequest(),n=this.getTask(),n.makeProductsSearch(t),i=n.getOptions(),this._logAction("SRCH",i.impressionGuid))},r.prototype._logAction=function(n,t){var i={logData:{feature:"SHOP",action:n},impressionGuid:t};v.invokeHandler("data-instrumentation",i)},r}(nt);a.registerControl("ShoppingTaskContainer",ki);di=function(n){function t(){var t=n.call(this)||this,i=t._privates;return i.defineProperty("task"),i.defineProperty("hasCardSettings"),i.defineProperty("cardSettings"),t.setTemplate(new a(pu,t)),t}return f(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this)},t}(tt);a.registerControl("TaskSettingsControl",di);gi=function(n){function t(){var t=n.call(this)||this,i=t._privates;return i.defineProperty("enrichment",function(){t._onEnrichmentChange()}),i.defineProperty("task"),t}return f(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this)},t.prototype._onEnrichmentChange=function(){this.setTemplate(new a(wu,this))},t.prototype.getTitleAugmentation=function(){var n=this.getTask();return n?n.getTitleEnrichment():document.createElement("div")},t}(tt);a.registerControl("TitleEnrichmentControl",gi);ht=function(){function t(t){var i=this,u;this.delayedUpdateTimeForScrollBar=1;this.contentHeight=0;this.visibleHeight=0;this.scrollRatio=0;this.hasScroll=!1;this.scrollHandleHeight=0;this.startDragHandlePos=0;this.startDragMousePos=0;this.scrollbar=null;this.scrollHandle=null;this.innerContainer=null;this.contentWrapper=null;this.scrollElement=null;this.isRtl=_G.RTL;this.defaultScrollHandleHeight=100;this.scrollPos=0;this.scrollTopChanged=new r;this.scrollElement=t[0];this.scrollbar=t.select(".custom-scrollbar")[0];this.scrollHandle=t.select(".custom-scroll-handle")[0];this.innerContainer=t.select(".inner-container")[0];this.contentWrapper=t.select(".content-wrapper")[0];u=t.select(".outer-container")[0];u&&(u.addEventListener("click",function(n){i._onClick(n)}),u.addEventListener("mousedown",function(n){i._onMouseDown(n)}));this.innerContainer&&(this.innerContainer.style[this.isRtl?"marginLeft":"marginRight"]=-this._getScrollbarWidth()+"px",this.innerContainer.addEventListener("scroll",function(n){i._onScroll(n);sj_evt.fire("customScrolled",n)}),this.innerContainer.addEventListener("wheel",function(n){i._onWheel(n)}),this._getScrollbarWidth(),this._scrollbarRenderingOnContent&&this.innerContainer.classList.add("scrollBarRenderingOnContent"));this._windowMouseDragEventHandler=function(n){n.preventDefault();var t=n.pageY-i.startDragMousePos,r=i._getBoundValue(i.startDragHandlePos+t,0,i.visibleHeight-i.scrollHandleHeight),u=i._getScrollValueFromHandlePosition(r);i._updateScrollPosition(u)};this._windowMouseDragEndEventHandler=function(t){t.preventDefault();n(i.scrollbar).remove_class("onScrolling");n(i.scrollElement).remove_class("onScrolling");document.removeEventListener("mousemove",i._windowMouseDragEventHandler);document.removeEventListener("mouseup",i._windowMouseDragEndEventHandler)};sj_be&&sj_be(_w,"resize",function(){i._delayedUpdateScrollBar(100)})}return t.prototype.componentDidMount=function(){this._delayedUpdateScrollBar(this.delayedUpdateTimeForScrollBar)},t.prototype.componentDidUpdate=function(n){n===void 0&&(n=!0);this.contentHeight!==this._getContentHeight()&&this._delayedUpdateScrollBar(this.delayedUpdateTimeForScrollBar,n?0:null)},t.prototype.setScrollPosition=function(n){this._delayedUpdateScrollBar(this.delayedUpdateTimeForScrollBar,n)},t.prototype.scrollToTarget=function(n){var t=this;this.targetTimer&&sb_ct(this.targetTimer);this.targetTimer=sb_st(function(){t._updateScrollBar(null,n)},this.delayedUpdateTimeForScrollBar)},t.prototype._delayedUpdateScrollBar=function(n,t){var i=this;this.timer&&sb_ct(this.timer);this.timer=sb_st(function(){i._updateScrollBar(t)},n)},t.prototype._getScrollbarWidth=function(){if(!this._cachedScrollbarWidth){var n=o._createElement("div"),t=o._createElement("div");n.append(t);n.appendTo(document.body);n.set_style({overflow:"scroll",height:"100px",width:"100px"});t.set_style({height:"100%",width:"100%"});this._cachedScrollbarWidth=n[0].offsetWidth-t[0].offsetWidth;this._cachedScrollbarWidth===0&&(this._scrollbarRenderingOnContent=!0,this._cachedScrollbarWidth=17);n.removeFromParent()}return this._cachedScrollbarWidth},t.prototype._calculateLayoutSizes=function(){if(this.innerContainer){this.contentHeight=this._getContentHeight();var n=this.innerContainer,t=parseFloat(window.getComputedStyle(this.scrollbar).marginTop)||0;this.visibleHeight=n.clientHeight-t*2;this.scrollRatio=this.contentHeight?this.visibleHeight/this.contentHeight:1}},t.prototype._getContentHeight=function(){if(this.contentWrapper&&this.contentWrapper.firstElementChild){var t=this.contentWrapper.firstElementChild.clientHeight,n=window.getComputedStyle(this.contentWrapper.firstElementChild);return n&&(t+=(parseInt(n.marginTop)||0)+(parseInt(n.marginBottom)||0)),t}return 0},t.prototype._toggleScrollIfNeeded=function(){var t=this.contentHeight-this.visibleHeight>1;this.hasScroll!==t&&(this.hasScroll=t,this.hasScroll?n(this.scrollbar).add_class("hasScroll"):n(this.scrollbar).remove_class("hasScroll"))},t.prototype._updateScrollBar=function(n,t){this._calculateLayoutSizes();this.scrollbar&&(this.scrollbar.style.height=this.visibleHeight+"px");this.innerContainer&&typeof n=="number"?this._setScrollTop(n):this.innerContainer&&t&&this._setScrollTop(this._getNewScrollTop(t));this._toggleScrollIfNeeded();this._render()},t.prototype._updateScrollPosition=function(n){var t=this._getBoundValue(n,0,this.contentHeight-this.visibleHeight);this._setScrollTop(t);this._setScrollBarPosition()},t.prototype._onClick=function(n){if(this.hasScroll&&this._isMouseEventOnCustomScrollbar(n)&&!this._isMouseEventOnScrollHandle(n)){var t=this._calculateNewScrollHandleTop(n),i=this._getScrollValueFromHandlePosition(t);this._updateScrollPosition(i)}},t.prototype._isMouseEventOnCustomScrollbar=function(n){if(!this.scrollbar)return!1;var u=this.scrollElement,t=u.getBoundingClientRect(),r=this.scrollbar.getBoundingClientRect(),i=this.isRtl?{left:t.left,right:r.right}:{left:r.left,width:t.right},f={left:i.left?i.left:t.left,right:i.right?i.right:t.right,top:t.top,height:t.height,width:i.width?i.width:t.width};return this._isEventOnRect(n,f)},t.prototype._isMouseEventOnScrollHandle=function(n){if(!this.scrollHandle)return!1;var t=this.scrollHandle;return this._isEventOnElement(n,t)},t.prototype._calculateNewScrollHandleTop=function(n){var i=this.scrollElement,r=i.getBoundingClientRect(),u=r.top+window.pageYOffset,f=n.pageY-u,t=this._getScrollHandleStyle().top,e=f>t+this.scrollHandleHeight;return e?t+Math.min(this.scrollHandleHeight,this.visibleHeight-this.scrollHandleHeight):t-Math.max(this.scrollHandleHeight,0)},t.prototype._getScrollValueFromHandlePosition=function(n){return n/this.scrollRatio},t.prototype._getScrollHandleStyle=function(){var n=this.scrollPos*this.scrollRatio;return this.scrollHandleHeight=this.visibleHeight*this.scrollRatio,{height:this.scrollHandleHeight,top:n}},t.prototype._onMouseDown=function(t){this.hasScroll&&this._isMouseEventOnScrollHandle(t)&&(this.startDragHandlePos=this._getScrollHandleStyle().top,this.startDragMousePos=t.pageY,n(this.scrollbar).add_class("onScrolling"),n(this.scrollElement).add_class("onScrolling"),document.addEventListener("mousemove",this._windowMouseDragEventHandler),document.addEventListener("mouseup",this._windowMouseDragEndEventHandler))},t.prototype._onScroll=function(n){this.hasScroll||this._updateScrollBar();this.hasScroll&&(this._setScrollTop(n.currentTarget.scrollTop),this._setScrollBarPosition())},t.prototype._onWheel=function(n){this.hasScroll||(this._calculateLayoutSizes(),this._toggleScrollIfNeeded());this.hasScroll||(this._setScrollTop(0),n.preventDefault(),n.stopPropagation())},t.prototype._enforceMinHandleHeight=function(n){var t=this.defaultScrollHandleHeight;if(n.height>=t)return n;var i=t-n.height,r=this.contentHeight-this.visibleHeight>0?this.scrollPos/(this.contentHeight-this.visibleHeight):0,u=i*r,f=n.top-u;return{height:t,top:f}},t.prototype._setScrollBarPosition=function(){if(this.scrollHandle){var n=this._enforceMinHandleHeight(this._getScrollHandleStyle());this.scrollHandle.style.top=this._ensureValidScrollHandleTop(n.top)+"px"}},t.prototype._ensureValidScrollHandleTop=function(n){if(n<0)return 0;var t=this.visibleHeight-this.scrollHandle.clientHeight;return n>t?t:n},t.prototype._getBoundValue=function(n,t,i){return(t=!t&&t!==0?n:t,i=!i&&i!==0?n:i,t>i)?n:n<t?t:n>i?i:n},t.prototype._isEventOnElement=function(n,t){var i=t.getBoundingClientRect();return this._isEventOnRect(n,i)},t.prototype._isEventOnRect=function(n,t){return n.clientX>t.left&&n.clientX<t.right&&n.clientY>t.top&&n.clientY<t.top+t.height},t.prototype._render=function(){this._setScrollHandleStyle()},t.prototype._setScrollHandleStyle=function(){if(this.scrollHandle){var n=this._enforceMinHandleHeight(this._getScrollHandleStyle());this.scrollHandle.style.height=n.height+"px";this.scrollHandle.style.top=n.top+"px"}},t.prototype._getNewScrollTop=function(t){for(var r=t.offsetTop,i=t.offsetParent,u=n(this.innerContainer);u.has(i);)r+=i.offsetTop,i=i.offsetParent;return r},t.prototype._setScrollTop=function(n){this.innerContainer&&(this.innerContainer.scrollTop!==n&&(this.innerContainer.scrollTop=n),this.scrollPos=n,this.scrollTopChanged.invoke(n))},t}();nr=function(){function n(){this._disposables=[]}return n.prototype.resetLayout=function(n){var r=this._taskManager.getStacks()[0],t,i;r&&(t=r.getForegroundTask(),t&&t.panelRoot&&(this._layoutContainer.append(t.panelRoot),i=document.getElementById("taskBarContainer"),i&&(i.style.visibility="visible")),n&&n.resume())},n.prototype.activate=function(n,t){var r=this,i,u,f;this._taskManager=t;i=this._layoutContainer;i||(u="taskLayoutContainer",f=sr.dashboardConfigs.minWidth,i=this._layoutContainer=n.add_class(u),i.set_style({width:"max(100vw, ".concat(f,"px)")}));this._disposables.push(t.stackAdded.add(function(n){return r.resetLayout(n)}),t.stacksReset.add(function(){return r.resetLayout()}))},n.prototype.deactivate=function(){for(var n=0;n<this._disposables.length;n++)this._disposables[n].dispose();this._disposables=[]},n}();it.registerLayout("DashboardLayout",nr);tr=function(){function n(){}return n.prototype.activate=function(){},n.prototype.deactivate=function(){},n}();it.registerLayout("FullMapLayout",tr);var ir=function(i){function r(n,t,r){var u=i.call(this)||this,f;return u.stacks=r,u.resources=g,u.layoutMetrics=t,f=u._privates,f.defineProperty("focusedStack",function(n,t){u._onFocusedStackChanged(n,t)}),f.defineProperty("slideoutTask",function(n,t){u._onSlideoutTaskChanged(n,t)}),f.defineProperty("hideLeftLane"),u}return f(r,i),r.prototype.closeStackById=function(n){return JSON.stringify({id:n,action:"removeStack"})},r.prototype.closeTaskOrStackIfNotForegroundById=function(n){return JSON.stringify({id:n,action:"removeTaskOrStackIfNotForeground"})},r.prototype.closeTaskByIdFromHeader=function(n){return JSON.stringify({id:n,action:"removeTaskAndReseatChild"})},r.prototype.boolToTitleBarClass=function(n){return n?"titleBar bm_enrichTitle":"titleBar"},r.prototype.displayTitleBar=function(n){var i;if(n&&n.id&&n.id.length>0){var u=n.id,t=n,r=h.features.localSearch;return(r===null||r===void 0?void 0:r.displayWebResultsOnMap)&&((i=t===null||t===void 0?void 0:t._taskState)===null||i===void 0?void 0:i.scenarioKey)&&t._taskState.scenarioKey.indexOf("ERR")>-1?"":n.type==="ItineraryDetailsTask"?"none":u.indexOf("Detail")>-1||n.type==="TransitLineTask"?"none":""}return"none"},r.prototype.displayBackButton=function(n){return n&&o.shouldLeftLaneBeHidden()?"":"none"},r.prototype.hideCloseButton=function(n){return n&&o.shouldLeftLaneBeHidden()?"none":""},r.prototype.hideLeftLane=function(n){return n?"none":""},r.prototype.getSlideoutClass=function(n){return"cardCol slidecard panelContent"+(n?" leftHidden":"")},r.prototype.taskExistsToDisplay=function(n){return n?"":"none"},r.prototype.taskExistsToDisplayNone=function(n){return n?"none":""},r.prototype.slideoutToIsHidden=function(n){return!n},r.prototype.boolToDisplayNone=function(n){return n?"none":""},r.prototype.boolToDisplay=function(n){return n?"":"none"},r.prototype.hideOnIconClass=function(n){return n?"none":"block"},r.prototype.customScrollbarRootClass=function(){return t.customScrollbar?"custom-scroll sticky":"stickyContainer bold"},r.prototype.customScrollbarSlideoutRootClass=function(){return t.customScrollbar?"custom-scroll slide":"stickyContainer bold"},r.prototype.customScrollbarOuterContainerClass=function(){return t.customScrollbar?"outer-container":"bold-scroll-container"},r.prototype.customScrollbarPositioningStyle=function(){return t.customScrollbar?"block":"none"},r.prototype.customScrollbarInnerContainerClass=function(){return t.customScrollbar?"inner-container":null},r.prototype.customScrollbarContentWrapperClass=function(){return t.customScrollbar?"content-wrapper":null},r.prototype.customScrollbarSlideContainerClass=function(){return t.customScrollbar?"bm_slideContainer":null},r.prototype.selectSlideoutTask=function(n){var t=null,i;return n&&n.getAllTasks().length>1&&(i=n.getForegroundTask(),i&&!i.noSlideout&&(t=i)),this.setSlideoutTask(t),gt.setIsSecondColumnDisplayed(!!t),!!t},r.prototype.onBackToTopClick=function(){var n={logData:{feature:"BackToTopButton",action:"C",data:{device:"Desktop"}},impressionGuid:h.dynamicProperties.mapsIG};v.invokeHandler("data-instrumentation",n)},r.prototype._onFocusedStackChanged=function(){var i=this;if(o._getIsSlideCardEnabled()){this.stackChanged&&this.stackChanged.dispose();var r=function(t){var u,r,f;t.name==="foregroundTask"&&(u=i.getSlideoutTask(),i.selectSlideoutTask(t.sender)&&(n(".slidecard .svg").inlineDataSvgs().remove_class("svg"),u||(r=i.getSlideoutTask(),f=r&&r._getTaskState&&r._getTaskState().suppressAnimationWhileSlideOut,n.Transition.run(n(".slidecard"),[{property:_G.RTL?"margin-right":"margin-left",from:"-375px",to:"0",duration:f?0:500}]))))},t=this.getFocusedStack(),u=t&&t.getForegroundTask();r({name:"foregroundTask",oldValue:null,newValue:u,sender:t});this.stackChanged=t&&t.changed.add(r)}},r.prototype._onSlideoutTaskChanged=function(){var n=o.shouldLeftLaneBeHidden();this.setHideLeftLane(n)},r.prototype.dispose=function(){i.prototype.dispose.call(this);this.stackChanged&&this.stackChanged.dispose()},r}(at),gt=function(){function i(n,t,i){var r=this;this._disposables=[];this._controlTemplateFactory=n;this._controlTemplateText=t;this._layoutMetrics=i;this._animationCount=0;this._hideLayoutOnEmptyTasks=!0;this._overflowTaskAddedHandler=function(n){r._onOverflowTaskAdded(n)}}return i.prototype._onTaskCardClick=function(n){var t=n.stack;this._taskManager.toggleStack(t)},i.prototype._onCloseSlidoutClick=function(n){if(n){var t=n.target,i=t&&t.getAttribute("data-tag");this._taskManager.removeTaskAndReseatChild(i);v.invokeHandler("data-instrumentation",{logData:{feature:"TM",action:"C",data:{TID:i,BID:t.classList}}});n.preventDefault();n.stopPropagation()}},i.prototype.refreshStacks=function(n){var f=this,i=this._taskManager.getStacks(),r,t,u;this._stacks.clear();this._stacks.insertAll(i.slice());sj_evt&&i.length===0&&!n&&sj_evt.fire("OnAllTaskStacksRemoved");r=this._cardsContainer.select("[data-taskId]").set_style({visibility:"visible"});this._initTaskCard(r,this._cardsContainer);t=this._taskManager.getFocusedStack();t&&(this.layoutContext.setFocusedStack(t),this._useSlideLayout&&this.layoutContext.selectSlideoutTask(t),t.overflowTaskAdded.add(this._overflowTaskAddedHandler),this._onOverflowTaskAdded(t.getOverflowTask()),u=this._cardsContainer.select("[data-taskId='"+t.id+"']"),this._animateCard(t,u,2,function(){f._scrollToFocusedCard(t,!1)}))},i.prototype._setPadding=function(){this._map.setViewPadding({left:null})},i.prototype._completeAnimation=function(){this._animationCount--;this._animationCount<=0&&(this._animationCount=0,this._layoutSizeHelper.startMonitoring())},i.prototype.onStackAdded=function(n){var f=this,t=n.stack,i,r,u,e;this.layoutContext.setFocusedStack(t);this._useSlideLayout&&this.layoutContext.selectSlideoutTask(t);t.overflowTaskAdded.add(this._overflowTaskAddedHandler);this._onOverflowTaskAdded(t.getOverflowTask());i=this._taskManager.getStacks().slice().indexOf(t);r=0;this._useSlideLayout&&i!==this._taskManager.getStacks().length-1?(this._stacks.insert(t,i),r=5):(i===0&&(r=5),this._stacks.insert(t));u=this._cardsContainer.select("[data-taskId='"+t.id+"']");this._initTaskCard(u,this._cardsContainer);this._animationCount+=2;this._layoutSizeHelper.stopMonitoring();e=function(){f._completeAnimation();f._animationCount<=0&&n.resume()};this._animateCard(t,u,r,e)},i.prototype._onStackRemoved=function(n){var f=this,i=n.stack,t,r,u;(this._stacks.remove(i),i.overflowTaskAdded.remove(this._overflowTaskAddedHandler),sj_evt&&sj_evt.fire("OnTaskStackRemoved",i),n.disableFindingFocusedStack)||(t=this._taskManager.getFocusedStack(),t&&(r=this._cardsContainer.select("[data-taskId='"+t.id+"']"),this._removingFocusedCard?this._animateCard(t,r,4,function(){f._scrollToFocusedCard(t,!0)}):c.setFocusToTitle(t,r)),u=this._taskManager.getStacks(),u&&u.length===0&&(this._layoutSizeHelper.startMonitoring(!0),this._currentStack=null,this._currentFirstTask=null,this._currentslideoutTask=null),this._removingFocusedCard=!1)},i.prototype._onStackRemoving=function(n){var t=n.stack,f=this._cardsContainer.select("[data-taskId='"+t.id+"']"),u=this._taskManager.getFocusedStack(),i,r;this.focusedStack!==t||this._isCollapsed(t)?n.resume():(this._removingFocusedCard=!0,i=2,r=function(){i--;i||n.resume()},u&&(i++,this._scrollToFocusedCard(u,!1,r)),this._animateCard(t,f,3,r))},i.prototype._onStackFocusing=function(n){var u=this,t,i,r;if(this._setPadding(n),t=n.stack,this.layoutContext.setFocusedStack(t),this._useSlideLayout&&this.layoutContext.selectSlideoutTask(t),this._onOverflowTaskAdded(t.getOverflowTask()),i=this._cardsContainer.select("[data-taskId='"+t.id+"']"),this._useSlideLayout&&(this.layoutContext.getSlideoutTask()&&this._resetSlideoutLaneScroll(),t===this.focusedStack&&!this._isCollapsed(t))){t.getAllTasks().length>1?(r=this._slideoutCardsContainer.select("[data-subtaskid='"+t.getForegroundTask().id+"']"),c.setFocusToTitle(t,r)):c.setFocusToTitle(t,i);n.resume&&n.resume();return}this._animationCount+=1;this._layoutSizeHelper.stopMonitoring();this._animateCard(t,i,2,function(){u._completeAnimation();n.resume&&n.resume()})},i.prototype._onStackCollapsed=function(n){var i=n.stack,u=n.task,f=u.getCurrentWidth()||t.defaultCardWidth,r;sj_evt.fire("TaskCardRemoving",f);r=this._cardsContainer.select("[data-taskId='"+i.id+"']");this.layoutContext.selectSlideoutTask(null);this._onOverflowTaskAdded(null);this._animateCard(i,r,4)},i.prototype._scrollToFocusedCard=function(n,t,i){var r=this.focusedStack,f,u;if(this.focusedStack=n,r&&r!==n&&(f=this._cardsContainer.select("[data-taskid='"+r.id+"']"),f.remove_class("focus"),nt.changeStackFocusState(r,1)),!n||!t&&r===n){i&&i();return}if(u=this._cardsContainer.select("[data-taskid='"+n.id+"']"),u.add_class("focus"),nt.changeStackFocusState(n,0),this._fireOnCardFocusEvent(u),this._useSlideLayout&&this._slideoutCardsContainer.select(".taskCard").add_class("focus"),this._skipNextTaskScroll){this._skipNextTaskScroll=!1;i&&i();return}this._scrollLane(n,t,i)},i.prototype._fireOnCardFocusEvent=function(n){sj_evt&&sj_evt.fire("OnCardFocus",n)},i.prototype.activate=function(i,r,u,f){var e=this,o=this._layoutContainer,c,s,h;o||(this._map=f,this._taskManager=r,this._stacks=new si,c="taskLayoutContainer bm_l2NavLeft",o=this._layoutContainer=i.add_class(c),o.set_style(_G.RTL?{right:"0"}:{left:"0"}),ui.whiteBackgroundEnable&&(o.add_class("bm_whitebg"),t.newCardSizingForTCF&&(o.add_class("bm_phase2"),(t.isSafari||t.isOSx)&&o.add_class("bm_safari"),t.isTouchDevice&&!t.isOSx&&o.add_class("bm_touch"),o.add_class("bm_tcftitlea"))),this._coreConfig=u,this._hideLayoutOnEmptyTasks&&this._disposables.push(new et(this._stacks,"length",o[0].style,"display",function(n){return n?"":"none"})),this._hideLayoutOnEmptyTasks&&this._disposables.push(new et(this._map,"Mode",o[0].style,"z-index",function(n){return n&&n.mapModeType===2?"-1":""})),s=this._createTaskListViewModel(u),this.layoutContext=s,this._disposables.push(s),s.onTaskCardClick=function(n){e._onTaskCardClick(n)},s.getWidthString=function(n){var i="CardResize";return n?(e._previousWidth=n,sj_evt.fire(i,n),n+"px"):e._previousWidth?(sj_evt.fire(i,e._previousWidth),e._previousWidth+"px"):(sj_evt.fire(i,t.defaultCardWidth),t.defaultCardWidth+"px")},s.onCloseSlideoutClick=function(n){e._onCloseSlidoutClick(n)},this._controlTemplate=this._controlTemplateFactory({templateText:this._controlTemplateText,staticResources:s}),this._panelWrapper=n(this._controlTemplate.applyDataTemplate(s)),this._initializeDomObjects(),this._registerTouchEvent(s));h=function(n){return e._onStackFocusing(n)};this._disposables.push(r.secondaryTaskAdded.add(h),r.stackAdded.add(function(n){return e.onStackAdded(n)}),r.stackFocusing.add(h),r.stackCollapsed.add(function(n){return e._onStackCollapsed(n)}),r.stackRemoved.add(function(n){return e._onStackRemoved(n)}),r.stackRemoving.add(function(n){return e._onStackRemoving(n)}),r.stacksReset.add(function(){return e.refreshStacks(!1)}));this.refreshStacks(this._coreConfig.noMapResizeOnInit===!0)},i.prototype.deactivate=function(){this._map.setViewPadding({left:0});for(var n=0;n<this._disposables.length;n++)this._disposables[n].dispose();this._disposables=[];this._layoutContainer=null},i.prototype._createTaskListViewModel=function(n){return new ir(n,this._layoutMetrics,this._stacks)},i.prototype._animateCard=function(n,t,i,r){r&&r()},i.prototype._getScrollbarThickness=function(){var n=o._createElement("div"),t=o._createElement("div"),i;return n.append(t),n.appendTo(document.body),n.set_style({overflow:"scroll",height:"100px",width:"100px"}),t.set_style({height:"100%",width:"100%"}),i=new dr(n[0].offsetWidth-t[0].offsetWidth,n[0].offsetHeight-t[0].offsetHeight),n.removeFromParent(),i},i.prototype._getScrollTarget=function(n){return n},i.prototype._resetSlideoutLaneScroll=function(){if(this._useSlideLayout){var n=this._slideoutPanelWrapper[0];n&&(n.scrollTop=0)}},i.prototype._scrollLane=function(n,t,i){var o=this,h=this._cardsContainer.select("[data-taskid='"+n.id+"']"),f;this._panelScrollFromFocus=!0;var s=this._panelWrapper.get_scroll_pos(),c=h.get_relative_pos(),r=this._getScrollTarget(s,c),u=this._panelWrapper[0];r.x=e._clamp(r.x,0,u.scrollWidth);r.y=e._clamp(r.y,0,u.scrollHeight);f=function(){o._cardsContainer.set_style({transform:""});u.scrollTop=r.y;u.scrollLeft=r.x;i&&i();b.setTimeout(function(){o._panelScrollFromFocus=!1},100)};t?f():this.cardsContainerTransition(u,s,r,f)},i.prototype.cardsContainerTransition=function(t,i,r,u){n.Transition.run(this._cardsContainer,[{property:"transform",to:"translate("+(i.x-r.x)+"px, "+(i.y-r.y)+"px)"}],u)},i.prototype._initPanelWrapper=function(){},i.prototype._initSlideoutPanelWrapper=function(){},i.prototype._initTaskCard=function(){},i.prototype._shouldResetScrollTopOfFirstTask=function(){var n=this._taskManager.getFocusedStack(),t=null,i=!1;return n&&(t=n.getAllTasks()[0]),this._currentStack&&this._currentFirstTask&&(n!==this._currentStack||t!==this._currentFirstTask)&&(i=!0),this._currentStack=n,this._currentFirstTask=t,i},i.prototype._shouldResetScrollTopOfSlideoutTask=function(){var n=this._taskManager.getFocusedStack(),t=null,i=!1;return n&&(t=n.getAllTasks()[1]),this._currentStack&&this._currentslideoutTask&&(n!==this._currentStack||t!==this._currentslideoutTask)&&(i=!0),this._currentStack=n,this._currentslideoutTask=t,i},i.prototype._layoutSizeChanged=function(){var n,t;this._customScroll&&(n=this._shouldResetScrollTopOfFirstTask(),n?this._currentFirstTask&&this._customScroll.setScrollPosition(this._currentFirstTask.displayState&&this._currentFirstTask.displayState.scrollTop||0):this._customScroll.scrollToTarget(null));this._slideoutCustomScroll&&(t=this._shouldResetScrollTopOfSlideoutTask(),this._currentslideoutTask&&(t?this._slideoutCustomScroll.setScrollPosition(this._currentslideoutTask.displayState&&this._currentslideoutTask.displayState.scrollTop||0):this._slideoutCustomScroll.scrollToTarget(null)))},i.prototype._scrollOnCardClick=function(){return!0},i.prototype._registerTouchEvent=function(){},i.prototype._isCollapsed=function(){return!1},i.prototype.addScrollHandler=function(n){for(var u,f=this,e=function(t){t&&t.scrollLane&&!i._taskStackScrollHandlerDictionary[t.id]&&(i._taskStackScrollHandlerDictionary[t.id]=t.scrollLane.add(function(i){f.scrollCardsLaneToElement(n,t,i)}))},i=this,t=0,r=n.getAllTasks();t<r.length;t++)u=r[t],e(u)},i.prototype.addScrollToTopHandler=function(n){for(var u,f=this,e=function(t){t&&t.scrollToTop&&!i._taskStackScrollTopHandlerDictionary[t.id]&&(i._taskStackScrollTopHandlerDictionary[t.id]=t.scrollToTop.add(function(i){f.scrollCardsLaneToElement(n,t,i,!0)}))},i=this,t=0,r=n.getAllTasks();t<r.length;t++)u=r[t],e(u)},i.prototype.scrollCardsLaneToElement=function(n,t,i,r){r===void 0&&(r=!1)},i.prototype.removeScrollHandler=function(n){for(var i,t,r=0,u=n.getAllTasks();r<u.length;r++)i=u[r],t=this._taskStackScrollHandlerDictionary[i.id],t&&(t.dispose(),delete this._taskStackScrollHandlerDictionary[i.id]),t=this._taskStackScrollTopHandlerDictionary[i.id],t&&(t.dispose(),delete this._taskStackScrollTopHandlerDictionary[i.id])},i.prototype._initializeDomObjects=function(){var i=this,e="bm_scrollbarMask",r,u,f;this._useSlideLayout?(this._layoutContainer.clear().append(this._panelWrapper.select("."+e)),r=this._layoutContainer.select(".panelWrapper"),this._panelWrapper=n(r[0]),this._slideoutPanelWrapper=n(r[1]),this._initSlideoutPanelWrapper(this._slideoutPanelWrapper),u=".cardCol[data-containerAreaType=cardsContainer]",this._cardsContainer=this._panelWrapper.select(u),this._slideoutCardsContainer=this._slideoutPanelWrapper.select(u)):(f=!(this instanceof ni),this._layoutContainer.clear().append(f?this._panelWrapper.select(".bm_scrollbarMask"):this._panelWrapper),(this._panelWrapper.has_class(e)||f)&&(this._panelWrapper=this._layoutContainer.select(".panelWrapper")),this._cardsContainer=this._panelWrapper.select("[data-containerAreaType=cardsContainer]"));this._taskStackScrollHandlerDictionary={};this._taskStackScrollTopHandlerDictionary={};this._initPanelWrapper(this._panelWrapper);this._layoutSizeHelper=this._useSlideLayout?t.customScrollbar?new pt(n([this._layoutContainer[0],this._cardsContainer[0],this._panelWrapper[0],this._slideoutPanelWrapper[0]]),500):new pt(n([this._layoutContainer[0],this._cardsContainer[0]]),500):new pt(n([this._panelWrapper[0],this._cardsContainer[0]]),500);this._disposables.push(this._layoutSizeHelper.resize.add(function(n){return i._layoutSizeChanged(i._panelWrapper,i._cardsContainer,n)}));this._layoutSizeChanged(this._panelWrapper,this._cardsContainer);this._initCustomScroll(this._layoutContainer)},i.prototype._initCustomScroll=function(i){var r=this,u,f;t.customScrollbar&&(u=i.select(".custom-scroll"),this._customScroll=new ht(n(u[0])),this._customScroll.scrollTopChanged.add(function(t){var u=r._taskManager.getFocusedStack(),i=u&&u.getAllTasks()[0];i&&i===r._currentFirstTask&&i.displayState&&i.displayState.scrollTop!==t&&n("[data-subtaskid="+i.id+"]").get_style("display")!=="none"&&(i.displayState.scrollTop=t)}),this._customScroll.componentDidMount(),this._useSlideLayout&&(this._slideoutCustomScroll=new ht(n(u[1])),this._slideoutCustomScroll.scrollTopChanged.add(function(t){var u=r._taskManager.getFocusedStack(),i=u&&u.getAllTasks()[1];i&&i===r._currentslideoutTask&&i.displayState&&i.displayState.scrollTop!==t&&n(".custom-scroll.slide .cardWrapper").get_style("display")!=="none"&&n(".custom-scroll.slide").getParent().get_style("display")!=="none"&&(i.displayState.scrollTop=t)}),this._slideoutCustomScroll.componentDidMount()),f=function(){r._scrollToTop()},sj_evt.bind("scrollToTop",f),sj_evt.bind("scrollToTarget",function(n){n.length>1&&r._scrollToTarget(n[1])}),sj_evt.bind("slideoutScroll",function(n){n.length>1&&r._slideoutScrollToTarget(n[1])}))},i.prototype._scrollToTop=function(){this._customScroll&&this._customScroll.setScrollPosition(0);this._slideoutCustomScroll&&this._slideoutCustomScroll.setScrollPosition(0)},i.prototype._scrollToTarget=function(n){this._customScroll&&this._customScroll.scrollToTarget(n)},i.prototype._slideoutScrollToTarget=function(n){this._slideoutCustomScroll&&this._slideoutCustomScroll.scrollToTarget(n)},i.setIsSecondColumnDisplayed=function(n){i._isSecondColumnDisplayed=n},i.getIsSecondColumnDisplayed=function(){return i._isSecondColumnDisplayed},i.prototype._onOverflowTaskAdded=function(n){var t=this._layoutContainer;t&&(n?t.add_class("overflowOpen"):t.remove_class("overflowOpen"))},i}(),rr=function(i){function r(n,t,r){r===void 0&&(r=!0);var u=this,f=r&&o._getIsSlideCardEnabled(),e=ou;return u=i.call(this,n,t?t:e,{horizontalAlignment:1,verticalAlignment:0,orientation:1})||this,u._useSlideLayout=f,u}return f(r,i),r.prototype.activate=function(n,r,u,f,e){var s=this,o;i.prototype.activate.call(this,n,r,u,f,e);this._scrollHandler=function(n){var i=s._taskManager.getFocusedStack(),t=i&&i.getForegroundTask();t&&t.laneScrolled&&t.laneScrolled.invoke();sj_evt.fire("nonCustomScrolled",n)};t.customScrollbar?this._panelWrapper.add_event("scroll",this._scrollHandler):n.select(".bold-scroll-container").add_event("scroll",this._scrollHandler);o=function(){return s._resetToggleState()};r.stackFocusing.add(o);r.secondaryTaskAdded.add(o)},r.prototype.deactivate=function(){var r,n,u;for(t.enableBoldUXChanges||this.removeToggleButton(),this._panelWrapper.remove_event("scroll",this._scrollHandler),r=this._taskManager.getStacks(),n=0,u=r.length;n<u;n++)this._removePrimitiveInteractedHandler(r[n]);i.prototype.deactivate.call(this)},r._updateStyle=function(n,t){var i="Light",r="Dark";switch(t){case"road":n.remove_class(r).add_class(i);return;case"birdseye":case"hybrid":case"aerial":case"streetside":n.remove_class(i).add_class(r);return;default:n.remove_class(r).add_class(i)}},r.prototype.refreshStacks=function(n){i.prototype.refreshStacks.call(this,n);for(var t=0,r=this._stacks.length;t<r;t++)this._addPrimitiveInteractedHandler(this._stacks[t])},r.prototype._createTaskListViewModel=function(n){var u=this,r=i.prototype._createTaskListViewModel.call(this,n);return r.onTitleMouseOver=function(n){u._onMouseOverTitle(n)},r.onTitleMouseLeave=function(n){u._onMouseLeaveTitle(n)},t.enableBoldUXChanges&&(r.onToggleCardLane=function(){u._toggleLayout()},r.map=this._map),r},r.prototype._onTaskCardClick=function(n){var u=n.stack,t;this._taskManager.getFocusedStack()!==u&&v.invokeHandler("data-instrumentation",{logData:{T:"CI.SearchCardReactivated",feature:"CD",action:"CI.SearchCardReactivated",data:{entryPoint:"cardheader"}}});t=this._cardsContainer.select("[data-taskId='"+u.id+"']");t.remove_attr("data-cardColor");window.clearTimeout(r._mouseoverDelayHandle);t.get_attr("data-hoverpoi")&&(t.remove_attr("data-hoverpoi"),u.setDisplayState({cardTitleHoveringState:2}));i.prototype._onTaskCardClick.call(this,n)},r.prototype._animateCard=function(n,t,i,r){var f=this,u;this._layoutHidden?(u=function(){f._performAnimation(n,t,i,r)},this._toggleLayout(u)):this._performAnimation(n,t,i,r)},r.prototype._performAnimation=function(t,r,u,f){var s,e=f,h,o;e&&u!==3&&(e=function(){f();c.setFocusToTitle(t,r)});this._updateTaskPanelHeight(this._taskManager.getFocusedStack(),0);switch(u){case 5:case 0:t.setDisplayState({animationState:0},!1);r.set_style({visibility:"visible"});this._updateCardList(t,!0,e);this.addScrollHandler(t);this.addScrollToTopHandler(t);this._addPrimitiveInteractedHandler(t);break;case 3:this._updateCardList(t,!1,e);this.removeScrollHandler(t);this._removePrimitiveInteractedHandler(t);break;case 2:t.setDisplayState({animationState:0},!1);this._updateCardList(t,!1,e);this.addScrollHandler(t);this.addScrollToTopHandler(t);break;case 4:for(r.set_style({height:"36px",overflow:"hidden"}),r.add_class("collapsed"),h=r.select(".".concat("cardTitleText")),o=0;o<h.length;o++)h[o].setAttribute("aria-expanded","false");this._panelWrapper[0].scrollTop=0;this._updateTaskPanelHeight(t,36);this._useSlideLayout&&this._addTitleMaskToStack(t)}u!==2&&(s&&s.length?n.Transition.run(r,s,e):i.prototype._animateCard.call(this,t,r,u,e))},r.prototype._getScrollTarget=function(n,t){return new wr(n.x,t.y-96)},r.prototype._initPanelWrapper=function(n){var i=this,r=this._useSlideLayout,u;r?(this._layoutContainer.add_class("slideout"),this._layoutContainer.remove_class("flipcard")):(this._layoutContainer.add_class("flipcard"),n.getParent().remove_class("slideout"));u=r?this._getScrollbarThickness().width:0;n.add_class("leftPanel noScroll").add_event(r?"mouseenter":"mouseover",function(){i._getLaneContentHeight()>i._panelWrapper[0].clientHeight&&i._updateScrollingOnPanel(n,0,!0)}).add_event(r?"mouseleave":"mouseout",function(){i._updateScrollingOnPanel(n,u,!1)});this._updateScrollingOnPanel(n,u,!1);this._taskPrimitiveInteractedHandlerDictionary={};t.enableBoldUXChanges?this._addStackChangedEvent():this.addToggleButton();this._taskStackChangeHandlerDictionary={}},r.prototype._initSlideoutPanelWrapper=function(n){var t=this,i=this._getScrollbarThickness().width;n.add_event("mouseenter",function(){t._slideoutCardsContainer[0].clientHeight>n[0].clientHeight&&t._updateScrollingOnPanel(n,0,!0)}).add_event("mouseleave",function(){t._updateScrollingOnPanel(n,i,!1)});this._updateScrollingOnPanel(n,i,!1)},r.prototype._getLaneContentHeight=function(){return this._cardsContainer[0].clientHeight},r.prototype._layoutSizeChanged=function(n,r,u){var s,o,e,a,f;if(n){var h=r[0],v=h&&h.lastElementChild,c=u&&u[0]&&u[0].height,l=u&&u[1]&&u[1].height;c===this._panelHeight&&l===this._cardsHeight&&u||(this._panelHeight=c,this._cardsHeight=l,o=this._taskManager.getFocusedStack(),e=o&&this._cardsContainer.select("[data-taskId='"+o.id+"']"),(e===null||e===void 0?void 0:e.length)===0&&(e=null),a=e&&e.get_size().height,t.noStopSizeMonitoring||this._updateTaskPanelHeight(o,a));(s=this._customScroll)===null||s===void 0?void 0:s.componentDidUpdate(!1)}t.enableBoldUXChanges&&(f=this.focusedStack&&this.focusedStack.getForegroundTask(),f&&(f.displayState&&f.displayState.stackOrder===2||f.getRecommendedWidth()!==f.getCurrentWidth()||f.getCurrentWidth()===944||f.getCurrentWidth()===484)&&f.resizeCompleted.invoke());i.prototype._layoutSizeChanged.call(this,n,r,u)},r.prototype._isCollapsed=function(n){var t=n&&this._cardsContainer.select("[data-taskId='"+n.id+"']"),i=t&&t.get_size().height;return i===36},r.prototype._changeCategoryIconDisplayState=function(n){var t=n.select(".catIcon");return t.set_style({display:"none"}),!0},r.prototype._resetToggleState=function(){this._layoutHidden&&this._toggleLayout()},r.prototype._onMouseOverTitle=function(t){var e=this._getTitleBar(n(t.target)),f;e.add_class("hover");var i=e.get_ancestor(2),r=i.get_attr("data-taskid"),o=this._taskManager.getStackById(r),u=c._getCardCssClassForTask(r,this._cardsContainer),s=u.indexOf(c.GrayedOutStyle)!==-1,h=u.indexOf("focus")!==-1;s&&(f="ac"+o.displayState.colorIndex,i.set_attr("data-cardColor",f),this._replaceCardClass(i,r,u,f+" hovering"));(s||!h)&&this._showHoverPois(i,o)},r.prototype._replaceCardClass=function(n,t,i,r){var u=c._replaceCardClass(t,this._cardsContainer,r);n.remove_class(i);n.add_class(u)},r.prototype._showHoverPois=function(n,t){window.clearTimeout(r._mouseoverDelayHandle);r._mouseoverDelayHandle=b.setTimeout(function(){n&&n.set_attr("data-hoverpoi",1..toString());t&&t.setDisplayState({cardTitleHoveringState:1});var i=t&&t.getForegroundTask();i&&v.invokeHandler("data-instrumentation",{logData:{feature:"CD",action:"H",data:{TT:i.type,TID:i.id,SID:t.id,GN:t.displayState.groupName,CI:t.displayState.colorIndex,PR:t.displayState.prominence}}})},300)},r.prototype._onMouseLeaveTitle=function(t){var u=this._getTitleBar(n(t.target));u.remove_class("hover");var i=u.get_ancestor(2),f=i.get_attr("data-cardColor"),e=i.get_attr("data-taskid"),o=this._taskManager.getStackById(e);f&&(i.remove_attr("data-cardColor"),this._replaceCardClass(i,e,f+" hovering",c.GrayedOutStyle));window.clearTimeout(r._mouseoverDelayHandle);i.get_attr("data-hoverpoi")&&(i.remove_attr("data-hoverpoi"),o.setDisplayState({cardTitleHoveringState:2}));this._changeCategoryIconDisplayState(u,"hovered","decayed")},r.prototype._getTitleBar=function(n){for(var t=n;t&&!t.has_class("titleBar");)t=t.getParent();return t},r.prototype._getStackIndex=function(n){for(var i=this._taskManager.getStacks(),r=i.length,t=0;t<r;t++)if(i[t]===n)return t;return-1},r.prototype._updateTaskPanelHeight=function(n,i){if(t.noStopSizeMonitoring){this._layoutContainer&&this._layoutContainer.set_style({bottom:n&&i===36?"auto":""});return}if(n&&i===36){var r=this._cardsContainer.get_size().height;this._layoutContainer.set_style({height:r+"px"})}else this._layoutContainer.set_style({height:""})},r.prototype._updateScrollingOnPanel=function(i,r,u){var l,s,h,f,e,c;if(!t.customScrollbar){if(l=i.select(".selectionCardClass"),l.length!==0||!o._getIsSlideCardEnabled()||n.Browser.is_safari||t.isOSx)return;this._layoutSizeHelper&&this._layoutSizeHelper.stopMonitoring();s=u?-r:r;h=-s+"px";i.set_style(_G.RTL?{"margin-left":h}:{"margin-right":h});f=void 0;f=this._useSlideLayout?s+"px":u?"0":"";i.select("> *").set_style(_G.RTL?{"padding-left":f}:{"padding-right":f});o.isSlideOutCard(this._taskManager.getFocusedStack())&&n.Browser.is_ie&&n.Browser.ie_version<12&&i.has_class("slide")&&(e=n(".bm_cardClose"),c=u?"0":"",e&&e.length>0&&e.set_style(_G.RTL?{"margin-left":c}:{"margin-right":c}));this._layoutSizeHelper&&this._layoutSizeHelper.startMonitoring(!0)}},r.prototype._updateCardList=function(n,i,u,f){var y=this,p,l,rt,d,g,w,v,nt;f===void 0&&(f=!0);this._cardFocusTimer&&(this._cardFocusTimerCallback&&(this._cardFocusTimerCallback(),this._cardFocusTimerCallback=null),clearTimeout(this._cardFocusTimer));var tt=this._taskManager.getStacks(),k=tt.length,s,e,h=0,a=0,it="";for(p=0;p<k;p++)if(l=tt[p],l)if(e=this._cardsContainer.select("[data-taskId='"+l.id+"']"),l===n)s=e,this._useSlideLayout&&(rt="[data-taskid='"+l.id+"'] .title",d=this._panelWrapper.select(rt+" .titleMask"),d.length!==0&&d.removeFromParent());else{for(e.set_style({height:"36px",overflow:"hidden",transition:r._transitionStyleFormat.replace("{duration}","0.3")}),e.swap_class("focus","collapsed hidden"),l.setDisplayState({isHidden:!0}),o._getIsSlideCardEnabled()||e.add_class("hidden"),g=e.select(".".concat("cardTitleText")),w=0;w<g.length;w++)g[w].setAttribute("aria-expanded","false");this._useSlideLayout&&this._addTitleMaskToStack(l)}return v=n.getForegroundTask(),!i&&t.enableBoldUXChanges&&v&&v.shouldResize()&&v.getRecommendedWidth()!==null&&v.resizeCard.invoke(),k===1?(h=0,a=0):(h=s?s.select("div.front").get_size().height:0,h&&(a=this._getAnimationDurationForHeight(h))),a=k===1?0:this._getAnimationDurationForHeight(h),it=r._transitionStyleFormat.replace("{duration}",a.toString()),nt=function(){var t={overflow:"hidden",transition:it},i;h&&(t.height=h+"px");s&&s.set_style(t);e&&e.add_class("collapsed");y._cardFocusTimerCallback=u;i=function(){var r,f,i,t;if(s&&(s.set_style({height:"",overflow:""}),s.remove_class("collapsed"),e))for(f=e.select(".".concat("cardTitleText")),i=0;i<f.length;i++)f[i].setAttribute("aria-expanded","true");n&&n.setDisplayState({animationState:1},!1);u&&u();y._cardFocusTimerCallback=null;c.taskHasBeenInitialized=!0;t=y._taskManager.getFocusedStack();((r=t===null||t===void 0?void 0:t.getFirstTask())===null||r===void 0?void 0:r.type)==="LocalGuideL2Task"&&t===n&&t.setDisplayState({activationState:1})};y._cardFocusTimer=b.setTimeout(i,a*1e3)},f?this._scrollToFocusedCard(n,!0,nt):nt(),a},r.prototype._getAnimationDurationForHeight=function(n){return n<500?.3:n<1e3?.5:.6},r.prototype.scrollCardsLaneToElement=function(n,t,i,r){r===void 0&&(r=!1);this._taskManager.getFocusedStack()===n&&(n.getForegroundTask()===t||this._useSlideLayout)&&(r||!i.is_element_inView())&&(i===t.panelRoot?this._scrollLane(n,!0):this._panelWrapper[0].scrollTop=i.get_relative_pos().y)},r.prototype._addPrimitiveInteractedHandler=function(n){var i=this,r,t,u;if(this._useSlideLayout){for(r=n.getAllTasks(),t=0;t<r.length;t++)this._updatePrimitiveInteractedDictionary(r[t]);this._disposables.push(n.taskAdded.add(function(n){i._updatePrimitiveInteractedDictionary(n)}));this._disposables.push(n.tasksRemoved.add(function(n){for(var t=0,r=n.length;t<r;t++)i._removePrimitiveInteractedHandlerFromTask(n[t])}))}else u=n.getForegroundTask(),this._updatePrimitiveInteractedDictionary(u);this._taskStackChangeHandlerDictionary[n.id]||(this._taskStackChangeHandlerDictionary[n.id]=n.flipAnimationCompleted.add(function(){return i._primitiveInteractedHandlerForFlippedStack(n)}))},r.prototype._primitiveInteractedHandlerForFlippedStack=function(n){var t=n.getForegroundTask();this._updatePrimitiveInteractedDictionary(t)},r.prototype._updatePrimitiveInteractedDictionary=function(n){var t=this;n&&n.primitiveInteracted&&!this._taskPrimitiveInteractedHandlerDictionary[n.id]&&(this._taskPrimitiveInteractedHandlerDictionary[n.id]=n.primitiveInteracted.add(function(n){return t._primitiveInteractedHandler(n)}))},r.prototype._primitiveInteractedHandler=function(n){n&&n.action!==0?n.action===1&&n.element?n.element.appendTo(this._layoutContainer.getParent()):n.action===2?t.noStopSizeMonitoring||this._layoutSizeHelper.stopMonitoring():n.action===3&&(t.noStopSizeMonitoring||this._layoutSizeHelper.startMonitoring(!0)):this._layoutHidden&&this._toggleLayout()},r.prototype._removePrimitiveInteractedHandler=function(n){var t=this;n.getAllTasks().forEach(function(n){t._removePrimitiveInteractedHandlerFromTask(n)});n.flipAnimationCompleted.remove(this._primitiveInteractedHandlerForFlippedStack);this._taskStackChangeHandlerDictionary[n.id].dispose();delete this._taskStackChangeHandlerDictionary[n.id]},r.prototype._removePrimitiveInteractedHandlerFromTask=function(n){var t=this._taskPrimitiveInteractedHandlerDictionary[n.id];t&&(n&&n.primitiveInteracted&&n.primitiveInteracted.remove(this._primitiveInteractedHandler),t.dispose(),delete this._taskPrimitiveInteractedHandlerDictionary[n.id])},r.prototype.addToggleButton=function(){var u=this,i=n(".toggleButton"),t;i.length>0&&i.removeFromParent();t=this._toggleButton=o._createElement("a");t.add_class("toggleButton hide").add_event("click",function(n){n.stopPropagation();n.preventDefault();u._toggleLayout()}).add_event("keydown",function(t){if(e._isMapsOverlay()&&t&&t.keyCode&&t.keyCode===9&&!t.shiftKey){var i=n("#maps_sb");i.length>0&&(t.preventDefault(),t.stopImmediatePropagation(),i[0].focus())}}).set_style({visibility:"hidden"}).set_attr("data-tag","toggleButtonHide").set_attr("href","#").set_attr("role","button").set_attr("aria-expanded","true").set_attr("title",g.L_CardLayoutExpandCollapse_Text);t.appendTo(this._layoutContainer);r._updateStyle(t,this._map.getStyle());this._addStackChangedEvent();this._disposables.push(new et(this._stacks,"length",this._toggleButton[0].style,"visibility",function(n){return n?"":"hidden"}),new et(this._map,"Mode",this._toggleButton[0].style,"z-index",function(n){return n&&n.mapModeType===2?"-1":""}))},r.prototype._addStackChangedEvent=function(){var n=this;this._disposables.push(this._stacks.changed.add(function(t){var f=t.added,u,i,r;if(f)for(u=function(i){var r=t.added[i];n._disposables.push(r.onHiddenStateChanged.add(function(t){var i=n._cardsContainer.select("[data-taskId='"+r.id+"']");i&&(t?i.swap_class("focus","hidden"):i.remove_class("hidden"))}))},i=0,r=t.added.length;i<r;i++)u(i,r)}))},r.prototype.removeToggleButton=function(){this._toggleButton.removeFromParent()},r.prototype._toggleLayout=function(t){var h=this,o,u=this._taskManager.getFocusedStack(),f=u&&u.getForegroundTask(),s;this._panelWrapper=(o=this._panelWrapper)!==null&&o!==void 0?o:n(".panelWrapper.leftPanel");var c={logData:{feature:"CD",action:this._layoutHidden?"EX":"CL",data:{TT:f&&f.type,TID:f&&f.id,SID:u&&u.id}},isMapsAction:!1},i=this._toggleButton,r=this._layoutContainer,l=function(){var n="aria-expanded";h._layoutHidden?i&&(i.swap_class("hide","show"),i.set_attr(n,"false")):(i&&(i.swap_class("show","hide"),i.set_attr(n,"true")),h._map.setViewPadding({left:r.get_size().width-12}));t&&t()};r[0].addEventListener("transitionend",l,{once:!0});this._layoutHidden?(this._layoutHidden=!1,r.set_style({transform:""}),this._panelWrapper.set_style({display:""})):(this._layoutHidden=!0,s=r.get_size().width-12,this._map.setViewPadding({left:10}),r.set_style({transform:"translate3d(".concat(e._isRtl()?s:-s+10,"px, 0,0)")}),this._panelWrapper.set_style({display:"none"}));v.invokeHandler("data-instrumentation",c)},r.prototype._addTitleMaskToStack=function(n){var i,t,r;n&&n.getForegroundTask()&&(i="[data-taskid='"+n.id+"'] .title",this._panelWrapper.select(i+" .titleMask").length===0&&(t=document.createElement("h2"),t.className="titleMask",t.textContent=n.getForegroundTask().getTitle(),r=this._panelWrapper.select(i),r.insertBefore(t,r.select("h2"))))},r.prototype._onOverflowTaskAdded=function(n){i.prototype._onOverflowTaskAdded.call(this,n);var t=this._toggleButton;t&&(n?t.set_style({display:"none"}):t.set_style({display:""}))},r._transitionStyleFormat="height {duration}s cubic-bezier(0.445, 0.05, 0.55, 0.95)",r}(gt);it.registerLayout("MultiCardLeftLayout",rr);ni=function(i){function u(n){var r=this,u=t.customScrollbar?hu:cu;return r=i.call(this,n,u,!1)||this,r._hideLayoutOnEmptyTasks=!1,r}return f(u,i),u.prototype._animateCard=function(n,t,r,u){switch(r){case 0:i.prototype._animateCard.call(this,n,t,r,u);break;default:u&&u()}},u.prototype._onTaskCardClick=function(){},u.prototype._getLaneContentHeight=function(){return this._cardsContainer[0].clientHeight+this._selectionCardContainer[0].clientHeight},u.prototype._updateTaskPanelHeight=function(){if(t.noStopSizeMonitoring){this._panelWrapper.getParent().set_style({bottom:""});return}this._panelWrapper.getParent().set_style({height:""})},u.prototype.activate=function(u,f,e,o){var s=this;this._map=o;this._container=o.getContainer();n(".mapContainer").set_style({"min-height":"0px"});this._taskManager=f;this._container.instanceAsync("BrowserHistoryManager",function(n){s._browserHistoryManager=n;s._browserHistoryManager.setIsCapturing(!1);s._browserHistoryManager.register("MultiCardSelectionLayout",{serialize:function(){},deserialize:function(){v.invokeHandler("data-share",{action:"closeShare"})},serializableObjectChanged:new r});i.prototype.activate.call(s,u,f,e,o);s._layoutContainer.set_attr("style","");s._selectionCardContainer=s._panelWrapper.select(".selectionCardClass");s._currentTaskListViewModel.getSelectionControl().controlUpdated.add(function(){t.customScrollbar&&s._enableScrollbar()});s._currentTaskListViewModel.getSelectionControl().refresh();s._cardsContainer.set_style({display:"none"});t.customScrollbar&&s._initCustomScroll(s._layoutContainer)})},u.prototype.deactivate=function(){var u,t,f,r;for(i.prototype.deactivate.call(this),n(".mapContainer").set_style({"min-height":ui.windowMinHeight+"px"}),this._selectionCardContainer=null,u=this._taskManager.getStacks(),t=this._taskManager.getFocusedStack(),f=0;f<u.length;f++)r=u[f],r&&(r.setIsLocked(!1),r.setIsSelected(!1),r.displayState.activationState===4&&(r.displayState.activationState=3));t||(t=u[0]);t&&t.displayState&&t.displayState.prominence!==1&&(t.displayState.prominence=1,this._taskManager.updateProminences(t));this._browserHistoryManager.unregister("MultiCardSelectionLayout");this._browserHistoryManager.setIsCapturing(!0);this._map=null;this._container=null;this._taskManager=null;this._browserHistoryManager=null},u.prototype._createTaskListViewModel=function(n){return this._currentTaskListViewModel=new bf(n,this._layoutMetrics,this._taskManager,this._map.getContainer(),this._stacks),this._currentTaskListViewModel},u.prototype._enableScrollbar=function(){var i=n("#b_footer"),r,t,u;i.length>0&&(r=i[0].getBoundingClientRect().top,t=n(".linkBox",this._panelWrapper[0]),t.length>0&&(u=t[0].getBoundingClientRect().bottom,u>=r&&this._customScroll.componentDidUpdate()))},u.prototype.addToggleButton=function(){},u.prototype.removeToggleButton=function(){},u.prototype._fireOnCardFocusEvent=function(){},u.prototype.addScrollHandler=function(){},u.prototype.addScrollToTopHandler=function(){},u.prototype.scrollCardsLaneToElement=function(n,t,i,r){r===void 0&&(r=!1)},u.prototype.removeScrollHandler=function(){},u}(rr);it.registerLayout("MultiCardLeftSelectionLayout",ni);var k=function(n){function i(t,i){function e(n){var t,i,r=(i=(t=n.primitive)===null||t===void 0?void 0:t.metadata)===null||i===void 0?void 0:i.sourcePrimitive;return new tu(r,n.event)}var u=n.call(this)||this,f;return u._disposables=[],u._primitiveMap={},u._map=t,u._templateSelector=t.getTemplateSelector(),f=u._primitiveManager=new hi.PrimitiveManager(t.getAzureMap()),f.modifyLayerGroupCallback=function(n,t){u._modifyLayerGroup(n,t)},f.setLayerOptionsCallback=function(n){u._setLayerOptions(n)},u.id="".concat(i).concat(u.id),f.id="".concat(u.id,";").concat(f.id),u._disposables.push(f,u.viewChanged=new r,u.poiViewStateChanged=new r,u.primDragStart=new r,u.primDragging=new r,u.primDragEnd=new r,u.primDragCancel=new r,u.primHoverStart=new r,u.primHoverStop=new r,u.primTapped=new r,f.primitiveDragStart.add(function(n){u.primDragStart.invoke(e(n))}),f.primitiveDragging.add(function(n){u.primDragging.invoke(e(n))}),f.primitiveDragEnd.add(function(n){u.primDragEnd.invoke(e(n))}),f.primitiveDragCancel.add(function(n){u.primDragCancel.invoke(e(n))}),f.primitiveHoverStart.add(function(n){u._onPrimitiveHover(e(n),!0)}),f.primitiveHoverStop.add(function(n){u._onPrimitiveHover(e(n),!1)}),f.primitiveClicked.add(function(n){u._onPrimTapped(e(n))}),f.primitiveRightClicked.add(function(n){u._onContextMenuInvoked(e(n))})),u}return f(i,n),i.prototype.setPrimitives=function(n,t){if(n&&!this._isDisposed){this._primitives=n;var i=this._isPrimaryProminence()&&!t;this._updatePrimitives(i,!0)}},i.prototype.suppressViewChangeOnRefreshOnce=function(){this._suppressViewChangeOnRefreshOnce=!0},i.prototype.getPrimitiveAt=function(n){return this._primitives&&n>=0&&n<this._primitives.length?this._primitives[n]:null},i.prototype.setTaskDisplayState=function(n){n=n||{};var t=this._taskDisplayState||{},h=t.prominence,c=n.prominence,u=n.cardTitleHoveringState,a=i._prominenceOrActivationChanged(n,t),r=this._taskDisplayState=l(l({},t),n),f=r.prominence,e=!1,o=!1;if(this instanceof w&&(e=f>=3,o=h>=3),e)u===1?this._updatePrimitives(!1,!0):this._primitiveManager.clear();else{var v=this._primitives&&(c||a),s=f===1&&!n.suppressViewChange,y=s&&r.activationState===1&&!r.isHidden;y||(this._lastBestView=null);v?this._updatePrimitives(s,o):u&&this._updatePrimitives(!1)}},i.prototype.dispose=function(){this._isDisposed||(e._clearDisposables(this._disposables),e._nullifyClass(this),this._isDisposed=!0)},i.prototype.getPrimitives=function(){return[Promise.resolve(this._primitives)]},i.prototype.refreshMap=function(n,t){if(!this._isDisposed&&!(Object.keys(i._poiAnimations).length>0))if(this._suppressViewChangeOnRefreshOnce&&(n=!1,this._suppressViewChangeOnRefreshOnce=!1),t||Object.keys(this._primitiveMap).length===0){this._primitiveMap={};var r=this.getPrimitives();this._externalSource&&r.push.apply(r,this._externalSource.getPrimitives());this._addPrimitives(r,n)}else this._updateBMSPs(n)},i.prototype._addPrimitives=function(n,t){var r=this,u,i,f,e;if(n.length)for(u=!0,i=0,f=n;i<f.length;i++)e=f[i],e.then(function(n){r._isDisposed||(u&&(r._primitiveManager.clear(),u=!1),r._addBMSPs(n,t))});else this._primitiveManager.clear()},i.prototype._modifyLayerGroup=function(){},i.prototype._setLayerOptions=function(){},i.prototype._convertPrimitives=function(n){function h(n,t){var r,i;return n===1?(i=t,r={geometryType:1,x:i.x,y:i.y}):n===2?(i=t,r={geometryType:2,x:i.x,y:i.y,bbox:i.boundingBox}):n===3&&(i=t,r={geometryType:3,rings:i.rings,bbox:i.boundingBox}),r}for(var t,r,f=[],u=0,o=n;u<o.length;u++)if(t=o[u],!t.isDisposed){t.id||(t.id=e._nextId().toString());var s=this._getPoiType(t),c=h(t.geometryType,t.geometry),l=this._getPoiState(t),a=typeof t.isDragEnabled=="function"&&t.isDragEnabled(),i={id:t.id,geometry:c,bucket:t.bucket,primitiveType:s,state:l,stylesheetEntry:t.stylesheetEntry,stylesheetEntryState:t.stylesheetEntryState,metadata:{sourcePrimitive:t},isDragEnabled:a};t.geometryType===1&&(i.title=this._getTitle(t),i.title&&(i.subtitle=d.getSecondaryDisplayName(t.entity)),i.iconText=this._getIconText(t)||null,i.badge=d.getBadgeType(t.entity),r=t.zIndex,r||(r=i.state===3||i.state===7?4:s===2?3:2),i.drawOrder=r);f.push(i);this._primitiveMap[t.id]=t}return f},i.prototype._addBMSPs=function(n,t){if(n&&!this._isDisposed){var i=this._convertPrimitives(n);this._primitiveManager.add(i);t&&this._updateView()}},i.prototype._updateView=function(){var i=this,n=this.computeBestView();ft.areViewEqual(n,this._lastBestView)||n&&(this.disableComputingMapViewForLoadingOnly?t.fixSharedMapView||setTimeout(function(){i.disableComputingMapViewForLoadingOnly=!1},0):(this._lastBestView=n,this._map.setView(n,function(){i._isDisposed||i.viewChanged.invoke(n)})))},i.prototype._updateBMSImpl=function(n){var u,s,r,h,c,y,f,l,o,p;if(!(Object.keys(i._poiAnimations).length>0)){var a=this._convertPrimitives(n),w=["id","geometry","drawOrder","metadata"],v=this._primitiveManager.getPrimitives(),t;if(v)for(t=[],u=0,s=a;u<s.length;u++)if(r=s[u],h=v[r.id],h){if(c=h.primitive,c)for(y=Object.keys(r),f=0,l=y;f<l.length;f++)if((o=l[f],!(w.indexOf(o)>0))&&(p=e.areValuesEqual(c[o],r[o]),!p)){t.push(r);break}}else t.push(r);else t=a;t&&t.length>0&&this._primitiveManager.update(t)}},i.prototype._updateBMSPs=function(n){this._primitives&&!this._isDisposed&&(this._updateBMSImpl(this._primitives),n&&this._updateView())},i.prototype._updateBMSP=function(n){n&&!this._isDisposed&&this._primitiveMap[n.id]&&this._updateBMSImpl([n])},i.prototype._allowPoiState=function(n,t){return t!==4},i.prototype.setExternalSource=function(n){this._externalSource=n},i.prototype.setPoiState=function(n,r){var u,f,e,o,s,h;n&&(u=n,f=u.viewState,f!==r&&(this.poiViewStateChanged.invoke(new hf(this,u,u.viewState,r)),this._setPrimitiveZIndex(u,r),e=d.getYpid(u.entity),o=i._poiAnimations[e],!o&&t.poiPopAnimation&&this._getPoiType(u)===1&&(f===3||f===2)&&r===4?(u.viewState=7,this._updateBMSP(u),u.viewState=4,s=this._convertPrimitives([u])[0],h=i._poiAnimations[e]=li.popupAnimation(this._map.getAzureMap(),s,this._primitiveManager),h.then(function(){delete i._poiAnimations[e]})):this._allowPoiState(u,r)&&(u.viewState=r,this._updateBMSP(u)),r===7&&li.reset(),i._createEntityChangedEvent(u),u.entity&&u.entity.changed.invoke()))},i.prototype._setPrimitiveZIndex=function(n,t){var r=n.entity&&n.entity.isPaginationReducedPoi,i=n.isSecondary?1:2;t===3?i=4:this._hasClientPagination&&!r&&(i=3);n.zIndex=i},i.prototype.getZIndex=function(){return 1},i.prototype.setZIndex=function(n){this._primitiveManager&&this._primitiveManager.setDrawOrder(n)},i.prototype.setViewFromBackend=function(n){var t,i;Array.isArray(n)?(i=y.BoundingBox.fromLatLngs(n),t=this._map.getCameraForBounds(i),t.bounds=i):t=n;this._viewFromBackend=t},i.prototype._getTargetView=function(){var n=this._primitives,t=ft.getPositions(n);return hi.ViewHelper.viewFromPositions(this._map.getAzureMap(),t)},i.prototype.computeBestView=function(){var t=null,i=this._primitives,n,u,e,f;if(i){var o=ft.getPositions(i),s=this._map.getBounds(),r=0;for(n=0,u=o;n<u.length;n++)e=u[n],y.BoundingBox.containsPosition(s,e)&&++r;f=this._getTargetView();r===i.length?t=f:0===r&&(t=this.findBestViewForPrimitivesNotInView(f))}return t},i.prototype.findBestViewForPrimitivesNotInView=function(n){return{center:n.center,zoom:Math.min(n.zoom,e.convertZoom(t.defaultZoomLevel,1))}},i.prototype._onPrimitiveHover=function(n,t){var r=n.primitive,u,f,e;r&&r.viewState!==4&&r.viewState!==7&&(sj_evt&&i._primitiveHasRichInfobox(r)&&(u=t?"pushpinhoverstarted":"pushpinhoverstopped",sj_evt.fire(u,r)),f=t?3:2,this.setPoiState(r,f));e=t?this.primHoverStart:this.primHoverStop;e.invoke(n)},i.prototype._onPrimTapped=function(n){this._resetHoveredPoi(n.primitive);this.setPoiState(n.primitive,4);this.primTapped.invoke(n)},i.prototype._onContextMenuInvoked=function(n){this._resetHoveredPoi(n.primitive)},i.updatePrimitiveForLabeling=function(n,t){var i=n.entity||{},r,f,u;!n.bucket&&i.getSelectedCategoryForIcon&&(r=i.getSelectedCategoryForIcon(),r||(r=t.extractCategoryId(i.getPrimaryCategoryPath(!0),!0),i.setSelectedCategoryForIcon(r)),n.bucket=t.getBucketForCategory(r,!0));f=i.getSearchCategory&&i.getSearchCategory();u=t.getBucketForCategory(f,!1);u&&u!==n.bucket&&(n.stylesheetEntry=t.getPaletteKeyForBucket(u))},i.prototype._updatePrimitiveForLabeling=function(n){i.updatePrimitiveForLabeling(n,this._templateSelector)},i.prototype._isPrimaryProminence=function(){return this._isProminenceEqualTo(1)},i.prototype._resetHoveredPoi=function(n){var t=n;!this._isPrimaryProminence()&&t&&t.viewState!==4&&t.viewState!==7&&this.setPoiState(t,2)},i.prototype._isProminenceEqualTo=function(n){return this._taskDisplayState&&this._taskDisplayState.prominence===n},i.prototype.setDeserializedView=function(n){this._dView=n},i.prototype._updatePrimitives=function(n,t){var r=this,u=function(){var s,f,e,u,o;if(r._primitives){for(s=function(){return!0},r._hasClientPagination=!1,f=0,e=r._primitives;f<e.length;f++)u=e[f],u.isHoverEnabled||(u.isHoverEnabled=s),o=u.entity,!r._hasClientPagination&&o&&o.isPaginationReducedPoi&&(r._hasClientPagination=!0),i._createEntityChangedEvent(u),u.taskDisplayState=r._taskDisplayState,r._updatePrimitiveForLabeling(u);r.refreshMap(n,t)}};this._templateSelector&&this._templateSelector.selectorReady().then(u)},i._createEntityChangedEvent=function(n){n.entity&&!n.entity.changed&&(n.entity.changed=new r)},i._primitiveHasRichInfobox=function(n){var e=["90287","90232","30949","30359","91572","13344","30646","30697","house"],t,u,i,f,r;if(n){if((t=n.entity,t&&t.infoboxHtml)||n.entity instanceof fu)return!0;if(u=t&&t.getPrimaryCategoryPath&&t.getPrimaryCategoryPath(),i=u&&u.split("."),i&&i.length)for(f=i.length,r=0;r<f;++r)if(i[r]&&e.indexOf(i[r].toLowerCase())>-1)return!0}return!1},i.prototype._getTitle=function(n){var t,i=n.entity,r=n,u=!0;return this._getPoiType(n)!==2&&r.viewState!==7&&!i.disablePoiLabel&&(this instanceof ct||this._isPrimaryProminence()||((t=r.taskDisplayState)===null||t===void 0?void 0:t.cardTitleHoveringState)===1)||(u=!1),u?d.getDisplayName(i):""},i.prototype._getIconText=function(n){return d.getIconText(n.entity)},i.prototype._getPoiState=function(n){return n.bucket&&d.getPoiState(n)},i.prototype._getPoiType=function(n){return d.getPoiType(n.entity)},i.prototype.setVisible=function(n){this._primitiveManager.setLayerOptions({visible:n})},i._prominenceOrActivationChanged=function(n,t){var r=t.activationState,i=n.activationState,u=t.prominence,f=n.prominence;return(r!==i||u!==f)&&i===1},i._poiAnimations={},i}(lr),ku=function(n){function u(t){var i=n.call(this,t,"CollectionsTaskPoiManager")||this;return i._isCollection=!0,i._newPrimitive=null,i._linePrimitives=[],i._lineLayers=[],i._lineSources=[],i._polygonPrimitives=[],i._polygonLayers=[],i._polygonSources=[],i._symbolLayers=[],i._symbolSources=[],i}return f(u,n),u.prototype.showAll=function(){this._primitives&&this._map.setView(n.prototype._getTargetView.call(this))},u.prototype.showPrimitive=function(n){if(n){var t=this._getMapViewForPrimitive(n);this._map.setView(t)}},u.prototype.dispose=function(){this._disposeLayers(this._lineLayers);this._lineLayers=[];this._disposeSources(this._lineSources);this._lineSources=[];this._linePrimitives=[];this._disposeLayers(this._polygonLayers);this._polygonLayers=[];this._disposeSources(this._polygonSources);this._polygonSources=[];this._polygonPrimitives=[];this._disposeLayers(this._symbolLayers);this._symbolLayers=[];this._disposeSources(this._symbolSources);this._symbolSources=[];n.prototype.dispose.call(this)},u.prototype.setPrimitives=function(t,u,f){var s,o,a,h,l,e,v,c;if(t){for(s=!0,o=t.length&&t[0]instanceof i.CloudGraphDataManager.SimplePoint,this._newPrimitive=null,this._primitives&&this._primitives.length&&(a=!(this._primitives[0]instanceof i.CloudGraphDataManager.FavoritePoint),s=!(a===o),s||o||this._setNewPrimitive(this._primitives,t)),this._isCollection=o,h=0,l=t;h<l.length;h++)e=l[h],e.isHoverEnabled=function(){return!0},e.taskDisplayState=this._taskDisplayState,e.entity&&!e.entity.changed&&(e.entity.changed=new r),this._updatePrimitiveForLabeling(e);u&&this.setTaskDisplayState({activationState:1,prominence:1,stackOrder:1,colorIndex:4});v=!f&&t.length&&(s&&o||!o&&!s);c=this._renderLinePrimitives(t);c=this._renderPolygonPrimitives(c);n.prototype.setPrimitives.call(this,c,!v)}},u.prototype.updatePrimitivesState=function(n){var t=this;this._primitives&&this._primitives.length>0&&this._primitives.forEach(function(i){t.setPoiState(i,n)});this._updatePrimitives(!0,!0)},u.prototype._getTargetView=function(){var r,u,s,f,h,i;if(this._isCollection)if(this._primitives.length===1){var o=this._primitives[0],c=this._map.getBounds(),l=new y.Position(o.geometry.x,o.geometry.y);y.BoundingBox.containsPosition(c,l)&&!this.reCenterMapAfterMapLoading?r=this._map.getView():(r=this._getMapViewForPrimitive(o,e.convertZoom(t.defaultZoomLevel,1)),this.reCenterMapAfterMapLoading=!1)}else r=n.prototype._getTargetView.call(this);else if(this._newPrimitive)r=this._getMapViewForPrimitive(this._newPrimitive);else return this._lineSources.length>0&&this._linePrimitives.length>0?(u=[],this._linePrimitives.forEach(function(n){var t=n.geometry.bounds;u.push(new yt(t[0],t[1]));u.push(new yt(t[2],t[3]))}),s=y.BoundingBox.fromLatLngs(u),i=this._map.getCameraForBounds(s),i.zoom=i.zoom-1,i):this._polygonSources.length>0&&this._polygonPrimitives.length>0?(f=[],this._polygonPrimitives.forEach(function(n){var t=n.geometry;t.rings.forEach(function(n){for(var t=0;t<n.x.length;t++)f.push([n.x[t],n.y[t]])})}),h=atlas.data.BoundingBox.fromPositions(f),i=this._map.getCameraForBounds(h),i.zoom=i.zoom-1,i):this._map.getView();return r},u.prototype._getMapViewForPrimitive=function(n,t){var r=ft.getPositions([n]),u=y.BoundingBox.fromPositions(r),i=this._map.getCameraForBounds(u);return isNaN(t)?i.zoom-=.5:i.zoom=t,i},u.prototype._updatePrimitiveForLabeling=function(t){if(t&&t.geometryType===1){var r=t.entity||{},i=r.homeOrWork;t.bucket=i==="home"?"1370":i==="work"?"1371":"353"}else n.prototype._updatePrimitiveForLabeling.call(this,t)},u.prototype.findBestViewForPrimitivesNotInView=function(t){return this._isCollection?n.prototype.findBestViewForPrimitivesNotInView.call(this,t):t},u.prototype._setNewPrimitive=function(n,t){for(var u,f,r,e,i=0;i<t.length;i++){for(u=t[i],f=!1,r=0;r<n.length;r++)if(e=n[r],u.entity.id===e.entity.id){f=!0;break}if(!f){this._newPrimitive=u;break}}},u.prototype.getPrimitives=function(){return e._isSmallMapShownOnSerp()?[]:n.prototype.getPrimitives.call(this)},u.prototype._disposeSources=function(n){var t=this;n.length>0&&n.forEach(function(n){t._map.getAzureMap().sources.remove(n);n.clear();n.dispose()})},u.prototype._disposeLayers=function(n){var t=this;n.length>0&&n.forEach(function(n){t._map.getAzureMap().layers.remove(n)})},u.prototype._filterLinePrimitive=function(n){return n.geometryType!==2},u.prototype._renderLinePrimitives=function(n){var t=this;return(n.forEach(function(n){if(n.geometryType===2){var i=n;t._linePrimitives.push(i)}}),this._linePrimitives.length>0)?(this._disposeLayers(this._lineLayers),this._disposeSources(this._lineSources),this._lineLayers=[],this._lineSources=[],this._linePrimitives.forEach(function(n){for(var e,u=n.polyShapeStyle,f=new atlas.source.DataSource,r=n.geometry,i=0;i<r.x.length-1;i++)f.add(new atlas.data.LineString([[r.x[i],r.y[i]],[r.x[i+1],r.y[i+1]]]));t._lineSources.push(f);t._map.getAzureMap().sources.add(f);e=new atlas.layer.LineLayer(f,null,{strokeColor:u?u.strokeStyle:"blue",strokeWidth:u?u.lineWidth:5});t._lineLayers.push(e);t._map.getAzureMap().layers.add(e)}),n.filter(this._filterLinePrimitive)):n},u.prototype._filterPolygonPrimitive=function(n){return n.geometryType!==3},u.prototype._calculatePolygonLabelPosition=function(n){var t=atlas.data.BoundingBox.getCenter(atlas.data.BoundingBox.fromPositions(n));return new atlas.data.Point(t)},u.prototype._renderPolygonPrimitives=function(n){var t=this;return(n.forEach(function(n){if(n.geometryType===3){var i=n;t._polygonPrimitives.push(i)}}),this._polygonPrimitives.length>0)?(this._disposeLayers(this._polygonLayers),this._disposeLayers(this._lineLayers),this._disposeLayers(this._symbolLayers),this._disposeSources(this._polygonSources),this._disposeSources(this._lineSources),this._disposeSources(this._symbolSources),this._polygonLayers=[],this._polygonSources=[],this._lineLayers=[],this._lineSources=[],this._symbolLayers=[],this._symbolSources=[],this._polygonPrimitives.forEach(function(n){var f,i=n.polyShapeStyle,r=new atlas.source.DataSource,u=new atlas.source.DataSource,l=n.geometry,s=[],h=null,e,o,c;l.rings.forEach(function(n){for(var r=[],i=0;i<n.x.length;i++)r.push([n.x[i],n.y[i]]);h=t._calculatePolygonLabelPosition(r);s.push(r)});r.add(new atlas.data.Polygon(s));t._polygonSources.push(r);t._map.getAzureMap().sources.add(r);u.add(new atlas.data.Feature(h,{label:(f=n.entity)===null||f===void 0?void 0:f.name}));t._symbolSources.push(u);t._map.getAzureMap().sources.add(u);e=new atlas.layer.PolygonLayer(r,null,{fillColor:i?i.fillStyle:"red",fillOpacity:.5});t._polygonLayers.push(e);o=new atlas.layer.LineLayer(r,null,{strokeColor:i?i.strokeStyle:"blue",strokeWidth:i?i.lineWidth:5});t._lineLayers.push(o);c=new atlas.layer.SymbolLayer(u,null,{iconOptions:{image:""},textOptions:{textField:["get","label"],font:["Roboto-Regular"]}});t._symbolLayers.push(c);t._map.getAzureMap().layers.add([e,o])}),this._symbolLayers.forEach(function(n){t._map.getAzureMap().layers.add(n)}),n.filter(this._filterPolygonPrimitive)):n},u}(k),ct=function(n){function i(t){var i=n.call(this,t,"DetailsTaskPoiManager")||this;return i._disposables.push(i.contextMenuInvoked=new r),i}return f(i,n),i.prototype.setPrimitives=function(t,i){n.prototype.setPrimitives.call(this,t,i);var r=this._taskDisplayState&&this._taskDisplayState.prominence;this._setDefaultPrimitiveState(r)},i.prototype.setTaskDisplayState=function(t){n.prototype.setTaskDisplayState.call(this,t);t.prominence&&this._setDefaultPrimitiveState(t.prominence)},i.prototype._onContextMenuInvoked=function(t){n.prototype._onContextMenuInvoked.call(this,t);var i=t===null||t===void 0?void 0:t.primitive;i&&i.entity&&this.contextMenuInvoked.invoke(t)},i.prototype._getTargetView=function(){var n=this._primitives[0],i,u=this._viewFromBackend,r;if(this._dView)i=this._dView,this._dView=null;else if(u)n?(r=n.geometry,i={center:new y.Position(r.x,r.y),zoom:u.zoom}):i=u;else if(n){var r=n.geometry,o=n.entity,f=t.defaultZoomLevel;o&&o.isApproximateLocation?f=t.approximateLocationZoomLevel:gt.getIsSecondColumnDisplayed()&&(f=t.defaultZoomLevel-1);i={center:new y.Position(r.x,r.y),zoom:e.convertZoom(f,1)}}return i},i.prototype.computeBestView=function(n){var i=null,f;if(n||(n=this._primitives),f=n&&n[0],f){var h=f.geometry,o=new y.Position(h.x,h.y),c=this._map.getBounds(),l=this._map.getView(),r=l.zoom,s=y.BoundingBox.containsPosition(c,o),u=this._getTargetView();if(this._taskDisplayState.stackOrder>1)if(t.suppressViewChangeForOpeningSlideoutTask&&this.skipMapViewChangeWhenPrimitiveInView){if(this.skipMapViewChangeWhenPrimitiveInView){if(s)return i;i={center:u.center,centerOffset:u.centerOffset,zoom:r}}}else i={center:u.center,centerOffset:u.centerOffset,zoom:r};else{if(this.skipMapViewChangeWhenPrimitiveInView)return s?i:{center:o,zoom:r};i=s&&r>=e.convertZoom(t.defaultZoomLevel,1)?{center:o,zoom:r}:u}}return i},i.prototype._setDefaultPrimitiveState=function(t){var i=this._primitives&&this._primitives[0];i&&(i.viewState!==7&&(i.alwaysShowOnMap=!0),t&&this._isPrimaryProminence()&&i.viewState!==7&&n.prototype.setPoiState.call(this,i,4))},i.prototype._allowPoiState=function(){return!0},i}(k),du=function(n){function t(t){return n.call(this,t,"DirectionsTaskPoiManager")||this}return f(t,n),t.prototype.setPrimitives=function(t,i){i||(this._lastBestView=null);n.prototype.setPrimitives.call(this,t,i)},t.prototype._setPrimitiveZIndex=function(n,t){if(n instanceof iu){var i=n.pushpinIconType;n.zIndex=i==="start"||i==="middle"||i==="end"?3:t===3?4:2}},t.prototype._updatePrimitives=function(t){n.prototype._updatePrimitives.call(this,t&&this._primitives.length>1)},t.prototype.computeBestView=function(){var n=this._mapViewFromBackend;return n||(n=this._getTargetView()),n},t}(k),gu=function(n){function i(t){return n.call(this,t,"FeedbackPoiManager")||this}return f(i,n),i.prototype._getTargetView=function(){var n,r=((n=this._primitives)===null||n===void 0?void 0:n.length)>0?this._primitives[0]:null,u,i,f;return r&&(i=r.geometry,f=t.defaultZoomLevel,u={center:new y.Position(i.x,i.y),zoom:e.convertZoom(f,1)}),u},i.prototype.computeBestView=function(){var u=this._primitives[0],n=u.geometry,i=new y.Position(n.x,n.y),f=this._map.getBounds(),o=this._map.getView(),r=o.zoom,s=y.BoundingBox.containsPosition(f,i),h=this._getTargetView();return s&&r>=e.convertZoom(t.defaultZoomLevel,1)?{center:i,zoom:r}:h},i}(k),w=function(n){function i(i,u){u===void 0&&(u="ResultsTaskPoiManager");var f=n.call(this,i,u)||this;return f.iconOnlyLimit=-1,f.refreshResultsRequired=new r,f.contextMenuInvoked=new r,f._map.getAzureMapFirstIdle().then(function(){f._setupHandler()}),f.viewChanged.addOne(function(){f._lkgView=f._map.getView()}),f._autoRefreshMinZoom=e.convertZoom(t.autoRefreshMinZoom,1),f}return f(i,n),i.prototype._setupHandler=function(){var n,i=this,t;this._userActionHandlerAttached||(this._userActionHandlerAttached=!0,this._lkgView=this._map.getView(),t=ei.handleUserActions(this._map.getAzureMap(),function(){return i._userActionHandler()}),(n=this._disposables).push.apply(n,t))},i.prototype._userActionHandler=function(){var s=this,r=this._taskDisplayState,h=this._isPrimaryProminence(),c=this._isProminenceEqualTo(2);if(r&&!r.pendingRemoval&&(h||c)&&!t.disableAutoRefresh){var i=this._lkgView,l=i.zoom,n=this._map.getView(),u=n.zoom,a=Math.abs(l-u)>=1,f=!1;if(u>this._autoRefreshMinZoom){var v=function(){var r=fi.getDistanceTo(n.center,i.center,fi.DistanceUnits.miles);return r>t.autoRefreshMaxMiles},y=function(){var r=s._map.getAzureMap(),u=e.screenPixelDistance(r,n,i);return u>t.distanceRequiredInPixelsForAutoRefresh},o=function(){return!v()};f=a?o():y()&&o()}f&&(this._viewFromBackend=null,this._lkgView=n,this.refreshResultsRequired.invoke())}},i.prototype._updatePrimitives=function(t,i){n.prototype._updatePrimitives.call(this,t,i);var r=this._pivotPrimitive;r&&this._taskDisplayState&&(r.taskDisplayState=l({},this._taskDisplayState),r.taskDisplayState.colorIndex=4)},i.prototype.setBoundary=function(n){var e=this._polygons||[],u,t,o,i,f,s,r;if(n=n||[],u=n.length,e.length!==u||u>0&&e[0].metadata!==n[0].metadata){for(t=this._primitives,o=t&&t.length&&t[0].taskDisplayState,i=0,f=n;i<f.length;i++)s=f[i],r=s,r.bucket="1383",r.taskDisplayState=o,r.viewState=4;this._polygons=n;this.setPrimitives(this._primitives)}},i.prototype.setPivotPrimitive=function(n){if(n){var t=n.entity;n.bucket=i._pivotEntityBucket;t&&(t.alwaysShowLabel=!0);k._createEntityChangedEvent(n);n.isHoverEnabled=function(){return!0}}this._pivotPrimitive=n},i.prototype._getCurrentPrimitives=function(){var n=this._primitives||[],t=this._polygons||[];return t.length===0?n:n.length===0?t:ii(ii([],n,!0),t,!0)},i.prototype.getPrimitives=function(){var n=this._getCurrentPrimitives(),t=this._pivotPrimitive,i;if(t&&(t.revision=n&&n.length&&n[0].revision?n[0].revision:(t.revision||0)+1,t.zIndex=3,n&&n.length))for(i=0;i<n.length;i++)n[i].zIndex=2;return[Promise.resolve(t?n.concat([t]):n)]},i.prototype._onContextMenuInvoked=function(t){n.prototype._onContextMenuInvoked.call(this,t);var i=t===null||t===void 0?void 0:t.primitive;i&&i.entity&&this.contextMenuInvoked.invoke(t)},i.prototype.computeBestView=function(){var o=!1,i,r,u,n,f;if(this._primitives)for(i=0,r=this._primitives;i<r.length;i++)if(u=r[i],u&&u.viewState!==7){o=!0;break}return o?(n=this._getTargetView(),f={center:n.center,zoom:Math.min(n.zoom,e.convertZoom(t.defaultZoomLevel,1))},n.bounds&&n.bounds.length===4&&(f.bounds=n.bounds.slice()),f):null},i.prototype._addPrimitives=function(i,r){var u=this,f,o,l;if(t.enableResultsPoiDedupe&&(i===null||i===void 0?void 0:i.length)>1){var s=new Set,h=[],c=this._addPrimitivesPassId=e._nextId();for(f=0,o=i;f<o.length;f++)l=o[f],h.push(l.then(function(n){var f,i,e,t;if(!u._isDisposed&&c===u._addPrimitivesPassId){for(i=0,e=n;i<e.length;i++)t=e[i],t.id=((f=t===null||t===void 0?void 0:t.entity)===null||f===void 0?void 0:f.id)?"".concat(u.id,"_").concat(t.entity.id):t.id,s.add(t.id);u._addBMSPs(n,r)}}));Promise.all(h).then(function(){var n,t,i;if(!u._isDisposed&&c===u._addPrimitivesPassId){var r=u._primitiveManager.getPrimitives(),e=Object.keys(r),f=[];for(n=0,t=e;n<t.length;n++)i=t[n],s.has(i)||f.push(r[i].primitive);u._primitiveManager.remove(f)}})}else n.prototype._addPrimitives.call(this,i,r)},i._pivotEntityBucket="353",i}(k),ti=function(n){function t(t,i){return i===void 0&&(i="PricePoiManager"),n.call(this,t,i)||this}return f(t,n),t.prototype._getIconText=function(t){var i=null;return this._getPoiType(t)===2&&(i=n.prototype._getIconText.call(this,t)),i},t}(w),nf=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return f(t,n),t.prototype._getTargetView=function(){var t=this._viewFromBackend;return t?l(l({},t),{zoom:t.zoom-nu.zoomAdjustment}):n.prototype._getTargetView.call(this)},t}(ti),tf=function(n){function t(t){return n.call(this,t,"ItineraryTaskPoiManager")||this}return f(t,n),t.prototype.computeBestView=function(){var t,r=this._primitives,i,u;return r&&r.length===1&&(i=r[0].geometry,isNaN(i.x)||(u=13,t={center:new y.Position(i.x,i.y),zoom:u})),t||(t=n.prototype.computeBestView.call(this)),t},t.prototype.setPoiState=function(t,i){if(n.prototype.setPoiState.call(this,t,i),!ri.enableInfoBox){var r=t;r&&r.viewState!==2&&(r.viewState=2)}},t}(w),rf=function(n){function t(t,i){var r=n.call(this,t,"LocalGuideL2TaskPoiManager")||this;return r.isForArticleEntityL2=!1,r._taskManager=i,r._initialMapView=r._map.getView(),r._becameUnfocusedStack=!1,r}return f(t,n),t.prototype.setTaskDisplayState=function(t){var r,u,i;n.prototype.setTaskDisplayState.call(this,t);r=l(l({},this._taskDisplayState),t);r&&r.activationState===2&&this._taskManager&&(u=this._taskManager.getFocusedStack(),i=u&&u.getFirstTask(),i&&(i.type!=="LocalGuideL2Task"||i.type==="LocalGuideL2Task"&&i.poiManager&&i.poiManager.isForArticleEntityL2)&&(this._becameUnfocusedStack=!0))},t.prototype.computeBestMapView=function(){return this.isForArticleEntityL2?n.prototype.computeBestView.call(this):this._initialMapView&&this._becameUnfocusedStack?(this._becameUnfocusedStack=!1,this._map.setView(this._initialMapView),null):this._map.getView()},t}(w),uf=function(n){function t(t,i){var r=n.call(this,t,"LocalGuideTaskPoiManager")||this;return r._taskManager=i,r._isVisible=!0,r}return f(t,n),t.prototype.setTaskDisplayState=function(t){var u=l(l({},this._taskDisplayState),t),f=!0,i,r;u.activationState===2&&this._taskManager?(i=this._taskManager.getFocusedStack(),r=i&&i.getFirstTask(),!u.isHidden&&r&&r.type==="LocalGuideTask"?this.setVisible(!0):(this.setVisible(!1),f=!1,t.suppressViewChange=!0)):this.setVisible(!0);this._isVisible=f;n.prototype.setTaskDisplayState.call(this,t)},t.prototype.computeBestView=function(){return null},t.prototype._setLayerOptions=function(t){n.prototype._setLayerOptions.call(this,t);this.setVisible(this._isVisible)},t}(w),ff=function(){function n(n,t,i){this.id=n;this.collisionBehavior=1;t&&(this._title=t);i&&(this._location=i);this.changed=new r}return n.prototype.getTitle=function(){return this._title},n.prototype.getLocation=function(){return this._location},n}(),ef=function(n){function t(t){var i=n.call(this,t,"MicroPoiManager")||this;return i._microPoiRequestProcessor=new ur,i._primitiveManager.useSymbolDrawOrder=!1,i}return f(t,n),t.prototype.fetchMicroPois=function(n,i,r,u,f,e,o){var s=this,h,c,y,p;if(u===void 0&&(u=null),this._isPrimaryProminence()&&!this._isDisposed)if(this._resultYpids=i.map(function(n){return n.entity.id}),this._displayCatId=o||e,!u&&n){var l=this._map.getAzureMap(),a=r?r:l.getCamera().bounds,w=hr.getScale(l,a),b=t._pyramidSpatialIndex.getRegionsInBounds(a,w),v=[],k=function(t){var i=new Promise(function(i){var r=function(n){i(s._updateMicroPoisTaskState(n))};s._microPoiRequestProcessor.getMicroPois(n,t.quadKey,r,f,e||o)});v.push(i)};for(h=0,c=b;h<c.length;h++)y=c[h],k(y);p=function(n){for(var u,t=[],i=0,r=n;i<r.length;i++)u=r[i],t.push.apply(t,u);s._primitiveManager&&s._primitiveManager.clear();s._addBMSPs(t,!1)};Promise.all(v).then(p)}else this._primitiveManager.setLayerOptions({visible:!1})},t.prototype.clearMicropoiData=function(){this._microPoiRequestProcessor.clearMicropoiData()},t.prototype.getPrimitives=function(){return[]},t.prototype.setPrimitives=function(){},t.prototype.setTaskDisplayState=function(n){function f(n){return n.prominence===1&&!n.isHidden}var r,u=this._taskDisplayState||{},e=f(u),o=u.prominence>=3,t=l(l({},u),n),s=t.prominence>=3,i;t.pendingRemoval?((r=this._primitiveManager)===null||r===void 0?void 0:r.dispose(),this._primitiveManager=null):s?this._primitiveManager.clear():(i=f(t),e!==i&&(this._primitiveManager.setLayerOptions({visible:i}),i&&o&&this._updatePrimitives(!1,!0)));this._taskDisplayState=t},t.prototype.dispose=function(){this._microPoiRequestProcessor&&this._microPoiRequestProcessor.dispose();n.prototype.dispose.call(this)},t.prototype._updateMicroPoisTaskState=function(n){var h=[],i,e,o,u,s,t,f;if(n){var c=function(){return!0},l=this._templateSelector.getBucketForCategory(this._displayCatId),a=this._templateSelector.getPaletteKeyForBucket(l);for(i=0,e=n;i<e.length;i++)if(o=e[i],o.primitives)for(u=0,s=o.primitives;u<s.length;u++)t=s[u],t.isHoverEnabled=c,t.taskDisplayState=this._taskDisplayState,f=t.entity,f.changed||(f.changed=new r),f.poiType=12,t.bucket="1374",t.stylesheetEntry=a,t.stylesheetEntryState="pointStateMicroPoi",t.entity.id&&this._resultYpids.indexOf(t.entity.id)!==-1||h.push(t)}return h},t._pyramidSpatialIndex=new vr(2),t}(k),ur=function(){function n(){this._microPois=new cr(100);this._pendingRequests={}}return n.prototype.getMicroPois=function(n,t,i,r,u){var f,e;i&&(f=this._pendingRequests,f[t]?f[t].push(i):(e=this._microPois.getItem(t),e?i(e):(f[t]=[i],this._sendRequest(n,t,r,u))))},n.prototype.clearMicropoiData=function(){this._microPois.clear()},n.prototype.dispose=function(){this._microPois.clear();this._pendingRequests={}},n.prototype._sendRequest=function(n,i,r,u){var f=this;r=r?r:"";u=u?u:"";var s=t.newMicroPoiRequestUrlFormat.replace("{quadkey}",i).replace("{query}",n).replace("{subdomain}",e._getTileSubDomain(i)).replace("{appid}",h.dynamicProperties.appId).replace("{chainId}",r).replace("{categoryId}",u),o=function(n){var r=null,t,u,e;if(f._pendingRequests[i]&&(r=f._pendingRequests[i],delete f._pendingRequests[i]),r)for(t=0,u=r;t<u.length;t++)e=u[t],e&&e(n)},c=function(n){var u=[],r,e;if(n&&n.results)for(r=0,e=n.results;r<e.length;r++){var t=e[r],h=t.name,s=new yt(t.geo.latitude,t.geo.longitude),c=new ff("ypid:"+t.id,t.name,s),l=new kr(s,c);u.push({titles:[h],primitives:[l]})}f._microPois.addItem(i,u);o(u)};oi.downloadJson(s,"micropoi",c,o,null,!1,null,!1)},n}(),sf=function(n){function t(t){return n.call(this,t,"NearbyTransitTaskPoiManager")||this}return f(t,n),t.prototype._onPrimTapped=function(n){this._resetHoveredPoi(n.primitive);this.primTapped.invoke(n)},t}(w),hf=function(){function n(n,t,i,r){this.sender=n;this.primitive=t;this.oldValue=i;this.newValue=r}return n}(),cf=function(n){function i(){return n!==null&&n.apply(this,arguments)||this}return f(i,n),i.prototype.getPrimitives=function(){var n,t,i;return this._canShowPrimitives()&&(t=this._boundaryPolygons,t?(i=void 0,i=t.primitives?t.primitives:this._primitives,n=Promise.resolve(i)):n=this._getPolygonSDS()),n?[n]:[]},i.prototype._getPolygonSDS=function(){var n=this;return new Promise(function(t){var i=n._primitives,r=function(r){var u=n._boundaryPolygons={primitives:br.fromGeoDataResult(r.results[0])},f=i&&i.length&&i[0].taskDisplayState;u.primitives.forEach(function(n){n.bucket="1383";n.taskDisplayState=f;n.viewState=4});u.primitives=u.primitives.concat(i);t(u.primitives)},u=function(){n._minZoomLevel=undefined;n._maxZoomLevel=undefined;t(n._primitives)};ru.getCityPolygons(n._entityVDPId,r,u)})},i.prototype.dispose=function(){this._primitives=null;this._boundaryPolygons=null;n.prototype.dispose.call(this)},i.prototype.setPrimitives=function(t,i){this._entityVDPId=t[0].entity.getVdpId();this._initialize();n.prototype.setPrimitives.call(this,t,i)},i.prototype.setViewFromBackend=function(i){if(n.prototype.setViewFromBackend.call(this,i),!this._viewFromBackend){this._alwaysShowPoi();return}var r=this._getBackendZoomLevel();this._maxZoomLevel=e.convertZoom(Math.min(r+10,t.maxPolygonZoomLevel),1);this._minZoomLevel=e.convertZoom(Math.min(r-2,t.maxPolygonZoomLevel),1)},i.prototype.computeBestView=function(){var r=this._isPrimaryProminence()&&this._taskDisplayState.activationState===1,n,i;return!r||!this._canShowPrimitives()?null:(this._dView?n=this._getTargetView():this._viewFromBackend?(n=this._getTargetView(),n.zoom=this._getBackendZoomLevel()):this._primitives&&(i=this._primitives[0].entity.getLocation(),n={center:new y.Position(i.longitude,i.latitude),zoom:e.convertZoom(t.defaultZoomLevel,1)}),this._alwaysShowPoi(),this.disableComputingMapViewForLoadingOnly=!1,n)},i.prototype._getTargetView=function(){return this._boundaryPolygons&&this._boundaryPolygons.primitives&&this._viewFromBackend?this._viewFromBackend:n.prototype._getTargetView.call(this)},i.prototype._onContextMenuInvoked=function(){},i.prototype._initialize=function(){},i.prototype._setLayerOptions=function(t){var i,r,u,f;if(n.prototype._setLayerOptions.call(this,t),t.geometryType===1?i={maxZoom:this._minZoomLevel}:t.geometryType===3&&(i={minZoom:this._minZoomLevel,maxZoom:this._maxZoomLevel}),i)for(r=0,u=t.layers;r<u.length;r++)f=u[r],f.setOptions(i)},i.prototype._alwaysShowPoi=function(){var n=this._primitives&&this._primitives[0];n&&(n.viewState=4,n.bucket="334",n.revision=(n.revision||0)+1)},i.prototype._canShowPrimitives=function(){var n=this._primitives,t=this._taskDisplayState;return n&&n.length>0&&t&&t.prominence!==undefined},i.prototype._getBackendZoomLevel=function(){var i=this,n=null,r;return this._viewFromBackend&&(n=this._viewFromBackend.zoom,r=e.convertZoom(n,0),r>t.maxPolygonZoomLevel&&(n=e.convertZoom(t.maxPolygonZoomLevel,1),this.viewChanged.addOne(function(){if(i._primitives){var n=i._primitives[0].entity,t={logData:{feature:"BD",action:"WRN",data:{title:n&&n._title,type:n&&n._locationType}}};v.invokeHandler("data-instrumentation",t)}}))),n},i}(ct),lf=function(n){function t(t){return n.call(this,t,"PolygonListingTaskPoiManager")||this}return f(t,n),t.prototype._createLayer=function(){},t.prototype._onPrimHover=function(){return null},t}(w),af=function(n){function i(i){var r=n.call(this,i,"RealEstatePoiManager")||this;return r._autoRefreshMinZoom=e.convertZoom(t.autoRefreshMinZoomRE,1),r}return f(i,n),i.prototype.setTaskDisplayState=function(t){var f,e,s,h,c;if(t=t||{},this._taskDisplayState&&!t.pendingRemoval&&!this._taskDisplayState.pendingRemoval){var u=i._visibilities,o=this.id,r=void 0;if(t.prominence===1)r=!0;else{for(f=[],e=0,s=Object.keys(u);e<s.length;e++)h=s[e],u[h]&&f.push(h);r=f.length===1&&f[0]===o?!0:!1}u[o]!==r&&(c=this._primitiveManager.setLayerOptions({visible:r},3),c&&(u[o]=r))}n.prototype.setTaskDisplayState.call(this,t)},i.prototype._setLayerOptions=function(t){var i,r,u,f;if(n.prototype._setLayerOptions.call(this,t),t.geometryType===3?i={minZoom:9,maxZoom:14}:t.geometryType===1&&(i={minZoom:e.convertZoom(or.houseZoomLevelThreshold,1)}),i)for(r=0,u=t.layers;r<u.length;r++)f=u[r],f.setOptions(i)},i.prototype._getTargetView=function(){return this._viewFromBackend?this._viewFromBackend:this._lkgView?this._lkgView:n.prototype._getTargetView.call(this)},i.prototype.dispose=function(){delete i._visibilities[this.id];n.prototype.dispose.call(this)},i._visibilities={},i}(ti),vf=function(n){function t(t,i){var r=n.call(this,t,"TopicSearchPoiManager")||this;return r._taskManager=i,r._isVisible=!0,r}return f(t,n),t.prototype.setTaskDisplayState=function(t){var u=l(l({},this._taskDisplayState),t),f=!0,i,r;u.activationState===2&&this._taskManager?(i=this._taskManager.getFocusedStack(),r=i&&i.getFirstTask(),!u.isHidden&&r&&r.type==="LocalGuideTask"?this.setVisible(!0):(this.setVisible(!1),f=!1,t.suppressViewChange=!0)):this.setVisible(!0);this._isVisible=f;n.prototype.setTaskDisplayState.call(this,t)},t.prototype._setLayerOptions=function(t){n.prototype._setLayerOptions.call(this,t);this.setVisible(this._isVisible)},t}(w),yf=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return f(t,n),t.prototype.computeBestView=function(){return this._map.getView()},t.prototype._setLayerOptions=function(t){var r,u,e;n.prototype._setLayerOptions.call(this,t);var i,f=["get","title"],o=["match",["get","bucketId"],"1386","","1387",f,""];if(t.geometryType===1?i={minZoom:10,textOptions:{textField:["step",["zoom"],"",12,o,14,f]}}:t.geometryType===2&&(i={minZoom:10}),i)for(r=0,u=t.layers;r<u.length;r++)e=u[r],e.setOptions(i)},t}(du),pf=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return f(t,n),t.prototype.computeBestView=function(){var t;return this._taskDisplayState.activationState===1&&(t=n.prototype.computeBestView.call(this)),t},t.prototype.setTaskDisplayState=function(t){t=t||{};t.suppressViewChange=!0;n.prototype.setTaskDisplayState.call(this,t)},t.prototype._setDefaultPrimitiveState=function(t){n.prototype._setDefaultPrimitiveState.call(this,t);var i=this._primitives&&this._primitives[0];i&&!i.viewState&&(i.alwaysShowOnMap=!1)},t}(ct),wf=function(t){function i(n,i){var r=t.call(this,i)||this;return r.controlTemplateFactory=n,r}return f(i,t),i.prototype.getControl=function(){return n(t.prototype.getControlElement.call(this))},i}(gr),bf=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,f)||this,l,h,a,o,s,c;for(e._taskManager=r,e._container=u,e._currentSelectionControlBindings=[],e._disposables=[],e._disabledStackCollection={},l=function(n){var t,i;if(e._selectionControl&&n.added&&n.added.length>0)for(t=0;t<n.added.length;t++)if(e._disabledStackCollection[n.added[t].id]===undefined){i=n.added[n.added.length-1];i&&i.getForegroundTask()&&e._taskManager.focusTask(i.getForegroundTask().id);e._exitSelectionMode();break}},e._disposables.push(f.changed.add(l)),h=r.getStacks(),a=function(n){var t,i=n.stack;e._disabledStackCollection[i.id]||(n.isSelected||e.disableStack(i),(t=e._selectionControl)===null||t===void 0?void 0:t.onSelectionChanged(i.getForegroundTask().id,n.isSelected))},o=0;o<h.length;o++)s=h[o],e._disposables.push(s.stackSelected.add(a)),c=s.getForegroundTask(),e._disabledStackCollection[s.id]=!(c.isSharable&&c.isSharable());return e}return f(t,n),t.prototype.getSelectionControl=function(){return this._selectionControl},t.prototype.setSelectionControl=function(n){var t=this;n&&(this._disposeCurrentSelectionControl(),this._selectionControl=n,n.setInitialData({container:this._container}),this._currentSelectionControlBindings.push(n.controlUpdated.add(function(n){switch(n.state){default:t._changeStacksLockStatus(!0);break;case 2:case 0:t._changeStacksLockStatus(!1)}})))},t.prototype._exitSelectionMode=function(){this._disposeCurrentSelectionControl();v.invokeHandler("data-share",{action:"closeShare"})},t.prototype.getSelectionModeControlName=function(){return"SharePanel"},t.prototype.dispose=function(){n.prototype.dispose.call(this);for(var t=0;t<this._disposables.length;t++)this._disposables[t]&&this._disposables[t].dispose();this._disposeCurrentSelectionControl()},t.prototype._changeStacksLockStatus=function(n){for(var i,t=0;t<this.stacks.length;t++)i=this.stacks[t],this._disabledStackCollection[i.id]||i.setIsLocked(n)},t.prototype.disableStack=function(n){n.displayState.activationState=4;var t=this._taskManager.getStackById(n.id);t.displayState.activationState=4;n.displayState.activationState=4;this._taskManager.updateProminences(t)},t.prototype._disposeCurrentSelectionControl=function(){var t,n;if((t=this._selectionControl)===null||t===void 0?void 0:t.dispose(),this._selectionControl=null,this._currentSelectionControlBindings&&this._currentSelectionControlBindings.length>0){for(n=0;n<this._currentSelectionControlBindings.length;n++)this._currentSelectionControlBindings[n].dispose();this._currentSelectionControlBindings.length=0}},t}(ir);u.BaseTask=wt;u.BaseTaskViewModel=wf;u.ShoppingAutosuggestControl=dt;i.CollectionsTaskPoiManager=ku;i.DetailsTaskPoiManager=ct;i.HotelsListingManager=nf;i.ItineraryTaskPoiManager=tf;i.LayoutManager=it;i.MicroPoiManager=ef;i.MicroPoiRequestProcessor=ur;i.NearbyTransitTaskPoiManager=sf;i.PoiManager=k;i.PolygonBoundaryManager=cf;i.PolygonListingTaskPoiManager=lf;i.PricePoiManager=ti;i.RealEstatePoiManager=af;i.ResultsTaskPoiManager=w;i.TaskManager=bu;i.TaskPrimitivesZOrderManager=st;i.TopicSearchPoiManager=vf;i.TransitLinePoiManager=yf;i.TransitStopTaskPoiManager=pf;i.LocalGuideTaskPoiManager=uf;i.LocalGuideL2TaskPoiManager=rf;i.FeedbackPoiManager=gu}catch(fr){if(i&&i.logger)i.logger.logCriticalError(fr);else throw fr;}}.call(window)