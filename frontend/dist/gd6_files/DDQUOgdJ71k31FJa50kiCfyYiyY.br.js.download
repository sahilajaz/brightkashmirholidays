(function(){var t;try{var o=Microsoft.Maps,e=o.Internal,lt=e.__assign,l=e.__extends,tt=e.__spreadArray,r=o.globalConfig,p=e.coreConfig,i=r.features,at=i.advertising,vt=i.autosuggest,yt=i.calendar,pt=i.collections,wt=i.directions,bt=i.feedback,c=i.flyover,h=i.landmarks3D,k=i.map3D,v=i.richMapsInfobox,kt=i.labels,dt=i.layerManager,gt=i.localGuide,d=i.localSearch,ni=i.mapDelay,ti=i.optIn,ii=i.print,ri=i.sharing,ui=i.streetside,fi=i.birdseye,ei=i.taskBar,oi=i.taskFramework,si=i.trafficControl,hi=i.traffic,ci=i.trafficExperiences,li=i.transit,ai=i.travel,it=i.xsr,et=atlas.data,g=atlas.layer,ot=atlas.math,vi=atlas.Pixel,yi=o.BingMapStyle,pi=o.Color,wi=o.Point,bi=o.ResourceManager,ki=o.Size,f=e.AtlasHelper,s=e.AzureMapEvents,u=e.JSEvent,st=e.LruCache,rt=e.MapsInfobox,y=e.Network,di=e.ObjectWithId,w=e.TimeoutWrapper,f=e.AtlasHelper,s=e.AzureMapEvents,u=e.JSEvent,b=e.MapDelegate,ut=e.dependencyResolver,nt=o.DeviceInfo,n=o.ResourceManager.MapCore,ht=e._Url,a=e.MapMath,ct=e.GeochainManager;(function(n){var f="id_h",r="web3dview",e=".mapBannerContainer",u,i,t;n.fullScreen=function(o){if(o!==i){var s=document.getElementById("mapContainer"),h=document.getElementById("taskArea"),c=document.getElementById(f),l=document.querySelector(e);o?(i=!0,l&&t===undefined&&(t=l.style.display,l.style.display="none"),s&&(u=s.style.width,s.style.width="100%",s.style.position="static"),h&&(h.style.display="none"),c&&(c.style.display="none"),document.body.classList.add(r)):(i=!1,t!==undefined&&(l.style.display=t,t=undefined),h&&(h.style.display="block"),s&&(s.style.position="",s.style.width=u),c&&(c.style.display="block"),document.body.classList.remove(r))}}})(t||(t={})),function(n){var t=function(t){function i(i){var r=this,u=i.clientProperties;return(u===null||u===void 0?void 0:u.baseMapFeatureDelegate)?u.baseMapFeatureDelegate:(r=t.call(this,i)||this,u&&(u.baseMapFeatureDelegate=r),r._isActive=!0,r._isBaseMapActive=!0,r._canvasContainer=i.getCanvasContainer(),r._disposables=[r._rasterHoverDelegate=new n.RasterHoverDelegate(i),s.add(i,"click",function(n){r._handleMouseClick(r._updateShapeData(n),!1)}),s.add(i,"contextmenu",function(n){r._handleMouseClick(r._updateShapeData(n),!0)}),s.add(i,"mousedown",function(n){r._handleMouseDown(r._updateShapeData(n))}),s.add(i,"mouseup",function(n){r._handleMouseUp(r._updateShapeData(n))}),s.add(i,"mousemove",function(n){r._handleMouseMove(r._updateShapeData(n))}),s.add(i,"mouseout",function(n){r._handleMouseOut(r._updateShapeData(n))}),s.add(i,"movestart",function(){r._mapMoving=!0}),s.add(i,"moveend",function(){r._mapMoving=!1})],r._initialize(),r)}return l(i,t),i.getInstance=function(n){return new i(n)},i.prototype.dispose=function(){this._isDisposed||(t.prototype.dispose.call(this),f._nullifyClass(this))},i.prototype.setActiveState=function(n){if(this._isActive=n,!n){var t=this._handler,i=this._featureInfo,r={preventDefault:function(){},map:this._map,type:"mouseout"};this._canDrag&&(this._isDragging&&(this._isDragging=!1,t===null||t===void 0?void 0:t.dragFeature(i,r,3)),this._canDrag=!1);t&&(t.leaveFeature(i,r),this._handler=undefined,this._featureInfo=undefined)}},i.prototype.setBaseMapActiveState=function(n){this._isBaseMapActive=n},i.prototype.getEventEmitter=function(n){return this.mapFeatureEventEmitters[n]},i.prototype.registerGlobalHandler=function(n){this._globalHandlers[n.handlerId]=n},i.prototype._initialize=function(){var t=new n.LandmarkFeatureHandler(this._map),i=new n.LabelFeatureHandler(this._map);this.mapFeatureEventEmitters={};this.mapFeatureEventEmitters[n.EventEmitterName.Label]=i;this.mapFeatureEventEmitters[n.EventEmitterName.Landmark]=t;this._clickAsToHandlerMap={lbl:i,lmk:t};this._globalHandlers={};this._disposables.push(t,i)},i.prototype._getHandlerForFeature=function(n){var t=n.properties,i=t&&t["clk-as"],r;return i&&(r=this._clickAsToHandlerMap[i]),r},i.prototype._getBaseFeatureAction=function(n,t){var r={},e,h,o,c,s,i,u,f;if(this._isBaseMapActive)for(e=0,h=n.shapes;e<h.length;e++){var a=h[e],l=a,i=this._getHandlerForFeature(l);i&&(!t||i.dragFeature)&&(r[i.handlerId]||(u=i.getFeatureInfo(l,t),u&&(r[i.handlerId]=[i,u])))}for(o=0,c=Object.keys(this._globalHandlers);o<c.length;o++)(s=c[o],i=this._globalHandlers[s],i&&(!t||i.dragFeature))&&(r[s]||(u=i.getFeatureInfo(n,t),u&&(r[s]=[i,u])));return(f=Object.keys(r),f.length>1&&f.sort(function(n,t){return r[n][1].priority-r[t][1].priority}),f.length>0)?r[f[0]]:[undefined,undefined]},i.prototype._handleMouseClick=function(n,t){var u,i,r,f;this._isActive&&(i=this._handler,r=this._featureInfo,i||(u=this._getBaseFeatureAction(n),i=u[0],r=u[1]),f=!1,i&&r&&(f=i.clickFeature(r,n,t),i.leaveFeature(r,n),this._handler=undefined,this._featureInfo=undefined),f||this._map.mapClicked.invoke(n))},i.prototype._handleMouseDown=function(n){var r;if(this._isActive){var u=this._getBaseFeatureAction(n,!0),t=u[0],i=u[1];t&&(this._map.setUserInteraction({dragPanInteraction:!1}),r=t||this._handler,r&&!r.areSameFeatureInfo(i,this._featureInfo)&&(this._handler&&this._handler.leaveFeature(this._featureInfo,n),t&&i&&(this._canvasContainer.style.cursor="pointer",t.enterFeature(i,n))),this._handler=t,this._featureInfo=i,this._canDrag=!0)}},i.prototype._handleMouseUp=function(n,t){if(t===void 0&&(t=2),this._isActive){var i=this._handler,r=this._featureInfo;this._isDragging&&(this._isDragging=!1,i.dragFeature(r,n,t));this._canDrag&&(this._map.setUserInteraction({dragPanInteraction:!0}),this._canDrag=!1)}},i.prototype._handleMouseMove=function(n){var u,f,e;if(this._isActive&&!this._mapMoving){if(this._canDrag){f=this._handler;e=this._featureInfo;this._isDragging||(this._isDragging=!0,f.dragFeature(e,n,0));f.dragFeature(e,n,1);return}var o=this._canvasContainer,s=this._getBaseFeatureAction(n),r=s[0],t=s[1],i=r||this._handler,h=i===null||i===void 0?void 0:i.areSameFeatureInfo(t,this._featureInfo);h?(u=i.hoverFeature)===null||u===void 0?void 0:u.call(i,t,n):(this._handler&&this._handler.leaveFeature(this._featureInfo,n),r&&t?(o.style.cursor="pointer",this._handler=r,this._featureInfo=t,r.enterFeature(t,n)):this._handler&&(o.style.cursor="",this._handler=undefined,this._featureInfo=undefined))}},i.prototype._handleMouseOut=function(n){this._isActive&&(this._canDrag&&this._handleMouseUp(n,3),this._handler&&(this._handler.leaveFeature(this._featureInfo,n),this._canvasContainer.style.cursor="",this._handler=undefined,this._featureInfo=undefined))},i.prototype._updateShapeData=function(n){return n.shapes=this._rasterHoverDelegate.getBaseMapShapes(n)||n.shapes,n},i}(b);n.BaseMapFeatureDelegate=t}(t||(t={})),function(n){var t=function(){function t(t){this.handlerId=n.EventEmitterName.Label;this._mlMap=t._getMap();this.disposables=[this.onClick=new u,this.onHoverStarted=new u,this.onHoverEnded=new u]}return t.prototype.dispose=function(){this.isDisposed||(f._nullifyClass(this),f._clearDisposables(this.disposables),this.isDisposed=!0)},t.prototype.getFeatureInfo=function(n){var t=n.properties,i=t&&t.id,r=t&&t.name,f=(i===null||i===void 0?void 0:i.indexOf("-"))<0,u;return f&&r&&(u={priority:3,feature:n,text:r,vdpid:i}),u},t.prototype.areSameFeatureInfo=function(n,t){return f.areValuesEqual(n,t)},t.prototype.clickFeature=function(n,t,i){return i?!1:(this.onClick.invoke({event:t,text:n.text,id:"vdpid:".concat(n.vdpid),anchorPoint:n.feature.geometry}),!0)},t.prototype.enterFeature=function(n,t){n&&(n.feature.sourceLayer&&this._mlMap.setFeatureState(n.feature,{hover:!0}),this.onHoverStarted.invoke({event:t,text:n.text,id:"vdpid:".concat(n.vdpid)}))},t.prototype.leaveFeature=function(n){n.feature.sourceLayer&&this._mlMap.setFeatureState(n.feature,{hover:!1});this.onHoverEnded.invoke()},t}();n.LabelFeatureHandler=t}(t||(t={})),function(n){var t=0,i=50,r=function(){function r(t){this._atlasMap=t;this.handlerId=n.EventEmitterName.Landmark;this._mlMap=this._atlasMap._getMap();this.disposables=[this._infobox,this.onClick=new u,this.onHoverStarted=new u,this.onHoverEnded=new u,]}return r.prototype.setHelpers=function(n,t){this._processor=n;this._entityCreator=t},r._getTransitStop=function(n){var i=n.transitJson,r,t;return i&&(t=JSON.parse(i),r=t.stops&&t.stops[0]),r},r.prototype.dispose=function(){this.isDisposed||(f._clearDisposables(this.disposables),f._nullifyClass(this),this.isDisposed=!0)},r.prototype.getFeatureInfo=function(n){var i,t=n.properties,o=t&&(t["lmk-ypid"]||t["lmk-tj"]),r,u=n.layer&&n.layer.id,f,e;return o&&u!=="lmk_hov"&&(f=n.bbox,e=(i=n.geometry)===null||i===void 0?void 0:i.coordinates,r={priority:2,feature:n,name:t.name,layerId:u||"",bbox:f,position:e,ypid:t["lmk-ypid"]||undefined,transitJson:t["lmk-tj"]||undefined,isCoupoi:p.landmarkDeals&&!!t["lmk-coupoi"],bucket:t.bkt}),r},r.prototype.areSameFeatureInfo=function(n,t){return f.areValuesEqual(n,t,["feature"])},r.prototype.clickFeature=function(n,t,i){var f,u,e;return i?!1:(f=n.ypid,u=r._getTransitStop(n),f&&n.layerId.indexOf("lmk_3d")<0?this.onClick.invoke({event:t,type:"business",name:n.name,id:f,layerId:n.layerId,position:n.position||t.position,bucket:n.bucket}):u&&this.onClick.invoke({event:t,type:"transit",name:u.name,id:u.id,layerId:n.layerId,position:n.position||t.position,bucket:n.bucket}),e=n.isCoupoi?"LD":"L",this._log(e,"C",n),!0)},r.prototype.enterFeature=function(u,f){var e=this,o,s,c,h;u&&u.layerId.indexOf("lmk_3d")<0&&(this._hoverStartTime=Date.now(),this._infobox&&(clearTimeout(this._infoboxCloseDelayHandle),this._infobox.setOptions({visible:!1,delayTime:0,animationDuration:0})),o=r._getTransitStop(u),o?(s=n.InfoboxContentCreator.createTransitContent(o),(v===null||v===void 0?void 0:v.isEnabled)?(h=function(){var t=e._getInfobox(s,u.position||f.position);t.setOptions({visible:!0,pixelOffset:[5,-10]});n.InfoboxInstrumentation.logOpen(""+o.id,o.name,!1,s);t.infoboxClicked.addOne(function(){n.InfoboxInstrumentation.logClick(""+o.id,o.name,!1)})},this._infoboxDelayHandle=w.setTimeout(h,i)):(c=this._getPopup(s,u.position||f.position),c.open()),this.onHoverStarted.invoke({event:f,type:"transit",name:o.name,id:o.id,layerId:u.layerId,position:u.position||f.position,bucket:u.bucket})):((v===null||v===void 0?void 0:v.isEnabled)&&(h=function(){s=n.InfoboxContentCreator.createSimpleContent(u.name);var r=u.position||f.position,i=e._getInfobox(s,r),o=rt.getAdjustedAnchor(e._atlasMap,{pixelOffset:[5,-15],position:r}),h=o.anchor,c=o.pixelOffset;i.setOptions({anchor:h,visible:!0,pixelOffset:c,animationDuration:u.isCoupoi?0:t});n.InfoboxContentCreator.createLandmarkContent(u).then(function(t){var o=i.getOptions().position,f;et.Position.areEqual(o,r)&&(f=e._entityCreator&&e._entityCreator.createFromFeatureInfo(u),!u.isCoupoi&&e._processor&&f&&(t=e._processor.preProcessContent(t,f,i)),t&&i.getOptions().visible&&(i.setOptions({delayTime:0,htmlContent:t,animationDuration:0,entity:f}),u.isCoupoi||(e._postProcessingHandle=w.setTimeout(function(){e._processor&&f&&e._processor.postProcessContent(f,i)})),n.InfoboxInstrumentation.logOpen(u.ypid,u.name,!0,t),i.infoboxClicked.addOne(function(){n.InfoboxInstrumentation.logClick(u.ypid,u.name,!0)})))})},this._infoboxDelayHandle=w.setTimeout(h,i)),this.onHoverStarted.invoke({event:f,type:"business",name:u.name,id:u.ypid,layerId:u.layerId,position:u.position||f.position,bucket:u.bucket})),it.landmarkHoverState&&u.feature.sourceLayer==="landmark"&&(this._updateHoverLayer(u),this._mlMap.setFeatureState(u.feature,{hover:!0})))},r.prototype.leaveFeature=function(r){var f=this,u;this._infobox&&(this._infoboxCloseDelayHandle=w.setTimeout(function(){f._infobox.setOptions({visible:!1,animationDuration:t})},i));this._popup&&this._popup.close();it.landmarkHoverState&&r.feature.sourceLayer==="landmark"&&r.layerId.indexOf("lmk_3d")<0&&this._mlMap.setFeatureState(r.feature,{hover:!1});this.onHoverEnded.invoke();clearTimeout(this._infoboxDelayHandle);n.InfoboxContentCreator.abortContentRequests();r&&(u=Date.now()-this._hoverStartTime,this._log("L","H",r,u))},r.prototype._updateHoverLayer=function(n){var i=n===null||n===void 0?void 0:n.feature,t,r,u;i&&(t=this._hoverLayer,t||(r=["concat","hov-",["get","bkt"]],p.landmarkDeals&&r.push(["case",["has","lmk-coupoi"],"-coupoi-dealsTag",""]),t=new g.SymbolLayer(i.source,"lmk_hov",{iconOptions:{image:r,allowOverlap:!0,anchor:"center",ignorePlacement:!0,offset:[1,1],opacity:["case",["boolean",["feature-state","hover"],!1],1,0]},sourceLayer:i.sourceLayer}),this._atlasMap.layers.add(t),this._hoverLayer=t),u=i.layer,t.setOptions({iconOptions:{offset:u.layout["icon-offset"],size:u.layout["icon-size"]}}))},r.prototype._getInfobox=function(i,r){var u=this;return this._infobox?this._resetInfobox():(this._infobox=new n.RichMapsInfobox(this._atlasMap,{anchor:"bottom-left"}),this._infobox.infoboxEnter.add(function(){clearTimeout(u._infoboxCloseDelayHandle)})),this._infobox.setOptions({htmlContent:i,position:r,animationDuration:t}),this._infobox},r.prototype._getPopup=function(n,t){if(!this._popup)this._popup=new atlas.Popup({closeButton:!1,showPointer:!0}),this._popup.attach(this._atlasMap);return this._popup.setOptions({content:n,position:t}),this._popup},r.prototype._log=function(n,t,i,r,u){var h=o.logger,e=i.ypid,c=i.position,f=null,s;e&&(f={ID:e,Z:this._atlasMap.getCamera().zoom,L:c,CP:i.isCoupoi?"1":"0"},r&&(f.HD=r),u&&(f.dealsUrl=u));s={feature:n,action:t,data:f};h.logObject(s)},r.prototype._resetInfobox=function(){[this._infoboxDelayHandle,this._postProcessingHandle,this._infoboxCloseDelayHandle].forEach(function(n){clearTimeout(n)});var n=this._infobox;n&&[n.infoboxClicked,n.infoboxEnter,n.infoboxLeave].forEach(function(n){return n.reset()})},r}();n.LandmarkFeatureHandler=r}(t||(t={})),function(n){var t=function(t){function i(n){var i=t.call(this,n)||this;return i._onStyleChanged=function(){var n,f,u,t;if(i._clickableRegionUrl=null,n=i._map._getMap().getStyle().sources,f=i._map.getStyle().style.toLowerCase(),f!=="ordnancesurvey")for(u in n)if(t=n[u],n[u].rasterHoverSource&&t.tiles&&t.tiles.length>0){i._clickableRegionUrl=t.tiles[0].replace("raster://","https://").replace("{quadkey}","{quadkey}.json")+"&output=json&jsonp={callback}&jsonso={jsonso}";r.testHooksEnabled&&(i._clickableRegionUrl+="&overrideBag=V9/Service/ClickableRegions.js");break}i._disabled=!i._clickableRegionUrl;i._lastHitHoverRegion=null;i._lastMousePosition=null;i._clearDebugPolygons()},i._onMouseMove=function(n){if(!i._paused&&!i._disabled){i._lastMousePosition=n.position;var t=i._getTileDataAtMousePosition();i._updateDataStore(t);i._hitTest(t)}},i._onMapMoveEnd=function(){i._paused=!1},i._onMapMoveStart=function(){i._lastHitHoverRegion=null;i._lastMousePosition=null;i._paused=!0},i._getTileDataAtMousePosition=function(n){var u,f=n||i._lastMousePosition;if(f){var t=Math.round(i._map.getCamera().zoom)-1,r=a.tileXYFromLocation(f,t),e=a.quadkeyFromTileXY(r.x,r.y,t);u={tileLod:t,tileXY:r,quadKey:e}}return u},i._clearDebugPolygons=function(){i._debugPolygonRendered={};i._debugPolygonDataSource&&i._debugPolygonDataSource.clear()},nt.renderingMode===2&&p.rasterHoverEnabled&&(i._pendingRequest={},i._debugPolygonRendered={},i._lruDataCache=new st(15),i._onStyleChanged(),i._attachEvents(),n.mapLoaded.then(function(){var t=i._getTileDataAtMousePosition(n.getCamera().center);i._updateDataStore(t)})),i}return l(i,t),i.prototype.getBaseMapShapes=function(n){var t=n.position;return t&&this._lastHitHoverRegion&&this._lastMousePosition&&t[0]===this._lastMousePosition[0]&&t[1]===this._lastMousePosition[1]?tt(tt([],n.shapes,!0),[this._lastHitHoverRegion.mapFeature],!1):null},i.prototype.dispose=function(){t.prototype.dispose.call(this);this._lruDataCache&&this._lruDataCache.clear();f._nullifyClass(this)},i.prototype._attachEvents=function(){this._disposables.push(s.add(this._map,"stylechanged",this._onStyleChanged),s.add(this._map,"mousemove",this._onMouseMove),s.add(this._map,"movestart",this._onMapMoveStart),s.add(this._map,"moveend",this._onMapMoveEnd),s.add(this._map,"zoomend",this._clearDebugPolygons))},i.prototype._updateDataStore=function(n){var i=this,t;n&&(t=n.quadKey,this._pendingRequest[t]||this._lruDataCache.getItem(t)||(this._pendingRequest[t]=!0,y.downloadJsonp(this._clickableRegionUrl.replace("{quadkey}",t),"RasterHoverDelegate",function(r){i._parseResponse(r,n.tileXY,n.tileLod);delete i._pendingRequest[t];i._lruDataCache.addItem(t,r)},function(){delete i._pendingRequest[t]})))},i.prototype._hitTest=function(n){var i,r,e,o,t,u,f;if(n&&(i=n.quadKey,r=this._lruDataCache.getItem(i),r&&(p.tileBoundary&&this._drawDebugBoundary(i),e=r.hrs,o=this._lastHitHoverRegion&&this._lastHitHoverRegion.boundingBoxes,!this._isInsideHoverRegion(o,this._lastMousePosition))))for(this._lastHitHoverRegion=null,t=0,u=e;t<u.length;t++)if(f=u[t],this._isInsideHoverRegion(f.boundingBoxes,this._lastMousePosition)){this._lastHitHoverRegion=f;break}},i.prototype._isInsideHoverRegion=function(n,t){var i,r,u;if(n)for(i=0,r=n;i<r.length;i++)if(u=r[i],atlas.data.BoundingBox.containsPosition(u,t))return!0;return!1},i.prototype._parseResponse=function(n,t,i){var o,p,u,s,r,h,f,c,w,l,e,v,y;if(n)for(o=a.tileXYToPixelXY(t,1024),p=n.hrs,u=0,s=p;u<s.length;u++)if(r=s[u],r.brs){for(h=[],f=0,c=r.brs;f<c.length;f++){for(w=c[f],l=[],e=0,v=w;e<v.length;e++)y=v[e],l.push(a.pixelXYToLatLong({x:o.x+y.x,y:o.y+y.y},i+2));h.push(atlas.data.BoundingBox.fromLatLngs(l))}r.boundingBoxes=h;r.mapFeature=this._getBaseFeature(r);delete r.brs;delete r.bmv}},i.prototype._getBaseFeature=function(t){var r=t.id,u=t.name,i,f;return t.type==="label"?i={id:r,name:u,"clk-as":n.EventEmitterName.Label,bkt:-1}:(t.type==="yp"||t.type==="transit")&&(f=t.transitdata&&JSON.stringify(t.transitdata),i={id:r,name:u,"clk-as":n.EventEmitterName.Landmark,bkt:-1,"lmk-sc":t.type==="yp"?1:2,"lmk-tj":f,"lmk-ypid":t.ypid}),new atlas.data.Feature(null,i,t.id)},i.prototype._drawDebugBoundary=function(){},i}(b);n.RasterHoverDelegate=t}(t||(t={})),function(n){var t=function(n,t,i){var r=o.logger,u={feature:"FLO",action:n,data:{component:"FOPLR",TS:i,videoUrl:t}};r.logObject(u)},i=function(i){function r(t){var r=i.call(this,t)||this,e,o;return(r.onFeedbackBtnClick=new u,r.onOpenBtnClick=new u,r.onCloseBtnClick=new u,r.onViewerOpen=new u,r.onViewerClose=new u,e=r.flyoverButtonControl=new n.FlyoverButtonControl(t),t.controls.add(e,{position:atlas.ControlPosition.NonFixed}),!nt.is3DSupported)?r:(o=f._getUrlParam(window.location,"lmk3ddataver",!1),o?r.getFlyovers(o):y.downloadGeneric(c.render3DDataVersionUrl,"flyoverdata",function(n){r.getFlyovers(n)}),r._disposables=[e.onButtonClick.add(function(t){var u=t.flyoverUrl.split(":",2),i=u[0];if(i!=="render")throw new Error('Unknown playback mode: "'.concat(i,'"'));r.openPlayer(t.flyoverUrl)}),e,r.onCloseBtnClick,r.onFeedbackBtnClick,r.onOpenBtnClick],r)}return l(r,i),Object.defineProperty(r.prototype,"landmarkDataVersion",{get:function(){return this._landmarkDataVersion},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){this._isDisposed||this._map.controls.remove(this.flyoverButtonControl);i.prototype.dispose.call(this)},r.prototype.getControl=function(){return this.flyoverButtonControl},r.prototype.sendCloseEvent=function(){n.Map3DShared.close()},r.prototype.getFlyovers=function(t){var i=this;this._landmarkDataVersion=t;n.getFlyoverReferences(t,function(t){n.flyoverData=t;i.flyoverButtonControl.update(i._map)})},r.prototype.openPlayer=function(t){var i=this,r,f,e,u;if(this._openDisposables&&this._close("ERR"),!t)throw new Error("Flyover player location must be set");if(this.lastPlayerTypedUrl=t,r=t.split(":",2),r.length!==2)throw new Error('Flyover player location badly formed: "'.concat(t,'"'));if(f=r[1],!f)throw new Error("Flyover player location id may not be blank");if(e=r[0],this.lastPlayerOpenTime=Date.now(),e!=="render")throw new Error('Unknown playback mode: "'.concat(e,'"'));u=n.Map3DShared.instance;u.open(this._map,{flyoverId:f,landmarkDataVersion:this.landmarkDataVersion});this._openDisposables=[u.onCloseBtnClick.add(function(n){i._close("X");i.onCloseBtnClick.invoke(n)}),u.onFeedbackBtnClick.add(function(n){i._close("F");i.onFeedbackBtnClick.invoke(n)})];this.onViewerOpen.invoke()},r.prototype._close=function(i){var r,u,f;this._openDisposables&&((u=(r=this.flyoverButtonControl)===null||r===void 0?void 0:r.getButtonElement())===null||u===void 0?void 0:u.focus(),f=this.lastPlayerOpenTime?Date.now()-this.lastPlayerOpenTime:undefined,this.lastPlayerOpenTime=undefined,t("CLSM",this.lastPlayerTypedUrl,f),this._openDisposables.forEach(function(n){return n.dispose()}),this._openDisposables=undefined,this.onViewerClose.invoke(),this.lastPlayerTypedUrl=undefined)},r}(b);n.FlyoverDelegate=i}(t||(t={})),function(n){n.decodeFlyoverReferences=function(n){return JSON.parse(n,function(n,t){switch(n){case"m":return this.coordinate=t,undefined;case"n":return this.name=t,undefined;case"c":return this.coordinate=t,undefined;case"r":return this.render=t,undefined;case"d":return this.radiusMercatorMeters=t,undefined;default:return t}})};n.getFlyoverReferences=function(t,i){var r=c.render3DAllUrlFormat.replace("{version}",t);y.downloadGeneric(r,"flyovers",function(t){var r=n.decodeFlyoverReferences(t);i(r)})}}(t||(t={})),function(n){var t;(function(t){var i=atlas.data,u=10,f=1e5,e=Math.PI/180,o=1/(4*Math.PI),r=85.0511287798,s=function(n){return a.C_earthCircumference/Math.pow(2,n)},h=function(n){return n-Math.floor(n+.5)},l=function(n,t){n=Math.max(Math.min(n,r),-r)*e;var u=h(.5*t/180),i=Math.sin(n),f=Math.log((1+i)/(1-i))*o;return[f*a.C_earthCircumference,u*a.C_earthCircumference]},v=function(n,t){var i=n[0]-t[0],r=n[1]-t[1];return Math.sqrt(i*i+r*r)};t.getFlyoverItems=function(t,r){var o=[],y=n.flyoverData,h,p,w,a,b,e,d;if(y)if(c===null||c===void 0?void 0:c.isRadiusSearchEnabled){var g=Math.min(f,s(r)),k=i.BoundingBox.getCenter(t),nt=l(k[1],k[0]);for(h=0,p=y;h<p.length;h++)e=p[h],w=v(e.coordinate,nt)-e.radiusMercatorMeters,w<g&&(e.distance=w,o.push(e));o.sort(function(n,t){return n.distance-t.distance});o.length=Math.min(u,o.length)}else for(a=0,b=y;a<b.length;a++)e=b[a],d=[e.coordinate[1],e.coordinate[0]],i.BoundingBox.containsPosition(t,d)&&o.push(e);return o}})(t=n.FlyoverService||(n.FlyoverService={}))}(t||(t={})),function(t){var h='\n        <div class="bm_flyoverBtnContent">\n            <span class="bm_flyoverBadge" aria-hidden="true"><\/span>\n            <span class="bm_flyoverText"><\/span>\n        <\/div>\n        <div class="bm_videoLinks">\n            <ul><\/ul>\n        <\/div>\n    ',a='<li tabindex="0" ><div data-url="{url}">{name}<\/div><\/li>',v='\n        <button type="button" class="bm_flyoverBtnContent">\n            <span class="bm_flyoverBadge" aria-hidden="true"><\/span>\n            <span class="bm_flyoverText"><\/span>\n        <\/button>\n        <div class="bm_videoLinks">\n            <ul><\/ul>\n        <\/div>\n    ',i=function(n,t,i){var r=o.logger,u={feature:"FLO",action:n,data:{component:"FOBTN",boundingBox:f.convertMapBoundsOrder(i.bounds,0).toString(),zoom:f.convertZoom(i.zoom,0),videoUrl:t}};r.logObject(u)},e=function(n,t,i){return t?n.classList.add(i):n.classList.remove(i)},y=function(n,t){return n===t||(n===null||n===void 0?void 0:n.length)===t.length&&(n===null||n===void 0?void 0:n.every(function(n,i){return n===t[i]}))},p=function(o){function p(n){var t=o.call(this)||this;return t._map=n,t.onButtonClick=new u,t.disposables=[s.add(n,"moveend",function(){t.update(n)}),t.onButtonClick],t}return l(p,o),p.prototype.update=function(u){var p=this,w,b=this.buttonContainer,et,g,tt,l,it,o,s,rt,v,h;if(!nt.is3DSupported){b.style.display="none";this.isVisible=!1;return}this.flyoverText.textContent=n.L_3DLandmark_Flyover_Render;var k=u.getCamera(),ut=k.zoom,ot=k.bounds,f=t.FlyoverService.getFlyoverItems(ot,ut),ft=f===null||f===void 0?void 0:f.find(function(n){return n.render}),d=ft&&ut>=c.minLodToShowButton;if(b.style.display=d?"flex":"none",d&&(e(b,r.isMapsVertical||r.dynamicProperties.isMapsOverlay,"vertical"),this.flyoverUrl="render:".concat(ft.render),et=!y(f,(w=this.lastBuiltFlyoverItems)!==null&&w!==void 0?w:[]),et)){for(this.lastBuiltFlyoverItems=f,g="",this.itemListContainer.replaceChildren(),tt=0,l=0,it=f;l<it.length;l++)o=it[l],o.render&&(c.useImprovedButton?(s=document.createElement("button"),s.type="button",s.setAttribute("data-url","render:".concat(o.render)),s.textContent=o.name,s.addEventListener("keydown",function(n){var t;n.code==="Escape"&&((t=p.getButtonElement())===null||t===void 0?void 0:t.focus(),n.stopPropagation())}),rt=document.createElement("li"),rt.appendChild(s),this.itemListContainer.appendChild(rt)):g+=a.replace("{url}","render:".concat(o.render)).replace("{name}",o.name),++tt);for(c.useImprovedButton||(this.itemListContainer.innerHTML=g),this.flyoverBadge.textContent=tt.toString(),v=this.itemListContainer.getElementsByTagName("li"),h=0;h<v.length;h++)c.useImprovedButton?v[h].addEventListener("click",function(n){p._onFlyoverListItemClick(n)}):v[h].addEventListener("keydown",function(n){(n.code==="Enter"||n.code==="Space")&&p._onFlyoverListItemClick(n)});this.isVisible||i("I",this.flyoverUrl,k)}this.isVisible=d},p.prototype.dispose=function(){this.isDisposed||(f._clearDisposables(this.disposables),this.isDisposed=!0)},p.prototype.onAdd=function(n){var i=this,s=function(){return i._invokeFlyoverButtonClick(i.flyoverUrl)},u=function(n){n.type==="mouseover"?(clearTimeout(i.timerHandle),i.itemListContainer.style.display="block"):i.timerHandle=setTimeout(function(){i.itemListContainer.style.display="none"},250)},l=function(){i.itemListContainer.style.display="block"},a=function(n){n.currentTarget.contains(n.relatedTarget)||(i.itemListContainer.style.display="none")},y=function(n){(n.keyCode===13||n.keyCode===32)&&(i.itemListContainer.style.display="block",i.itemListContainer.firstElementChild.focus())},t=this.buttonContainer=this.buildContainer(n,atlas.ControlStyle.auto),f,o;return t.className="bm_flyoverButton",c.useImprovedButton||(t.tabIndex=0),e(t,r.isMapsVertical||r.dynamicProperties.isMapsOverlay,"vertical"),t.innerHTML=c.useImprovedButton?v:h,t.addEventListener("mouseover",u),t.addEventListener("mouseout",u),t.addEventListener("focusout",a),c.useImprovedButton?t.addEventListener("focusin",l):t.addEventListener("keydown",y),f=t.querySelector(".bm_videoLinks"),f.addEventListener("click",function(n){return i._onFlyoverListItemClick(n)}),o=t.querySelector(".bm_flyoverBtnContent"),o.addEventListener("click",s),this.itemListContainer=t.querySelector(".bm_videoLinks ul"),this.flyoverBadge=t.querySelector(".bm_flyoverBadge"),this.flyoverText=t.querySelector(".bm_flyoverText"),t},p.prototype.getRootElement=function(){return this.buttonContainer},p.prototype.getButtonElement=function(){var n;if((n=this.buttonContainer)!==null&&n!==void 0)return n.querySelector(".bm_flyoverBtnContent")},p.prototype._invokeFlyoverButtonClick=function(n){i("C",n,this._map.getCamera());var t={flyoverUrl:n};this.onButtonClick.invoke(t)},p.prototype._onFlyoverListItemClick=function(n){var t=n.type==="click"?n.target:n.target.firstElementChild,i=t.getAttribute("data-url");this._invokeFlyoverButtonClick(i)},p}(atlas.control.ControlBase);t.FlyoverButtonControl=p}(t||(t={})),function(n){var t;(function(n){n.Label="lbl";n.Landmark="lmk"})(t=n.EventEmitterName||(n.EventEmitterName={}))}(t||(t={})),function(t){var c=function(n,t,i){var r=o.logger,u={feature:"LMK3D",action:n,data:{LN:t,CTX:i}};r.logObject(u)},i=function(n){var t=document.createElement("img");return t.crossOrigin="anonymous",n.startsWith("/")&&(n=r.dynamicProperties.origin+n),t.src=n,t},e=48,a=6,v=7,p="DRTLNK",k=function(o){function b(n){var t=o.call(this,n.getAzureMap&&n.getAzureMap()||n)||this;return t.onFeedbackBtnClick=new u,t.onViewerOpen=new u,t.onViewerClose=new u,t._open=!1,t._htmlElement=document.querySelector("html"),t._disposables=[t.onFeedbackBtnClick],t._map.mapLoaded.then(function(){t._initialize();(h===null||h===void 0?void 0:h.enableShare)&&window.location.search.indexOf("lmk3d=")>=0&&t._openDirectLink()}),t}return l(b,o),b.prototype.dispose=function(){o.prototype.dispose.call(this)},b.prototype._updateLayerVisibility=function(){var t,f,s,i,e,h;if(this._defaultLayers&&this._map){var o=this._map._getMap(),r=o.getStyle().metadata,n=r===null||r===void 0?void 0:r.layerIndex,c=((n===null||n===void 0?void 0:n.defaultBusinessLandmarks)||[]).concat((n===null||n===void 0?void 0:n.retiredBusinessLandmarks)||[]),u=!1;for(t=0,f=c;t<f.length;t++)if(s=f[t],u=o.getLayoutProperty(s,"visibility")==="visible",u)break;for(i=0,e=this._defaultLayers;i<e.length;i++)h=e[i],h.setOptions({visible:u})}},b.prototype._initialize=function(){var n=this,t=this._map.sources.getById("bing-mvt"),r,u;t?(r=function(t,i){return t.width=e,t.height=e,n._map.imageSprite.add(i,t)},u=new Promise(function(n){var t=i(h.defaultIconResource),u=i(h.hoverIconResource);if(!t||!u){n(!1);return}var f=new Promise(function(n){t.onload=function(){r(t,"lmk-3d").then(function(){return n()})}}),e=new Promise(function(n){u.onload=function(){r(u,"lmk-3d-hover").then(function(){return n()})}}),o=[f,e];Promise.all(o).then(function(){return n(!0)})}),u.then(function(i){if(i){var r=n._defaultLayers=[new g.SymbolLayer(t,"lmk_3d_default",{sourceLayer:"landmark",minZoom:11,filter:["==","lmk-has3d","1"],iconOptions:{allowOverlap:!1,ignorePlacement:!0,image:"lmk-3d",offset:h.iconOffsetDefault,size:.7}}),new g.SymbolLayer(t,"lmk_3d_premium_default",{sourceLayer:"premium",minZoom:12,filter:["==","lmk-has3d","1"],iconOptions:{allowOverlap:!1,ignorePlacement:!0,image:"lmk-3d",offset:h.iconOffsetPremium,size:.7}})];n._map.layers.add(r);n._map.events.add("stylechanged",function(){return n._updateLayerVisibility()});n._updateLayerVisibility();n._map.createDataSource("lmk_hover_ds").then(function(t){n._hoverDataSource=t;var i=n._hoverLayer=new g.SymbolLayer(t,"lmk_3d_hover",{iconOptions:{allowOverlap:!1,ignorePlacement:!0,image:"lmk-3d-hover",size:.7}});n._map.layers.add(i)});n._disposables.push(s.add(n._map,"mouseenter",r,function(t){return n._hoverShape(n._getShapeData(t))}),s.add(n._map,"mouseleave",r,function(){return n._hoverShape()}),s.add(n._map,"mousemove",r,function(t){return n._hoverShape(n._getShapeData(t))}),s.add(n._map,"click",r,function(t){return n._onClicked(t)}))}})):this._map.events.addOnce("stylechanged",function(){return n._initialize()})},b.prototype.sendCloseEvent=function(){t.Map3DShared.close()},b.prototype._openDirectLink=function(){var t,r=f._getUrlParam(window.location,"lmk3d",!1),n;if(r&&(n=r.split("|"),n.length===a||n.length===v)){var i=parseFloat(n[0]),u=parseFloat(n[1]),e=parseFloat(n[2]),o=parseFloat(n[3]),s=parseFloat(n[4]),h=n[5],c=(t=n[6])!==null&&t!==void 0?t:"",l=ot.normalizeLongitude(u);i>=-90&&i<=90&&!isNaN(l)&&!isNaN(e)&&!isNaN(o)&&!isNaN(s)&&this._openViewer({pivotLat:i,pivotLong:u,elevation:e,radius:o,pitch:s,name:h},p,c)}},b.prototype._openViewer=function(n,i,r){var f=this,e,u;this._openDisposables&&this._close("ERR");e={viewLatitude:n.pivotLat,viewLongitude:n.pivotLong,viewAltitude:n.elevation,targetCameraRadius:n.radius,targetCameraInclination:n.pitch};u=t.Map3DShared.instance;u.open(this._map,e,r,"LMK3D",i);this._openDisposables=[u.onCloseBtnClick.add(function(){f._close("X")}),u.onFeedbackBtnClick.add(function(n){f._close("F");f.onFeedbackBtnClick.invoke(n)})];this.onViewerOpen.invoke()},b.prototype._close=function(n){if(this._open=!1,this._openDisposables){this.onViewerClose.invoke();var i=this._openDisposables;this._openDisposables=undefined;i.forEach(function(n){return n.dispose()});this._htmlElement.style["overscroll-behavior"]=""}},b.prototype._onClicked=function(n){var u=this,f=this._getShapeData(n),i=f===null||f===void 0?void 0:f.ypid,e;i&&!this._open&&(this._open=!0,e=h.backendUrlFormat.replace("{origin}",r.dynamicProperties.origin).replace("{ypid}",i),y.downloadJson(e,null,function(n){try{u._openViewer(n,"ICON",i)}catch(r){u._open=!1;throw r;}},function(){u._open=!1}))},b.prototype._hoverShape=function(t){var r=this,u,f,e,i=t===null||t===void 0?void 0:t.feature,o,s;if(i!==this._hoveredFeature&&(i===null||i===void 0?void 0:i.id)!==((u=this._hoveredFeature)===null||u===void 0?void 0:u.id)){if((f=this._flyout)===null||f===void 0?void 0:f.remove(),this._flyout=undefined,this._hoverDataSource.clear(),window.clearTimeout(this._hoveredTimer),!(t===null||t===void 0?void 0:t.position)){this._hoveredFeature=undefined;return}this._hoveredFeature=i;o=i.sourceLayer==="premium"?h.iconOffsetPremium:h.iconOffsetDefault;s=i.sourceLayer==="premium"?h.popupOffsetPremium:h.popupOffsetDefault;(e=this._hoverLayer)===null||e===void 0?void 0:e.setOptions({iconOptions:{offset:o}});this._hoverDataSource.add(i);this._hoveredTimer=w.setTimeout(function(){r._hoveredTimer=undefined;var u=n.L_Landmark3D_Flyout_Text_Format.replace("{name}",t.name),f={content:'<div class="bm_3dlandmark_flyout" aria-hidden="true">'.concat(u,"<\/div>"),pixelOffset:s,position:t.position,closeButton:!1,showPointer:!1},i=r._flyout=new atlas.Popup(f);i.attach(r._map);i.open();c("H",t.ypid,"ICON")},200)}},b.prototype._getShapeData=function(n){var r,u=n.shapes,f,t,i,e;return u&&u.length&&(t=u[0],i=t.properties,i["lmk-ypid"]&&(e=(r=t.geometry)===null||r===void 0?void 0:r.coordinates,f={feature:t,name:i.name,ypid:i["lmk-ypid"],position:e})),f},b}(b);t.Landmarks3DDelegate=k}(t||(t={})),function(n){var t;n.TMap3D="map3D";t=function(n,t){var i=o.logger,r={feature:n.feature,action:n.action,TS:t,data:n.data};i.logObject(r)};n.errorToString=function(n,t){var i,r;return n instanceof Error?t?(i=n.stack)!==null&&i!==void 0?i:"stackless ".concat(n):(r=n.message)!==null&&r!==void 0?r:"noMessage":n!==null&&typeof n=="object"?"class ".concat(n.constructor.name):"".concat(n)};var i=function(i){var r,u;try{(r=i===null||i===void 0?void 0:i.dispose)===null||r===void 0?void 0:r.call(i)}catch(f){u={CTX:"DISPOSE",MSG:"Dispose ".concat(i===null||i===void 0?void 0:i.constructor.name,": ").concat(n.errorToString(f,!0))};t({feature:"MAP3D",action:"ERR",data:u})}},r=function(n){var u,t,f,s,h,r,e,o;if(n)if(Array.isArray(n)){for(u=n,t=0,f=u;t<f.length;t++)s=f[t],i(s);u.length=0}else for(h=Object.keys(n),r=0,e=h;r<e.length;r++)o=e[r],i(n[o]),delete n[o]},f=function(){function n(){}return n.prototype.onLog=function(n){var i=map3DBundle.Map3DLogHelpers.createLogDataFromEvent(n);i&&t(i)},n}(),e=function(){function n(){}return n.prototype.onLog=function(n){var i=map3DBundle_vnext.Map3DLogHelpers.createLogDataFromEvent(n);i&&t(i)},n}(),s=function(){function i(){var n=this;this.onFeedbackBtnClick=new u;this.onCloseBtnClick=new u;this.onViewerOpen=new u;this._disposables=[];this.loggedError=!1;this.onError=function(t){n.doError("Closing for uncaught error",t.error)};this.onPromiseRejection=function(t){var i,r;(i=(r=t).error)!==null&&i!==void 0?i:r.error=t.reason;n.doError("Closing for uncaught promise rejection",t.reason)};this._htmlElement=document.querySelector("html")}return Object.defineProperty(i,"instance",{get:function(){return i._instance||(i._instance=new i),i._instance},enumerable:!1,configurable:!0}),Object.defineProperty(i,"haveInstance",{get:function(){return!!i._instance},enumerable:!1,configurable:!0}),i.prototype.open=function(i,r,u,o,s){var h=this,c,l;this._viewerSettings&&this._close();this.loggedError=!1;t({feature:"MAP3D",action:"PRF",data:{CTX:"INIT"}});c="/maps/m3dping";fetch(c).catch(function(){console.error("Failed m3dping")});this._desiredViewerSettings={map:i,options:r};l=[new Promise(function(n){ut.resolveBySourceKey("Map3DControl",n)}),new Promise(function(n){ut.resolveBySourceKey("Map3DControlCss",n)})];Promise.all(l).then(function(){var a,v,i,y,p,l,w,c;if(h._desiredViewerSettings){if(v=h._viewerSettings=h._desiredViewerSettings,h._desiredViewerSettings=undefined,n.fullScreen(!0),window.addEventListener&&window.removeEventListener&&(i=window.jsErrorHandler,i&&(window.removeEventListener("unhandledrejection",i,!1),window.removeEventListener("error",i,!1)),window.addEventListener("error",h.onError,!1),window.addEventListener("unhandledrejection",h.onPromiseRejection,!1),i&&(window.addEventListener("error",i,!1),window.addEventListener("unhandledrejection",i,!1))),y=k.package==="VNext",p=y?map3DBundle_vnext.Ypid:map3DBundle.Ypid,r.ypid=p.tryParse(u),o&&(l={},l.LN=(a=r.ypid)===null||a===void 0?void 0:a.toString(),l.CTX=s,t({feature:o,action:"C",data:l})),w=y?new e:new f,c=h._viewer=new n.Map3DViewerControl(k,v.options,w),k.causeError)throw new Error("Test");h.lastViewerOpenTime=Date.now();v.map.controls.add(c);h._disposables.push(c);h._disposables.push(c.onCloseBtnClick.add(function(t){h._close();h.onCloseBtnClick.invoke(t)}));h._disposables.push(c.onFeedbackBtnClick.add(function(t){h._close();h.onFeedbackBtnClick.invoke(t)}));h._htmlElement.style["overscroll-behavior"]="none";h.onViewerOpen.invoke()}})},i.close=function(){var n;(n=i._instance)===null||n===void 0?void 0:n._closeExternal()},i.prototype._closeExternal=function(){var t;this._viewer&&this.lastViewerOpenTime!==undefined?t=this._viewer.onCloseBtnClick:(this._close(),t=this.onCloseBtnClick);t.invoke(new MouseEvent("click"))},i.prototype._close=function(){var i,u,f,e;window.removeEventListener&&(window.removeEventListener("unhandledrejection",this.onPromiseRejection),window.removeEventListener("error",this.onError));f=this.lastViewerOpenTime?Date.now()-this.lastViewerOpenTime:undefined;this.lastViewerOpenTime=undefined;e=this.errorMessage?{feature:"MAP3D",action:"ERR",data:{CTX:"CLOSE",MSG:this.errorMessage}}:{feature:"MAP3D",action:"CLSM",data:{CTX:"BUTTON"}};t(e,f);this._desiredViewerSettings=undefined;this._viewer&&((u=(i=this._viewerSettings)===null||i===void 0?void 0:i.map)===null||u===void 0?void 0:u.controls.remove(this._viewer),this._viewer=undefined);this._viewerSettings=undefined;this._htmlElement.style["overscroll-behavior"]="";n.fullScreen(!1);r(this._disposables)},i.prototype.doError=function(t,r){var u,e,f,o;r&&((t===null||t===void 0?void 0:t.startsWith(ct.geocodingErrorPrefix))||(typeof r.message=="string"&&r.message.startsWith("v9;")?(u=r.message.indexOf(":"),u!==-1&&(r.message=r.message.slice(0,u)+";3D"+r.message.slice(u))):(this.errorMessage="Code error in 3D map: ".concat(t),e=n.errorToString(r,!0),e&&(this.errorMessage+=": ".concat(e)),f="SDK",Microsoft.Maps.globalConfig.isMapsVertical?f="Vertical":Microsoft.Maps.globalConfig.isMapsAnswer&&(f="MapSerp"),r.message="v9;".concat(f,";3D:").concat(n.errorToString(r,!1))),console.error(this.errorMessage),this._closeExternal(),this.loggedError||(k.causeError||!i.isLikelyBotOrTestTraffic())&&(o="/maps/m3deping",fetch(o).catch(function(){console.error("Failed m3deping")}),this.loggedError=!0)))},i.hasMapsNameSpace=function(){return!!(typeof Microsoft!="undefined"&&Microsoft.Maps)},i.isLikelyBotOrTestTraffic=function(){return!navigator.userAgent||i.hasMapsNameSpace()&&Microsoft.Maps.globalConfig&&(Microsoft.Maps.globalConfig.isTestTraffic||Microsoft.Maps.globalConfig.dynamicProperties.likelyBot)},i}();n.Map3DShared=s}(t||(t={})),function(n){var t=55,i=function(n){return a.C_earthCircumference/Math.pow(2,n)},r=function(r){function f(n){var t=r.call(this,n.getAzureMap&&n.getAzureMap()||n)||this;return t.onFeedbackBtnClick=new u,t.onOpen=new u,t.onClose=new u,t}return l(f,r),f.prototype.open=function(r){var f=this,c,u=this._map.getCamera(),e=undefined,l=(c=r===null||r===void 0?void 0:r.metadata)===null||c===void 0?void 0:c.sourcePrimitive,o,s,h;if(l&&(o=l.geometry.y,s=l.geometry.x,o!==undefined&&s!==undefined)){var a=-u.bearing,v=Math.max(t,u.pitch),y=i(u.zoom);e={viewLatitude:o,viewLongitude:s,targetCameraAzimuth:a,targetCameraInclination:v,targetCameraRadius:y}}if(!e){var o=u.center[1],s=u.center[0],a=-u.bearing,v=Math.max(t,u.pitch),y=i(u.zoom);e={viewLatitude:o,viewLongitude:s,targetCameraAzimuth:a,targetCameraInclination:v,targetCameraRadius:y}}h=n.Map3DShared.instance;h.open(this._map,e);this._openDisposables=[h.onCloseBtnClick.addOne(function(){f.clearOpenDisposables();f.onClose.invoke()}),h.onFeedbackBtnClick.addOne(function(t){f.clearOpenDisposables();f.onFeedbackBtnClick.invoke(t)})];this.onOpen.invoke()},f.prototype.sendCloseEvent=function(){n.Map3DShared.close()},f.prototype.clearOpenDisposables=function(){var n;(n=this._openDisposables)===null||n===void 0?void 0:n.forEach(function(n){return n.dispose()});this._openDisposables=undefined},f}(b);n.Map3DSharedDelegate=r}(t||(t={})),function(t){var e='<canvas class="bm_map3DRenderCanvas" id="bm_map3DRenderCanvas"><\/canvas>',o=function(n,t){switch(t){case"V3":return n==="VNext"?map3DBundle_vnext.ModelTileFormat.V3:map3DBundle.ModelTileFormat.V3;case"V4":return n==="VNext"?map3DBundle_vnext.ModelTileFormat.V4:map3DBundle.ModelTileFormat.V4;default:return undefined}},s=function(n){switch(n){case 0:return map3DBundle_vnext.PowerPreference.default;case 1:return map3DBundle_vnext.PowerPreference.highPerformance;case 2:return map3DBundle_vnext.PowerPreference.lowPower;default:return undefined}},i=function(n){var t=new URL(n,window.location.origin);return t.toString()},c=function(n){var i=":not([tabindex='-1'])",t="".concat(i).concat(":not([disabled])").concat(":not([hidden])").concat(":not([inert])");return n.querySelectorAll("a".concat(t,", button").concat(t,", div[tabindex='1']").concat(t," input").concat(t,", select").concat(t,", textarea").concat(t,", [tabindex]").concat(i))},a=function(a){function v(n,t,i){var r=a.call(this)||this;return r.onFeedbackBtnClick=new u,r.onCloseBtnClick=new u,r._componentName="M3D",r.focusTrap=function(n){var i=r.container,s,f,u,e,o,t;if(i&&n.target instanceof HTMLElement&&i!==n.target&&!i.contains(n.target))for(s=n.target===r.precedingFocusableDiv,f=Array.from(c(i)),s&&f.reverse(),u=0,e=f;u<e.length;u++)if(o=e[u],t=getComputedStyle(o),t.display!=="none"&&t.visibility!=="hidden"&&t.visibility!=="collapse"&&t.opacity!=="0"){n.stopPropagation();n.preventDefault();o.focus();break}},r.options=t,r.config=n,r.logger=i,r.disposables=[r.onCloseBtnClick,r.onFeedbackBtnClick],r}return l(v,a),v.prototype.onAdd=function(n){var y=this,s,h,v,a,u,o;if(h=r.dynamicProperties.sessionKey,!h)throw new Error("Session key is not defined");var c=this.config,l=c.package==="VNext",p=l?map3DBundle_vnext.Ypid:map3DBundle.Ypid,w=l?map3DBundle_vnext.setIfLandmarkDataVersion:map3DBundle.setIfLandmarkDataVersion,b=l?map3DBundle_vnext.setIfFlyoverId:map3DBundle.setIfFlyoverId,i=this.options;if(i.sessionId=h,i.market=r.dynamicProperties.uiLanguage,i.region=r.dynamicProperties.userRegion,i.rightToLeft=f._isRtl(),i.class=nt.deviceClassification,i.styleVersion=r.stlVersion,i.ypid=p.tryParse((s=i.ypid)===null||s===void 0?void 0:s.toString()),i.appearance=c.isThemeSynchronized&&c.isDarkModeEnabled&&f.getMapStyle(n).theme==="dark"?0:1,v=f._getUrlParam(window.location,"lmk3ddataver",!1),w(v,function(n){i.landmarkDataVersion=n}),a=i.flyoverId,a!==undefined&&(i.flyoverId=undefined,b(a,function(n){i.flyoverId=n})),u=this.container=this.buildContainer(n,atlas.ControlStyle.auto),u.className="bm_map3DContainer",u.innerHTML=e,this.config.isFocusTrapEnabled&&(u.role="dialog",u.ariaModal="true"),o=u.querySelector(".bm_map3DRenderCanvas"),!o)throw new Error("Could not get canvas");return o.style.width="100%",o.style.height="100%",n.mapLoaded.then(function(){return y.onIsInDOM(o)}),u},v.prototype.onIsInDOM=function(u){var c,l,y=this,it=f._getUrlParam(window.location,"setapplicationendpoint"),p=function(n){return it&&(n+="".concat(n.includes("?")?"&":"?","setapplicationendpoint=").concat(it)),n},a=this.config,d=a.package==="VNext",v=this.options,g,rt,nt,e,w,tt,b,k;v.fetchWorkerUrlOverride=i(p(a.fetchWorkerJsResource));v.decodeWorkerUrlOverride=i(p(a.decodeWorkerJsResource));v.basisTranscodeWorkerUrlOverride=i(p(a.basisTranscoderJsResource));v.dracoDecodeWorkerUrlOverride=i(p(a.dracoDecoderJsResource));v.decoderWasmUrlOverride=i(a.decoderWasmResource);v.basisWasmUrlOverride=i(a.basisWasmResource);v.assetPrefix=d?"/3dmap/vnext":"/3dmap";v.showFlyoverButton=a.isFlyoverButtonEnabledIn3D;v.enableImmersiveViews=a.isImmersiveViewEnabled;v.showFeedbackButton=r.isMapsVertical;v.isFlyoverInterruptable=a.isFlyoverInterruptible;v.fetchWorkerCount=a.fetchWorkerCount;v.decodeWorkerCount=a.decodeWorkerCount;v.dracoWasmBinaryUrlOverride=i(a.dracoDecoderWasmResource);v.modelTileFormat=o(a.package,a.modelTileFormat);v.enableBorderLines=!!a.isCountryRegionDisplayEnabled;v.enablePoliticalLabels=!!a.isCountryRegionDisplayEnabled;v.enableNearbySights=!!a.isNearbySightsEnabled;v.enableOutdoorButton=!!a.isOutdoorButtonEnabled;v.enableScreenSpaceReflections=!!a.isScreenSpaceReflectionsEnabled;v.sceneOptimizerEnabled=!!a.isSceneOptimizerEnabled;v.enableTrees=!!a.isVegetationEnabled;a.hardwareScalingOverride>0&&(v.hardwareScalingOverride=a.hardwareScalingOverride);v.powerPreference=s(a.powerPreference);v.useLocationRecognition=!!a.isLocationRecognitionEnabled;v.isLoadingGraphicEnabled=!!a.isLoadingSpinnerEnabled;v.showLabelsAutomatically=!!a.isAutomaticLabellingEnabled;v.isLabelLightingEnabled=!!a.isDarkModeEnabled;v.isAutoAppearanceEnabled=!!a.isDarkModeEnabled;v.showRichCardContent=!!a.isRichCardContentEnabled;v.renderImagePreviewAsOverlay=!!a.useImagePreviewIFrame;v.imagePreviewUrlFormat=a.imagePreviewUrlFormat;v.albedoSaturation=a.saturation;a.networkMockFormatUrl&&(g=f._getUrlParam(window.location,"vptest3d"),g&&(v.networkMockFormatUrl=a.networkMockFormatUrl.replace("{testScenario}",g)));rt=a.gpuClassificationOverride>=0;rt&&(this.options.gpuClassification=a.gpuClassificationOverride);nt=h.shareLinkFormat.replace("{origin}",r.dynamicProperties.origin);d?(e=map3DBundle_vnext.LocalizationKey,w=(c={},c[e.canvasAltText]=n.L_3D_Canvas_Alt_Text,c[e.shareButtonTitle]=n.L_3DLandmark_Share_Button_Tooltip,c[e.shareButtonAriaLabel]=n.L_3DLandmark_Share_Button_Aria_Label,c[e.copyUrlButtonText]=n.L_3DLandmark_Copy_Button_Text,c[e.copyUrlTextBoxArialLabel]=n.L_3D_Copy_Url_Text_Box_Aria_Label,c[e.sharePanelCloseText]=n.L_3DLandmark_Share_Panel_Close,c[e.copyLinkSuccessText]=n.L_3DLandmark_Copy_Link_Success,c[e.feedbackButtonTitle]=n.L_3DLandmark_Feedback_Button_Tooltip,c[e.feedbackButtonAriaLabel]=n.L_3DLandmark_Feedback_Button_Aria_Label,c[e.closeButtonTitle]=n.L_3DLandmark_Share_Panel_Close,c[e.closeButtonAriaLabel]=n.L_3DLandmark_Share_Panel_Close,c[e.clearInputButtonTitle]=n.L_3D_Search_Clear_Button_Aria_Label,c[e.clearInputButtonAriaLabel]=n.L_3D_Search_Clear_Button_Title,c[e.searchPlaceholderText]=n.L_3D_Search_Placeholder,c[e.searchAriaLabel]=n.L_3D_Search_Aria_Label,c[e.mapPickerZoomInButtonTitle]=n.L_ZoomIn,c[e.mapPickerZoomInButtonAriaLabel]=n.L_ZoomIn,c[e.mapPickerZoomOutButtonTitle]=n.L_ZoomOut,c[e.mapPickerZoomOutButtonAriaLabel]=n.L_ZoomOut,c[e.mapPickerCompassResetButtonTitle]=n.L_Compass_Reset,c[e.mapPickerCompassResetButtonAriaLabel]=n.L_Compass_Reset,c[e.mapPickerCompassRotateClockwiseButtonTitle]=n.L_Compass_Left,c[e.mapPickerCompassRotateClockwiseButtonAriaLabel]=n.L_Compass_Left,c[e.mapPickerCompassRotateCounterclockwiseButtonTitle]=n.L_Compass_Right,c[e.mapPickerCompassRotateCounterclockwiseButtonAriaLabel]=n.L_Compass_Right,c[e.mapPickerTiltButtonTitle]=n.L_Pitch_Reset,c[e.mapPickerTiltButtonAriaLabel]=n.L_Pitch_Reset,c[e.mapPickerTiltUpButtonTitle]=n.L_Pitch_Decrease,c[e.mapPickerTiltUpButtonAriaLabel]=n.L_Pitch_Decrease,c[e.mapPickerTiltDownButtonTitle]=n.L_Pitch_Increase,c[e.mapPickerTiltDownButtonAriaLabel]=n.L_Pitch_Increase,c[e.weatherText]=n.L_3D_WeatherPicker_Button_Text,c[e.weatherAriaLabel]=n.L_3D_WeatherPicker_Button_Aria_Label,c[e.cloudsText]=n.L_3D_WeatherPicker_Clouds_Button_Text,c[e.cloudsAriaLabel]=n.L_3D_WeatherPicker_Clouds_Aria_Label,c[e.rainText]=n.L_3D_WeatherPicker_Rain_Button_Text,c[e.rainAriaLabel]=n.L_3D_WeatherPicker_Rain_Button_Aria_label,c[e.snowText]=n.L_3D_WeatherPicker_Snow_Button_Text,c[e.snowAriaLabel]=n.L_3D_WeatherPicker_Snow_Button_Aria_Label,c[e.clearSkyText]=n.L_3D_WeatherPicker_Clear_Sky_Button_Text,c[e.clearSkyAriaLabel]=n.L_3D_WeatherPicker_Clear_Sky_Button_Aria_Label,c[e.weatherCollapseTitle]=n.L_3D_WeatherPicker_Collapse_Button_Title,c[e.weatherCollapseArialLabel]=n.L_3D_WeatherPicker_Collapse_Button_Aria_Label,c[e.timeSliderTitle]=n.L_3D_TimeSlider_Title,c[e.timeSliderButtonTitle]=n.L_3D_TimeSlider_Aria_Label,c[e.timeSliderArialabel]=n.L_3D_TimeSlider_Aria_Label,c[e.timeSliderCollapseTitle]=n.L_3D_TimeSlider_Collapse_Button_Title,c[e.timeSliderCollapseArialLabel]=n.L_3D_TimeSlider_Collapse_Button_Aria_label,c[e.flyoverButtonText]=n.L_3DLandmark_Flyover_Render,c[e.flyoverButtonAriaLabel]=n.L_3DLandmark_Flyover_Render,c[e.flyoverReturnButtonTitle]=n.L_3D_Flyover_Exit_Button_Title,c[e.playButtonTitleText]=n.L_3D_Flyover_Play_Button_Title,c[e.pauseButtonTitleText]=n.L_3D_Flyover_Pause_Button_Title,c[e.speedSliderTitleText]=n.L_3D_Speed_Slider_Title,c[e.playbackSliderAriaLabel]=n.L_3D_Playback_Slider_Aria_Label,c[e.hideButtonTitle]=n.L_3D_Hide_Button_Title,c[e.showButtonTitle]=n.L_3D_Show_Button_Title,c[e.hideShowButtonAriaLabel]=n.L_3D_HideShow_Button_Aria_Label,c[e.immersiveViewReturnButtonText]=n.L_3D_Immersive_View_Exit_Button_Title,c[e.outdoorButtonText]=n.L_3D_Outdoor_Button_Text,c[e.outdoorButtonTitle]=n.L_3D_Outdoor_Button_Title,c[e.cardResetViewAriaLabel]=n.L_3D_Card_Reset_View_Aria_Label,c[e.cardCloseButtonTitle]=n.L_3DLandmark_Share_Panel_Close,c[e.cardCloseButtonAriaLabel]=n.L_3DLandmark_Share_Panel_Close,c[e.cardCollapseButtonTitle]=n.L_3D_Card_Collapse_Button_Title,c[e.cardCollapseButtonAriaLabel]=n.L_3D_Card_Collapse_Button_Title,c[e.cardExpandButtonTitle]=n.L_3D_Card_Expand_Button_Title,c[e.cardExpandButtonAriaLabel]=n.L_3D_Card_Expand_Button_Title,c[e.cardSeeMoreText]=n.L_3D_Card_See_More_Text,c[e.cardPhoneAriaLabel]=n.L_3D_Card_Phone_Aria_Label,c[e.cardReviewCountText]=n.L_3D_Card_Review_Count_Text,c[e.cardDataFromText]=n.L_3D_Card_Data_From_Text,c[e.nearbySightsAriaLabel]=n.L_3D_NearbySights_Aria_Label,c[e.loadingText]=n.L_3D_Loading_Text,c),this.map3DControl=new map3DBundle_vnext.Map3DControl(u,v,this.logger,new map3DBundle_vnext.DefaultSharingUrlGenerator(nt),w),this.map3DControl.onFeedbackClickObservable.add(function(){y.onFeedbackBtnClick.invoke()})):(e=map3DBundle.LocalizationKey,w=(l={},l[e.CanvasAltText]=n.L_3D_Canvas_Alt_Text,l[e.ShareButtonTitle]=n.L_3DLandmark_Share_Button_Tooltip,l[e.ShareButtonAriaLabel]=n.L_3DLandmark_Share_Button_Aria_Label,l[e.CopyUrlButtonText]=n.L_3DLandmark_Copy_Button_Text,l[e.CopyUrlTextBoxArialLabel]=n.L_3D_Copy_Url_Text_Box_Aria_Label,l[e.SharePanelCloseText]=n.L_3DLandmark_Share_Panel_Close,l[e.CopyLinkSuccessText]=n.L_3DLandmark_Copy_Link_Success,l[e.FeedbackButtonTitle]=n.L_3DLandmark_Feedback_Button_Tooltip,l[e.FeedbackButtonAriaLabel]=n.L_3DLandmark_Feedback_Button_Aria_Label,l[e.CloseButtonTitle]=n.L_3DLandmark_Share_Panel_Close,l[e.CloseButtonAriaLabel]=n.L_3DLandmark_Share_Panel_Close,l[e.ClearInputButtonTitle]=n.L_3D_Search_Clear_Button_Aria_Label,l[e.ClearInputButtonAriaLabel]=n.L_3D_Search_Clear_Button_Title,l[e.SearchPlaceholderText]=n.L_3D_Search_Placeholder,l[e.SearchAriaLabel]=n.L_3D_Search_Aria_Label,l[e.MapPickerZoomInButtonTitle]=n.L_ZoomIn,l[e.MapPickerZoomInButtonAriaLabel]=n.L_ZoomIn,l[e.MapPickerZoomOutButtonTitle]=n.L_ZoomOut,l[e.MapPickerZoomOutButtonAriaLabel]=n.L_ZoomOut,l[e.MapPickerCompassResetButtonTitle]=n.L_Compass_Reset,l[e.MapPickerCompassResetButtonAriaLabel]=n.L_Compass_Reset,l[e.MapPickerCompassRotateClockwiseButtonTitle]=n.L_Compass_Left,l[e.MapPickerCompassRotateClockwiseButtonAriaLabel]=n.L_Compass_Left,l[e.MapPickerCompassRotateCounterclockwiseButtonTitle]=n.L_Compass_Right,l[e.MapPickerCompassRotateCounterclockwiseButtonAriaLabel]=n.L_Compass_Right,l[e.MapPickerTiltButtonTitle]=n.L_Pitch_Reset,l[e.MapPickerTiltButtonAriaLabel]=n.L_Pitch_Reset,l[e.MapPickerTiltUpButtonTitle]=n.L_Pitch_Decrease,l[e.MapPickerTiltUpButtonAriaLabel]=n.L_Pitch_Decrease,l[e.MapPickerTiltDownButtonTitle]=n.L_Pitch_Increase,l[e.MapPickerTiltDownButtonAriaLabel]=n.L_Pitch_Increase,l[e.WeatherText]=n.L_3D_WeatherPicker_Button_Text,l[e.WeatherAriaLabel]=n.L_3D_WeatherPicker_Button_Aria_Label,l[e.CloudsText]=n.L_3D_WeatherPicker_Clouds_Button_Text,l[e.CloudsAriaLabel]=n.L_3D_WeatherPicker_Clouds_Aria_Label,l[e.RainText]=n.L_3D_WeatherPicker_Rain_Button_Text,l[e.RainAriaLabel]=n.L_3D_WeatherPicker_Rain_Button_Aria_label,l[e.SnowText]=n.L_3D_WeatherPicker_Snow_Button_Text,l[e.SnowAriaLabel]=n.L_3D_WeatherPicker_Snow_Button_Aria_Label,l[e.ClearSkyText]=n.L_3D_WeatherPicker_Clear_Sky_Button_Text,l[e.ClearSkyAriaLabel]=n.L_3D_WeatherPicker_Clear_Sky_Button_Aria_Label,l[e.WeatherCollapseTitle]=n.L_3D_WeatherPicker_Collapse_Button_Title,l[e.WeatherCollapseArialLabel]=n.L_3D_WeatherPicker_Collapse_Button_Aria_Label,l[e.TimeSliderTitle]=n.L_3D_TimeSlider_Title,l[e.TimeSliderButtonTitle]=n.L_3D_TimeSlider_Aria_Label,l[e.TimeSliderArialabel]=n.L_3D_TimeSlider_Aria_Label,l[e.TimeSliderCollapseTitle]=n.L_3D_TimeSlider_Collapse_Button_Title,l[e.TimeSliderCollapseArialLabel]=n.L_3D_TimeSlider_Collapse_Button_Aria_label,l[e.FlyoverButtonText]=n.L_3DLandmark_Flyover_Render,l[e.FlyoverButtonAriaLabel]=n.L_3DLandmark_Flyover_Render,l[e.FlyoverReturnButtonTitle]=n.L_3D_Flyover_Exit_Button_Title,l[e.PlayButtonTitleText]=n.L_3D_Flyover_Play_Button_Title,l[e.PauseButtonTitleText]=n.L_3D_Flyover_Pause_Button_Title,l[e.SpeedSliderTitleText]=n.L_3D_Speed_Slider_Title,l[e.PlaybackSliderAriaLabel]=n.L_3D_Playback_Slider_Aria_Label,l[e.HideButtonTitle]=n.L_3D_Hide_Button_Title,l[e.ShowButtonTitle]=n.L_3D_Show_Button_Title,l[e.HideShowButtonAriaLabel]=n.L_3D_HideShow_Button_Aria_Label,l[e.ImmersiveViewReturnButtonText]=n.L_3D_Immersive_View_Exit_Button_Title,l[e.OutdoorButtonText]=n.L_3D_Outdoor_Button_Text,l[e.OutdoorButtonTitle]=n.L_3D_Outdoor_Button_Title,l[e.CardResetViewAriaLabel]=n.L_3D_Card_Reset_View_Aria_Label,l[e.CardCloseButtonTitle]=n.L_3DLandmark_Share_Panel_Close,l[e.CardCloseButtonAriaLabel]=n.L_3DLandmark_Share_Panel_Close,l[e.CardCollapseButtonTitle]=n.L_3D_Card_Collapse_Button_Title,l[e.CardCollapseButtonAriaLabel]=n.L_3D_Card_Collapse_Button_Title,l[e.CardExpandButtonTitle]=n.L_3D_Card_Expand_Button_Title,l[e.CardExpandButtonAriaLabel]=n.L_3D_Card_Expand_Button_Title,l[e.CardSeeMoreText]=n.L_3D_Card_See_More_Text,l[e.CardPhoneAriaLabel]=n.L_3D_Card_Phone_Aria_Label,l[e.CardReviewCountText]=n.L_3D_Card_Review_Count_Text,l[e.CardDataFromText]=n.L_3D_Card_Data_From_Text,l[e.NearbySightsAriaLabel]=n.L_3D_NearbySights_Aria_Label,l[e.LoadingText]=n.L_3D_Loading_Text,l),a.isFocusTrapEnabled&&u.focus(),this.map3DControl=new map3DBundle.Map3DControl(u,v,this.logger,new map3DBundle.DefaultSharingUrlGenerator(nt),w),this.map3DControl.onFeedbackClickObservable.add(function(){y.onFeedbackBtnClick.invoke()}));this.map3DControl.onSceneCompletedObservable.addOnce(function(){sj_evt.fire("map3DSceneCompleted")});this.map3DControl.onCloseButtonClickObservable.add(function(){y.onCloseBtnClick.invoke()});tt=d?map3DBundle_vnext.packageVersion:map3DBundle.packageVersion;this.map3DControl.build().then(function(){y.disposables.length===0}).catch(function(n){y.onCloseBtnClick.invoke();throw n;});a.isFocusTrapEnabled&&(b=this.precedingFocusableDiv=document.createElement("div"),b.ariaHidden="true",b.tabIndex=0,this.container.insertAdjacentElement("beforebegin",b),k=this.followingFocusableDiv=document.createElement("div"),k.ariaHidden="true",k.tabIndex=0,this.container.insertAdjacentElement("afterend",k),document.addEventListener("focus",this.focusTrap,!0))},v.prototype.dispose=function(){var n,i,r;this.config.isFocusTrapEnabled&&document.removeEventListener("focus",this.focusTrap,!0);this.container=undefined;(n=this.precedingFocusableDiv)===null||n===void 0?void 0:n.remove();this.precedingFocusableDiv=undefined;(i=this.followingFocusableDiv)===null||i===void 0?void 0:i.remove();this.followingFocusableDiv=undefined;f._clearDisposables(this.disposables);this.map3DControl&&(r=this.map3DControl,this.map3DControl=undefined,r.dispose())},v}(atlas.control.ControlBase);t.Map3DViewerControl=a}(t||(t={})),function(t){var i;(function(t){function b(n,t,i){var u,f="",e,l;if(n.indexOf("ypid:")===0)u=d.localFilterFormat,f=encodeURIComponent(u.replace("{ypid}",n.substring(5))+" ");else if(n.indexOf("sid:")===0)u=d.entityFilterFormat,d.sendDoNotBlockResultsForSID&&i&&(u+='DoNotBlockResultsForSID:"false" '),f=encodeURIComponent(u.replace("{sid}",n.substring(4))+" ");else if(n.indexOf("eventId:")===0){u='eventId:"{eventId}" eventParentId:"{eventParentId}"';var o=void 0,s=void 0,c=n.indexOf("eventParentId:");c!==-1?(o=n.substring(8,c-1),s=n.substring(c+14)):(o=n.substring(8),s=o);f=encodeURIComponent(u.replace("{eventId}",o).replace("{eventParentId}",s)+" ");!t&&f&&(t=f)}return!t||!f?null:(e=d.infoboxUrlFormat.replace(new RegExp("{query}","gi"),encodeURIComponent(t.trim())).replace("{filter}",f).replace("{tid}",h).replace("{appid}",r.dynamicProperties.appId)+"&cardWidth=280",e.toLowerCase().indexOf("mcig")<0&&(l=r.dynamicProperties.mapsIG,l&&(e+="&MCIG="+l)),r.isOnCorpnet&&r.isOnChina&&r.dynamicProperties.clientIP&&(e+="&clientip="+r.dynamicProperties.clientIP),e)}function o(n,t,r){return new Promise(function(u,f){var o=b(n,t,r),e=y.downloadGeneric(o,"landmarkInfo",function(n){var t=n.replace(/src="\/th\?/g,'src="https://www.bing.com/th?').replace(/src="\/th\/id\//g,'src="https://www.bing.com/th/id/').replace(/url\(\//g,"url(https://www.bing.com/"),r=l.replace("{firstPartyCss}",v.enableInfoboxActions?"":"first-party")+t+a;i&&i.delete(e);u(r)},null,function(){return f()});i.add(e)})}function k(t){var r=function(n,t){for(var u,r=t&&t.toLowerCase().indexOf("tripadvisor")>-1,e=r?"tartg_f sw_st":"sw_st",o=r?"tartg_hf sw_sth":"sw_sth",s=r?"tartg_e sw_ste":"sw_ste",f='<div><div class="me-b_factrow"><span class="csrc sc_rc1" role= "img" aria-label="Star Rating: '+n+' out of 10." >',i=0;i<10;i=i+2)u=s,n>i&&(u=n>i+1?e:o),f+='<span class="'.concat(u,'"><\/span>');return f+"<\/span><\/div><\/div>"},u=function(n){if(n){var t=n.split(":");if(t.length===3){if(parseInt(t[0])>0)return"".concat(parseInt(t[0]),"day");if(parseInt(t[1])>0)return"".concat(parseInt(t[1]),"hr")}}return""},o=function(i){var y=i.Ads,p=t.name,w=y.length,o=y[0],l=o.cpc,a="",v,s;l&&(v=ht.fromString(l).host,s=v&&v.split(".")||[],s.length>1&&(a="".concat(s[s.length-2],".").concat(s[s.length-1])));var b=o.category||"",h=parseInt(o.reviewCount),d=isNaN(h)?"":"(".concat(h<1e3?h.toString():(h/1e3).toFixed(1)+"k",")"),g=o.img?o.img+"&h=121&dpr="+f._getDpr():"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAAAXRSTlMAQObYZgAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=",k=parseFloat(o.bingRating),nt=c.replace("{image}",g).replace("{title}",p||"").replace("{category}",b).replace("{morefacts}",r(k,o.ratingProvider)).replace("{price}",o.price?"from ".concat(o.price):"").replace("{adsUrl}",l||"").replace("{numdeals}",w>1?n.L_LandmarkDealsMore_Text.replace("{0}",""+(w-1)):"").replace("{reviewCount}",d).replace("{couponTitle}",o.title||p||"").replace("{duration}",u(o.duration)).replace("{provider}",a||"").replace("{categoryOpacity}",b?"1":"0").replace("{ratingOpacity}",isNaN(k)?"0":"1").replace("{providerDisplay}",a&&o.price?"block":"none");return e.replace("{content}",nt).replace("{firstPartyCss}","")};return new Promise(function(n,r){var u=t.ypid,f=p.landmarkDealsUrl.replace("{ypid}",u),e=y.downloadJson(f,"landmarkDeals",function(i,u){if(u===t.ypid&&i.Ads){var f=o(i);n(f)}else r()},r,u,null,0);i.add(e)})}function g(n){for(var t,i,r,o,u,l=[],f=[],e=0,a=n.routes;e<a.length;e++)if(t=a[e],i=t===null||t===void 0?void 0:t.names,i&&i.length>0)for(r=0,o=i;r<o.length;r++)u=o[r],u.length>s?f.push(u):l.push(u);var h=l.join(", "),c=f.length?"".concat(f.join("<br>")):"",v=h&&c?"".concat(h,"<br>").concat(c):"".concat(h).concat(c);return'\n                <div class="bm_transitPopup">\n                    <p class="bm_transitPopup_title">'.concat(n.name,'<\/p>\n                    <p class="bm_transitPopup_content">').concat(v,"<\/p>\n                <\/div>\n            ")}function nt(n){if(n.isCoupoi&&p.landmarkDeals)return k(n);var t="ypid:"+n.ypid;return o(t,n.name)}function tt(n,t,i){return o(n,t,i)}function it(n){return e.replace("{content}",w).replace("{htmlContent}",n)}function rt(){for(var n in this.dispatchKeys)y.abortRequest(n);i=new Set}var s=5,h=f._hasBingHeaders()&&_G.IG,c='\n            <div class="infoBoxLink">\n                <div class="bm_layerInfobox" id="infobox-container">\n                    <div class="infoboxBody clientSide coupoiInfobox">\n                        <div class="infoboxHouseImage coupoiImgCtr">\n                            <img class="infoboxBgImg" src="{image}" style="width:auto"/>\n                        <\/div>\n                        <div class="infoboxText coupoiContainer">\n                            <div class="titleLine">{title}<\/div>\n                            <div style="opacity:{ratingOpacity}">\n                                <span class="factsLine coupoiFactLine">{morefacts}<\/span>\n                                <span>{reviewCount}<\/span>\n                            <\/div>\n                            <div class="adContainer">\n                                <span class="adIcon">Ad<\/span>\n                                <span class="adDuration">{duration}<\/span>\n                                <span style="opacity:{categoryOpacity}">\n                                    <span class="adSeperator">.<\/span>\n                                    <span class="adCategory">{category}<\/span>\n                                <\/span>\n                            <\/div>\n                            <div class="coupoiAdLink">\n                                <a style="color:#333" id="adsLink" target="_blank" href="{adsUrl}">{couponTitle}<\/a>\n                            <\/div>\n                            <div style="float:left">\n                                <span class="adProvider">{provider}<\/span>\n                                <span class="adSeperator" style="display:{providerDisplay}">.<\/span>\n                                <span>{price}<\/span>\n                            <\/div>\n                        <\/div>\n                    <\/div>\n                <\/div>\n            <\/div>\n        ',u='<div class="MapsInfoboxContainer rich {firstPartyCss}">',l="\n            ".concat(u,'\n                <div class="infoBoxLink" role="button" tabindex="0">\n        '),a='\n                <\/div>\n                <div class="directionsPopOut" data-tag="directionsPopOut"><\/div>\n                <div class="collectionsPopOut"><\/div>\n            <\/div>\n        ',e="\n            ".concat(u,"\n                {content}\n            <\/div>\n        "),w='\n            <div class="rib_primer">\n                <a class="infoBoxLink" role="button" tabindex="0">\n                    <div class="bm_ib_container">\n                        <div class="bm_ib_title">\n                            <span class="cnm">\n                                {htmlContent}\n                            <\/span>\n                        <\/div>\n                    <\/div>\n                <\/a>\n            <\/div>\n        ',i=new Set;t.createTransitContent=g;t.createLandmarkContent=nt;t.createEntityContent=tt;t.createSimpleContent=it;t.abortContentRequests=rt})(i=t.InfoboxContentCreator||(t.InfoboxContentCreator={}))}(t||(t={})),function(n){var t;(function(n){function t(n,t,i,r){var e=r?"Landmark":"TransitStop",u={feature:"INF",action:n,data:{SRC:"Landmark",TYP:e,LBL:i,ID:t}},f;r&&n==="C"&&(u.data.Q=i);f=o.logger;f.logObject(u)}function i(n,i,u,f){var s,h,o,e,c;t("EX",n,i,u);typeof((s=Microsoft.Maps.Internal)===null||s===void 0?void 0:s.Helper)!="undefined"&&typeof((h=r===null||r===void 0?void 0:r.dynamicProperties)===null||h===void 0?void 0:h.mapsIG)!="undefined"&&typeof Microsoft.Maps.GlobalDataEventHandler!="undefined"&&(o=Microsoft.Maps.Internal.Helper._tryParsingWithDOMParser(f),e=o===null||o===void 0?void 0:o.select("div[data-ig]").get_attr("data-ig"),(e===null||e===void 0?void 0:e.length)>0&&(c={impressionGuid:r.dynamicProperties.mapsIG,logData:{feature:"MPV",action:"C",data:{P:"Page.Maps.Search",CIG:e}}},Microsoft.Maps.GlobalDataEventHandler.invokeHandler("data-instrumentation",c)))}function u(n,i,r){t("C",n,i,r)}n.logOpen=i;n.logClick=u})(t=n.InfoboxInstrumentation||(n.InfoboxInstrumentation={}))}(t||(t={})),function(n){var t=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._keepVisible=!1,r}return l(t,n),t.prototype.setOptions=function(t){var r,i;t.visible&&(i=document.getElementById("transientLens"),((r=i===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.visibility)==="visible")||(this._keepVisible&&(t.visible=!0),n.prototype.setOptions.call(this,t))},t.prototype._onMouseenter=function(){this.preventAutoClose=!0;this.infoboxEnter.invoke();this._keepVisible=!0},t.prototype._onMouseleave=function(){this.preventAutoClose=!1;this.infoboxLeave.invoke();this._keepVisible=!1;n.prototype.setOptions.call(this,{visible:!1,delayTime:150})},t}(rt);n.RichMapsInfobox=t}(t||(t={}));o.Delegates=t}catch(ft){if(o&&o.logger)o.logger.logCriticalError(ft);else throw ft;}}).call(window)