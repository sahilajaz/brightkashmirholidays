(function(){var t={L_ArrowTapAndHoldTooltip:"Did you know you could tap and hold to move faster?",L_CompassButton_Title:"Set initial heading",L_ExitButtonTooltip:"Close",L_OverviewMapSwitchOffTip:"Show location on map",L_OverviewMapSwitchOnTip:"Hide map",L_PhotosynthModeName:"Step inside",L_ReportAProblem_LinkText:"Report a privacy concern with this image",L_ZoomInButton_Title:"Zoom in",L_ZoomOutButton_Title:"Zoom out",L_StreetsideNoCoverageInstructions_Text:"Tap on a highlighted road to enter Streetside."},n=window.$MicrosoftMaps8,i;n.ResourceManager?n.ResourceManager.init("Streetside",t):(i=n.ResourcesObject=n.ResourcesObject||{},i.Streetside=t)})(),function(){try{var i=Microsoft.Maps,n=i.Internal,g=n.__assign,l=n.__extends,nt=n.__spreadArray,s=i.globalConfig,tt=n.coreConfig,t=s.features,it=t.advertising,rt=t.autosuggest,ut=t.calendar,ft=t.collections,et=t.directions,v=t.feedback,ot=t.flyover,st=t.landmarks3D,ht=t.map3D,ct=t.richMapsInfobox,lt=t.labels,at=t.layerManager,vt=t.localGuide,yt=t.localSearch,pt=t.mapDelay,wt=t.optIn,bt=t.print,kt=t.sharing,u=t.streetside,dt=t.birdseye,gt=t.taskBar,ni=t.taskFramework,ti=t.trafficControl,ii=t.traffic,ri=t.trafficExperiences,ui=t.transit,fi=t.travel,ei=t.xsr,oi=atlas.math,si=atlas.data,hi=atlas.layer,ci=atlas.Pixel,li=atlas.data.BoundingBox,f=n.AzureMapEvents,ai=n.AzureMapInteractions,vi=n.Binding,yi=n.BoundsAccumulator,pi=n.Debug,e=n.Gimme,o=n.AtlasHelper,wi=n.EntityHelper,bi=n.Helper,ki=n.LocationRectHelper,di=n.LocalStorageCache,gi=n.LruCache,nr=n.MapMath,tr=n.Network,h=n.JSEvent,ir=n.ObjectWithId,rr=n.Observable,ur=n.ObservableCollection,fr=n.ObservableObject,er=n.Overlay,or=n.PyramidTileSpatialIndex,sr=n.TaskDataHandlerHelper,hr=n.TileSystemHelper,c=n.PerfV2Logger,cr=n.VectorMath,y=n.TimeoutWrapper,lr=i.Anchor,ar=i.BingMapStyle,vr=i.Color,yr=i.globalContainer,pr=n.InstrumentationBase,wr=i.LatLonCrs,br=i.Location,kr=i.LatLonEncoder,dr=n.ObservableObjectChangedArgs,gr=i.Point,nu=i.Rectangle,tu=i.ResourceManager,iu=i.SimpleAreaPrimitive,ru=i.SimpleLinePrimitive,uu=i.SimplePointPrimitive,fu=i.Size,p=n.ReverseGeocoder,r=i.ResourceManager.Streetside;(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("azure-maps-control")):typeof define=="function"&&define.amd?define(["exports","azure-maps-control"],t):(n=n||self,t(n.atlas=n.atlas||{},n.atlas))})(this,function(n,t){"use strict";function s(n,t){function i(){this.constructor=n}bt(n,t);n.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}function u(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})}function f(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e}function bo(){this.__data__=[];this.size=0}function ns(n,t){return n===t||n!==n&&t!==t}function ts(n,t){for(var i=n.length;i--;)if(ei(n[i][0],t))return i;return-1}function us(n){var t=this.__data__,i=kt(t,n),r;return i<0?!1:(r=t.length-1,i==r?t.pop():rs.call(t,i,1),--this.size,!0)}function fs(n){var t=this.__data__,i=kt(t,n);return i<0?undefined:t[i][1]}function es(n){return kt(this.__data__,n)>-1}function os(n,t){var i=this.__data__,r=kt(i,n);return r<0?(++this.size,i.push([n,t])):i[r][1]=t,this}function g(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function ss(){this.__data__=new ht;this.size=0}function hs(n){var t=this.__data__,i=t["delete"](n);return this.size=t.size,i}function cs(n){return this.__data__.get(n)}function ls(n){return this.__data__.has(n)}function oi(n,t){return t={exports:{}},n(t,t.exports),t.exports}function ks(n){var r=ws.call(n,lt),u=n[lt],t,i;try{n[lt]=undefined;t=!0}catch(f){}return i=bs.call(n),t&&(r?n[lt]=u:delete n[lt]),i}function th(n){return nh.call(n)}function fh(n){return n==null?n===undefined?uh:rh:dr&&dr in Object(n)?ds(n):ih(n)}function eh(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}function lh(n){if(!at(n))return!1;var t=tt(n);return t==sh||t==hh||t==oh||t==ch}function vh(n){return!!nu&&nu in n}function bh(n){if(n!=null){try{return wh.call(n)}catch(t){}try{return n+""}catch(t){}}return""}function rc(n){if(!at(n)||yh(n))return!1;var t=gr(n)?ic:kh;return t.test(y(n))}function uc(n,t){return n==null?undefined:n[t]}function oc(n,t){var i=iu(n,t);return tu(i)?i:undefined}function cc(){this.__data__=yt?yt(null):{};this.size=0}function lc(n){var t=this.has(n)&&delete this.__data__[n];return this.size-=t?1:0,t}function wc(n){var t=this.__data__,i;return yt?(i=t[n],i===vc?undefined:i):pc.call(t,n)?t[n]:undefined}function gc(n){var t=this.__data__;return yt?t[n]!==undefined:dc.call(t,n)}function nl(n,t){var i=this.__data__;return this.size+=this.has(n)?0:1,i[n]=yt&&t===undefined?fu:t,this}function it(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function tl(){this.size=0;this.__data__={hash:new hi,map:new(vt||ht),string:new hi}}function il(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null}function rl(n,t){var i=n.__data__;return su(t)?i[typeof t=="string"?"string":"hash"]:i.map}function ul(n){var t=pt(this,n)["delete"](n);return this.size-=t?1:0,t}function fl(n){return pt(this,n).get(n)}function el(n){return pt(this,n).has(n)}function ol(n,t){var i=pt(this,n),r=i.size;return i.set(n,t),this.size+=i.size==r?0:1,this}function rt(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function sl(n,t){var i=this.__data__,r;if(i instanceof ht){if(r=i.__data__,!vt||r.length<yu-1)return r.push([n,t]),this.size=++i.size,this;i=this.__data__=new vu(r)}return i.set(n,t),this.size=i.size,this}function ut(n){var t=this.__data__=new ht(n);this.size=t.size}function hl(n,t){for(var i=-1,r=n==null?0:n.length;++i<r;)if(t(n[i],i,n)===!1)break;return n}function al(n,t,i){t=="__proto__"&&bu?bu(n,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[t]=i}function pl(n,t,i){var r=n[t];yl.call(n,t)&&ei(r,i)&&(i!==undefined||t in n)||ku(n,t,i)}function wl(n,t,i,r){var s=!i,e,o,u,f;for(i||(i={}),e=-1,o=t.length;++e<o;)u=t[e],f=r?r(i[u],n[u],u,i,n):undefined,f===undefined&&(f=n[u]),s?ku(i,u,f):ci(i,u,f);return i}function bl(n,t){for(var i=-1,r=Array(n);++i<n;)r[i]=t(i);return r}function kl(n){return n!=null&&typeof n=="object"}function dl(n){return ft(n)&&tt(n)==gu}function ua(){return!1}function sa(n,t){var i=typeof n;return t=t==null?ea:t,!!t&&(i=="number"||i!="symbol"&&oa.test(n))&&n>-1&&n%1==0&&n<t}function ha(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=ff}function ca(n){return ft(n)&&ef(n.length)&&!!r[tt(n)]}function la(n){return function(t){return n(t)}}function wa(n,t){var r=li(n),u=!r&&ia(n),f=!r&&!u&&rf(n),o=!r&&!u&&!f&&va(n),s=r||u||f||o,e=s?du(n.length,String):[],h=e.length;for(var i in n)!(t||pa.call(n,i))||s&&(i=="length"||f&&(i=="offset"||i=="parent")||o&&(i=="buffer"||i=="byteLength"||i=="byteOffset")||uf(i,h))||e.push(i);return e}function ba(n){var t=n&&n.constructor,i=typeof t=="function"&&t.prototype||cf;return n===i}function ka(n,t){return function(i){return n(t(i))}}function iv(n){var i,t;if(!dt(n))return ga(n);i=[];for(t in Object(n))tv.call(n,t)&&t!="constructor"&&i.push(t);return i}function rv(n){return n!=null&&ef(n.length)&&!gr(n)}function uv(n){return yi(n)?vi(n):af(n)}function fv(n,t){return n&&wt(t,gt(t),n)}function ev(n){var t=[],i;if(n!=null)for(i in Object(n))t.push(i);return t}function cv(n){var r,i,t;if(!at(n))return ov(n);r=dt(n);i=[];for(t in n)t=="constructor"&&(r||!hv.call(n,t))||i.push(t);return i}function lv(n){return yi(n)?vi(n,!0):yf(n)}function av(n,t){return n&&wt(t,ni(t),n)}function vv(n,t){var i=-1,r=n.length;for(t||(t=Array(r));++i<r;)t[i]=n[i];return t}function yv(n,t){for(var i=-1,f=n==null?0:n.length,e=0,u=[],r;++i<f;)r=n[i],t(r,i,n)&&(u[e++]=r);return u}function pv(){return[]}function dv(n,t){return wt(n,pi(n),t)}function gv(n,t){for(var i=-1,r=t.length,u=n.length;++i<r;)n[u+i]=t[i];return n}function ry(n,t){return wt(n,re(n),t)}function uy(n,t,i){var r=t(n);return li(n)?r:te(r,i(n))}function fy(n){return wi(n,gt,pi)}function ey(n){return wi(n,ni,re)}function gy(n){var i=n.length,t=new n.constructor(i);return i&&typeof n[0]=="string"&&dy.call(n,"index")&&(t.index=n.index,t.input=n.input),t}function ip(n){var t=new n.constructor(n.byteLength);return new le(t).set(new le(n)),t}function rp(n,t){var i=t?ti(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}function up(n){var t=new n.constructor(n.source,ve.exec(n));return t.lastIndex=n.lastIndex,t}function ep(n){return pe?Object(pe.call(n)):{}}function op(n,t){var i=t?ti(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}function ow(n,t,i){var r=n.constructor;switch(t){case bp:return ti(n);case hp:case cp:return new r(+n);case kp:return ae(n,i);case dp:case gp:case nw:case tw:case iw:case rw:case uw:case fw:case ew:return sp(n,i);case lp:return new r;case ap:case pp:return new r(n);case vp:return fp(n);case yp:return new r;case wp:return we(n)}}function lw(n){return typeof n.constructor=="function"&&!dt(n)?cw(ie(n)):{}}function aw(n){return ft(n)&&nr(n)==de}function bw(n){return ft(n)&&nr(n)==ww}function ii(n,t,r,u,f,e){var o,h=t&nb,c=t&tb,w=t&ib,l,s,a,v,p,y;if(r&&(o=f?r(n,u,f,e):r(n)),o!==undefined)return o;if(!at(n))return n;if(l=li(n),l){if(o=np(n),!h)return bf(n,o)}else{if(s=nr(n),a=s==io||s==rb,rf(n))return wf(n,h);if(s==ro||s==to||a&&!f){if(o=c||a?{}:ke(n),!h)return c?ue(n,pf(o,n)):ne(n,vf(o,n))}else{if(!i[s])return f?n:{};o=sw(n,s,h)}}return(e||(e=new wu),v=e.get(n),v)?v:(e.set(n,o),gw(n)?n.forEach(function(i){o.add(ii(i,t,r,i,n,e))}):pw(n)&&n.forEach(function(i,u){o.set(u,ii(i,t,r,u,n,e))}),p=w?c?oy:fe:c?ni:gt,y=l?undefined:p(n),cl(y||n,function(i,u){y&&(u=i,i=n[u]);ci(o,u,ii(i,t,r,u,n,e))}),o)}function ob(n){return ub(n,fb|eb)}function eo(n,t){var i=lb(t),r=n[0],u=n[1],f=Math.min(Math.max(u+i,-85.5),85.5),e=Math.min(Math.max(u-i,-85.5),85.5),o=oo(r+i),s=oo(r-i);return[s,e,o,f]}function oo(n){return n>180?(n+180)%360-180:n<-180?(n-180)%360+180:n}function lb(n){var t=n/hb,i=Math.PI/10800*t;return i*fo}function ri(n){return n*fo}function so(n){return n*cb}function db(n,t){var i=ur(t),r=n[0],u=n[1],f=Math.min(Math.max(u+i,-85.5),85.5),e=Math.min(Math.max(u-i,-85.5),85.5),o=rr(r+i),s=rr(r-i);return[s,e,o,f]}function rr(n){return n>180?(n+180)%360-180:n<-180?(n-180)%360+180:n}function ur(n){var t=n/bb,i=Math.PI/10800*t;return i*co}function ot(n){while(n<0)n+=ui;while(n>=ui)n-=ui;return n}function b(n){return(360+n)%360}function fr(n){return n*co}function lo(n){return n*kb}function fi(n,t,i,r){var f=i||180,e=r||360,u=Math.abs(n-t);return u>f&&(u=Math.abs(Math.min(n,t)+e-Math.max(n,t))),u}function er(n,t){return fi(n,t,Math.PI,ui)}function ao(n,t){var i=Math.sin(n)*t,r=Math.cos(n)*t;return new h(i,r)}function vo(n,t,i){var u=i[0]-t[0],f=i[1]-t[1],s=u*u+f*f,r=((n[0]-t[0])*u+(n[1]-t[1])*f)/s;r>1?r=1:r<0&&(r=0);var h=t[0]+r*u,c=t[1]+r*f,e=h-n[0],o=c-n[1];return Math.sqrt(e*e+o*o)}function k(n,t,i){if(t&&n)for(var r=0;r<t.length;r++)n.addEventListener(t[r],i)}function d(n,t,i){if(t&&n)for(var r=0;r<t.length;r++)n.removeEventListener(t[r],i)}var e="default"in t?t["default"]:t,bt,st,or,sr,ei,hr,cr,lr,ar,ht,vr,yr,pr,wr,ct,tt,tu,iu,ru,uu,fu,eu,hi,ou,su,pt,hu,cu,lu,au,vu,yu,pu,wu,ci,wt,du,ft,gu,uf,ff,sf,vi,cf,dt,af,yi,gt,vf,yf,ni,pf,wf,bf,kf,ne,ue,wi,fe,ti,ae,ve,we,ke,de;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.
    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.
    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
bt=function(n,t){return bt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},bt(n,t)};st=function(){return st=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},st.apply(this,arguments)};or=function(){function n(){}return n.merge=function(n,t){for(var u,i=window||global,e=n.split("."),r=0,f=e;r<f.length;r++)if(u=f[r],i[u])i=i[u];else return t;return st(st({},i),t)},n}();sr=bo;ei=ns;var kt=ts,is=Array.prototype,rs=is.splice;hr=us;cr=fs;lr=es;ar=os;g.prototype.clear=sr;g.prototype["delete"]=hr;g.prototype.get=cr;g.prototype.has=lr;g.prototype.set=ar;ht=g;vr=ss;yr=hs;pr=cs;wr=ls;ct=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};var as=typeof ct=="object"&&ct&&ct.Object===Object&&ct,br=as,vs=typeof self=="object"&&self&&self.Object===Object&&self,ys=br||vs||Function("return this")(),l=ys,ps=l.Symbol,nt=ps,kr=Object.prototype,ws=kr.hasOwnProperty,bs=kr.toString,lt=nt?nt.toStringTag:undefined;var ds=ks,gs=Object.prototype,nh=gs.toString;var ih=th,rh="[object Null]",uh="[object Undefined]",dr=nt?nt.toStringTag:undefined;tt=fh;var at=eh,oh="[object AsyncFunction]",sh="[object Function]",hh="[object GeneratorFunction]",ch="[object Proxy]";var gr=lh,ah=l["__core-js_shared__"],si=ah,nu=function(){var n=/[^.]+$/.exec(si&&si.keys&&si.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();var yh=vh,ph=Function.prototype,wh=ph.toString;var y=bh,kh=/^\[object .+?Constructor\]$/,dh=Function.prototype,gh=Object.prototype,nc=dh.toString,tc=gh.hasOwnProperty,ic=RegExp("^"+nc.call(tc).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");tu=rc;iu=uc;var p=oc,sc=p(l,"Map"),vt=sc,hc=p(Object,"create"),yt=hc;ru=cc;var ac=lc,vc="__lodash_hash_undefined__",yc=Object.prototype,pc=yc.hasOwnProperty;var bc=wc,kc=Object.prototype,dc=kc.hasOwnProperty;uu=gc;fu="__lodash_hash_undefined__";eu=nl;it.prototype.clear=ru;it.prototype["delete"]=ac;it.prototype.get=bc;it.prototype.has=uu;it.prototype.set=eu;hi=it;ou=tl;su=il;pt=rl;hu=ul;cu=fl;lu=el;au=ol;rt.prototype.clear=ou;rt.prototype["delete"]=hu;rt.prototype.get=cu;rt.prototype.has=lu;rt.prototype.set=au;vu=rt;yu=200;pu=sl;ut.prototype.clear=vr;ut.prototype["delete"]=yr;ut.prototype.get=pr;ut.prototype.has=wr;ut.prototype.set=pu;wu=ut;var cl=hl,ll=function(){try{var n=p(Object,"defineProperty");return n({},"",{}),n}catch(t){}}(),bu=ll;var ku=al,vl=Object.prototype,yl=vl.hasOwnProperty;ci=pl;wt=wl;du=bl;ft=kl;gu="[object Arguments]";var nf=dl,tf=Object.prototype,gl=tf.hasOwnProperty,na=tf.propertyIsEnumerable,ta=nf(function(){return arguments}())?nf:function(n){return ft(n)&&gl.call(n,"callee")&&!na.call(n,"callee")},ia=ta,ra=Array.isArray,li=ra;var fa=ua,rf=oi(function(n,t){var i=t&&!t.nodeType&&t,r=i&&!0&&n&&!n.nodeType&&n,f=r&&r.exports===i,u=f?l.Buffer:undefined,e=u?u.isBuffer:undefined,o=e||fa;n.exports=o}),ea=9007199254740991,oa=/^(?:0|[1-9]\d*)$/;uf=sa;ff=9007199254740991;var ef=ha,r={};r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0;r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1;sf=ca;var ai=la,et=oi(function(n,t){var u=t&&!t.nodeType&&t,i=u&&!0&&n&&!n.nodeType&&n,f=i&&i.exports===u,r=f&&br.process,e=function(){try{var n=i&&i.require&&i.require("util").types;return n?n:r&&r.binding&&r.binding("util")}catch(t){}}();n.exports=e}),hf=et&&et.isTypedArray,aa=hf?ai(hf):sf,va=aa,ya=Object.prototype,pa=ya.hasOwnProperty;vi=wa;cf=Object.prototype;dt=ba;var lf=ka,da=lf(Object.keys,Object),ga=da,nv=Object.prototype,tv=nv.hasOwnProperty;af=iv;yi=rv;gt=uv;vf=fv;var ov=ev,sv=Object.prototype,hv=sv.hasOwnProperty;yf=cv;ni=lv;pf=av;wf=oi(function(n,t){function o(n,t){if(t)return n.slice();var i=n.length,r=f?f(i):new n.constructor(i);return n.copy(r),r}var i=t&&!t.nodeType&&t,r=i&&!0&&n&&!n.nodeType&&n,e=r&&r.exports===i,u=e?l.Buffer:undefined,f=u?u.allocUnsafe:undefined;n.exports=o});bf=vv;kf=yv;var df=pv,wv=Object.prototype,bv=wv.propertyIsEnumerable,gf=Object.getOwnPropertySymbols,kv=gf?function(n){return n==null?[]:(n=Object(n),kf(gf(n),function(t){return bv.call(n,t)}))}:df,pi=kv;ne=dv;var te=gv,ny=lf(Object.getPrototypeOf,Object),ie=ny,ty=Object.getOwnPropertySymbols,iy=ty?function(n){for(var t=[];n;)te(t,pi(n)),n=ie(n);return t}:df,re=iy;ue=ry;wi=uy;fe=fy;var oy=ey,sy=p(l,"DataView"),bi=sy,hy=p(l,"Promise"),ki=hy,cy=p(l,"Set"),di=cy,ly=p(l,"WeakMap"),gi=ly,ee="[object Map]",ay="[object Object]",oe="[object Promise]",se="[object Set]",he="[object WeakMap]",ce="[object DataView]",vy=y(bi),yy=y(vt),py=y(ki),wy=y(di),by=y(gi),w=tt;(bi&&w(new bi(new ArrayBuffer(1)))!=ce||vt&&w(new vt)!=ee||ki&&w(ki.resolve())!=oe||di&&w(new di)!=se||gi&&w(new gi)!=he)&&(w=function(n){var t=tt(n),i=t==ay?n.constructor:undefined,r=i?y(i):"";if(r)switch(r){case vy:return ce;case yy:return ee;case py:return oe;case wy:return se;case by:return he}return t});var nr=w,ky=Object.prototype,dy=ky.hasOwnProperty;var np=gy,tp=l.Uint8Array,le=tp;ti=ip;ae=rp;ve=/\w*$/;var fp=up,ye=nt?nt.prototype:undefined,pe=ye?ye.valueOf:undefined;we=ep;var sp=op,hp="[object Boolean]",cp="[object Date]",lp="[object Map]",ap="[object Number]",vp="[object RegExp]",yp="[object Set]",pp="[object String]",wp="[object Symbol]",bp="[object ArrayBuffer]",kp="[object DataView]",dp="[object Float32Array]",gp="[object Float64Array]",nw="[object Int8Array]",tw="[object Int16Array]",iw="[object Int32Array]",rw="[object Uint8Array]",uw="[object Uint8ClampedArray]",fw="[object Uint16Array]",ew="[object Uint32Array]";var sw=ow,be=Object.create,hw=function(){function n(){}return function(t){if(!at(t))return{};if(be)return be(t);n.prototype=t;var i=new n;return n.prototype=undefined,i}}(),cw=hw;ke=lw;de="[object Map]";var vw=aw,ge=et&&et.isMap,yw=ge?ai(ge):vw,pw=yw,ww="[object Set]";var kw=bw,no=et&&et.isSet,dw=no?ai(no):kw,gw=dw,nb=1,tb=2,ib=4,to="[object Arguments]",io="[object Function]",rb="[object GeneratorFunction]",ro="[object Object]",i={};i[to]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object DataView]"]=i["[object Boolean]"]=i["[object Date]"]=i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Map]"]=i["[object Number]"]=i[ro]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object Symbol]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0;i["[object Error]"]=i[io]=i["[object WeakMap]"]=!1;var ub=ii,fb=1,eb=4;var v=ob,tr=function(){function n(){}return n.prototype.merge=function(){for(var f,u,e,i,t,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];for(u=0,e=o;u<e.length;u++)if(i=e[u],i)for(t in i)i.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(i[t]!==undefined&&i[t]!=null?this[t]instanceof n?this[t].merge(i[t]):this[t]=i[t]:(f||(f=new(Object.getPrototypeOf(this).constructor)),this[t]=f[t]));return this},n}(),uo=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.rootElement=undefined,t.disableBubbleNavigation=!1,t.overviewMapMode="expanded",t.bubbleLookupRadius=-1,t.showCurrentAddress=!1,t.showCloseButton=!0,t.showHeadingCompass=!0,t.showProblemReporting=!0,t.showZoomButtons=!0,t.showAttribution=!0,t.visible=!0,t.setFocusOnLoad=!0,t}return s(t,n),t}(tr),ir=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.center=undefined,t.bounds=undefined,t.heading=undefined,t.pitch=undefined,t.bubbleId=undefined,t}return s(t,n),t}(tr),a=function(n){function t(t,i,r){var f,e=n.call(this)||this,u=e;return u.disposables=[],u._rootElement=document.createElement("div"),t&&u._rootElement.setAttribute("id",t),i&&(f=u._rootElement.classList).add.apply(f,i),r&&u._rootElement.append(r),e}return s(t,n),t.prototype.getRootElement=function(){return this._rootElement},t.prototype.dispose=function(){var n=this.disposables,t;if(n){for(t=0;t<n.length;t++)n[t]&&n[t].dispose();n.length=0}this._rootElement&&this._rootElement.parentElement&&this._rootElement.parentElement.removeChild(this._rootElement);this._rootElement=null},t}(t.internal.EventEmitter),sb=function(n){function t(t,i,r,u,f){var e=n.call(this,"_$sivOverlay$",["am-siv","sivOverlay"])||this;return e.streetsideCoverageMapUrl=f.streetsideCoverageMapUrl,e._rootElement.style.height=u+"px",t.appendChild(e._rootElement),e.addOverviewControl(i,r),e}return s(t,n),t.prototype.addOverviewControl=function(n,t){return u(this,void 0,void 0,function(){var r,i;return f(this,function(){return r=this,i=this.overviewMap=new e.Map(this._rootElement,{center:n.center,zoom:15,minZoom:15,maxZoom:21,dragRotateInteraction:!1}),r._addPoi(),i.setServiceOptions(t),i.events.add("ready",function(){i.layers.add(new e.layer.TileLayer({tileUrl:r.streetsideCoverageMapUrl,subdomains:["0","1","2","3"],tileSize:256,minSourceZoom:16,maxSourceZoom:21}),"ssCoverage");i.events.add("moveend",function(n){n.originalEvent&&r._invokeEvent("moveend",i.getCamera().center)})}),[2]})})},t.prototype.update=function(n,t){this.directionPoi&&(this.directionPoi.style.transform="rotate("+n+"deg)",t&&this.overviewMap.setCamera({center:t}))},t.prototype.setHeight=function(n){this._rootElement.style.height=n+"px";this.overviewMap.resize()},t.prototype.dispose=function(){n.prototype.dispose.call(this);this.overviewMap&&this.overviewMap.dispose();this.overviewMap=null;this.directionPoi=null},t.prototype._addPoi=function(){this._rootElement.insertAdjacentHTML("afterbegin",'<div class="am-siv overviewPoiContainer"><div class="overviewPoi"><\/div><div class="overviewDirPtr"><\/div><\/div>');this.directionPoi=this._rootElement.getElementsByClassName("overviewDirPtr")[0]},t}(a),h=function(){function n(n,t,i){this.x=n;this.y=t;this.z=i}return n.prototype.add=function(t){var i=this;return i.z&&t.z?new n(i.x+t.x,i.y+t.y,i.z+t.z):new n(i.x+t.x,i.y+t.y)},n.prototype.subtract=function(t){var i=this;return i.z&&t.z?new n(i.x-t.x,i.y-t.y,i.z-t.z):new n(i.x-t.x,i.y-t.y)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.equals=function(t,i){return n.pointsEqual(this,t,i)},n.pointsEqual=function(n,t,i){return n&&t?i>0?Math.abs(n.x-t.x)<=i&&Math.abs(n.y-t.y)<=i:n.x===t.x&&n.y===t.y&&n.z===t.z:!1},n.prototype.toString=function(){var n=this;return typeof n.z=="undefined"?"[Point ("+n.x+", "+n.y+")]":"[Point ("+n.x+", "+n.y+", "+n.z+")]"},n.prototype.scalarMultiply=function(t){return new n(this.x*t,this.y*t,this.z?this.z*t:null)},n.prototype.invert=function(){return new n(-this.x,-this.y,this.z?-this.z:null)},n}(),hb=1852,fo=180/Math.PI,cb=Math.PI/180;var ab=function(){function n(n){this._capacity=n;this._count=0;this._dictionary={}}return n.prototype.addItem=function(n,t,i){if(t){var r=this._dictionary[n];r?(this._dictionary[n].item=t,this._moveNodeToHead(r)):this._addNewItem(n,t,i)}},n.prototype.getItem=function(n){var t,i=this._dictionary[n];return i?(t=i.item,this._moveNodeToHead(i)):t=null,t},n.prototype.clear=function(){while(this._count>0)this._deleteTailNode()},n.prototype._addNewItem=function(n,t,i){var r=this,u;r._count===r._capacity&&(i?r._capacity++:r._deleteTailNode());u={key:n,item:t};r._count===0?r._headNode=r._tailNode=u:(u.next=r._headNode,r._headNode.previous=u,r._headNode=u);r._dictionary[n]=u;r._count++},n.prototype._removeNode=function(n){if(this._count===1){this._headNode=null;this._tailNode=null;return}var t=n.previous,i=n.next;t?t.next=i:this._headNode=i;i?i.previous=t:this._tailNode=t},n.prototype._moveNodeToHead=function(n){var t=this;n!==t._headNode&&(t._removeNode(n),t._headNode&&(t._headNode.previous=n),n.previous=null,n.next=t._headNode,t._headNode=n)},n.prototype._deleteTailNode=function(){var t=this,i,n,r,f,u;if(t._tailNode&&(i=t._tailNode,t._removeNode(i),delete t._dictionary[i.key],t._count--,n=i.item,n&&n.dispose&&n.dispose(),Array.isArray(n))){for(r=0,f=n.length;r<f;r++)u=n[r],u&&u.dispose&&u.dispose();n.length=0}},n}(),vb=function(){function n(){this._cache=new ab(1e3)}return n.prototype.hasItem=function(n){var t=this.getStringId(n),i=this._cache.getItem(t);return i!==null},n.prototype.getItem=function(n){var t=this.getStringId(n);return this._cache.getItem(t)},n.prototype.putItem=function(n,t){var i=this,f,r,u,s,o,h;if(typeof n=="number")r=t;else if(n instanceof e.data.BoundingBox)for(r=t,u=0,s=t.length;u<s;u++)o=t[u],i._cache.addItem(i.getStringId(o.id),o);else r=t;return f=i.getStringId(n),h=i.hasItem(f),i._cache.addItem(f,r),h},n.prototype.getStringId=function(n){return n instanceof String?n:n.toString()},n}(),ho=function(){function n(){this._cache=new yb;this.EarthRadius=e.math.getEarthRadius()}return n.prototype.hasItem=function(t,i){if(i===void 0&&(i=[0,0]),n.IsByLocationRequest(t)){var r=this._cache.getBoundingBox();return r&&e.data.BoundingBox.containsPosition(r,i)}return this._cache.getId()===t.toString()},n.prototype.getItem=function(t,i){var r,f,u,l;if(i===void 0&&(i=[0,0]),r=this,n.IsByLocationRequest(t)){if(f=r._cache.getBoundingBox(),!f||!e.data.BoundingBox.containsPosition(f,i))return[];var s=void 0,a=[i[0],i[1]],v=r._cache.getCachedBubbles(),h=r._cache.getPrecomputedMapLocations(),c=Number.MAX_VALUE,o=void 0;for(u=0,l=h.length;u<l;u++)o=e.math.getDistanceTo(h[u],a),o<c&&(c=o,s=v[u]);return[s]}return r._cache.getId()===t.toString()?r._cache.getCachedBubbles():null},n.prototype.putItem=function(n,t){var i=this._cache.getId();return this._cache.setNewCache(n,t),i===this._cache.getId()},n.IsByLocationRequest=function(n){return e.data.BoundingBox.getWidth(n)===0&&e.data.BoundingBox.getHeight(n)===0},n}(),yb=function(){function n(){this._precomputedLocations=[]}return n.prototype.getBoundingBox=function(){return this._actualRect},n.prototype.setNewCache=function(n,t){var i,o,f,r,u;if(!ho.IsByLocationRequest(n)){for(i=this,i._bubbles=t,o=t.length,i._precomputedLocations.length=o,f=[],r=0;r<o;r++)u=t[r],i._precomputedLocations[r]=[u.lo,u.la,],f.push([u.lo,u.la]);i._actualRect=f.length>0?e.data.BoundingBox.fromPositions(f):n;i._id=n.toString()}},n.prototype.getId=function(){return this._id},n.prototype.getPrecomputedMapLocations=function(){return this._precomputedLocations},n.prototype.getCachedBubbles=function(){return this._bubbles},n}(),pb=function(){function n(n){this._streetsideBubbleUrl=n.streetsideBubbleUrl;this._streetsideBubbleByIdUrl=n.streetsideBubbleByIdUrl}return n.prototype.getBubbleById=function(n){return u(this,void 0,void 0,function(){var i,t;return f(this,function(r){switch(r.label){case 0:return i=this._streetsideBubbleByIdUrl.replace("{bubbleId}",n.toString()),[4,this._makeNetworkCall(i)];case 1:return(t=r.sent(),t&&t.length>0)?[2,t[0]]:[2,null]}})})},n.prototype.getBubbles=function(n,t,i){return u(this,void 0,void 0,function(){var t;return f(this,function(r){switch(r.label){case 0:return t=this._streetsideBubbleUrl.replace("{count}",Math.max(50,i).toString()).replace("{north}",e.data.BoundingBox.getNorth(n).toString()).replace("{south}",e.data.BoundingBox.getSouth(n).toString()).replace("{east}",e.data.BoundingBox.getEast(n).toString()).replace("{west}",e.data.BoundingBox.getWest(n).toString()),[4,this._makeNetworkCall(t)];case 1:return[2,r.sent()]}})})},n.prototype._makeNetworkCall=function(n){return u(this,void 0,void 0,function(){var t,i;return f(this,function(r){switch(r.label){case 0:return t=null,[4,fetch(n)];case 1:return(i=r.sent(),!i.ok)?[3,3]:[4,i.json()];case 2:if(t=r.sent(),t)return t.length>=1&&t.splice(0,1),[2,t];r.label=3;case 3:return[2,null]}})})},n}(),wb=function(){function n(n){this._bubbleSource=new pb(n);this._cachingStrategyById=new vb;this._cachingStrategyByBB=new ho}return n.prototype.hasCachedBubble=function(n){return this._cachingStrategyById.hasItem(n)},n.prototype.getBubbleById=function(n){return u(this,void 0,void 0,function(){var t,i;return f(this,function(r){switch(r.label){case 0:return!this._cachingStrategyById.hasItem(n)?[4,this._bubbleSource.getBubbleById(n)]:[3,2];case 1:t=r.sent();t&&this._cachingStrategyById.putItem(n,t);r.label=2;case 2:return i=this._cachingStrategyById.getItem(n),[2,Promise.resolve(i)]}})})},n.prototype.getBubbles=function(n,t,i){return u(this,void 0,void 0,function(){var r,u,e,o;return f(this,function(f){switch(f.label){case 0:return(r=this,!!r._cachingStrategyByBB.hasItem(n,t))?[3,2]:[4,r._bubbleSource.getBubbles(n,undefined,i)];case 1:if(u=f.sent(),u)for(r._cachingStrategyByBB.putItem(n,u),e=0;e<u.length;e++)r._cachingStrategyById.putItem(u[e].id,u[e]);f.label=2;case 2:return o=r._cachingStrategyByBB.getItem(n,t),[2,Promise.resolve(o)]}})})},n}(),bb=1852,ui=2*Math.PI,co=180/Math.PI,kb=Math.PI/180;var yo=Object.freeze({__proto__:null,getBoundingBoxFromCenter:db,normalizeLongitude:rr,metersToDegrees:ur,normalizeRadian:ot,normalizeDegrees:b,radiansToDegrees:fr,degreesToRadians:lo,getAngleDifference:fi,getAngleDifferenceInRadians:er,getPointFromAngleAndRadius:ao,getDistanceFromPointToVector:vo}),gb=function(){function n(n,t){this.minPoint=n;this.maxPoint=t}return n.prototype.isEmpty=function(){return!this.minPoint||!this.maxPoint},n.prototype.pointInRect=function(n){var t=this;return!t.isEmpty()&&n.x>=t.minPoint.x&&n.x<=t.maxPoint.x&&n.y>=t.minPoint.y&&n.y<=t.maxPoint.y},n}(),nk=function(n){function t(t,i,r,u,f,e,o){var l=n.call(this,0,0,0)||this,s,c;return l.clickRegionAdjustment=50,s=l,s._streetName=e,s._threeDPosition=new h(t,i,0),s._radiansOfRotation=u,s._initialRadiansOfRotation=u,s._previousRadiansYWasRotated=0,s._canvasCameraProperties=r,s._color="#EBEBEB",s._lineWidth=1,s._arrowPoints=[],c=s._arrowPoints,c.push(new h(0,0)),c.push(new h(15,12.5)),c.push(new h(15,0)),c.push(new h(0,-15)),c.push(new h(-15,0)),c.push(new h(-15,12.5)),s._rotateAroundXAxis(f),s._nextBubbleId=o,l}return s(t,n),t.prototype.getNextBubbleId=function(){return this._nextBubbleId},t.prototype.getInitialRadiansOfRotation=function(){return this._initialRadiansOfRotation},t.prototype.rotateAroundYAxis=function(n){var t=this,i=t._previousRadiansYWasRotated-n;t._previousRadiansYWasRotated=n;var r=Math.cos(i),u=Math.sin(i),f=t._threeDPosition.x*r-t._threeDPosition.z*u,e=t._threeDPosition.z*r+t._threeDPosition.x*u;t._threeDPosition.x=f;t._threeDPosition.z=e;t._threeDPosition.y=150;t._radiansOfRotation-=i;t._setScale();t._setPositionAdjustedForScale()},t.prototype._rotateAroundXAxis=function(n){var t=this,i=Math.cos(n),r=Math.sin(n),u=t._threeDPosition.y*i-t._threeDPosition.z*r,f=t._threeDPosition.z*i+t._threeDPosition.y*r;t._threeDPosition.y=u;t._threeDPosition.z=f;t._setScale();t._setPositionAdjustedForScale()},t.prototype.draw=function(n){var t=this;n.save();n.translate(t.x,t.y);n.rotate(t._radiansOfRotation);n.scale(t._scaleX,t._scaleY);n.lineWidth=t._lineWidth;n.fillStyle=t._color;n.strokeStyle=t._color;t._drawStreetName(n);t._drawArrow(n);n.restore()},t.prototype._drawStreetName=function(n){var f;n.save();f=this._getTextRotationAngle();n.rotate(f);n.font="300 14.66px Arial";n.textAlign="right";n.shadowColor="#000000";n.shadowBlur=1;var r=-20,u=0,t=ot(this._radiansOfRotation),i=5*Math.PI;t<=i||t>=Math.PI*2-i?(n.textAlign="center",r=0,u=-30):t>i&&t<Math.PI-i?(n.textAlign="left",r=20):t>=Math.PI-i&&t<=Math.PI+i&&(n.textAlign="center",r=0,u=30);n.textBaseline="middle";n.fillText(this._streetName,r,u);n.shadowBlur=0;n.restore()},t.prototype._getTextRotationAngle=function(){var t=0,n=this;return t=n._initialRadiansOfRotation==Math.PI||n._initialRadiansOfRotation==0?n._initialRadiansOfRotation-n._previousRadiansYWasRotated:Math.PI-n._initialRadiansOfRotation-n._previousRadiansYWasRotated,n._initialRadiansOfRotation>0&&n._initialRadiansOfRotation!=Math.PI&&(t+=Math.PI),t},t.prototype._drawArrow=function(n){var t=this,i,u,r;for(n.beginPath(),n.moveTo(t._arrowPoints[0].x,t._arrowPoints[0].y),i=1,u=t._arrowPoints.length;i<u;i++)r=t._arrowPoints[i],n.lineTo(r.x,r.y);n.closePath();n.fill();n.save();n.shadowColor="#000000";n.shadowOffsetY=1.5;n.fill();n.restore();t._lineWidth>0&&n.stroke()},t.prototype._setScale=function(){if(this._canvasCameraProperties){var n=this._canvasCameraProperties.getCameraFocalLength(),t=n/(n+this._threeDPosition.z);this._scaleX=this._scaleY=t}},t.prototype._setPositionAdjustedForScale=function(){var n=this,t;n._canvasCameraProperties&&(t=n._canvasCameraProperties.getVanishingPoint(),n.x=t.x+n._threeDPosition.x*n._scaleX,n.y=t.y+n._threeDPosition.y*n._scaleY)},t.prototype.getBounds=function(){for(var t,n=this,i=1e5,r=-1,u=1e5,f=-1,e=0,l=n._arrowPoints.length;e<l;e++){var o=n._arrowPoints[e],s=n.x+o.x,c=n.y+o.y;i=Math.min(i,s);r=Math.max(r,s);u=Math.min(u,c);f=Math.max(f,c)}return t=n.clickRegionAdjustment,new gb(new h(i-t,u-t),new h(r+t,f+t))},t}(h),tk=function(){function n(n){this._vanishingPoint=n}return n.prototype.getCameraFocalLength=function(){return n._cameraFocalLength},n.prototype.getVanishingPoint=function(){return this._vanishingPoint},n._cameraFocalLength=250,n}();var ik=function(){function n(){this.mercatorPositionZoomLevel=18}return n.prototype.getBubbleStreetName=function(n,t,i){if(this._updateRoadSegments(i),this.currentRoadSegments){var r=this._getSortedRoadSegmentsByDistance(e.math.mercatorPositionsToPixels([t],this.mercatorPositionZoomLevel)[0]);return this._getVectorRoadName(r,n)}return""},n.prototype.dispose=function(){this.currentRoadsGeomtry=null;this.currentRoadSegments=null},n.prototype._getVectorRoadName=function(n,t){for(var r,u,f=[],i=0;i<n.length;i++)r=n[i].heading,u=n[i].distance,(this._areHeadingsSimilar(r,t,15)&&u<80||this._areHeadingsSimilar(r,t,30)&&u<20||this._areHeadingsSimilar(r,t,45)&&u<6)&&f.push(n[i]);return f.length>0?f[0].name:""},n.prototype._getSortedRoadSegmentsByDistance=function(n){for(var t,i=this.currentRoadSegments,r=0;r<i.length;r++)t=i[r],t.distance=vo(n,t.pointA,t.pointB);return i.sort(function(n,t){return n.distance-t.distance})},n.prototype._areHeadingsSimilar=function(n,t,i){var u=Math.abs(n-t),f,r;return u<i||u>360-i?!0:(f=(n+180)%360,r=Math.abs(f-t),r<i||r>360-i)},n.prototype._updateRoadSegments=function(n){var r,c,u,o,s,h,i,a,v;if(n&&n!==this.currentRoadsGeomtry&&(this.currentRoadsGeomtry=n,r=this.currentRoadsGeomtry,c=[],this.currentRoadSegments=c,r))for(u=0;u<r.length;u++){var l=r[u],f=[],t=l.geometry,y=l.properties&&l.properties.name;if(t&&y)if(t.type==="MultiLineString")for(o=0;o<t.coordinates.length;o++)f.push(e.math.mercatorPositionsToPixels(t.coordinates[o],this.mercatorPositionZoomLevel));else t.type==="LineString"&&f.push(e.math.mercatorPositionsToPixels(t.coordinates,this.mercatorPositionZoomLevel));for(s=0;s<f.length;s++)for(h=f[s],i=1;i<h.length;i++)a=h[i-1],v=h[i],c.push({pointA:a,pointB:v,name:y,heading:e.Pixel.getHeading(a,v),distance:0})}},n}(),o=function(){function n(){}return n.ArrowTapAndHoldTooltip="Did you know you could tap and hold to move faster?",n.CompassButton="Set initial heading",n.ExitButtonTooltip="Close",n.OverviewMapSwitchOffTip="Show location on map",n.OverviewMapSwitchOnTip="Hide map",n.ReportAProblem="Report a privacy concern with this image",n.ZoomInButton="Zoom in",n.ZoomOutButton="Zoom out",n}(),rk=function(n){function t(t,i){var u=n.call(this,"",["streetsideNavigation","streetsideNavigationRoot"])||this,r=u;return r.sivControl=t,r.arrows=[],r.disposables.push(r.vectorDataStreetLabelSource=new ik),r.streetsideModeRootElement=t.getRootElement(),r.sharedImmersiveViewer=t.getSivViewer(),r.bubblesSource=t.getBubblesSource(),r.currentBubble=i,r._createRootElement(),r.context=r.navElement.getContext("2d"),r.pointerArgs=null,r.arrowsPlaced=!1,r._setUpEventHandling(),r.update(i),r.timerFunctionHandle=0,r.setWidth(r.streetsideModeRootElement.offsetWidth),u}return s(t,n),t.prototype.setWidth=function(n){var t=this;t.width=n;t.navElement.setAttribute("width",n+"px");t.navElement.setAttribute("height","275px");t.cameraProperties?t.cameraProperties.getVanishingPoint().x=n/2:t.cameraProperties=new tk(new h(n/2,-70));t.arrowsPlaced&&t._onViewChange(t.sharedImmersiveViewer.getView())},t.prototype.update=function(n){return u(this,void 0,void 0,function(){var t;return f(this,function(i){switch(i.label){case 0:return t=this,t.currentBubble=n,t.context.clearRect(0,0,t.width,275),[4,t._checkCacheAndPlaceArrows(n)];case 1:return i.sent(),t.pointerArgs&&t._onPointerDown(t.pointerArgs),t._onViewChange(t.sharedImmersiveViewer.getView()),[2]}})})},t.prototype.updateCurrentRoadShapes=function(n){n&&(this.currentRoadGeomtry=n,this.currentBubble&&this._checkCacheAndPlaceArrows(this.currentBubble))},t.prototype.dispose=function(){var i=this.sharedImmersiveViewer,t=this;t.sivControl=null;t.arrows=[];i.viewChangeEvent.removeEventListener(t.sivViewChangeHandler);i.keyDownEvent.removeEventListener(t.sivKeyDownHandler);i.keyUpEvent.removeEventListener(t.sivKeyUpHandler);i.doubleTappedEvent.removeEventListener(t.sivDoubleTappedHandler);t.timerFunctionHandle>0&&(window.clearInterval(t.timerFunctionHandle),t.timerFunctionHandle=0);d(t.streetsideModeRootElement,["mousedown","touchstart"],t.pointerDownHandler);d(t.streetsideModeRootElement,["mouseup","mouseout","touchend","touchcancel",],t.pointerUpHandler);t.currentRoadGeomtry=t.sivViewChangeHandler=t.sivKeyDownHandler=t.sivKeyUpHandler=t.sivDoubleTappedHandler=t.pointerDownHandler=t.pointerUpHandler=null;n.prototype.dispose.call(this)},t.prototype._createRootElement=function(){var n=document.createElement("canvas"),t;n.setAttribute("id","ssNav");n.setAttribute("data-tag","Streetside.NavigationControl");n.classList.add("streetsideNavigation");t=document.createElement("div");t.classList.add("streetsideText","streetsideArrowTooltip");t.innerText=o.ArrowTapAndHoldTooltip;this._rootElement.append(n);this._rootElement.append(t);this.tooltipElement=t;this.navElement=n},t.prototype._setUpEventHandling=function(){var n=this;n.sivViewChangeHandler=function(t){return n._onViewChange(t)};n.sivKeyDownHandler=function(t){return n._onKeyDown(t)};n.sivKeyUpHandler=function(t){return n._onKeyUp(t)};n.sivDoubleTappedHandler=function(t){return n._onDoubleTapped(t)};n.pointerDownHandler=function(t){return n._onPointerDown(t)};n.pointerUpHandler=function(t){return n._onPointerUp(t)};n.sharedImmersiveViewer.viewChangeEvent.addEventListener(n.sivViewChangeHandler);n.sharedImmersiveViewer.keyDownEvent.addEventListener(n.sivKeyDownHandler);n.sharedImmersiveViewer.keyUpEvent.addEventListener(n.sivKeyUpHandler);n.sharedImmersiveViewer.doubleTappedEvent.addEventListener(n.sivDoubleTappedHandler);k(n.streetsideModeRootElement,["mousedown","touchstart"],n.pointerDownHandler);k(n.streetsideModeRootElement,["mouseup","mouseout","touchend","touchcancel",],n.pointerUpHandler)},t.prototype._checkCacheAndPlaceArrows=function(n){return u(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return!this._doWeHaveNavigationBubblesInCache(n)?[4,this._precacheMoreBubbles()]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,this._placeArrows()];case 3:t.sent();t.label=4;case 4:return[2]}})})},t.prototype._placeArrows=function(){return u(this,void 0,void 0,function(){function o(n,t,i){return t.id===n?i.id:t.id}function s(n){return n.length===2&&!n[0].az&&!n[1].az}var i,n,u,e,r,t,h,c;return f(this,function(f){switch(f.label){case 0:return(i=this,n=i.currentBubble,u=n.ne,e=n.pr,r=n.nbn,t=n.pbn,!(u&&e))?[3,2]:[4,i._placeArrowsFromBubbleInfo(n)];case 1:return f.sent(),[3,19];case 2:return(e&&r&&r.length>0)?[4,i._placeArrowsFromBubbleNavigationInfo(n,n.nbn,e)]:[3,4];case 3:return f.sent(),[3,19];case 4:return(u&&t&&t.length>0)?[4,i._placeArrowsFromBubbleNavigationInfo(n,t,u)]:[3,6];case 5:return f.sent(),[3,19];case 6:return(r&&r.length>0&&t&&t.length>0)?(s(r)&&s(t))?(n.ne=o(n.id,r[0],r[1]),n.pr=o(n.id,t[0],t[1]),[4,i._placeArrowsFromBubbleInfo(n)]):[3,8]:[3,17];case 7:return f.sent(),[3,16];case 8:return s(r)?(h=o(n.id,r[0],r[1]),[4,i._placeArrowsFromBubbleNavigationInfo(n,t,h)]):[3,10];case 9:return f.sent(),[3,16];case 10:return s(t)?(c=o(n.id,t[0],t[1]),[4,i._placeArrowsFromBubbleNavigationInfo(n,r,c)]):[3,12];case 11:return f.sent(),[3,16];case 12:return(r.length>1)?[4,i._placeArrowsFromBubbleNavigationInfo(n,r,null)]:[3,14];case 13:return f.sent(),[3,16];case 14:return(t.length>1)?[4,i._placeArrowsFromBubbleNavigationInfo(n,t,null)]:[3,16];case 15:f.sent();f.label=16;case 16:return[3,19];case 17:return(u||e)?[4,i._placeArrowsFromBubbleInfo(n)]:[3,19];case 18:f.sent();f.label=19;case 19:return i.arrowsPlaced=!0,i._onViewChange(i.sharedImmersiveViewer.getView()),[2]}})})},t.prototype._placeArrowFromAngle=function(n,t,i){var r=lo(n),u=ao(Math.PI-r,100);this._placeArrow(u.x,u.y,r,t,i)},t.prototype._placeArrowsFromBubbleInfo=function(n){return u(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,this._placeArrowsFromBubbleInfoWithNextAndPrevious(n,n.ne,n.pr)];case 1:return t.sent(),[2]}})})},t.prototype._placeArrowsFromBubbleInfoWithNextAndPrevious=function(n,t,i){return u(this,void 0,void 0,function(){var r,u,e,o,a,v,s,y,p,h,w,c,l,k,d;return f(this,function(f){switch(f.label){case 0:return(r=this,u=null,e=null,o=t,!o)?[3,2]:(v=(a=yo).normalizeDegrees,[4,r._getAngleToBubble(n,t)]);case 1:o=v.apply(a,[f.sent()]);f.label=2;case 2:return(u=o,s=i,!s)?[3,4]:(p=(y=yo).normalizeDegrees,[4,r._getAngleToBubble(n,i)]);case 3:s=p.apply(y,[f.sent()]);f.label=4;case 4:return e=s,h=r._areAnglesSimilar(n.he,u),w=r._areAnglesSimilar(n.he,e),c=fi(n.he,u),l=fi(n.he,e),h||w?h?(u=r._areAnglesFacingSameDirection(c)?n.he:n.he+180,e=b(u+180)):(e=r._areAnglesFacingSameDirection(l)?n.he:n.he+180,u=b(e+180)):c<l?(u=n.he,e=b(u+180)):(e=n.he,u=b(e+180)),r.arrows=[],(t||i)&&(k=function(n){t&&r._placeArrowFromAngle(u,n,t);i&&r._placeArrowFromAngle(e,n,i)},d=r.vectorDataStreetLabelSource.getBubbleStreetName(n.he,[n.lo,n.la],r.currentRoadGeomtry),k(d)),[2]}})})},t.prototype._areAnglesFacingSameDirection=function(n){return n<30||n>330},t.prototype._areAnglesFacingOppositeDirection=function(n){return n<210&&n>150},t.prototype._areAnglesSimilar=function(n,t){if(n===null||t===null)return!1;var i=b(n-t),r=this._areAnglesFacingSameDirection(i),u=this._areAnglesFacingOppositeDirection(i);return r||u},t.prototype._getAngleToBubble=function(n,t){return u(this,void 0,void 0,function(){var i,r;return f(this,function(u){switch(u.label){case 0:return[4,this.bubblesSource.getBubbleById(t)];case 1:return(i=u.sent(),!i)?[2,0]:(r=fr(ot(Math.atan2(n.lo-i.lo,n.la-i.la))),[2,r])}})})},t.prototype._placeArrowsFromBubbleNavigationInfo=function(n,t,i){return u(this,void 0,void 0,function(){var r,c,u,e,s,p,l,o,h,a,v,y,w;return f(this,function(f){switch(f.label){case 0:for(r=this,c=!1,u=n.ne,e=n.pr,r.arrows=[],s=0,p=t.length;s<p;s++){if(l=t[s],o=l.id,h=l.az,a=n.id===o,h===undefined||h===null){a||(u===undefined||u===null?u=o:(e===undefined||e===null)&&(e=o));c=!0;continue}(v=a?i:o,v!==null)&&(y=b(h),w=r.vectorDataStreetLabelSource.getBubbleStreetName(y,[n.lo,n.la],this.currentRoadGeomtry),r._placeArrowFromAngle(y,w,v))}return c?[4,r._placeArrowsFromBubbleInfoWithNextAndPrevious(n,u,e)]:[3,2];case 1:f.sent();f.label=2;case 2:return[2,Promise.resolve()]}})})},t.prototype._placeArrow=function(n,t,i,r,u){var f=new nk(n,t,this.cameraProperties,i,-2,r,u);this.arrows.push(f)},t.prototype._drawArrows=function(n){var r,t,i;for(this.context.clearRect(0,0,this.width,275),r=this.arrows.length,t=0;t<r;t++)i=this.arrows[t],i.rotateAroundYAxis((Math.PI+n)%360),i.draw(this.context)},t.prototype._onViewChange=function(n){this.yAngleToRotateInRadians=-ot(n.heading);this._drawArrows(this.yAngleToRotateInRadians)},t.prototype._onKeyDown=function(n){var t=this;n.keyCode===38?(n.handled=!0,t.isBackwardArrowPressed=!0,t.timerFunctionHandle==0&&(t.timerFunctionHandle=window.setInterval(function(n){return t._onWindowNavigationTimeout(n)},100,t))):n.keyCode===40&&(n.handled=!0,t.isForwardArrowPressed=!0,t.timerFunctionHandle==0&&(t.timerFunctionHandle=window.setInterval(function(n){return t._onWindowNavigationTimeout(n)},100,t)))},t.prototype._onKeyUp=function(n){var t=this;n.keyCode===38?(n.handled=!0,t.isBackwardArrowPressed=!1,!t.isForwardArrowPressed&&t.timerFunctionHandle>0&&(window.clearInterval(t.timerFunctionHandle),t.timerFunctionHandle=0)):n.keyCode===40&&(n.handled=!0,t.isForwardArrowPressed=!1,!t.isBackwardArrowPressed&&t.timerFunctionHandle>0&&(window.clearInterval(t.timerFunctionHandle),t.timerFunctionHandle=0))},t.prototype._onWindowNavigationTimeout=function(n){n.isBackwardArrowPressed&&n.isForwardArrowPressed||(n.isBackwardArrowPressed?n._goToClosestArrowsBubble(ot(n.sharedImmersiveViewer.getView().heading)+Math.PI):n.isForwardArrowPressed&&n._goToClosestArrowsBubble(ot(n.sharedImmersiveViewer.getView().heading)))},t.prototype._goToClosestArrowsBubble=function(n){var t=this,r,o,f;if(t.arrows.length!==0){var i=t.arrows[0],u=er(n,i.getInitialRadiansOfRotation()),e=t.arrows[0].getNextBubbleId();if(t.arrows.length!==1||!(u>Math.PI/2)){for(r=1,o=t.arrows.length;r<o;r++)i=t.arrows[r],f=er(n,i.getInitialRadiansOfRotation()),u>f&&(u=f,e=i.getNextBubbleId());t.sivControl.loadBubbleById(e)}}},t.prototype._onDoubleTapped=function(n){this._bubbleIdOfTappedArrow(n)&&(n.handled=!0)},t.prototype._onPointerUp=function(){this.pointerArgs=null},t.prototype._onPointerDown=function(n){var u=this,i,r;this.pointerArgs=n;i=this._bubbleIdOfTappedArrow(n);i&&(t.tooltipDisplayed||(t.tooltipDisplayed=!0,this.tooltipElement.classList.add("streetsideTooltipShow"),r=function(){u.tooltipElement.classList.remove("streetsideTooltipShow")},window.setTimeout(r,1e4)),this.sivControl.loadBubbleById(i))},t.prototype._bubbleIdOfTappedArrow=function(n){var r=this.streetsideModeRootElement.getBoundingClientRect(),u="clientX",f="clientY",v=this.sharedImmersiveViewer.getViewportSize().height-275,e=r.y||0,o=r.x||0,s,c,t,l,i,a;for(n.type==="touchstart"?n=n.targetTouches[0]:typeof n.offsetX!="undefined"&&n.offsetX&&(u="offsetX",f="offsetY",e=0,o=0),s=n[u]-o,c=n[f]-e-v,t=0,l=this.arrows.length;t<l;t++)if(i=this.arrows[t],a=i.getBounds(),a.pointInRect(new h(s,c)))return i.getNextBubbleId();return 0},t.prototype._doWeHaveNavigationBubblesInCache=function(n){return n.ne&&this.bubblesSource.hasCachedBubble(n.ne)===null?!1:n.pr&&this.bubblesSource.hasCachedBubble(n.pr)===null?!1:n.nbn&&n.nbn.length>0&&!this._checkIfWeHaveNextAndPreviousNavigationInfoBubbles(n.nbn)?!1:n.pbn&&n.pbn.length>0&&!this._checkIfWeHaveNextAndPreviousNavigationInfoBubbles(n.pbn)?!1:!0},t.prototype._precacheMoreBubbles=function(){return u(this,void 0,void 0,function(){var n,t;return f(this,function(i){switch(i.label){case 0:return n=this._getBoundingBoxForNextRequest(),[4,this.bubblesSource.getBubbles(n,undefined,50)];case 1:return(t=i.sent(),!t)?[3,3]:[4,this._placeArrows()];case 2:i.sent();this.pointerArgs&&this._onPointerDown(this.pointerArgs);i.label=3;case 3:return[2,Promise.resolve()]}})})},t.prototype._getBoundingBoxForNextRequest=function(){var n=this.currentBubble,i=[n.lo,n.la],t=ur(400);return e.data.BoundingBox.fromDimensions(i,t,t)},t.prototype._checkIfWeHaveNextAndPreviousNavigationInfoBubbles=function(n){for(var r,u=n.length,t=!0,i=0;i<u;i++)r=n[i],t=t&&this.bubblesSource.hasCachedBubble(r.id);return t},t.tooltipDisplayed=!1,t}(a),uk=function(){function n(n,t){this.serviceOptions=n;var i=t.reverseGeocoderUrl;typeof i=="string"?(this.reverseGeocoderUrl=i,this.responseParser=this._getAzureReverseGeocoderAddress):(this.reverseGeocoderUrl=i.url,this.responseParser=i.responseParser)}return n.prototype.getApproximateAddress=function(n){return u(this,void 0,void 0,function(){var t,i,r,u,e;return f(this,function(f){switch(f.label){case 0:this.controller=new AbortController;t=this.controller.signal;f.label=1;case 1:return f.trys.push([1,4,,5]),i=this.reverseGeocoderUrl.replace("{domain}",this.serviceOptions.domain).replace("{subscription-key}",this.serviceOptions.subscriptionKey).replace("{latitude}",n.la).replace("{longitude}",n.lo),[4,fetch(i,{signal:t})];case 2:return r=f.sent(),[4,r.json()];case 3:return u=f.sent(),[2,this.responseParser(u)||this._getDefaultAddress(n)];case 4:return e=f.sent(),e.name==="AbortError"?[2,null]:[2,this._getDefaultAddress(n)];case 5:return[2]}})})},n.prototype.cancelRequest=function(){return u(this,void 0,void 0,function(){return f(this,function(){return this.controller&&this.controller.abort(),this.controller=null,[2]})})},n.prototype.dispose=function(){this.cancelRequest();this.serviceOptions=null},n.prototype._getAzureReverseGeocoderAddress=function(n){return n&&n.addresses&&n.addresses.length>0?n.addresses[0].address.freeformAddress:null},n.prototype._getDefaultAddress=function(n){return n.la+","+n.lo},n}(),fk=function(n){function t(t,i,r){var u=this,f;if(!t)throw new Error("bubbleInfo is invalid.");return f=document.createElement("span"),f.setAttribute("data-tag","Streetside.ApproximateAddress"),f.classList.add("streetsideApproxAddressText"),u=n.call(this,"ssApproxAddress",["streetsideText"],f)||this,u.reverseGeocoder=new uk(i,r),u.approxAddressSpan=f,u.update(t),u}return s(t,n),t.prototype.update=function(n){return u(this,void 0,void 0,function(){var t;return f(this,function(i){switch(i.label){case 0:return this.reverseGeocoder.cancelRequest(),[4,this.reverseGeocoder.getApproximateAddress(n)];case 1:return t=i.sent(),t&&(this.approxAddressSpan.innerText=t),[2]}})})},t.prototype.dispose=function(){this.reverseGeocoder&&this.reverseGeocoder.dispose();this.reverseGeocoder=null;n.prototype.dispose.call(this)},t}(a),ek=function(n){function t(t,i){var u=n.call(this,"ssReportAProblem",["streetsideReportAProblem"])||this,r;if(!t)throw new Error("Bubble info is invalid.");return u.privacyReportForm=i.privacyReportForm,r=document.createElement("a"),r.innerText=o.ReportAProblem,r.setAttribute("data-tag","Streetside.ReportAProblem"),r.classList.add("streetsideText","streetsideReportAProblemText"),r.setAttribute("target","_blank"),r.setAttribute("target-new","tab"),r.addEventListener("touchstart",function(){window.open(u._reportAProblemLink.getAttribute("href"),"_blank")}),u._reportAProblemLink=r,u.update(t),u._rootElement.append(r),u}return s(t,n),t.prototype.update=function(n){var t=n.id;if(t>0)this._reportAProblemLink.setAttribute("href",this.privacyReportForm.replace("{id}",t+""));else throw new Error("Bubble info or bubble id is invalid.");},t}(a),c;(function(n){n[n.expanded=.7]="expanded";n[n.minimized=.9]="minimized";n[n.hidden=1]="hidden"})(c||(c={}));var ok=function(n){function t(t){var r=n.call(this,"ssOverviewMapSwitch",["streetsideModeOverviewMapSwitch"])||this,i,u;return r.totalAnimationDuration=300,i=r,i.options=t,i.currentMode=t.overviewMapMode,i._rootElement.setAttribute("tabindex","0"),i._rootElement.setAttribute("role","button"),u=function(n){(n.type==="click"||n.type==="touchstart"||n.type==="keydown"&&(n.code==="Enter"||n.code==="Space"))&&r._onOverviewMapSwitchClick(n)},k(i._rootElement,["click","touchstart","keydown"],u),i.isUserInitiatedPropertyChange=!1,i.updateOptions(),r}return s(t,n),t.prototype.updateOptions=function(){var n=this,t;n.targetMode=n.options.overviewMapMode;n.currentMode!==n.targetMode?(n.animationStartTime=Date.now(),t=function(){n.currentMode=n.targetMode;n._setFinalState()},n._animateTransition(t,n._getExpectedSizeRatio(n.currentMode),n._getExpectedSizeRatio(n.targetMode))):n._setFinalState()},t.prototype.dispose=function(){this._rootElement&&d(this._rootElement,["click","touchstart"],this.overviewMapSwitchClickHandler);this.options=null;n.prototype.dispose.call(this)},t.prototype._getExpectedSizeRatio=function(n){return n==="expanded"?c.expanded:n==="minimized"?c.minimized:c.hidden},t.prototype._animateTransition=function(n,t,i){var r=this,o=i-t,s=r.totalAnimationDuration,e=(Date.now()-r.animationStartTime)/s,h=e*o,u=t+h,f;u=Math.min(u,r.targetMode==="minimized"?c.minimized:c.hidden);u=Math.max(u,c.expanded);f=e>=1;r._invokeEvent("mapOverviewModeChanging",{ratio:u,completed:f});f?n():window.requestAnimationFrame(function(){r._animateTransition(n,t,i)})},t.prototype._onOverviewMapSwitchClick=function(n){n&&n.preventDefault&&n.preventDefault();var t=this.options;this.isUserInitiatedPropertyChange=!0;t.overviewMapMode==="minimized"?t.overviewMapMode="expanded":t.overviewMapMode==="expanded"&&(t.overviewMapMode="minimized");this.updateOptions()},t.prototype._setFinalState=function(){var u=this.options.overviewMapMode==="expanded",i,r,n;this.isUserInitiatedPropertyChange&&!t.tooltipDisplayed&&(i=document.getElementsByClassName("streetSideToolTip fov"),i&&i.length>0&&i[0].classList.add("streetsideTooltipFadeInOut"),t.tooltipDisplayed=!0);this.isUserInitiatedPropertyChange=!1;r="On";n=this._rootElement;u?(n.classList.add(r),n.setAttribute("data-tag","Streetside.OverviewMap.SwitchOn"),n.setAttribute("title",o.OverviewMapSwitchOnTip)):(n.classList.remove(r),n.setAttribute("data-tag","Streetside.OverviewMap.SwitchOff"),n.setAttribute("title",o.OverviewMapSwitchOffTip));n.setAttribute("aria-expanded",u?"true":"false")},t}(a),sk=function(n){function t(t){var i=n.call(this,"",["streetsideAttribution"])||this;return i._dateRegexp=new RegExp("(\\d{1,2})/(\\d{1,2})/(\\d{4})"),t&&i.update(t),i}return s(t,n),t.prototype.update=function(n){var i=n?n.id:0,t;if(i>0)t=" "+(new Date).getFullYear()+" Microsoft Corporation | "+this._getFormattedBubbleDate(n),this._rootElement.innerText=t;else throw new Error("Bubble info or bubble id is invalid.");},t.prototype._getFormattedBubbleDate=function(n){var u=n.cd,t=this._dateRegexp.exec(u),i="",r;return t!=null&&t[1]!=null&&t[2]!=null&&t[3]&&(r=new Date(parseInt(t[3],10),parseInt(t[1],10)-1,parseInt(t[2],10)),i=r.toLocaleDateString()),i},t}(a),hk=function(n){function t(t){var i=n.call(this,"",["streetsideExit"])||this,r=i._rootElement;return r.setAttribute("data-tag","Streetside.Exit"),r.setAttribute("title",o.ExitButtonTooltip),r.setAttribute("tabindex","0"),r.setAttribute("role","button"),i._sivRoot=t,i._setUpEventHandling(),i}return s(t,n),t.prototype.dispose=function(){this._detachEvents();n.prototype.dispose.call(this)},t.prototype._detachEvents=function(){d(this._rootElement,["click","touchstart"],this._clickHandler);this._rootElement.removeEventListener("keydown",this._keyDownHandler);this._sivRoot.removeEventListener("keydown",this._SIVKeyDownHandler)},t.prototype._setUpEventHandling=function(){var n=this;n._clickHandler=function(t){t&&t.preventDefault&&t.preventDefault();n._exitSIVMode()};n._keyDownHandler=function(t){return n._onKeyDown(t)};n._SIVKeyDownHandler=function(t){return n._onKeyDownSIV(t)};k(n._rootElement,["click","touchstart"],n._clickHandler);n._rootElement.addEventListener("keydown",n._keyDownHandler);n._sivRoot.addEventListener("keydown",n._SIVKeyDownHandler)},t.prototype._exitSIVMode=function(){this._invokeEvent("exit",null)},t.prototype._onKeyDownSIV=function(n){n.keyCode===27&&this._exitSIVMode()},t.prototype._onKeyDown=function(n){n.keyCode===13&&this._exitSIVMode()},t}(a),ck=function(n){function t(t,i){var r=n.call(this,"ssLeftPanel",null,null)||this,u;return r._siv=t,r._streetsideControlOptions=i,u=document.createElement("div"),u.setAttribute("id","ssLeftPanel"),u.classList.add("streetsideToolPanel"),r._rootElement=u,r.updateOptions(),t.viewChangeEvent.addEventListener(function(n){r.updateHeading(n.heading)}),r}return s(t,n),t.prototype.update=function(n){n&&this.updateHeading(n.he)},t.prototype.updateOptions=function(){this._streetsideControlOptions.showHeadingCompass?this._attachHeadingControl():this._detachHeadingControl();this._streetsideControlOptions.showZoomButtons?this._attachZoomControl():this._detachZoomControl()},t.prototype.dispose=function(){n.prototype.dispose.call(this);this._detachZoomControl();this._detachHeadingControl();this._siv=null;this._streetsideControlOptions=null},t.prototype.updateHeading=function(n){this._updateCompass(-n)},t.prototype._attachZoomControl=function(){var i=this,r,u,n,t,f;i._zoomInButton||(r=document.createElement("div"),r.classList.add("zoomControl","streetsideToolPanelButton"),r.setAttribute("data-tag","Streetside.ZoomControl"),i._rootElement.append(r),i._zoomControl=r,u=r,n=document.createElement("div"),n.classList.add("zoomIn","streetsideToolPanelButton"),n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("href","#"),n.setAttribute("title",o.ZoomInButton),n.setAttribute("aria-label",o.ZoomInButton),n.setAttribute("data-tag","Streetside.ZoomIn"),u.append(n),t=document.createElement("div"),t.classList.add("zoomOut","streetsideToolPanelButton"),t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.setAttribute("href","#"),t.setAttribute("title",o.ZoomOutButton),t.setAttribute("aria-label",o.ZoomOutButton),t.setAttribute("data-tag","Streetside.ZoomOut"),u.append(t),f='<div class="NavButton_Icon"><\/div>',n.innerHTML=f,t.innerHTML=f,i._zoomInHandler=function(n){i._handleZoomEvent(n,!0)},k(n,["click","touchstart","keydown"],i._zoomInHandler),i._zoomOutHandler=function(n){i._handleZoomEvent(n,!1)},k(t,["click","touchstart","keydown"],i._zoomOutHandler),i._zoomInButton=n,i._zoomOutButton=t)},t.prototype._handleZoomEvent=function(n,t){n&&n.type==="keydown"&&n.which&&n.which!==13||(n&&n.preventDefault&&n.preventDefault(),t?this._siv.zoomIn(!0):this._siv.zoomOut(!0))},t.prototype._attachHeadingControl=function(){var t=this,n;t._compassButton||(n=document.createElement("div"),n.classList.add("compass","streetsideToolPanelButton"),n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("href","#"),n.setAttribute("title",o.CompassButton),n.setAttribute("aria-label",o.CompassButton),n.setAttribute("data-tag","Streetside.Compass"),t._zoomInButton?t._rootElement.insertBefore(n,t._zoomControl):t._rootElement.append(n),t._compassButton=n,t._compassHandler=function(n){if(!(n instanceof KeyboardEvent)||n.keyCode===13){n&&n.preventDefault&&n.preventDefault();var i=t._siv.getView();t._siv.setView(i.pitch,0,i.verticalFov,!0)}},k(n,["click","touchstart","keydown"],t._compassHandler))},t.prototype._detachZoomControl=function(){var n=this,t=n._zoomInButton,i=n._zoomOutButton;t&&(d(t,["click","touchstart"],n._zoomInHandler),t.parentElement.removeChild(t),n._zoomInButton=null,d(i,["click","touchstart"],n._zoomOutHandler),i.parentElement.removeChild(i),n._zoomOutButton=null,n._zoomControl.parentElement.removeChild(n._zoomControl),n._zoomControl=null)},t.prototype._detachHeadingControl=function(){var n=this._compassButton;n&&(d(n,["click","touchstart","keydown"],this._compassHandler),n.parentElement.removeChild(n),this._compassButton=null)},t.prototype._updateCompass=function(n){if(this._compassButton){var t=fr(n);this._compassButton.style.transform="rotate("+t+"deg)"}},t}(a),lk=function(n){function t(t,i,r,u,f){var e=n.call(this,"ssControlsOverlay",["streetsideModeControlsOverlay"])||this;return e._rootElement.setAttribute("data-tag","Streetside.ControlsOverlay"),e.serviceEndpoints=f,e.sivControl=t,e.currentBubble=r,e.options=i,e.serviceOptions=u,e.updateOptions(),e}return s(t,n),t.prototype.update=function(n){if(n){var t=this;n!==t.currentBubble&&(t.currentBubble=n,t.bubbleNavigationControl&&t.bubbleNavigationControl.update(n),t.addressControl&&t.addressControl.update(n),t.reportAProblemControl&&t.reportAProblemControl.update(n),t.attributionControl&&t.attributionControl.update(n))}},t.prototype.updateHeading=function(n){this.toolPanelControl&&this.toolPanelControl.updateHeading(n)},t.prototype.updateOptions=function(){var n=this,t=n.options;this._setUpCompositeInfoAndExitControl(this.currentBubble);t.showHeadingCompass||t.showZoomButtons?(this._attachToolPanel(),this.toolPanelControl.updateOptions()):this._detachToolPanel();t.disableBubbleNavigation?n._detachNavigationControl():n._attachNavigationControl();t.showProblemReporting!==!1?n._attachReportAProblemControl(n.currentBubble):n._detachReportAProblemControl();n._attachOverviewMapSwitch();n.overviewMapSwitch.updateOptions()},t.prototype.getOverviewMapSwitch=function(){return this.overviewMapSwitch},t.prototype.updateCurrentRoadShapes=function(n){this.bubbleNavigationControl&&this.bubbleNavigationControl.updateCurrentRoadShapes(n)},t.prototype.setWidth=function(n){var t;(t=this.bubbleNavigationControl)===null||t===void 0?void 0:t.setWidth(n)},t.prototype.dispose=function(){var t=this;t._detachToolPanel();t._detachExitControl();t._detachApproximateAddressControl();t._detachAttributionControl();t._detachNavigationControl();t.overviewMapSwitch&&t.overviewMapSwitch.dispose();t.overviewMapSwitch=null;t._detachReportAProblemControl();n.prototype.dispose.call(this)},t.prototype._attachExitControl=function(){var n=this;n.bubbleExitControl||(n.bubbleExitControl=new hk(n.sivControl.getRootElement()),n.bubbleExitControl._addEventListener("exit",function(){n._invokeEvent("exit",null);n.dispose()},!0))},t.prototype._detachExitControl=function(){this.bubbleExitControl&&(this.bubbleExitControl.dispose(),this.bubbleExitControl=null)},t.prototype._attachToolPanel=function(){var n=this;n.toolPanelControl||(n.toolPanelControl=new ck(n.sivControl.getSivViewer(),n.options),n._rootElement.append(n.toolPanelControl.getRootElement()))},t.prototype._detachToolPanel=function(){this.toolPanelControl&&(this.toolPanelControl.dispose(),this.toolPanelControl=null)},t.prototype._attachAttributionControl=function(n){this.attributionControl||(this.attributionControl=new sk(n))},t.prototype._detachAttributionControl=function(){this.attributionControl&&(this.attributionControl.dispose(),this.attributionControl=null)},t.prototype._attachOverviewMapSwitch=function(){var n=this;this.overviewMapSwitch||(this.overviewMapSwitch=new ok(this.options),this._rootElement.append(this.overviewMapSwitch.getRootElement()),this.overviewMapSwitch._addEventListener("mapOverviewModeChanging",function(t){n._invokeEvent("mapOverviewModeChanging",t)},!1));this.overviewMapSwitch.getRootElement().style.display=this.options.overviewMapMode!=="hidden"?"block":"none"},t.prototype._attachNavigationControl=function(){var n=this;n.bubbleNavigationControl||(n.bubbleNavigationControl=new rk(n.sivControl,n.currentBubble),n._rootElement.append(n.bubbleNavigationControl.getRootElement()),n.currentBubble&&n.bubbleNavigationControl.update(n.currentBubble))},t.prototype._detachNavigationControl=function(){this.bubbleNavigationControl&&(this.bubbleNavigationControl.dispose(),this.bubbleNavigationControl=null)},t.prototype._attachAddressControl=function(n){this.addressControl||(this.addressControl=new fk(n,this.serviceOptions,this.serviceEndpoints))},t.prototype._detachApproximateAddressControl=function(){this.addressControl&&(this.addressControl.dispose(),this.addressControl=null)},t.prototype._attachReportAProblemControl=function(n){this.reportAProblemControl||(this.reportAProblemControl=new ek(n,this.serviceEndpoints),this._rootElement.append(this.reportAProblemControl.getRootElement()))},t.prototype._detachReportAProblemControl=function(){this.reportAProblemControl&&(this.reportAProblemControl.dispose(),this.reportAProblemControl=null)},t.prototype._setUpCompositeInfoAndExitControl=function(n){var t=this,o=t.options,i=t.compositeInfoAndExitControlRootElement,r,u,f,e;i&&i.parentElement.removeChild(i);i=document.createElement("div");i.classList.add("streetsideCompositeInfoAndExitControl");t.compositeInfoAndExitControlRootElement=i;r=document.createElement("div");r.classList.add("streetsideCompositeInfoAndExitControl","left");o.showAttribution!==!1?(t._attachAttributionControl(n),u=document.createElement("div"),u.classList.add("streetsideCompositeInfoAndExitControl","left","top"),u.append(t.attributionControl.getRootElement())):t._detachAttributionControl();o.showCurrentAddress!==!1?(t._attachAddressControl(n),f=document.createElement("div"),f.classList.add("streetsideCompositeInfoAndExitControl","left","bottom"),f.append(t.addressControl.getRootElement())):t._detachApproximateAddressControl();o.showCloseButton!==!1?(t._attachExitControl(),e=document.createElement("div"),e.classList.add("streetsideCompositeInfoAndExitControl","right"),e.append(t.bubbleExitControl.getRootElement())):t._detachExitControl();i.append(r);e&&i.append(e);u&&r.append(u);f&&r.append(f);t._rootElement.append(i)},t}(a);(function(){function t(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){this.m11=n;this.m12=t;this.m13=i;this.m14=r;this.m21=u;this.m22=f;this.m23=e;this.m24=o;this.m31=s;this.m32=h;this.m33=c;this.m34=l;this.m41=a;this.m42=v;this.m43=y;this.m44=p}function vt(n,t,i,r,u){this.a=n;this.b=t;this.c=i;this.d=r;this.normal=new e(this.a,this.b,this.c);this.point=u}function l(n,t,i,r){this.w=n;this.x=t;this.y=i;this.z=r}function tu(n,t){this.origin=n;this.direction=t}function h(n,t){this.x=n||0;this.y=t||0}function e(n,t,i){this.x=n;this.y=t;this.z=i}function f(n,t,i,r){this.x=n;this.y=t;this.z=i;this.w=r}function s(n,t){function i(){}i.prototype=t.prototype;n.prototype=new i;n.prototype.constructor=n;n.baseConstructor=t;n.superClass=t.prototype;n.__super=t}function ct(){function t(){return!n||n.length===0}var n=[];this.fire=function(i){if(!t())for(var r=0,u=n.length;r<u;r++)n[r](i)};this.addEventListener=function(t){n=n||[];for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return;n.push(t)};this.removeEventListener=function(i){if(!t())for(var r=0,u=n.length;r<u;r++)n[r]===i&&n.splice(r,1)}}function ut(){this.map={};this._innerArray=[]}function ai(n,t){this.screenArray=n;this.textureArray=t}function rt(n,t,i,r,u,f,e){rt.__super.call(this);this._url=n;this._loadCallback=t;this._loadCallbackInfo=i;this._image=null;this._wrapS=r!==undefined?r:rt.Wrap.CLAMP_TO_EDGE;this._wrapT=u!==undefined?u:rt.Wrap.CLAMP_TO_EDGE;this._minFilter=f!==undefined?f:rt.Filter.LINEAR_MIPMAP_LINEAR;this._magFilter=e!==undefined?e:rt.Filter.LINEAR;this._isReady=!1;this._isDirty=!1}function bt(){bt.__super.call(this);bt._animation=null;bt._animationEndStates=null}function ki(n){this._texture=n;ki.__super.call(this)}function di(){this._rotX=this._rotY=this._rotZ=0;this._translateX=this._translateY=this._translateZ=0;this._scaleX=this._scaleY=this._scaleZ=0;di.__super.call(this)}function ar(n){this._geometry=n.geometry||null;this._material=n.material||null;this._transform=n.transform||null}function v(n,i,r){v.__super.call(this);this._name="BaseRenderer";this._renderables={};this._viewModel=null;this._removedRenderables={};this._layers={};this._window=n;this._rootElement=null;this._viewProjMatrix=t.createIdentity();this._width=i;this._height=r;this._initBackground();this.SortRenderableFucntion=function(n,t){var i=n.id.levelOfDetail,r=t.id.levelOfDetail;return i&&r?i-r:i||r?i?1:-1:0}}function y(){}function or(n,i,r,u,f,e){var h,s,o,l,c;or.__super.call(this,{});h=this;s=document.createElement("canvas");s.width=n;s.height=i;o=s.getContext("2d");o.clearRect(0,0,n,i);o.fillStyle=u||"gray";o.fillRect(0,0,n,i);o.fillStyle="black";o.font="12pt Segoe UI,sans-serif";o.fillText(f,n*.3,i*.3);l=s.toDataURL();c=new rt(l,null,null,null,null,null,null);e&&c.loadImageInDOM();h._material=new ki(c);h._transform=r?r:t.createIdentity()}function c(n){c.__super.call(this,n);if(!st.isValidBrowser())throw"css3d is not supported";this._viewportToScreenTransform=u.createViewportToScreen(this._width,this._height)}function w(n){if(!ht.isValidBrowser())throw new Error("WebGL not supported in this browser.");w.__super.call(this,n);this._contextCache=new Array(this.MAX_CONTEXTS)}function lr(n,t,r){var u,f;return(u=n.createShader(t),n.shaderSource(u,r),n.compileShader(u),!n.getShaderParameter(u,n.COMPILE_STATUS))?(f=n.getShaderInfoLog(u),i.log("Shader compiling error: "+f),n.deleteShader(u),null):u}function nt(n,t,i){nt.__super.call(this,n,t,i);this._expansionInPixels=nt.STD_PIXEL_EXPANSION}function si(){}function b(){}function a(){}function cr(n){s(this,n);var t={};this.Tesselate=function(i,r,u){var s=i.viewElementId.id,e=t[s],o,f;return e||(e={},t[s]=e),f=e[r],f===undefined&&(f=n.prototype.Tesselate.apply(this,[i,r,u,]),o=f.density,o>0&&(e[o]=f)),f};this.GetRawDensity=function(t,i){return n.prototype.GetRawDensity.call(this,t,i)}}function d(){function t(){var t,r;if(g.debugEnabled){t="TRegistry state: ";for(r in n)t+=r+", ";i.log(t+".")}}var n={};this.register=function(r){var u=r.id;return n[u]?(i.log(u+" cannot be registered because it's already registered for a different transition."),!1):(n[u]=r,t(),!0)};this.unregister=function(r){var u=r.id;n[u]||i.log(u+" cannot be unregistered because it's already registered for a different transition.");delete n[u];t()};this.getTransitionItem=function(t){return n[t]}}function pt(n){this.cullWorldAtLod=function(i,r,u,f){var p=n.getViewProjectionTransform(),a=i.getViewElements(r,u),v,s=t.createIdentity(),o={},y=0,h,l;f&&(o._notVisibleArray=[],y=3);for(h in a){var e=a[h],c=e.viewElementId,w=e.textureSource(c.x,c.y,c.levelOfDetail);if(e.priority=y,e.url=w,v!=e.faceTransform&&(s=p.multiply(e.faceTransform),v=e.faceTransform),l=this.genericCullPolygon(e.geometryPolygon,e.texturePolygon,s),!l){f&&o._notVisibleArray.push(e);continue}e.computedGeometry=l;e.mvpMatrix=s;o[h]=e}return o};this.genericCullPolygon=function(n,t,i){var r,e,o=u.applyWorldTransformation(n,i),f=ft.clip(pt.lowerVisibleBoundary,pt.higherVisibleBoundary,o,t);return r=f.polygon,e=f.polygonTexture,e.length=r.length,r.length>2?f:undefined}}function yr(t,i,r){function c(n,r,u,e,o){var y=r||!o||o<0,c,l,a,s,v;if(!y)return!1;c=!1;l=u.map;for(a in l)if((s=l[a],s&&s.viewElementId.levelOfDetail==e)&&!h.isBorderTile(n,s)&&t.getState(s.url)==tt.ready){v=n.getElementRawTesselationDensity(s,i);f[n.getDataSourceName()].tesselationMap[e]=v;c=!0;break}return c}function o(t){var f=t.getMinimumLod(),h=t.getMaximumLod(),e=i.getViewport(),c=e.getHeight(),l=e.getWidth(),o=i.getVerticalFov(),a=c,v,r,s;return l>c&&(o=at.convertVerticalToHorizontalFieldOfView(e.getAspectRatio(),o),a=l),v=u.calculateTexelToPixelRatioAtFov(u._cubeSide,t.getWorldConfiguration().source.tileSize,a,o),r=f+Math.round(n.logBase(1/v,2)),r>h?r=h:r<f&&(r=f),g.debugEnabled&&(s=document.getElementById("LODV"),s&&(s.textContent="LOD: "+r)),r}function s(n,i,r,u){var f=n.getParent(),o;return f&&!t.AllCompleted.get(f.id,!0)&&f.levelOfDetail>i&&(o=r.getViewElementById(f,u),e(o)||t.downloadImage(o.textureSource(f.x,f.y,f.levelOfDetail),0,f.id),f=s(n.getParent(),i,r,u)),f}function e(n){var i=t.getState(n.url);return i==tt.failed||i==tt.timedout}var f={},h=this;window.instrumentPerf&&window.instrumentPerf.ttl&&(o=function(n){return n.getMinimumLod()});this.initDataSource=function(n){f[n.getDataSourceName()]={currentLod:{value:n.getMinimumLod()},tesselationMap:{},lastLod:-1,minLodHoldTime:0}};this.dropDataSource=function(n){delete f[n]};this.UpdateLodAndTesselation=function(n,t,i,r){var a=n.getDataSourceName(),u=f[a],e=u.currentLod.value,v=n.getMinimumLod(),p=e==u.lastLod,s=!p||i,h,l,y;return s&&(h=!1,l=e===v&&!r,u.minLodHoldTime!==0&&(h=Date.now()-u.minLodHoldTime>1500,h&&(l=!1,u.minLodHoldTime=0)),l?(u.currentLod.value=e=v,u.minLodHoldTime===0&&(u.minLodHoldTime=Date.now())):(u.lastLod=e,u.currentLod.value=e=o(n))),y=c(n,s,t,e,this.GetCurrentTesselationDensity(e,a)),s&y};this.getCurrentLod=function(n){var t=f[n].currentLod;return!t,t};this.isAtMinLod=function(n){return this.getCurrentLod(n.dataSourceName).value===n.getMinimumLod()};this.getMinLodHoldTime=function(n){return f[n].minLodHoldTime};this.GetCurrentTesselationDensity=function(n,t){var i=f[t].tesselationMap[n];return i?i:-1};this.EnrichWithParentIViewElements=function(n,u,f){var p=n.getMinimumLod(),k=i.getViewProjectionTransform(),c,h,a,v,y,b;for(c in u){var o=u[c],l=t.AllCompleted.get(c,!0),w=l?l.style.opacity:0;if((!l||w===undefined||w<1||l.animationInProgress)&&o.viewElementId.levelOfDetail>p)if(h=s(o.viewElementId,p,n,f),a=h.id,e(o)&&delete u[c],u[a]===undefined){if(o=n.getViewElementById(h),e(o))continue;if(v=k.multiply(o.faceTransform),o.mvpMatrix=v,y=r.genericCullPolygon(o.geometryPolygon,o.texturePolygon,v),y)o.computedGeometry=y,b=o.textureSource(h.x,h.y,h.levelOfDetail),o.priority=0,o.url=b,u[a]=o;else{u[a]=!1;continue}}else continue}};this.isBorderTile=function(n,t){return t.viewElementWidth!=n.worldConfiguration.source.tileSize||t.viewElementHeight!=n.worldConfiguration.source.tileSize}}function ou(t,f,e,o){function ot(n,t,i){n.animation=t!=null?ht(t,i):st()}function st(){var n=t.getType()==="3D"?r.TYPE.ImmediateFadeIn:r.TYPE.FadeIn;return ht(n)}function ht(n,t){return v&&n!=r.TYPE.ImmediateFadeIn?r.createCSSAnimation(n,t):r.createAnimation(n,t)}function vt(n){if(window.elapsed===undefined&&!o.currentlyDownloading()&&n){window.elapsed=Date.now()-window.instrumentPerf.startTime;document.getElementById("timerSpan").innerText=window.elapsed+" ms.";var t=document.createElement("img");t.src=PingRequest.end}}function yt(){p=e.getViewport();k=p.getWidth();nt=p.getHeight();var i=e.getVerticalFov(),r=Math.abs(it-i);y|=!n.isZero(r);y&&(it=i);t.setViewProjectionMatrix(e.getViewProjectionTransform())}function wt(n,i,r,u){var tt,w,e,s,g,f,b,it,l,a,rt,ut,y,d,c,p;if(w=t.getType()=="2D",tt=w,e=n.dataSourceName,s=h.getCurrentLod(e).value,v&&s>n.getMinimumLod()&&(s-=i),g=u&&h.getMinLodHoldTime(e)===0,f=et.cullWorldAtLod(n,s,v,g),g){for(b=0,it=f._notVisibleArray.length;b<it;++b)l=f._notVisibleArray[b],l!=null&&o.downloadImage(l.url,l.priority,l.viewElementId.id);delete f._notVisibleArray}else r&&h.EnrichWithParentIViewElements(n,f,v);a=[];for(rt in f)a.push(f[rt]);if(ut=a.length,w)for(y={},y[s]=h.GetCurrentTesselationDensity(s,e),d=0;d<ut;d++)c=a[d],p=c.viewElementId.levelOfDetail,y[p]===undefined&&(y[p]=h.GetCurrentTesselationDensity(p,e)),c.computedGeometry=n.covertToScreenSpace(c.computedGeometry.polygon,c.computedGeometry.polygonTexture,k,nt),tt&&bt(n,c,y[p],w);return kt(a,e)}function bt(n,t,i,r){var o=t.computedGeometry,l,f,y,a,p,w;if(i===0)o.intileTesselated=[o],o.density=0;else{var b=h.isBorderTile(n,t)?-1:i,v=n.tesselate(t,b,e),s=v.squares,c=v.texelSquares;for(s.length!=c.length,o.intileTesselated=new Array(s.length),l=0,f=0,y=s.length;f<y;f++)a=u.applyWorldTransformation(s[f],t.mvpMatrix),p=ft.clip(pt.lowerVisibleBoundary,pt.higherVisibleBoundary,a,c[f]),p.polygon.length>2&&(r?(w=n.covertToScreenSpace(a,c[f],k,nt),o.intileTesselated[l]=w):o.intileTesselated[l]=new ai(a,c[f]),l++)}}function kt(n,t){for(var i,e,o,h=[],c=[],l=[],r=s.getVisibleElements(t).map||{},a={},u,v=n.length,f=0;f<v;f++)(i=n[f],u=i.viewElementId,u)&&(e=u.id,r[e]?c.push(i):h.push(i),a[e]=i);for(o in r)a[o]||l.push(r[o]);return{added:h,updated:c,removed:l}}function dt(n){for(var r=n.getDataSourceName(),c=s.getDelta(r).added,i=s.getRenderables(r),l=i.map,a=h.getCurrentLod(r),u,y=n.getInteractionController(),f=0,p=c.length;f<p;++f){var t=c[f],e=t.viewElementId,o={texture:new rt(t.url,null,null,null,null,null,null),polygon:t.texturePolygon.slice()};o.texture.dataSourceWidth=t.viewElementWidth;o.texture.dataSourceHeight=t.viewElementHeight;u=new hi(t.geometryPolygon,[o],e,a);ct(t,u);l[e.id];i.add(e.id,u)}n.isCursorAndLabelEnabled&&(n.isRoadVectorReady&&n.generateLabelRenderables(i,v),n.prepareCursorTextureIfNecessary(i),n.generateCursorRenderableIfNecessary(i),n.updateCursorRenderableTranslation(i,y.getHitTestResultTranslation(),v))}function ct(n,i){switch(t.getType()){case"2D":i.geometryPolygon=n.computedGeometry;break;case"3D":i.transform=n.faceTransform}g.debugEnabled&&(i.isClipped=n.isClipped)}function gt(n){var t,i=s.getDelta(n),u,f,r;if(i.removed&&i.removed.length>0)for(u=i.removed.length,t=0;t<u;++t)o.cancel(i.removed[t].viewElementId.id);if(i.added&&i.added.length>0)for(f=i.added.length,t=0;t<f;++t)r=i.added[t],o.downloadImage(r.url,r.priority,r.viewElementId.id)}function ni(n){for(var r,t,u,f=s.getRenderables(n).getArray(),e=!0,i=0,h=f.length;i<h;i++)if(r=f[i],t=r.texturesWithPolygons[0].texture,!t._image){if(u=o.AllCompleted.get(r.id.id,!0),!u){e=!1;continue}t._image=u;t._isReady=!0;t._isDirty=!0}return e}var s=new eu,it=-1,y=!1,et=new pt(e),l=new ut,h=new yr(o,e,et),p=e.getViewport(),k=p.getWidth(),nt=p.getHeight(),w=new d,lt=48e4,at=1049088,tt=0,v=t instanceof c;for(this.doPerfPingCall=function(){},window.instrumentPerf&&(this.doPerfPingCall=vt),t.setViewModel(s),this.RenderFrame=function(n){var c,f,e,v,k,a,g;for(yt(),c=l.getArray(),f=!1,e=0,v=c.length;e<v;e++){var u=c[e],i=u.getDataSourceName(),p=h.isAtMinLod(u),r=w.getTransitionItem(i),b=r&&r.animation,nt=!r;if((nt||r.transitionType!=d.TRANSITION_TYPE.OUT)&&(k=wt(u,n,!0,p),s.setDelta(i,k),gt(i),dt(u)),s.syncAddedFromDeltaCurrentVisibleElements(i),s.syncUpdatedFromDeltaCurrentVisibleElements(i,ct),o.update(),a=ni(i),t.syncRemovedRenderables(i),s.syncRemovedFromDeltaCurrentVisibleElements(i),!p||a?f|=t.render(i,b,n,st):f=!0,g=h.UpdateLodAndTesselation(u,s.getVisibleElements(i),y,a),g&&(y=!1),r&&b.isComplete(u))switch(r.transitionType){case d.TRANSITION_TYPE.OUT:l.remove(i);s.removeModel(i);h.dropDataSource(i);t.disposeLayer(i);case d.TRANSITION_TYPE.IN:w.unregister(r);r.notifyCallback(u)}}return this.doPerfPingCall(f),!f},this.setViewChanged=function(n){y=n;var t=e.getViewport(),r=t.getWidth(),u=t.getHeight(),i=r*u;i<lt?(b.setScreenQuadSize(32),a.setScreenQuadSize(32)):i<at?(b.setScreenQuadSize(64),a.setScreenQuadSize(64)):(b.setScreenQuadSize(128),a.setScreenQuadSize(128))},this.registerDataSourceForAdd=function(n,r,u,f){var e=n.getDataSourceName(),o,s;return l.map[e]?(i.log(e+" is already in ViewController's ds list."),!1):(o=new d.DataSourceRegistryItem(n,f,d.TRANSITION_TYPE.IN),s=w.register(o),!s)?!1:(ot(o,r,u),l.add(e,n),h.initDataSource(n),t.initLayer(e,n.getZOrder()),!0)},this.registerDataSourceForRemoval=function(n,r,u,f){if(!l.map[n])return i.log(n+" not found in ViewController's ds list."),!1;var e=new d.DataSourceRegistryItem(l.map[n],f,d.TRANSITION_TYPE.OUT),o=w.register(e);return o?(ot(e,r,u),t.finalizeLayer(n),!0):!1},this.dispose=function(){for(var r,i=l.getArray(),n=0,u=i.length;n<u;n++)r=i[n].getDataSourceName(),t.disposeLayer(r,!0);t.dispose&&t.dispose();s.dispose();l.dispose()};tt<f.length;)this.registerDataSourceForAdd(f[tt],r.TYPE.FadeIn),tt++;this.setViewChanged(!0)}function hi(n,t,i,r){this.geometryPolygon=n.slice();this.texturesWithPolygons=t.slice();this.id=i;this.worldLod=r}function eu(){function t(t){return n[t]?!0:(n[t]=new i,!1)}function i(){this.delta={added:[],removed:[],updated:[]};this.currentRenderables=new ut;this.currentVisibleElements=new ut;this.dispose=function(){this.delta.added.length=0;this.delta.added.length=0;this.delta.updated.length=0;this.delta=null;this.currentRenderables.dispose();this.currentVisibleElements.dispose()}}var n={};this.getVisibleElements=function(i){return t(i),n[i].currentVisibleElements};this.getRenderables=function(i){return!t(i),n[i].currentRenderables};this.getDelta=function(i){return!t(i),n[i].delta};this.setDelta=function(i,r){t(i);n[i].delta=r};this.syncAddedFromDeltaCurrentVisibleElements=function(i){var r,e;!t(i);var o=n[i].delta,u=o.added,s=n[i].currentVisibleElements,f;for(r=0,e=u.length;r<e;r++)f=u[r],s.add(f.viewElementId.id,f);u.length=0};this.syncUpdatedFromDeltaCurrentVisibleElements=function(i,r){var u,l,o,s,h;!t(i);var f=n[i],a=f.delta,e=a.updated,v=f.currentVisibleElements.map,y=f.currentRenderables.map,c;for(u=0,l=e.length;u<l;u++)c=e[u],o=c.viewElementId.id,s=v[o],!s,h=y[o],h&&r(s,h);e.length=0};this.syncRemovedFromDeltaCurrentVisibleElements=function(i){var r,o;!t(i);var u=n[i],s=u.delta,f=s.removed,h=u.currentVisibleElements,c=u.currentRenderables,e;for(r=0,o=f.length;r<o;r++)e=f[r].viewElementId.id,h.remove(e),c.remove(e);f.length=0};this.removeModel=function(i){!t(i);delete n[i]};this.dispose=function(){for(var t in n)n.hasOwnProperty(t)&&n[t].dispose()}}function r(n){this._durationMs=n||r.DefaultDurationMs}function kt(n){kt.__super.call(this,n)}function ci(n){ci.__super.call(this,n)}function ii(n){ii.__super.call(this,n)}function ri(n){ri.__super.call(this,n)}function ui(n){ui.__super.call(this,n)}function ot(n){ot.__super.call(this,n)}function nr(n){nr.__super.call(this,n)}function at(n,t,i,r){this._width=n;this._height=t;this._aspectRatio=this._width/this._height;this._nearDistance=i;this._farDistance=r}function fu(n,t,i,r,u,f){this.width=n?n.getWidth():0;this.height=n?n.getHeight():0;this.up=e.clone(r);this.look=e.clone(u);this.fieldOfView=f;var o=function(n,t,i){var r=n.dot(t),u;return r>1?r=1:r<-1&&(r=-1),u=Math.acos(r),u<i};this.isFuzzyEqualTo=function(n,t){if(this.width!==n.width||this.height!==n.height)return!1;var i=t*this.fieldOfView/this.height;return Math.abs(this.fieldOfView-n.fieldOfView)>i?!1:o(this.up,n.up,i)?o(this.look,n.look,i)?!0:!1:!1}}function hu(i,r){function y(){var n=Math.tan(.5*c);w=n===0?1:1/n;u.createLookAtRHOut(l,v,a,b);u.createPerspectiveOGLOut(c,s.getAspectRatio(),s.getNearDistance(),s.getFarDistance(),k);k.multiplyOut(b,d);o=!1}function nt(n){g=n;l=n.position;a=n.up;v=n.look;c=n.verticalFov}var tt=r||{verticalFov:n.degreesToRadians(80),position:new e(-1,-1,1),look:new e(0,0,-1),up:new e(0,1,0),side:new e(1,0,0)},g=null,s=i,p=new h(0,0),l=null,a=null,v=null,c=null,w=-1,b=t.createIdentity(),k=t.createIdentity(),d=t.createIdentity(),o=!0;nt(tt);this.setCameraParameters=nt;this.getCameraParameters=function(){return g};this.getPose=function(){return new fu(s,p,l,a,v,c)};this.setViewport=function(n){s=n;o=!0};this.getViewport=function(){return s};this.setPosition=function(n){l=n;o=!0};this.getPosition=function(){return l};this.setVerticalFov=function(n){c=n;o=!0};this.getVerticalFov=function(){return c};this.getFocalLength=function(){return o&&y(),w};this.setLook=function(n){v=n;o=!0};this.getLook=function(){return v};this.setUp=function(n){a=n;o=!0};this.getUp=function(){return a};this.setDigitalPan=function(n){p=n;o=!0};this.getDigitalPan=function(){return p};this.getViewTransform=function(){return o&&y(),b};this.getProjectionTransform=function(){return o&&y(),k};this.getViewProjectionTransform=function(){return o&&y(),d};this.projectTo2D=function(n){o&&y();var r=s.getWidth()*.5,u=s.getHeight()*.5,i=d.transformVector4(f.createFromVector3(n));return i.x/=i.w,i.y/=i.w,i.z=i.w=1,new t(r,0,r,0,0,-u,u,0,0,0,1,0,0,0,0,1).transformVector4(i)}}function ti(n,t,i){this._startTime=-1;this._initialValue=-1;this._timeInMillis=-1;this._springConstant=n;this._damperConstant=t;this._allowOvershoot=i;this._current=0;this._target=0;this._velocity=0;this._t=-1;this._isSettled=!1}function sr(n,t,i){this._internalSpring=new ti(n,t,i);this._internalSpringCurrentValue=0;this._internalSpringTargetValue=1;this._current=[];this._initial=[];this._target=[]}function gr(n,t){function b(n){n.type="gestureStart";ut(n)}function a(n){n.type="gestureChange";ft(n)}function k(n){n.type="gestureEnd";d(n);u.focus()}function ht(n){n.type="mouseClicked";d(n)}function v(n){n.type="discreteZoom";et(n)}function g(n){tt(n);ot(n)}function nt(n){tt(n);st(n)}function tt(n){[37,38,39,40,61,107,109,173,187,189,].indexOf(n.keyCode)>=0&&n.preventDefault()}function s(n){b({clientX:n.offsetX||n.layerX,clientY:n.offsetY||n.layerY,hasCursor:!0});o={x:n.clientX,y:n.clientY};n.preventDefault()}function h(n){var t=n.currentTarget===document;o!=null?(a({clientX:n.offsetX||n.layerX,clientY:n.offsetY||n.layerY,translationX:n.clientX-o.x,translationY:n.clientY-o.y,scale:1,hasCursor:!0,isOffTarget:t}),n.preventDefault()):(a({clientX:n.offsetX||n.layerX,clientY:n.offsetY||n.layerY,translationX:n.clientX,translationY:n.clientY,scale:1,hasCursor:!0,isOffTarget:t}),n.preventDefault())}function f(n){if(o!=null){var t=n.clientX-o.x,i=n.clientY-o.y;k({clientX:n.offsetX||n.layerX,clientY:n.offsetY||n.layerY,translationX:t,translationY:i,scale:1,hasCursor:!0});t==0&&i==0&&ht({clientX:n.offsetX||n.layerX,clientY:n.offsetY||n.layerY,translationX:0,translationY:0,scale:0});o=null;n.preventDefault()}}function e(n){var t=0;n.wheelDelta?t=n.wheelDelta/-120:n.deltaY&&(t=n.deltaY/3);v({clientX:n.offsetX||n.layerX,clientY:n.offsetY||n.layerY,direction:t>=0?1:-1,wheelDelta:t,mouseInteractionType:"mousewheel",hasCursor:!0});n.preventDefault()}function c(n){v({clientX:n.offsetX||n.layerX,clientY:n.offsetY||n.layerY,direction:1,hasCursor:!0});n.preventDefault()}var i=n,ut=t.gestureStart||function(){},ft=t.gestureChange||function(){},d=t.gestureEnd||function(){},et=t.discreteZoom||function(){},ot=t.keyDown||function(){},st=t.keyUp||function(){},w=!1,r,o=null,y,p,l,u,it,rt;(window.navigator.msPointerEnabled||window.PointerEvent)&&window.MSGesture!==undefined?(l=window.navigator.msPointerEnabled,y=function(){r=new br(i,b,a,k,v);window.PointerEvent?(i.addEventListener("pointerdown",r.msPointerDown,!1),i.addEventListener("pointerup",r.msPointerUp,!1)):l&&(i.addEventListener("MSPointerDown",r.msPointerDown,!1),i.addEventListener("MSPointerUp",r.msPointerUp,!1));l===!1&&(i.addEventListener("mousedown",s,!1),i.addEventListener("mousemove",h,!1),i.addEventListener("mouseup",f,!1),i.addEventListener("mouseout",f,!1));i.addEventListener("MSGestureTap",r.msGestureTap,!1);i.addEventListener("MSGestureStart",r.msGestureStart,!0);i.addEventListener("MSGestureChange",r.msGestureChange,!0);i.addEventListener("MSGestureEnd",r.msGestureEnd,!0);i.addEventListener("dblclick",c,!1);i.addEventListener("mousewheel",e,!1);i.addEventListener("pointermove",r.msPointerMove,!1)},p=function(){r&&(window.PointerEvent?(i.removeEventListener("pointerdown",r.msPointerDown,!1),i.removeEventListener("pointerup",r.msPointerUp,!1)):l&&(i.removeEventListener("MSPointerDown",r.msPointerDown,!1),i.removeEventListener("MSPointerUp",r.msPointerUp,!1)),l===!1&&(i.removeEventListener("mousedown",s,!1),i.removeEventListener("mousemove",h,!1),i.removeEventListener("mouseup",f,!1),i.removeEventListener("mouseout",f,!1)),i.removeEventListener("MSGestureTap",r.msGestureTap,!1),i.removeEventListener("MSGestureStart",r.msGestureStart,!0),i.removeEventListener("MSGestureChange",r.msGestureChange,!0),i.removeEventListener("MSGestureEnd",r.msGestureEnd,!0),i.removeEventListener("pointermove",r.msPointerMove,!1));i.removeEventListener("dblclick",c,!1);i.removeEventListener("mousewheel",e,!1)}):window.ontouchstart!==undefined?(y=function(){r=new dr(b,a,k,v);i.addEventListener("touchstart",r.handleTouchStart,!1);i.addEventListener("touchend",r.handleTouchEnd,!1);i.addEventListener("touchcancel",r.handleTouchEnd,!1);i.addEventListener("touchleave",r.handleTouchEnd,!1);i.addEventListener("touchmove",r.handleTouchMove,!1);i.addEventListener("mousedown",s,!1);i.addEventListener("mousemove",h,!1);i.addEventListener("mouseup",f,!1);i.addEventListener("mouseout",f,!1);i.addEventListener("dblclick",c,!1);i.addEventListener("mousewheel",e,!1);i.addEventListener("wheel",e,!1)},p=function(){i.removeEventListener("touchstart",r.handleTouchStart,!1);i.removeEventListener("touchend",r.handleTouchEnd,!1);i.removeEventListener("touchcancel",r.handleTouchEnd,!1);i.removeEventListener("touchleave",r.handleTouchEnd,!1);i.removeEventListener("touchmove",r.handleTouchMove,!1);i.removeEventListener("mousedown",s,!1);i.removeEventListener("mousemove",h,!1);i.removeEventListener("mouseup",f,!1);i.removeEventListener("mouseout",f,!1);i.removeEventListener("dblclick",c,!1);i.removeEventListener("mousewheel",e,!1);i.removeEventListener("wheel",e,!1)}):(y=function(){i.addEventListener("mousedown",s,!1);i.addEventListener("mousemove",h,!1);i.addEventListener("mouseup",f,!1);i.addEventListener("mouseout",f,!1);i.addEventListener("mousewheel",e,!1);i.addEventListener("wheel",e,!1);i.addEventListener("dblclick",c,!1)},p=function(){i.removeEventListener("mousedown",s,!1);i.removeEventListener("mousemove",h,!1);i.removeEventListener("mouseup",f,!1);i.removeEventListener("mouseout",f,!1);i.removeEventListener("mousewheel",e,!1);i.removeEventListener("wheel",e,!1);i.removeEventListener("dblclick",c,!1)});u=document.createElement("div");u.id="focusElement";u.setAttribute("aria-label","Streetside view");u.setAttribute("role","application");it=function(){i.appendChild(u);u.addEventListener("keydown",g,!1);u.addEventListener("keyup",nt,!1);u.focus()};rt=function(){u.removeEventListener("keydown",g,!1);u.removeEventListener("keyup",nt,!1);u.parentNode&&u.parentNode.removeChild(u)};this.enable=function(){y();it();w=!0};this.disable=function(){p();rt();w=!1;r=null};this.isEnabled=function(){return w};this.userCurrentlyInteracting=function(){return r?r.userCurrentlyInteracting():!1}}function kr(n,t){function i(n){t(n);n.handled||u.push(n)}var u=[],r=new gr(n,{gestureStart:i,gestureChange:i,gestureEnd:i,discreteZoom:i,keyDown:i,keyUp:i});this.enable=function(){r.enable()};this.disable=function(){r.disable()};this.isEnabled=function(){return r.isEnabled()};this.getQueuedEvents=function(){var n=u;return u=[],n};this.userCurrentlyInteracting=function(){return r.userCurrentlyInteracting()}}function br(n,t,i,r){var f=n,a=t,v=i,c=r,e,s,h,o=!1,u=0,y=getComputedStyle(f.parentNode).direction=="rtl",l=new MSGesture;this.msGestureTap=function(n){a({clientX:n.offsetX,clientY:n.offsetY,hasCursor:n.pointerType&&n.pointerType==="mouse",isTouch:n.pointerType&&n.pointerType==="touch"});c({clientX:n.offsetX,clientY:n.offsetY,translationX:0,translationY:0,scale:1,hasCursor:n.pointerType&&n.pointerType==="mouse",isTouch:n.pointerType&&n.pointerType==="touch"})};this.msPointerDown=function(n){f.msSetPointerCapture?f.msSetPointerCapture(n.pointerId):f.setPointerCapture&&f.setPointerCapture(n.pointerId);l.target||(l.target=f);l.addPointer(n.pointerId);u++;u==1&&(a({clientX:n.offsetX,clientY:n.offsetY,hasCursor:n.pointerType&&n.pointerType==="mouse",isTouch:n.pointerType&&n.pointerType==="touch"}),e=0,s=0,h=1)};this.msPointerUp=function(n){u=Math.max(0,u-1);o||u!=0||c({clientX:n.offsetX,clientY:n.offsetY,translationX:e,translationY:s,scale:h,hasCursor:n.pointerType&&n.pointerType==="mouse",isTouch:n.pointerType&&n.pointerType==="touch"})};this.msPointerMove=function(n){o||u!=0||(v({clientX:n.offsetX||n.layerX,clientY:n.offsetY||n.layerY,translationX:n.clientX,translationY:n.clientY,scale:1,hasCursor:n.pointerType&&n.pointerType==="mouse",isTouch:n.pointerType&&n.pointerType==="touch"}),n.preventDefault())};this.msGestureStart=function(){o=!0};this.msGestureChange=function(n){if(o){y?e-=n.translationX:e+=n.translationX;s+=n.translationY;h*=n.scale;var t={clientX:n.offsetX,clientY:n.offsetY,translationX:e,translationY:s,scale:h,hasCursor:n.pointerType&&n.pointerType==="mouse",isTouch:n.pointerType&&n.pointerType==="touch"};n.detail&n.MSGESTURE_FLAG_INERTIA?(c(t),o=!1):v(t)}};this.msGestureEnd=function(n){o&&c({clientX:n.offsetX,clientY:n.offsetY,translationX:e,translationY:s,scale:h,hasCursor:n.pointerType&&n.pointerType==="mouse",isTouch:n.pointerType&&n.pointerType==="touch"})};this.userCurrentlyInteracting=function(){return u>0}}function dr(t,i,r){function a(n){var t=n.target.offsetParent,i=0,r=0;t&&(i=t.offsetLeft,r=t.offsetTop);n.actualX=n.clientX-i;n.actualY=n.clientY-r}var v=t,y=i,p=r,s,h,c,u={},e=0,f,o,l=0;this.handleTouchStart=function(t){for(var i,y=t.changedTouches,r=0,p=y.length;r<p;r++)i=y[r],e==0?f=i.identifier:e==1&&(o=i.identifier),a(i),u[i.identifier]={identifier:i.identifier,actualX:i.actualX,actualY:i.actualY,clientX:i.clientX,clientY:i.clientY},e++;e==1?(s=0,h=0,v({clientX:u[f].actualX,clientY:u[f].actualY})):e==2&&(c=1,t.preventDefault(),v({clientX:(u[f].actualX+u[o].actualX)/2,clientY:(u[f].actualY+u[o].actualY)/2}),l=n.distanceBetweenTwoPoints(u[f].actualX,u[f].actualY,u[o].actualX,u[o].actualY))};this.handleTouchMove=function(t){var d,w,b,nt,r,i,k,g;for(t.preventDefault(),d=t.changedTouches,w={},b=0,nt=d.length;b<nt;b++)(r=d[b],u[r.identifier])&&(a(r),w[r.identifier]={identifier:r.identifier,actualX:r.actualX,actualY:r.actualY,clientX:r.clientX,clientY:r.clientY});if(i=w[f],k=w[o],e>1&&(i||k)&&l!=0){s=0;h=0;var v=i==null?u[f]:i,p=k==null?u[o]:k,tt=n.distanceBetweenTwoPoints(v.actualX,v.actualY,p.actualX,p.actualY);c=tt/l;y({clientX:(v.actualX+p.actualX)/2,clientY:(v.actualY+p.actualY)/2,translationX:s,translationY:h,scale:c,isTouch:!0});u[f]=v;u[o]=p}else e>0&&i&&(g=u[f],c=1,s+=i.actualX-g.actualX,h+=i.actualY-g.actualY,y({clientX:i.actualX,clientY:i.actualY,translationX:s,translationY:h,scale:c,isTouch:!0}),u[f]=i)};this.handleTouchEnd=function(n){for(var r,f=n.changedTouches,t,i=0,o=f.length;i<o;i++)t=f[i],r=t.identifier,u[r]&&(delete u[r],e--);n.touches.length==0&&u.length>0&&(u={},e=0);e<2&&(a(t),p({clientX:t.actualX,clientY:t.actualY,translationX:s,translationY:h,scale:c}))};this.userCurrentlyInteracting=function(){return e>0}}function wi(t,i,r,u,f,o,s){var h,c;this._camera=t;this._upperPitchLimit=r||n.degreesToRadians(90);this._lowerPitchLimit=u||n.degreesToRadians(-90);this._upperHeadingLimit=null;this._lowerHeadingLimit=null;this._currentView={pitch:s||0,heading:o||0,verticalFov:0};this._viewChanging=!1;this._pitchSpring=new ti(.01,1,!0);this._headingSpring=new ti(.01,1,!0);this._fieldOfViewSpring=new ti(.0033,1,!0);this._zoomToPointSpring=new sr(.01,1,!1);this._zoomingToPoint=!1;this._wheelZoomFudgeFactor=.1;this._pitchSpring.setCurrentAndTarget(s||0);this._headingSpring.setCurrentAndTarget(o||0);this._fieldOfViewSpring.setCurrentAndTarget(this._camera.getVerticalFov());f?(h=n.degreesToRadians(40),this._minFieldOfView=f<h?f:h,c=n.degreesToRadians(5),this._minFieldOfView=this._minFieldOfView>c?this._minFieldOfView:c):this._minFieldOfView=n.degreesToRadians(20);this._maxFieldOfView=n.degreesToRadians(80);this._worldUp=i&&i.up?i.up:new e(0,1,0);this._worldLook=i&&i.look?i.look:new e(0,0,-1);this._worldSide=i&&i.side?i.side:new e(1,0,0);this._look=new e(0,0,0);this._side=new e(0,0,0);this._up=new e(0,0,0);this._tempQuaternion=new l(0,0,0,0);this._tempPitchRotationQuaternion=new l(0,0,0,0);this._tempHeadingRotationQuaternion=new l(0,0,0,0);this._lastGestureScale=1;this._startingPosition=null;this._discreteZoomFactor=.7;this._scrollSpeedX=0;this._scrollSpeedY=0;this._scrollAccX=0;this._scrollAccY=0;this._motionHandle=0;this._scrollSpeedDamper=.9;this._scrollSpeedAdjustmentFactor=200;this._previousTempZoomScale=null;this.viewChangeEvent=new ct;this.viewChangeEndEvent=new ct}function yi(i,r,u,f,o){function ot(){return[s._pitchSpring.getTarget(),s._headingSpring.getTarget()]}function st(){var n=s._zoomToPointSpring.isSettled();return n&&(s._zoomingToPoint=!1),n&&s._pitchSpring.isSettled()&&s._headingSpring.isSettled()&&s._fieldOfViewSpring.isSettled()}function ht(n,t,i,r,u){var f,e,o=i/r;return e=n===0?0:2*Math.atan(o*(n/i)/u),f=t===0?0:2*Math.atan(-t/r/u),[f,e]}function ct(){if(st()){s._viewChanging&&s.viewChangeEndEvent!=null&&s.viewChangeEndEvent.fire(s.getView());s._viewChanging=!1;return}s._viewChanging=!0;var n=Date.now();s._zoomToPointSpring.step(n);s._pitchSpring.step(n);s._headingSpring.step(n);s._fieldOfViewSpring.step(n);s.updateCameraProperties()}function lt(t,i,r,u,f,e,o){s._zoomingToPoint=!1;r*=o;u*=o;var a=s._camera.getFocalLength(),h,c,l=ht(r,u,f,e,a);h=l[0];c=l[1];y=s.constrainHeading(i-c);k=s.constrainPitch(t-h);b=n.pickStartHeadingToTakeShortestPath(s._headingSpring.getCurrent(),y);s._pitchSpring.setTarget(k);s._headingSpring.setCurrent(b);s._headingSpring.setTarget(y)}function at(n){s.setViewTarget(s.getPitch(),s.getHeading(),s.getVerticalFov(),!1,null);s._lastGestureScale=1;pt(n.clientX,n.clientY)}function vt(){s._lastGestureScale=1;nt();s._zoomingToPoint=!1}function yt(n){var t=s._lastGestureScale/n.scale,i,r;if(t!==1){nt();i=(s._startingPosition[0]+n.clientX)/2;r=(s._startingPosition[1]+n.clientY)/2;n.clientX=i;n.clientY=r;s.onDiscreteZoom(n,t)}s._lastGestureScale=n.scale;c=new h(s._startingPosition[0]+n.translationX,s._startingPosition[1]+n.translationY)}function pt(n,t){p=!0;s._startingPosition=[n,t];a[0]=s.getPitch();a[1]=s.getHeading()}function nt(){p=!1;c=null}function wt(){if(s._camera!==null&&c!==null&&p){var t=c.x,i=c.y,n=s._camera.getViewport(),r=t-s._startingPosition[0],u=i-s._startingPosition[1];lt(a[0],a[1],r,u,n.getWidth(),n.getHeight(),1.1)}}function bt(t,i){var e=s.prevGyrometerReadingNonZero?2:2;if(t==null)return s.prevGyrometerReadingNonZero=!1,[0,0];if(Math.abs(t.angularVelocityX)<e&&Math.abs(t.angularVelocityY)<e&&Math.abs(t.angularVelocityZ)<e)return s.prevGyrometerReadingNonZero=!1,[0,0];s.prevGyrometerReadingNonZero=!0;var o=1.5*n.degreesToRadians(i/1e3)*Math.sin(s.getVerticalFov()),u=t.angularVelocityY*o,f=t.angularVelocityX*o,r=null;return(Windows&&Windows.Graphics&&Windows.Graphics.Display&&Windows.Graphics.Display.DisplayProperties&&(r=Windows.Graphics.Display.DisplayProperties.currentOrientation),r==null||r===Windows.Graphics.Display.DisplayOrientations.none||r===Windows.Graphics.Display.DisplayOrientations.landscape)?[f,u]:r===Windows.Graphics.Display.DisplayOrientations.portrait?[u,-f]:r===Windows.Graphics.Display.DisplayOrientations.landscapeFlipped?[-f,-u]:r===Windows.Graphics.Display.DisplayOrientations.portraitFlipped?[-u,f]:[0,0]}yi.__super.call(this,i,null,r,u,o);var s=this,b=0,k=0,y=0,tt=t.createIdentity(),kt=t.createIdentity().multiply(tt),it=-.7,a=[],p=!1,c=null,l=!1,d=t.createIdentity(),g=t.createIdentity(),v=t.createIdentity(),w=t.createIdentity(),rt=new e(0,0,-1),ut=new e(0,1,0),ft=new e(1,0,0),et=new e(0,0,0);this.setDimension=function(){};this.setBounds=function(t){t.top>=0&&(this._upperPitchLimit=t.top,this._lowerPitchLimit=Math.min(it,t.bottom));var i=Math.abs(t.left-t.right);i<n.twoPI&&(t.left>0&&t.left<t.right?(this._upperHeadingLimit=t.left,this._lowerHeadingLimit=t.right):(this._upperHeadingLimit=t.right,this._lowerHeadingLimit=t.left<0?n.twoPI+t.left:t.left))};this.updateCameraProperties=function(){var n,i,r,u,f;this._zoomingToPoint?(u=this._zoomToPointSpring.getCurrent(),n=u[0],i=u[1],r=u[2],this._pitchSpring.setCurrentAndTarget(n),this._headingSpring.setCurrentAndTarget(i),this._fieldOfViewSpring.setCurrentAndTarget(r)):(n=this.constrainPitch(this.getPitch()),i=this.getHeading(),r=this.getVerticalFov());w.transformVector3Out(rt,this._worldLook);w.transformVector3Out(ut,this._worldUp);w.transformVector3Out(ft,this._worldSide);t.createRotationXOut(n,d);t.createRotationYOut(-i,g);g.multiplyOut(d,v);v.transformVector3Out(this._worldLook,this._look);v.transformVector3Out(this._worldUp,this._up);v.transformVector3Out(this._worldSide,this._side);f=et;this._camera.setPosition(f);this._camera.setLook(this._look);this._camera.setUp(this._up);this._camera.setVerticalFov(r);this.viewChangeEvent!=null&&this.viewChangeEvent.fire(this.getView())};this.control=function(n,t){for(var i,e,r,u,f=0;f<t.length;++f){i=t[f];switch(i.type){case"gestureStart":l=!0;this.stopMovingCamera();at(i);break;case"gestureChange":yt(i);break;case"gestureEnd":l=!1;vt();break;case"discreteZoom":this.onDiscreteZoom(i,null);break;case"keydown":l=!0;this.onKeyDown(i);break;case"keyup":l=!1;this.onKeyUp(i)}}if(this._gyrometer){if(e=new Date,r=this._gyrometer.getCurrentReading(),r&&this.prevGyroReading&&r.timestamp!=this.prevGyroReading.timestamp&&!l&&this.prevFrameTime&&(u=bt(r,e-this.prevFrameTime),u[0]!==0&&u[1]!==0)){var o=ot(),s=o[0]+u[0],h=o[1]-u[1];this.setPitchAndHeading(s,h,!0)}this.prevGyroReading=r;this.prevFrameTime=e}return ct(),wt(),this._camera};this.setGyrometer=function(n){this._gyrometer=n}}function oi(t,i,r,u,f,e,o){oi.__super.call(this,t,i,r,u,f,e,o);this._mouseDownPoint=new h(0,0);this._mouseUpPoint=new h(0,0);this._previousMousePoint=new h(-1,-1);this.hasCursor=!1;this._isMouseDown=!1;this._isCurrentMouseSet=!1;this._isPreviousMouseSet=!1;this._startingPitch=null;this._startingHeading=null;this._animationInProgress=null;this._radiansPerPixelPitch=null;this._radiansPerPixelHeading=null;this._accelerateHorizontalRotationNearPoles=!0;this._maxPitchForAcceleratingHorizontalRotation=n.degreesToRadians(70);this._currentMousePoint=new h(0,0);this.control=function(n,t){for(var i,r=0;r<t.length;++r){i=t[r];switch(i.type){case"gestureEnd":this.onGestureEnd(i);break;case"gestureStart":this.onGestureStart(i);break;case"gestureChange":this.onGestureChange(i);break;case"discreteZoom":this.onDiscreteZoom(i);break;case"keydown":this.onKeyDown(i);break;case"keyup":this.onKeyUp(i)}}return this.updateCameraProperties(),this._camera};this.updateCameraPropertiesImpl=function(){var u,n,t,i,r;this.updateViewForMouseDrag();u=this.stepUpSpring();this._zoomingToPoint?(r=this._zoomToPointSpring.getCurrent(),n=r[0],t=r[1],i=r[2],this._pitchSpring.setCurrentAndTarget(n),this._headingSpring.setCurrentAndTarget(t),this._fieldOfViewSpring.setCurrentAndTarget(i)):(n=this.getPitch(),t=this.getHeading(),i=this.getVerticalFov());this._look=this.calculateLookFromPitchAndHeading(n,t,this._worldLook,this._worldUp,this._worldSide,null);this._up=this.calculateLookFromPitchAndHeading(n,t,this._worldUp,this._worldUp,this._worldSide,null);this._side=this.calculateLookFromPitchAndHeading(n,t,this._worldSide,this._worldUp,this._worldSide,null);var f=this._camera.getLook(),e=this._camera.getUp(),o=this._camera.getVerticalFov();!this._animationInProgress&&(this._animationInProgress||u)&&f.equals(this._look)&&e.equals(this._worldUp)&&o===i||(this._camera.setLook(this._look),this._camera.setUp(this._worldUp),this._camera.setVerticalFov(i),this.viewChangeEvent!=null&&this.viewChangeEvent.fire(this.getView()));this._animationInProgress=!u};this.updateCameraProperties=function(){this.updateCameraPropertiesImpl()};this.updateViewForMouseDrag=function(){if(this._isCurrentMouseSet){if(this._isMouseDown&&this._isPreviousMouseSet&&(this._previousMousePoint.x!==this._currentMousePoint.x||this._previousMousePoint.y!==this._currentMousePoint.y)){var t=n.clamp(this._startingPitch+this._radiansPerPixelPitch*(this._currentMousePoint.y-this._mouseDownPoint.y),this._lowerPitchLimit,this._upperPitchLimit),i=n.normalizeRadian(this._startingHeading+this._radiansPerPixelHeading*(this._mouseDownPoint.x-this._currentMousePoint.x));this.setViewTarget(t,i,null,!0)}this._previousMousePoint.x=this._currentMousePoint.x;this._previousMousePoint.y=this._currentMousePoint.y;this._isPreviousMouseSet=!0}};this.stepUpSpring=function(){var n=Date.now(),t=this._zoomToPointSpring.step(n),i=this._pitchSpring.step(n),r=this._headingSpring.step(n),u=this._fieldOfViewSpring.step(n);return(t&&(this._zoomingToPoint=!1),t&&i&&r&&u)?(this._viewChanging&&this.viewChangeEndEvent!=null&&this.viewChangeEndEvent.fire(this.getView()),this._viewChanging=!1,!0):(this._viewChanging=!0,!1)};this.onGestureStart=function(t){var i,r;this.hasCursor=t.hasCursor==!0;this._mouseUpPoint.x=this._mouseUpPoint.y=-1;this._lastGestureScale=1;this._isMouseDown=!0;this._mouseDownPoint.x=t.clientX;this._mouseDownPoint.y=t.clientY;this._startingPitch=this._pitchSpring.getCurrent();this._startingHeading=this._headingSpring.getCurrent();this._startingPosition=[t.clientX,t.clientY];i=this._camera.getViewport();this._radiansPerPixelPitch=this._camera.getVerticalFov()/i.getHeight();this._accelerateHorizontalRotationNearPoles&&(r=Math.min(Math.abs(this._startingPitch),this._maxPitchForAcceleratingHorizontalRotation),this._radiansPerPixelHeading=this._radiansPerPixelPitch/Math.sin(n.halfPI-r))};this.onGestureEnd=function(n){this._mouseUpPoint.x=n.clientX;this._mouseUpPoint.y=n.clientY;this._lastGestureScale=1;this._isMouseDown=!1;this._isCurrentMouseSet=!1;this._isPreviousMouseSet=!1;this._startingPitch=null;this._startingHeading=null};this.onGestureChange=function(n){var t,i,r;if(this.hasCursor=n.hasCursor==!0,t=this._lastGestureScale/n.scale,t!==1){if(!this._startingPosition)return;i=(this._startingPosition[0]+n.clientX)/2;r=(this._startingPosition[1]+n.clientY)/2;n.clientX=i;n.clientY=r;this.onDiscreteZoom(n,t)}else this._isMouseDown&&(this._currentMousePoint.x=this._mouseDownPoint.x+n.translationX,this._currentMousePoint.y=this._mouseDownPoint.y+n.translationY,this._isCurrentMouseSet=!0);this._lastGestureScale=n.scale}}function pi(n,i,r,u,f,s,h,c,l){var b;pi.__super.call(this,n,i,r,u,f,s,h);var y=t.createIdentity(),v=!1,p=!1,w=null,k=c,d=l,a=null;this.hasCursor=!1;this.control=function(n,t){for(var i,r=0;r<t.length;++r){i=t[r];switch(i.type){case"mouseClicked":this.onMouseClicked(i);break;case"gestureEnd":this.onGestureEnd(i);break;case"gestureStart":this.onGestureStart(i);break;case"gestureChange":this.onGestureChange(i);break;case"discreteZoom":this.onDiscreteZoom(i);break;case"keydown":this.onKeyDown(i);break;case"keyup":this.onKeyUp(i)}}return this.updateCameraProperties(),this._camera};this._upArrowHandler=function(){this.navigateForward(!0)};this.navigateForward=function(n){var t=this._camera.getViewport();this.hitTestLocation(t.getWidth()/2,t.getHeight()*.65);this.onMouseClicked(null,!n)};this._downArrowHandler=function(){this.navigateForward(!1)};this.setHitTestResultTranslation=function(n){y=n;v=!0};this.getHitTestResultTranslation=function(){return y};this.setIsNewHitTestResult=function(n){v=n};this.getIsNewHitTestResult=function(){return v};this.setIsPancakeClicked=function(n){p=n};this.getIsPancakeClicked=function(){return p};this.setPancakeLocation=function(n){w=n};this.getPancakeLocation=function(){return w};this.updateCameraProperties=function(){this.updateCameraPropertiesImpl();this.hitTest()};this.hitTest=function(){this.hitTestLocation(this._currentMousePoint.x,this._currentMousePoint.y)};this.hitTestLocation=function(n,i){var o=this._camera.getViewport(),h=2*n/o.getWidth()-1,c=1-2*i/o.getHeight(),f=new e(h,c,-1),u,s;f=this._camera.getProjectionTransform().inverse().transformVector3(f);f.z=-1;u=this._camera.getViewTransform().inverse().transformVector3(f);u.normalizeOut(u);var l=new e(0,-2.7,0),v=new e(0,1,0),y=vt.createFromPointAndNormal(l,v),p=new tu(u.multiplyScalar(-100),u),r=vt.intersectWithRay(p,y);r!=null&&(a==null||a.x!=r.x||a.y!=r.y||a.z!=r.z)&&(s=t.createTranslation(r.x,r.y,r.z),this.setHitTestResultTranslation(s),a=r)};this.onMouseClicked=function(n,t){var f=this.getHitTestResultTranslation(),i,r,u,s;this.setIsPancakeClicked(!0);i=new e(-f.m14,0,-f.m34);t&&(i.z*=-1,i.x*=-1);r=k.transformVector3(i);r=r.add(d);u=o.toLatLongAlt(r);s={latitude:u.x,longitude:u.y};this.setPancakeLocation(s)};b=this.onGestureEnd;this.onGestureEnd=function(n){if(b.call(this,n),this._mouseDownPoint.x==this._mouseUpPoint.x&&this._mouseDownPoint.y==this._mouseUpPoint.y){this._currentMousePoint=this._mouseUpPoint;this.hitTest();this.onMouseClicked(n)}};this.onGestureChange=function(n){var t,i,r;if(this.hasCursor=n.hasCursor,t=this._lastGestureScale/n.scale,t!==1){if(!this._startingPosition)return;i=(this._startingPosition[0]+n.clientX)/2;r=(this._startingPosition[1]+n.clientY)/2;n.clientX=i;n.clientY=r;this.onDiscreteZoom(n,t)}else this._isMouseDown?(this._currentMousePoint.x=this._mouseDownPoint.x+n.translationX,this._currentMousePoint.y=this._mouseDownPoint.y+n.translationY,this._isCurrentMouseSet=!0):n.isOffTarget||(this._currentMousePoint.x=n.clientX,this._currentMousePoint.y=n.clientY,this.hitTest());this._lastGestureScale=n.scale}}function iu(){var n=this;n.byId={};n.byType={};n.add=function(t){if(t.id==null)throw new Error("expected id property on the item");if(!t.type)throw new Error("expected type property on the item");n.byId[t.id]=t;n.byType[t.type]=n.byType[t.type]||[];n.byType[t.type].push(t)};n.remove=function(t){var i;if(typeof item=="number")i=n.byId[t],n.byType[i.type].remove(i),n.byType[i.type].length===0&&delete n.byType[i.type],delete n.byId[t];else throw new Error("Expected a single ID");};n.update=function(t){var i;if(t.added)for(i=0;i<t.added.length;++i)n.add(t.added[i]);if(t.removed)for(i=0;i<t.removed.length;++i)n.remove(t.removed[i])}}function vi(){this.interactionController=null;this.viewElementContainers=[];this.initialCameraParams=null;this.dataSourceName=null;this.worldConfiguration=null}function li(n,t){this.message=n;this.innerException=t}function gt(n,t){this.message=n;this.innerException=t}function et(){et.__super.call(this);this.tesselator=new cr(a);this.worldConfiguration=null;this.dataSourceName="panorama"+Date.now();this.faceNames=["front","right","back","left","top","bottom"];this.jsonWrapper="/jsonproxy.psfx?jsonUrl={0}";this.jsonpWrapperParam="&jsCallback={0}";this.defaultHttpsPhotosynthServer="https://photosynth.net";this.uriRegex=new RegExp("^(\\w+)://([^/]+)(/.*)$");this.outputMultiLODTiles=!1;this.scanConvertSize=20;this.prevViewTransform=null;this.prevProjectionTransform=null;this.initialCameraParams={verticalFov:n.degreesToRadians(60),position:new e(0,0,0),look:new e(0,.3,-1),up:new e(0,1,0)}}function p(i,r,u,f,e,s,h,c,l){var l=l||{},y,k,a;if(!i)throw new Error("urlFormat cannot be null or empty");if(!r)throw new Error("bubbleId must be specified");p.__super.call(this);this.tesselator=new cr(b);var w=["frontFace","rightFace","backFace","leftFace","topFace","bottomFace",],nt=["01","02","03","10","11","12"],v=8,tt=Math.pow(2,v+3);for(this.dataSourceName="streetsidePanorama"+r+Date.now(),this.interactionController=null,this.worldConfiguration={id:"streetsideCube"+r,type:"streetsidePanorama",source:{dimension:2032,tileSize:254,tileOverlap:1,tileBorder:1,minimumLod:v,maximumResolution:s?Math.pow(2,v+s):tt,bounds:{left:-3.141592653589793,right:3.141592653589793,top:-1.5707963267948966,bottom:1.5707963267948966},startingPitch:f&&n.degreesToRadians(f)||0,startingHeading:u&&n.degreesToRadians(u)||0,startingRoll:e&&n.degreesToRadians(e)||0,latitude:h,longitude:c,cameraHeight:2.7,projectorAspectRatio:1,projectorFocalLength:.5}},this.isCursorAndLabelEnabled=l.isCursorAndLabelEnabled||!1,y=l.cursor||{},this.cursorConfiguration={entityId:1e5,textureSize:y.size||256,textureExpansion:2,textureData:y.src||"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAEtBJREFUeNrsnb9T21gXhq/cM+MtoXIa0pLh6zF9siEl+YpAk5QJk/RAvztJyqSJKTaUIT96TP8xSxuadQXleoY/gE8HjsL1RbJlLNlXV88zozEoEEDW+973nHslGQMAtSXiEITJ5eVl29m1FG/NnN/ej7eTgRMlirocVQwA/BB3IuZE5Ct3EPldsc3hSF/FHPqxSZzw7mAAUKzQWyrsFf245fmv3dPtSI2ihzFgADBa7MmInoh90tH8PN7Ohnw+jIV4mx/y+V1TQ2IK3dgU+rzrGACCvxZ7IvxxxX0abxfW6zgivyuJGczF26L1Oq5JnGjpcIQhYAB1ivQi9sdW/T6KYxX4qYr72PM/c1nNYFG35ZzfJ2bwVc2AkgEDCEr0z+JtLUf9nghdRP5TPw4BMYL7agaJMYzqIxzE2x5mgAGELPpzHfmOdbuoySGaUzNY1iQ0jxlgAFUXvQh9Q4XfGhF1j7X2PePI/eorrFiGMMwM9uKtE5tBj8OGAfgg/DVrtE/jQsXerdkoP2k6aKspzGV8XZIKDjhkGMC0RS8d/FcjRnsR/A99hbsjRvBwSDJIUsE7ZhIwgGnE/G2N+mlI025fRc9IX3wyEBNYN9lNxE687VIeYABFC7+twm8PififTThde98RA3g6pEToqhGQvjCA0oQvHfyPjPYzTwUP1QzmMQIMYBrCP7ZiPvjVK5DyYBkjwADuKnyZv387RPgfjf8r8eqOGMDzIUawxXoCDMAVfstkN/cQfnhG0DE0CzEAFf9O/PLS3L7yDuGHbQQyZfg+NoEdDKCewl/TuN9C+LU2AkkBm3XtD0Q1FH5Lhe+u3Eu6+t/RStA8UiNwZw0OtD/QwwDCFf8rrfXduC/Cl84+03n1QKYP19UI3LJAegPvMIDwRv1P5nZ3X2L+ruGinLqyoAOCWxZ0tSzoYQBhjvoXKvwuGgAdGLbN4KrCWqSBKGDhi+C/pIz6+xr5ifvglgXPtTRw08CTUC80igIV/5pGfnvUlybfjqG7D8NZ1vNk3kkDmyFeetwIUPxvdeRvOi7+FPFDDo71XLHLw6s0qecWCcBT4bdU+EvU+lBib+BES4IeBuCP+Nspo75cmvvG0OGHyZCZgj/M4D0I+moClR9YGgGIX7r8h4749zXGIX6YlDM9l/adkuBQzz0SwIyEL2+C1GQbRH6YYUnQMdcrCPsYwHTFf+jU+xL5dwx35YFyWdTzbNHpC6xW0QQaFRS/iP5vR/wy4r9A/DAFTvVcs1Pm1Tmp5yYJoGTxp9X7f3Jewgx4bQYXDvU1CVTmhiONCol/I0X8u4gfZsifeg4mJM3BDRJA8eL/ZO2i2Qc+0Ta3m4OycrCDAZQjfup98A1pCn6omglEiB+gviYQVUj8SfeVq/jAZ+bUBBarYAIR4georwlEiB+gviYQIX6A+ppAhPgB6msCkSfid1f4ieh/R/wQkAl8MzezA96sGGx4Kn5GfggJ95xOVgzO/NqBaMbilwMhF/a0nAPFPD+EiLtOoBdvD2Z5FWFjxuI/NIOP5tpF/BAwp2bw2oGWJoFmHUsAuZnHkiP+LucIBE7XMYHkkfT1MQC9ldKGtUsu6eWZfFAXvpvBW4xtzOr2YtEMxN/W6G874hvOCaghcrPRtvX56rRvNBpNWfxS80jTr2nVRHT8oa64awSkGfhgmrccn3YJYN+6W0S/g/ihxrgaSB5nF14PQJ+q4jb96PhD3XFnBpam+QSixpTEL8/qs5sc+4aOP0BC1ww2BV+pZqrfA9A5zn+cuv8p7znALT47/YB7ZS8SmkYCcOt+Ov4A6byZdj+gVAPQuc22U/fzuC6AdM6cfkC77PUBUYnib5nBKb8uoz9ALuz1AaVODZZpAIfWH3GudT9TfgCjmdN+wHwyeMYGsFqZEiAl+u8gfoDcJOsDSi8FGiWIX6L/trVLpjeOeU8BxuLYDE4Nbqu2vE8Ab81g1/8j7yXAnfhoBmcF3nptAHqhj72AYZfoDzBRKWDPCqypxrxNAJ+cCNPlPQSYiK5TQn/y0gBiZ9oxt+/uAwCTM3AXIdWaPwagzYmXTu3Cgh+AYjgzg720l0U1BItKANL1Txp/Mue/z3sGUCj7qi2jWtv2wgD01sYbzuhP4w+gWNwZtY0ibiteRAKwpyakWcG9/QDK4bsZbAi+nakB6JRE2xn9AaA8bI21J50WnDQBbDujPyv+AMrF1dn2TAyA0R+g+ilgkgTA6A9Q8RRwJwNg9AcIIwXcNQEw+gMEkALGNgBdgcToD+BfCmhNIwEw+gMEkgLGMgC9xfeGtYslvwCzxX3IaLM0AzCDD/eQdcldjj/ATOmam2sEXI0WbgDPrI8/c+wBvOBzhkaLMwB9VFFLP5ULE35w3AG84Ie5uQCvNc5jxcZJALazHBmu+APwhQvV5NgpINdzAXR64R9rl9zjnyf7AvjDolMK3MvzMJG8CWDD+vgU8QN4h6vLjSJLADtSMPUH4Cf745YBIw1A7zrSsnZ1Oc4AXmJrs5XnjkF5EsAz5wfQ/APwkwvHBJ4VYQD2lAJTfwB+8yNDu+MbgBP/L4j/AJUoAy7ylgGjEoA79w8A/pN7TcAoA1hznAUAqpECcpUBjZzxX+CyX4BqYGt1aBkwLAG0M+oKAPAbt1/XvosBPKb+BwgiBTzO+qIoI/7LTQX+tXb9bnjYJ0CVWIi3b9bnv0VR1M+bAOzIcI74ASrHmRm8UUh7nBJgxan/AaB6dDM0PVYCoPsPUP0+QDtXDyCl/l81zAAAVJG5eDsc1gdojBj9TxE/QGW5MIP3CGjnKQGWHAMAgOpymqHtTANYof4HCLIPsJLHAOyY8JPjB1BpfuZOAClrhikBAMIpAZquxt0E0CL+AwRdBrSGGQANQICwU8DQBLCCAQAEbQAreUsA1v8DhMFZVgkwsBLwMsb69D8cN4Bg+N8v0cfcSgBOd/Cc4wUQFOdpWrdLgCbxH6AWZUAzzQDaGU0DAAgoAdhaz7ocmAuAAMJNACbNAJgCBAiX1KlAEgBAPbgYlQCYBQCoRw+AWQCAGvcAmqNKAACoAVcGcHl52Sb+A9SnDEg03xgRFQAgzDKAEgCAEgAAam8ATAEC1KgHkGg+MQCmAAHq1QNoUgIAUAIAAAYAABgAAGAAAIABAAAGAAAYAABgAAAQmAH0rX0LHBaAILG13bcN4MT6h3mOE0CQ2No+oQQAoAQAAAyAHgBAnXoAV/x6SihPBgYInltPCKYEAKAEuIKpQIB6xP9+mgEwFQgQLvNpWs8qAeY4XgBBMTeqBDiyPl7keAEExWKa1kkAAPXrAaQmgC4JAKAWPYBumgEwCwBQjxLgl9Yj+ytYDAQQLLcWAaX1AHrWx8scM4AgWM7Q+FADoAwACIOFvAbAVCBA2PX/0TADOMEAAII2gJO8JQA9AIA69QCiKBJ36JMCAIIc/fuq8cwE4EaE+xw/gEpzPyv+ZxnAEWUAQJDx/yiPAdAIBAizBLiVACJ3x+XlZTN++dfatRpvFxxHgMohF/UdWp//FkVRf2gC0C84oQwACCr+n7jizyoBhC4GABCUAXTTviDLAOxmQZvjCFBJ2hmaHisByHXEXBcAUC0WTMY9AEYagNYK9jescDwBKoWt2W5a/T8sAQhf6QMABFH/f836omEG0HVqCe4TCFAN5pz6vzu2Aeia4R4pAKDSo3/PXf+fNwEIB04KAAD/aWdoeGwD2MtoKgCAv6xkaHg8A3DKgDlSAID3PDI3/bqh8T9PAnAjxEOOL0BlRv+DUV+cxwD2nNqC2QAAP3FT+t7EBpAyG0AZAOAntjZHxv+8CcB1knWOM4CX2Np8n+cb8hpAx/p40XCjEADfcHV5UJgBxFGi5/yHTzneAF5ha/JANVtYAnDLAOk00gwE8IM5M8bc/50MIHYUSQA96we2Oe4AXvDQDM79HxRuACnO8pzjDuBd/N8b5xvHNYB31sfzpACAmdM2gzf+eFeaAehNBTrWLqYEAWaLrcFO1o0/MjU97k+7vLxsxS//WLtexNsx7wPA1JHLfj9Yn9/L2/2/awmQTAl26QUAzBxbe91xxX8nA1B2HRfiZiEA0x/9lzM0Wa4BxE7TJQUAeDX6d6dmAKQAgOqP/hMZACkAoNqj/6QJgBQAUOHRf2IDIAUAVHf0LyIBCFuOOz3iPQIohUfO6L856X84sQHoXUc6jkNxpSBAscw5o3/nLvP+ZSSApA5JliDKumSWCAMUy7q5WfPfn7T2L9QA1IneOymAJwoDFMOCM/q/L2L0v9Jukb/l5eWlXCPQ0k/l+oAXvHcAE/PBqv3lev97Rf3HjYJ/Ubch2Oa9A5iItim48VdaAtAU8CV+WdNPL+Ltd30FgPGQxt83c9NUl3v9PSnyBzRK+KUlBfStP4C1AQB347Ul/r6TsP00AG1O2B3KdcMKQYBxEc3Yj+LbLarxV2oJYJUCh1YP4Nxc37eMUgAgX/T/bG6m/WTF32oZP6hR4h+xaQbXBmzzvgLkYtsMzvlvlvWDSjOAlFKgbZgVABiFq5NSon/pJUBGKSAlwH/j7Yz3GeAWsuDnL3PT+Cst+k/TAJrm+iaiTd11ani0GEAaUvcvWtH/3rh3+fWpB5CUAm4NI3/ga95rgAFem8GHe26WLf6pGICagDyqyH5gwTr9AICBut++gO7dOI/38roEcMqBv+OXJasf8EJLAoC6IqP+B6vuP4nF/2BaP7wx5T/2iRlcJbhjuHcA1BdXA33ViAnSAHQ644njfqwPgLqy7dT9T8qc8vMhAST3Edxy6h+aglA3XpvBPtjWpPf3q4QBqAlIQ7Bj7ZIGCPcShLrwyNx+qOe7mWhxVkdA1wfIIqEla/cbM3iXYYDQkFH/D+tzuafm6jSm/LwyAMsEZGagpbuYGYCQcTv+Uu8/mJX4Z1YCWKVA0vW0ZwY+mMHGCECI4r8692cp/pknACsJLGk50LSSAHcSglBw7+zT19h/MutfrOHD0dEDseUcMNstAaosfvdc3vJB/N4kACsJbMQvn6xdp9oTIAlAlcXvrvHv+PILRr4dMUwAEH+NDQATAMRfcwPABADx19wAMkyAdQLgM+5Un9fi994AMAFA/OXS8P2o6gHcTIlYbc458IR2FcVfCQNwTMBeMSjrqbmACGbNIz0X7UU+lRB/JUoApxxwVwwK+/H2J+chzAC5pNe+qs+bFX5BJQArCVxdOWWuL6JIWHccGKBskgRqi79XNfFXLgFYSSDtUmJpCu4YmoNQLot6ntnTfDO9pLc2CcBKAn1NAh3njaE5CGXSNrfn+DtVFX9lE4CTBl7FL2+d3fQFoOx6X9ia1Z18MIBBExBn/mIGm4NSCsgdhngMGUzCgtb79qifXMvfrfof1wjhHdI34oHWYnZJ8BclAUwY+f9KqfcfhCD+YBKAkwakHHjl7JY3S55UzHUEkAfp8m+nDB7yxJ6tkP7QKMR3LzaBNXO9fNguCc7Ndff2mPMbhrBsbk8rJ4t7DkL7Y6NQ30WdKvyS4uLSIPxIGoCUUV8afQ9T0uOTqnb5a9EDyOgL9PXZ6lvmZgmxIJ3cb/QGwKn1vznil3NGuvyroYo/6ATgpIGWlgSu6I+1N8BMQT1Z0Fp/OWXU35z2Y7owgPKN4JW+4U3nnz5qaUBZUJ+4L0nwubNfRvrdqs/tYwCj04DMFKw5/3SuRvAdfQTNIxX+vLP/QCN/r04HI6rrWaCLh6QsaKWUBR8NswWhITFfmnzuQ2d6Gve7dTwoUd3PitgIduKXlyllAUYQjvCfp9T5Evffx8LfqfPBiTg/fpUF0hvYSPlnjCAs4QsdrfV7dT9IGMBtI0ibLcAIwhB+19Sku48BTN4f2B5iBPuGx5j7hrxX60OEv1vXOh8DKMcIZNbgc7z9MEwfzgqZzpPFO0/N7a4+wscApmIEIv4jNQPuRjQdFlX0Kyb9VnAIHwMorUeQ1Sw0agBJeUAqKH60T2L+YsbXdAzNPQxgCkYgU4ayqvCZub2OwB6FftArKKS2f2iyr90Qse+Z60t1+xwuDGDaZrCmRrCW8SVJiSBGcEwyyDXSL6vgsyK+ICv39kK8RBcDqG55sDEiFRjLCMQUuAjpmgUV+7IZfpVmMtp3iPkYgM9msGSlgmFmcG4ZQp3SQTLKJ4KfHyH6ZLQ/4ezCAEI1A+FUNzGDnyacWQVp2t1XwS+a7CYeoscAgjcDGfEem/w3JDm2jOHM+L8ScVkjfSL05ZzfJ0noq7wiegygDmbQNDeNLnldGuPbL9QQztUUTnXf+RT6Cgsa2edU4Mnni2a8x7OdqOiPVPR08DEADEGNYEVfmxP8l64ZjGMOC05dvjCiTh9FXwV/lAgfwWMAkK9kaFmm0MrRR5g1Pd0SsfeI9BgAFG8MTauPsKKvk6aGcUZzoyJP6vc+QscAwB+TaDu7xjEHW+TXJwrr6gEAwuL/AgwAWfnIbrU1Rq8AAAAASUVORK5CYII="},k=l.label||{},this.labelConfiguration={entityId:2e4,labelOffsetFromBubbleInMeters:5,labelOffsetMaxInMeters:20,labelOffsetIncreaseStepInMeters:2,textureToGeometryRatio:1/60,font:k.font||"60pt SegoeBing"},this.roadVectorGroup=[],this.initialCameraParams=this.createCameraParameters(n.degreesToRadians(e||.07),n.degreesToRadians(f),n.degreesToRadians(u),null),a=0;a<w.length;a++){var it=w[a],rt=r+nt[a],ut=i.replace("{quadkey}",rt+"{quadkey}"),ft=a%4;this.worldConfiguration.source[it]={tileSource:new wr(ut,ft).getTileUrl,clip:[0,0,0,2032,2032,2032,2032,0]}}this.viewElementContainers.push(new ir(this.worldConfiguration));var et=this.worldConfiguration.source.startingHeading,ot=this.worldConfiguration.source.startingRoll,st=this.worldConfiguration.source.startingPitch,d=this.worldConfiguration.source.latitude,g=this.worldConfiguration.source.longitude;this.bubbleCenterInGlobal=o.fromLatLongAlt(d,g,0);var ht=t.createRotationY(-et),ct=t.createRotationX(st),lt=t.createRotationZ(ot),at=o.getLocalToGlobalRotation(n.degreesToRadians(d),n.degreesToRadians(g));this.localToGlobal=ht.multiply(lt).multiply(ct);this.localToGlobal=at.multiply(this.localToGlobal);this.globalToLocal=this.localToGlobal.inverse();this.surfaceNormalInGlobal=o.getSurfaceNormalFromPoint(this.bubbleCenterInGlobal);this.surfaceNormalInLocal=this.globalToLocal.transformVector3(this.surfaceNormalInGlobal)}function lt(n,t,i,r,u){function e(n){return n.faceName.toString().concat(n.levelOfDetail.toString(),"_",n.x.toString(),"_",n.y.toString())}var f=this;f.x=t?Math.floor(t):0;f.y=i?Math.floor(i):0;f.levelOfDetail=n?Math.floor(n):0;f.faceName=r||Date.now();f.idFunction=u||e;f.id=f.idFunction(f)}function nu(n,t,i,r,u,f,e){this.geometryPolygon=n;this.texturePolygon=t;this.faceTransform=i;this.textureSource=r;this.viewElementId=u;this.viewElementWidth=f||256;this.viewElementHeight=e||256}function dt(n){this._geometry=n}function tr(n){dt.apply(this,new Array(new fr(n)))}function ir(n){dt.apply(this,new Array(new er(n)))}function ni(t){this._worldConfiguration=t;this._viewElementsByLod=[];this._minimumLod=t.source.minimumLod;this._maximumLod=t.source.maximumLod||n.ceilLog2(t.source.dimension);this._baseImageWidth=t.source.dimension;this._baseImageHeight=t.source.dimension;this._tileWidth=t.source.tileSize;this._tileHeight=t.source.tileSize;this._tileOverlap=t.source.tileOverlap;this._tileBorder=t.source.tileBorder;this._faceNames=["frontFace","rightFace","backFace","leftFace","topFace","bottomFace",]}function fr(){function i(n,i){r(t._worldConfiguration.source[i.faceName],u.cubeSideBase,i.lod,t._viewElementsByLod[i.lod],t._tileWidth,t._tileHeight,t._baseImageWidth,t._baseImageHeight,t._maximumLod,n,i)}function r(t,i,r,e,o,s,c,l,a,v,y){function hi(n,t,i){return n&&t!=i?i:t}function ci(n,t,i){for(var u,f=0,e=i,r=1,o=n.length;r<o;r++)u=n[r]-n[r-1],f==0?f=u:f!=u&&(e=Math.abs(t*u));return e}function li(n,t,i,r,u){var f,e,o;if(i==1&&!u)return[n,n+r];for(f=[n],e=1,o=0;e<=i;e++,o++)f[e]=f[o]+r;return u&&f.push(t),f}var yt=i[0].x,ai=i[0].y,nt=i[0].z,tt=i[0].w,pt=Math.pow(2,a-r),it=u._cubeSide,d=c/pt,rt=l/pt,wt=[],et=t.clip,bt=et.length,kt,g,dt,gt,w,ht,ti,ii,b,k,at,vt;if(bt%2!=0)throw new Error("The clip region defined for the current face is invalid.");for(kt=i[1].y,g=0;g<bt;g+=2)dt=et[g],gt=et[g+1],wt.push(new h(yt+dt*it/c,kt-gt*it/l));var p=Math.ceil(d/o),ut=Math.ceil(rt/s),ni=0,ot=1,st=1;p>1&&(ni=Math.floor(d-o*(p-1)),ot=it*(o/d),st=it*(s/rt));w=!n.isZero(ni);ht=w;!w&&p>1&&(p--,ut--);ti=p-w;ii=ut-ht;ot!=st;var ct=li(yt,i[2].x,ti,ot,w),lt=li(i[1].y,ai,ii,-st,ht),ri=0,ui=0;for(w&&(ri=ci(ct,d,o),ui=ci(lt,rt,s)),b=0;b<p;b++)for(k=0;k<ut;k++){var fi=ct[b],ei=ct[b+1],oi=lt[k],si=lt[k+1],ft=[new f(fi,si,nt,tt),new f(fi,oi,nt,tt),new f(ei,oi,nt,tt),new f(ei,si,nt,tt),];u.AreIntersecting(ft,wt)&&(ft.x=b,ft.y=k,at=d,vt=rt,w&&(at=hi(b==p-1,o,ri),vt=hi(k==ut-1,s,ui)),v(e,ft,u._texelCornersBase,y,at,vt))}return}ni.apply(this,arguments);var t=this;this.getViewElements=function(n,r){return this.constructor.superClass.getViewElements(t,i,n,r)};this.getViewElementById=function(n,r){if(n!=null){var u=this.constructor.superClass.getViewElements(t,i,n.levelOfDetail,r);if(u!=null)return u[n.id]}return null}}function er(){function t(t,i){u.splitSquareRecursive(u.cubeSideBase,null,i.lod-n._minimumLod,null,n._viewElementsByLod[i.lod],!1,u._texelCornersBase,t,i,n._tileWidth,n._tileHeight)}ni.apply(this,arguments);var n=this;this.getViewElements=function(i,r){return this.constructor.superClass.getViewElements(n,t,i,r)};this.getViewElementById=function(i,r){if(i!=null){var u=this.constructor.superClass.getViewElements(n,t,i.levelOfDetail,r);if(u!=null)return u[i.id]}return null}}function wr(n,t){var i=8;this.getTileUrl=function(r,u,f){var s=f-i,e=new lt(s,r,u,null,null),o;if(bi.isInBounds(e)){if(e.levelOfDetail===0)if(t!=null)o=bi.fromTileId(e,!0);else return null;else o=bi.fromTileId(e,!1);return n.replace("{quadkey}",o).replace("{subdomain}",t)}return null}}var g={},ft,n,u,i,o,k,st,ht,fi,gi;g.debugEnabled=!1;ft={clip:function(n,t,i,r){if(t.x<n.x||t.y<n.y||t.z<n.z)throw new Error("clip bounds should have positive volume");var u={clipBounds:{x:n.x,y:n.y,z:n.z,sizeX:t.x-n.x,sizeY:t.y-n.y,sizeZ:t.z-n.z},poly:i,polyTextureCoords:r||null,polyVertexCount:i.length,clippedPoly:new Array(i.length+6),clippedPolyTextureCoords:r===undefined||r==null?null:new Array(r.length+6),clippedPolyVertexCount:0,tempVertexBuffer:new Array(i.length+6),tempTextureCoordBuffer:r===undefined||r==null?null:new Array(r.length+6),isClipped:!1};return ft.clipConvexPolygonGeneral(u),u.clippedPoly.length=u.clippedPolyVertexCount,{polygon:u.clippedPoly,polygonTexture:u.clippedPolyTextureCoords,isClipped:u.isClipped}},clipConvexPolygonGeneral:function(n){var i;if(!n.clipBounds)throw new Error("expected clip bounds option");if(n.polyVertexCount<3||n.poly==null||n.poly.length<n.polyVertexCount||n.clippedPoly==null||n.clippedPoly.length<n.polyVertexCount+6||n.tempVertexBuffer==null||n.tempVertexBuffer.length<n.polyVertexCount+6)throw new Error("polygon arrays must have sufficient capacity");if(n.polyTextureCoords!=null&&(n.polyTextureCoords.length<n.polyVertexCount||n.clippedPolyTextureCoords==null||n.clippedPolyTextureCoords.Length<n.polyVertexCount+6||n.tempTextureCoordBuffer==null||n.tempTextureCoordBuffer.Length<n.polyVertexCount+6))throw new Error("polygon arrays must have sufficient capacity");i=n.tempVertexBuffer;n.tempVertexBuffer=n.clippedPoly;n.clippedPoly=i;i=null;i=n.tempTextureCoordBuffer;n.tempTextureCoordBuffer=n.clippedPolyTextureCoords;n.clippedPolyTextureCoords=i;i=null;var r=n.tempVertexBuffer,e=n.tempTextureCoordBuffer,f=n.polyVertexCount,u,t,o,s;for(n.clippedPolyVertexCount=0,u=f-1,t=0;t<f;t++)o=n.poly[u].x-n.clipBounds.x*n.poly[u].w,s=n.poly[t].x-n.clipBounds.x*n.poly[t].w,n.BC0=o,n.BC1=s,n.p0Idx=u,n.p1Idx=t,n.clippedPolyCurrent=n.poly,n.clippedPolyTextureCoordsCurrent=n.polyTextureCoords,ft.genericClipAgainstPlane(n),u=t;if(n.clippedPolyVertexCount!=0){for(i=r,r=n.clippedPoly,n.clippedPoly=i,i=null,i=e,e=n.clippedPolyTextureCoords,n.clippedPolyTextureCoords=i,i=null,f=n.clippedPolyVertexCount,n.clippedPolyVertexCount=0,u=f-1,t=0;t<f;t++)o=(n.clipBounds.x+n.clipBounds.sizeX)*r[u].w-r[u].x,s=(n.clipBounds.x+n.clipBounds.sizeX)*r[t].w-r[t].x,n.BC0=o,n.BC1=s,n.p0Idx=u,n.p1Idx=t,n.clippedPolyCurrent=r,n.clippedPolyTextureCoordsCurrent=e,ft.genericClipAgainstPlane(n),u=t;if(n.clippedPolyVertexCount!=0){for(i=r,r=n.clippedPoly,n.clippedPoly=i,i=null,i=e,e=n.clippedPolyTextureCoords,n.clippedPolyTextureCoords=i,i=null,f=n.clippedPolyVertexCount,n.clippedPolyVertexCount=0,u=f-1,t=0;t<f;t++)o=r[u].y-n.clipBounds.y*r[u].w,s=r[t].y-n.clipBounds.y*r[t].w,n.BC0=o,n.BC1=s,n.p0Idx=u,n.p1Idx=t,n.clippedPolyCurrent=r,n.clippedPolyTextureCoordsCurrent=e,ft.genericClipAgainstPlane(n),u=t;if(n.clippedPolyVertexCount!=0){for(i=r,r=n.clippedPoly,n.clippedPoly=i,i=null,i=e,e=n.clippedPolyTextureCoords,n.clippedPolyTextureCoords=i,i=null,f=n.clippedPolyVertexCount,n.clippedPolyVertexCount=0,u=f-1,t=0;t<f;t++)o=(n.clipBounds.y+n.clipBounds.sizeY)*r[u].w-r[u].y,s=(n.clipBounds.y+n.clipBounds.sizeY)*r[t].w-r[t].y,n.BC0=o,n.BC1=s,n.p0Idx=u,n.p1Idx=t,n.clippedPolyCurrent=r,n.clippedPolyTextureCoordsCurrent=e,ft.genericClipAgainstPlane(n),u=t;if(n.clippedPolyVertexCount!=0){for(i=r,r=n.clippedPoly,n.clippedPoly=i,i=null,i=e,e=n.clippedPolyTextureCoords,n.clippedPolyTextureCoords=i,i=null,f=n.clippedPolyVertexCount,n.clippedPolyVertexCount=0,u=f-1,t=0;t<f;t++)o=r[u].z-n.clipBounds.z*r[u].w,s=r[t].z-n.clipBounds.z*r[t].w,n.BC0=o,n.BC1=s,n.p0Idx=u,n.p1Idx=t,n.clippedPolyCurrent=r,n.clippedPolyTextureCoordsCurrent=e,ft.genericClipAgainstPlane(n),u=t;if(n.clippedPolyVertexCount!=0){for(i=r,r=n.clippedPoly,n.clippedPoly=i,i=null,i=e,e=n.clippedPolyTextureCoords,n.clippedPolyTextureCoords=i,i=null,f=n.clippedPolyVertexCount,n.clippedPolyVertexCount=0,u=f-1,t=0;t<f;t++)o=(n.clipBounds.z+n.clipBounds.sizeZ)*r[u].w-r[u].z,s=(n.clipBounds.z+n.clipBounds.sizeZ)*r[t].w-r[t].z,n.BC0=o,n.BC1=s,n.p0Idx=u,n.p1Idx=t,n.clippedPolyCurrent=r,n.clippedPolyTextureCoordsCurrent=e,ft.genericClipAgainstPlane(n),u=t;n.clippedPolyCurrent=null;n.clippedPolyTextureCurrent=null}}}}}},genericClipAgainstPlane:function(n){var t;n.BC1>=0?(n.BC0<0&&(t=n.BC0/(n.BC0-n.BC1),n.clippedPoly[n.clippedPolyVertexCount]=n.clippedPolyCurrent[n.p0Idx].lerp(n.clippedPolyCurrent[n.p1Idx],t),n.clippedPolyTextureCoords!=null&&(n.clippedPolyTextureCoords[n.clippedPolyVertexCount]=n.clippedPolyTextureCoordsCurrent[n.p0Idx].lerp(n.clippedPolyTextureCoordsCurrent[n.p1Idx],t)),n.clippedPolyVertexCount++,n.isClipped=!0),n.clippedPoly[n.clippedPolyVertexCount]=n.clippedPolyCurrent[n.p1Idx],n.clippedPolyTextureCoords!=null&&(n.clippedPolyTextureCoords[n.clippedPolyVertexCount]=n.clippedPolyTextureCoordsCurrent[n.p1Idx]),n.clippedPolyVertexCount++):n.BC0>=0&&(t=n.BC0/(n.BC0-n.BC1),n.clippedPoly[n.clippedPolyVertexCount]=n.clippedPolyCurrent[n.p0Idx].lerp(n.clippedPolyCurrent[n.p1Idx],t),n.clippedPolyTextureCoords!=null&&(n.clippedPolyTextureCoords[n.clippedPolyVertexCount]=n.clippedPolyTextureCoordsCurrent[n.p0Idx].lerp(n.clippedPolyTextureCoordsCurrent[n.p1Idx],t)),n.clippedPolyVertexCount++,n.isClipped=!0)}};n={};n.zeroTolerance=1e-12;n.halfPI=Math.PI/2;n.twoPI=2*Math.PI;n.oneEightyOverPI=180/Math.PI;n.piOverOneEighty=Math.PI/180;n.isZero=function(t){return Math.abs(t)<n.zeroTolerance};n.degreesToRadians=function(t){return t*n.piOverOneEighty};n.radiansToDegrees=function(t){return t*n.oneEightyOverPI};n.normalizeRadian=function(t){while(t<0)t+=n.twoPI;while(t>=n.twoPI)t-=n.twoPI;return t};n.pickStartHeadingToTakeShortestPath=function(t,i){return Math.abs(i-t)>Math.PI?t<i?t+n.twoPI:t-n.twoPI:t};n.invSqrt=function(n){return 1/Math.sqrt(n)};n.isFinite=function(n){return n>Number.NEGATIVE_INFINITY&&n<Number.POSITIVE_INFINITY};n.clamp=function(n,t,i){return Math.min(Math.max(n,t),i)};n.logBase=function(n,t){return Math.log(n)/Math.log(t)};n.ceilLog2=function(t){return Math.ceil(n.logBase(t,2))};n.compareTo=function(n,t){return n<t?-1:n===t?0:1};n.divPow2RoundUp=function(t,i){return n.divRoundUp(t,1<<i)};n.divRoundUp=function(n,t){return Math.ceil(n/t)};n.isPowerOfTwo=function(n){return(n&n-1)==0};n.nextHighestPowerOfTwo=function(n){--n;for(var t=1;t<32;t<<=1)n=n|n>>t;return n+1};n.distanceBetweenTwoPoints=function(n,t,i,r){return Math.sqrt((i-n)*(i-n)+(r-t)*(r-t))};t.createCopy=function(n){return new t(n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44)};t.createIdentity=function(){return new t(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)};t.createScale=function(n,i,r){return new t(n,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1)};t.createTranslation=function(n,i,r){return new t(1,0,0,n,0,1,0,i,0,0,1,r,0,0,0,1)};t.createRotationX=function(n){return new t(1,0,0,0,0,Math.cos(n),-Math.sin(n),0,0,Math.sin(n),Math.cos(n),0,0,0,0,1)};t.createRotationY=function(n){return new t(Math.cos(n),0,Math.sin(n),0,0,1,0,0,-Math.sin(n),0,Math.cos(n),0,0,0,0,1)};t.createRotationXOut=function(n,t){t.m11=1;t.m12=0;t.m13=0;t.m14=0;t.m21=0;t.m22=Math.cos(n);t.m23=-Math.sin(n);t.m24=0;t.m31=0;t.m32=Math.sin(n);t.m33=Math.cos(n);t.m34=0;t.m41=0;t.m42=0;t.m43=0;t.m44=1};t.createRotationYOut=function(n,t){t.m11=Math.cos(n);t.m12=0;t.m13=Math.sin(n);t.m14=0;t.m21=0;t.m22=1;t.m23=0;t.m24=0;t.m31=-Math.sin(n);t.m32=0;t.m33=Math.cos(n);t.m34=0;t.m41=0;t.m42=0;t.m43=0;t.m44=1};t.createRotationZ=function(n){return new t(Math.cos(n),-Math.sin(n),0,0,Math.sin(n),Math.cos(n),0,0,0,0,1,0,0,0,0,1)};t.prototype={add:function(n){return new t(this.m11+n.m11,this.m12+n.m12,this.m13+n.m13,this.m14+n.m14,this.m21+n.m21,this.m22+n.m22,this.m23+n.m23,this.m24+n.m24,this.m31+n.m31,this.m32+n.m32,this.m33+n.m33,this.m34+n.m34,this.m41+n.m41,this.m42+n.m42,this.m43+n.m43,this.m44+n.m44)},subtract:function(n){return new t(this.m11-n.m11,this.m12-n.m12,this.m13-n.m13,this.m14-n.m14,this.m21-n.m21,this.m22-n.m22,this.m23-n.m23,this.m24-n.m24,this.m31-n.m31,this.m32-n.m32,this.m33-n.m33,this.m34-n.m34,this.m41-n.m41,this.m42-n.m42,this.m43-n.m43,this.m44-n.m44)},multiply:function(n){return new t(this.m11*n.m11+this.m12*n.m21+this.m13*n.m31+this.m14*n.m41,this.m11*n.m12+this.m12*n.m22+this.m13*n.m32+this.m14*n.m42,this.m11*n.m13+this.m12*n.m23+this.m13*n.m33+this.m14*n.m43,this.m11*n.m14+this.m12*n.m24+this.m13*n.m34+this.m14*n.m44,this.m21*n.m11+this.m22*n.m21+this.m23*n.m31+this.m24*n.m41,this.m21*n.m12+this.m22*n.m22+this.m23*n.m32+this.m24*n.m42,this.m21*n.m13+this.m22*n.m23+this.m23*n.m33+this.m24*n.m43,this.m21*n.m14+this.m22*n.m24+this.m23*n.m34+this.m24*n.m44,this.m31*n.m11+this.m32*n.m21+this.m33*n.m31+this.m34*n.m41,this.m31*n.m12+this.m32*n.m22+this.m33*n.m32+this.m34*n.m42,this.m31*n.m13+this.m32*n.m23+this.m33*n.m33+this.m34*n.m43,this.m31*n.m14+this.m32*n.m24+this.m33*n.m34+this.m34*n.m44,this.m41*n.m11+this.m42*n.m21+this.m43*n.m31+this.m44*n.m41,this.m41*n.m12+this.m42*n.m22+this.m43*n.m32+this.m44*n.m42,this.m41*n.m13+this.m42*n.m23+this.m43*n.m33+this.m44*n.m43,this.m41*n.m14+this.m42*n.m24+this.m43*n.m34+this.m44*n.m44)},multiplyOut:function(n,t){t.m11=this.m11*n.m11+this.m12*n.m21+this.m13*n.m31+this.m14*n.m41;t.m12=this.m11*n.m12+this.m12*n.m22+this.m13*n.m32+this.m14*n.m42;t.m13=this.m11*n.m13+this.m12*n.m23+this.m13*n.m33+this.m14*n.m43;t.m14=this.m11*n.m14+this.m12*n.m24+this.m13*n.m34+this.m14*n.m44;t.m21=this.m21*n.m11+this.m22*n.m21+this.m23*n.m31+this.m24*n.m41;t.m22=this.m21*n.m12+this.m22*n.m22+this.m23*n.m32+this.m24*n.m42;t.m23=this.m21*n.m13+this.m22*n.m23+this.m23*n.m33+this.m24*n.m43;t.m24=this.m21*n.m14+this.m22*n.m24+this.m23*n.m34+this.m24*n.m44;t.m31=this.m31*n.m11+this.m32*n.m21+this.m33*n.m31+this.m34*n.m41;t.m32=this.m31*n.m12+this.m32*n.m22+this.m33*n.m32+this.m34*n.m42;t.m33=this.m31*n.m13+this.m32*n.m23+this.m33*n.m33+this.m34*n.m43;t.m34=this.m31*n.m14+this.m32*n.m24+this.m33*n.m34+this.m34*n.m44;t.m41=this.m41*n.m11+this.m42*n.m21+this.m43*n.m31+this.m44*n.m41;t.m42=this.m41*n.m12+this.m42*n.m22+this.m43*n.m32+this.m44*n.m42;t.m43=this.m41*n.m13+this.m42*n.m23+this.m43*n.m33+this.m44*n.m43;t.m44=this.m41*n.m14+this.m42*n.m24+this.m43*n.m34+this.m44*n.m44},multiplyScalar:function(n){return new t(this.m11*n,this.m12*n,this.m13*n,this.m14*n,this.m21*n,this.m22*n,this.m23*n,this.m24*n,this.m31*n,this.m32*n,this.m33*n,this.m34*n,this.m41*n,this.m42*n,this.m43*n,this.m44*n)},transpose:function(){return new t(this.m11,this.m21,this.m31,this.m41,this.m12,this.m22,this.m32,this.m42,this.m13,this.m23,this.m33,this.m43,this.m14,this.m24,this.m34,this.m44)},transformVector4:function(n){var t=n.x,i=n.y,r=n.z,u=n.w;return new f(this.m11*t+this.m12*i+this.m13*r+this.m14*u,this.m21*t+this.m22*i+this.m23*r+this.m24*u,this.m31*t+this.m32*i+this.m33*r+this.m34*u,this.m41*t+this.m42*i+this.m43*r+this.m44*u)},transformVector4Out:function(n,t){var i=n.x,r=n.y,u=n.z,f=n.w;t.x=this.m11*i+this.m12*r+this.m13*u+this.m14*f;t.y=this.m21*i+this.m22*r+this.m23*u+this.m24*f;t.z=this.m31*i+this.m32*r+this.m33*u+this.m34*f;t.w=this.m41*i+this.m42*r+this.m43*u+this.m44*f},transformVector3:function(n){return new e(this.m11*n.x+this.m12*n.y+this.m13*n.z,this.m21*n.x+this.m22*n.y+this.m23*n.z,this.m31*n.x+this.m32*n.y+this.m33*n.z)},transformVector3Out:function(n,t){t.x=this.m11*n.x+this.m12*n.y+this.m13*n.z;t.y=this.m21*n.x+this.m22*n.y+this.m23*n.z;t.z=this.m31*n.x+this.m32*n.y+this.m33*n.z},determinant:function(){var n,t,i,r,u,f,e,o,s,h,c,l;return n=this.m11*this.m22-this.m12*this.m21,t=this.m11*this.m23-this.m13*this.m21,i=this.m11*this.m24-this.m14*this.m21,r=this.m12*this.m23-this.m13*this.m22,u=this.m12*this.m24-this.m14*this.m22,f=this.m13*this.m24-this.m14*this.m23,e=this.m31*this.m42-this.m32*this.m41,o=this.m31*this.m43-this.m33*this.m41,s=this.m31*this.m44-this.m34*this.m41,h=this.m32*this.m43-this.m33*this.m42,c=this.m32*this.m44-this.m34*this.m42,l=this.m33*this.m44-this.m34*this.m43,n*l-t*c+i*h+r*s-u*o+f*e},inverse:function(){var r,u,f,e,o,s,h,c,l,a,v,y,p,i,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,st,ht,ct;return(r=this.m11*this.m22-this.m12*this.m21,u=this.m11*this.m23-this.m13*this.m21,f=this.m11*this.m24-this.m14*this.m21,e=this.m12*this.m23-this.m13*this.m22,o=this.m12*this.m24-this.m14*this.m22,s=this.m13*this.m24-this.m14*this.m23,h=this.m31*this.m42-this.m32*this.m41,c=this.m31*this.m43-this.m33*this.m41,l=this.m31*this.m44-this.m34*this.m41,a=this.m32*this.m43-this.m33*this.m42,v=this.m32*this.m44-this.m34*this.m42,y=this.m33*this.m44-this.m34*this.m43,p=r*y-u*v+f*a+e*l-o*c+s*h,Math.abs(p)<n.zeroTolerance)?t.createIdentity():(w=this.m22*y-this.m23*v+this.m24*a,b=-this.m12*y+this.m13*v-this.m14*a,k=this.m42*s-this.m43*o+this.m44*e,d=-this.m32*s+this.m33*o-this.m34*e,g=-this.m21*y+this.m23*l-this.m24*c,nt=this.m11*y-this.m13*l+this.m14*c,tt=-this.m41*s+this.m43*f-this.m44*u,it=this.m31*s-this.m33*f+this.m34*u,rt=this.m21*v-this.m22*l+this.m24*h,ut=-this.m11*v+this.m12*l-this.m14*h,ft=this.m41*o-this.m42*f+this.m44*r,et=-this.m31*o+this.m32*f-this.m34*r,ot=-this.m21*a+this.m22*c-this.m23*h,st=this.m11*a-this.m12*c+this.m13*h,ht=-this.m41*e+this.m42*u-this.m43*r,ct=this.m31*e-this.m32*u+this.m33*r,i=1/p,new t(w*i,b*i,k*i,d*i,g*i,nt*i,tt*i,it*i,rt*i,ut*i,ft*i,et*i,ot*i,st*i,ht*i,ct*i))},toString:function(){return this.m11+", "+this.m12+", "+this.m13+", "+this.m14+"\n"+this.m21+", "+this.m22+", "+this.m23+", "+this.m24+"\n"+this.m31+", "+this.m32+", "+this.m33+", "+this.m34+"\n"+this.m41+", "+this.m42+", "+this.m43+", "+this.m44+"\n"},pullToZero:function(){Math.abs(this.m11)<n.zeroTolerance&&(this.m11=0);Math.abs(this.m12)<n.zeroTolerance&&(this.m12=0);Math.abs(this.m13)<n.zeroTolerance&&(this.m13=0);Math.abs(this.m14)<n.zeroTolerance&&(this.m14=0);Math.abs(this.m21)<n.zeroTolerance&&(this.m21=0);Math.abs(this.m22)<n.zeroTolerance&&(this.m22=0);Math.abs(this.m23)<n.zeroTolerance&&(this.m23=0);Math.abs(this.m24)<n.zeroTolerance&&(this.m24=0);Math.abs(this.m31)<n.zeroTolerance&&(this.m31=0);Math.abs(this.m32)<n.zeroTolerance&&(this.m32=0);Math.abs(this.m33)<n.zeroTolerance&&(this.m33=0);Math.abs(this.m34)<n.zeroTolerance&&(this.m34=0);Math.abs(this.m41)<n.zeroTolerance&&(this.m41=0);Math.abs(this.m42)<n.zeroTolerance&&(this.m42=0);Math.abs(this.m43)<n.zeroTolerance&&(this.m43=0);Math.abs(this.m44)<n.zeroTolerance&&(this.m44=0)},flattenColumnMajor:function(){return[this.m11,this.m21,this.m31,this.m41,this.m12,this.m22,this.m32,this.m42,this.m13,this.m23,this.m33,this.m43,this.m14,this.m24,this.m34,this.m44,]},flattenRowMajor:function(){return[this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.m41,this.m42,this.m43,this.m44,]}};vt.createFromPoints=function(n,t,i){var f=t.subtract(n),e=i.subtract(n),r=f.cross(e),u;return r=r.normalize(),u=-1*(r.x*n.x+r.y*n.y+r.z*n.z),new vt(r.x,r.y,r.z,u,null)};vt.createFromPointAndNormal=function(n,t){var i=-1*(t.x*n.x+t.y*n.y+t.z*n.z);return new vt(t.x,t.y,t.z,i,n)};vt.intersectWithRay=function(t,i){var u,r;if(i.point===null)throw new Error("requires plane.point to not equal null");return(u=t.direction.dot(i.normal),n.isZero(u))?null:(r=i.point.subtract(t.origin).dot(i.normal)/t.direction.dot(i.normal),r<=0)?null:t.origin.add(t.direction.multiplyScalar(r))};vt.prototype={transformNormal:function(n){var i=n.inverse().transpose(),t=i.transformVector3(this.normal);return new e(t.x,t.y,t.z)},toString:function(){return"A:"+this.a+", B:"+this.b+", C:"+this.c+", D:"+this.d}};l.createIdentity=function(){return new l(1,0,0,0)};l.fromRotationMatrix=function(t){var f,r,i,u;if(i=new l(0,0,0,0),f=t.m11+t.m22+t.m33,f>n.zeroTolerance)i.w=Math.sqrt(f+1)*.5,r=1/(4*i.w),i.x=(t.m32-t.m23)*r,i.y=(t.m13-t.m31)*r,i.z=(t.m21-t.m12)*r;else{u=0;t.m22>t.m11?(u=1,t.m33>t.m22&&(u=2)):t.m33>t.m11&&(u=2);switch(u){case 0:i.x=.5*Math.sqrt(t.m11-t.m22-t.m33+1);r=1/(4*i.x);i.w=(t.m32-t.m23)*r;i.y=(t.m12+t.m21)*r;i.z=(t.m13+t.m31)*r;break;case 1:i.y=.5*Math.sqrt(t.m22-t.m11-t.m33+1);r=1/(4*i.y);i.w=(t.m13-t.m31)*r;i.x=(t.m12+t.m21)*r;i.z=(t.m23+t.m32)*r;break;case 2:i.z=.5*Math.sqrt(t.m33-t.m11-t.m22+1);r=1/(4*i.z);i.w=(t.m21-t.m12)*r;i.x=(t.m13+t.m31)*r;i.y=(t.m32+t.m23)*r}}return i};l.fromAxisAngle=function(n,t){var r,i;return r=.5*t,i=Math.sin(r),new l(Math.cos(r),n.x*i,n.y*i,n.z*i)};l.fromAxisAngleOut=function(n,t,i){var u,r;u=.5*t;r=Math.sin(u);i.w=Math.cos(u);i.x=n.x*r;i.y=n.y*r;i.z=n.z*r};l.slerp=function(t,i,r){var e,u,o,f,s,h;return t===0?i:t>=1?r:(e=i.dot(r),u=Math.acos(e),Math.abs(u)>=n.zeroTolerance)?(o=Math.sin(u),f=1/o,s=Math.sin((1-t)*u)*f,h=Math.sin(t*u)*f,i.multiplyScalar(s).add(r.multiplyScalar(h))):i};l.prototype={dot:function(n){return this.w*n.w+this.x*n.x+this.y*n.y+this.z*n.z},length:function(){return Math.sqrt(this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var i,t;return(i=this.length(),i<n.zeroTolerance)?new l(0,0,0,0):(t=1/i,new l(this.w*t,this.x*t,this.y*t,this.z*t))},inverse:function(){var i,t;return(i=this.w*this.w+this.x*this.x+this.y*this.y*this.z*this.z,Math.abs(i)>n.zeroTolerance)?(t=1/i,new l(this.w*t,-this.x*t,-this.y*t,-this.z*t)):new l(0,0,0,0)},conjugate:function(){return new l(this.w,-this.x,-this.y,-this.z)},transform:function(n){var i,r,t;return r=2*(this.x*n.x+this.y*n.y+this.z*n.z),t=2*this.w,i=t*this.w-1,new e(i*n.x+r*this.x+t*(this.y*n.z-this.z*n.y),i*n.y+r*this.y+t*(this.z*n.x-this.x*n.z),i*n.z+r*this.z+t*(this.x*n.y-this.y*n.x))},transformOut:function(n,t){var r,u,i;u=2*(this.x*n.x+this.y*n.y+this.z*n.z);i=2*this.w;r=i*this.w-1;t.x=r*n.x+u*this.x+i*(this.y*n.z-this.z*n.y);t.y=r*n.y+u*this.y+i*(this.z*n.x-this.x*n.z);t.z=r*n.z+u*this.z+i*(this.x*n.y-this.y*n.x)},add:function(n){return new l(this.w+n.w,this.x+n.x,this.y+n.y,this.z+n.z)},multiply:function(n){return new l(this.w*n.w-this.x*n.x-this.y*n.y-this.z*n.z,this.y*n.z-this.z*n.y+this.w*n.x+n.w*this.x,this.z*n.x-this.x*n.z+this.w*n.y+n.w*this.y,this.x*n.y-this.y*n.x+this.w*n.z+n.w*this.z)},multiplyOut:function(n,t){t.w=this.w*n.w-this.x*n.x-this.y*n.y-this.z*n.z;t.x=this.y*n.z-this.z*n.y+this.w*n.x+n.w*this.x;t.y=this.z*n.x-this.x*n.z+this.w*n.y+n.w*this.y;t.z=this.x*n.y-this.y*n.x+this.w*n.z+n.w*this.z},multiplyScalar:function(n){return new l(this.w*n,this.x*n,this.y*n,this.z*n)},toRotationMatrix:function(){var r,i,n,u,f,e,o,s,h,c,l,a;return r=2*this.x,i=2*this.y,n=2*this.z,u=r*this.w,f=i*this.w,e=n*this.w,o=r*this.x,s=i*this.x,h=n*this.x,c=i*this.y,l=n*this.y,a=n*this.z,new t(1-(c+a),s-e,h+f,0,s+e,1-(o+a),l-u,0,h-f,l+u,1-(o+c),0,0,0,0,1)},toAxisAngle:function(){var i,t;return(i=this.x*this.x+this.y*this.y+this.z*this.z,i>n.zeroTolerance)?(t=n.invSqrt(i),new f(this.x*t,this.y*t,this.z*t,2*Math.acos(this.w))):new f(1,0,0,0)},toString:function(){return"["+this.w+", "+this.x+", "+this.y+", "+this.z+"]"}};h.clone=function(n){return new h(n.x,n.y)};h.prototype={dot:function(n){return this.x*n.x+this.y*n.y},perp:function(){return new h(this.y,-this.x)},normalize:function(){var t,i;return(t=this.length(),t<n.zeroTolerance)?new h(0,0):(i=1/t,new h(this.x*i,this.y*i))},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},add:function(n){return new h(this.x+n.x,this.y+n.y)},subtract:function(n){return new h(this.x-n.x,this.y-n.y)},multiplyScalar:function(n){return new h(this.x*n,this.y*n)},equals:function(n){return this.x===n.x&&this.y===n.y},lerp:function(n,t){return new h(this.x+t*(n.x-this.x),this.y+t*(n.y-this.y))},toString:function(){return"["+this.x+", "+this.y+"]"}};e.createFromVector2=function(n,t){return new e(n.x,n.y,t)};e.clone=function(n){return new e(n.x,n.y,n.z)};e.prototype={dot:function(n){return this.x*n.x+this.y*n.y+this.z*n.z},normalize:function(){var i,t;return(i=this.length(),i<n.zeroTolerance)?new e(0,0,0):(t=1/i,new e(this.x*t,this.y*t,this.z*t))},normalizeOut:function(t){var r,i;if(r=this.length(),r<n.zeroTolerance){t.x=0;t.y=0;t.z=0;return}i=1/r;t.x=this.x*i;t.y=this.y*i;t.z=this.z*i;return},cross:function(n){return new e(this.y*n.z-this.z*n.y,this.z*n.x-this.x*n.z,this.x*n.y-this.y*n.x)},crossOut:function(n,t){t.x=this.y*n.z-this.z*n.y;t.y=this.z*n.x-this.x*n.z;t.z=this.x*n.y-this.y*n.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z},add:function(n){return new e(this.x+n.x,this.y+n.y,this.z+n.z)},subtract:function(n){return new e(this.x-n.x,this.y-n.y,this.z-n.z)},subtractOut:function(n,t){t.x=this.x-n.x;t.y=this.y-n.y;t.z=this.z-n.z},multiplyScalar:function(n){return new e(this.x*n,this.y*n,this.z*n)},multiplyScalarOut:function(n,t){t.x=this.x*n;t.y=this.y*n;t.z=this.z*n},equals:function(n){return this.x===n.x&&this.y===n.y&&this.z===n.z},lerp:function(n,t){return new e(this.x+t*(n.x-this.x),this.y+t*(n.y-this.y),this.z+t*(n.z-this.z))},toString:function(){return"["+this.x+", "+this.y+", "+this.z+"]"}};f.createFromVector3=function(n){return new f(n.x,n.y,n.z,1)};f.prototype={dot:function(n){return this.x*n.x+this.y*n.y+this.z*n.z+this.w*n.w},normalize:function(){var i,t;return(i=this.length(),i<n.zeroTolerance)?new f(0,0,0,0):(t=1/i,new f(this.x*t,this.y*t,this.z*t,this.w*t))},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSquared:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},add:function(n){return new f(this.x+n.x,this.y+n.y,this.z+n.z,this.w+n.w)},subtract:function(n){return new f(this.x-n.x,this.y-n.y,this.z-n.z,this.w-n.w)},multiplyScalar:function(n){return new f(this.x*n,this.y*n,this.z*n,this.w*n)},equals:function(n){return this.x===n.x&&this.y===n.y&&this.z===n.z&&this.w===n.w},lerp:function(n,t){return new f(this.x+t*(n.x-this.x),this.y+t*(n.y-this.y),this.z+t*(n.z-this.z),this.w+t*(n.w-this.w))},toString:function(){return"["+this.x+", "+this.y+", "+this.z+", "+this.w+"]"}};u={};u.rotatedPos=new e(0,0,0);u.viewSide=new e(0,0,0);u.viewUp=new e(0,0,0);u.createLookAtRHOut=function(n,t,i,r){var e=u.rotatedPos,o=u.viewSide,f=u.viewUp;t.normalizeOut(t);i.normalizeOut(i);t.multiplyScalarOut(i.dot(t),f);i.subtractOut(f,f);f.normalizeOut(f);t.crossOut(f,o);r.m11=o.x;r.m12=o.y;r.m13=o.z;r.m21=f.x;r.m22=f.y;r.m23=f.z;r.m31=-t.x;r.m32=-t.y;r.m33=-t.z;r.transformVector3Out(n,e);r.m14=-e.x;r.m24=-e.y;r.m34=-e.z};u.createPerspective=function(n,i,r,u,f){var e;return e=1/Math.tan(n/2),new t(e/i,0,f.x*2,0,0,e,f.y*2,0,0,0,u/(u-r),-(r*u)/(u-r),0,0,-1,0)};u.createPerspectiveFromFrustumOut=function(n,t,i,r,u,f,e){e.m11=2*u/(t-n);e.m12=0;e.m13=(t+n)/(t-n);e.m14=0;e.m21=0;e.m22=2*u/(r-i);e.m23=(r+i)/(r-i);e.m24=0;e.m31=0;e.m32=0;e.m33=-1*(f+u)/(f-u);e.m34=-2*f*u/(f-u);e.m41=0;e.m42=0;e.m43=-1;e.m44=0};u.createPerspectiveOGLOut=function(n,t,i,r,f){var e=i*Math.tan(n/2),o=-e,s=o*t,h=e*t,c=i,l=r;u.createPerspectiveFromFrustumOut(s,h,o,e,c,l,f)};u.projectOntoPlane=function(n,i){var r=n,u=i.normal,f=i.d,e=u.dot(r),o=e+f-r.x*u.x,s=-r.x*u.y,h=-r.x*u.z,c=-r.x*f,l=-r.y*u.x,a=e+f-r.y*u.y,v=-r.y*u.z,y=-r.y*f,p=-r.z*u.x,w=-r.z*u.y,b=e+f-r.z*u.z,k=-r.z*f,d=-u.x,g=-u.y,nt=-u.z,tt=e;return new t(o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt)};u.createViewportToScreen=function(n,i){var r=t.createIdentity();return r.m11=n/2,r.m12=0,r.m13=0,r.m14=0,r.m21=0,r.m22=i/-2,r.m23=0,r.m24=0,r.m31=0,r.m32=0,r.m33=1,r.m34=0,r.m41=n/2,r.m42=i/2,r.m43=0,r.m44=1,r.transpose()};u.parseQuaternion=function(t,i,r){var u=1-(t*t+i*i+r*r);return u<n.zeroTolerance&&(u=0),new l(Math.sqrt(u),t,i,r)};u._halfCube=.5;u._halfCubeSquared=u._halfCube*u._halfCube;u._cubeSide=u._halfCube*2;u._dummyCornerBase=[new f(0,1,0,1),new f(0,0,0,1),new f(1,0,0,1),new f(1,1,0,1),];u.cubeSideBase=[new f(0,0,0,1),new f(0,u._cubeSide,0,1),new f(u._cubeSide,u._cubeSide,0,1),new f(u._cubeSide,0,0,1),];u._texelCornersBase=[new f(0,1,0,1),new f(0,0,0,1),new f(1,0,0,1),new f(1,1,0,1),];u.splitSquareRecursive=function(n,t,i,r,e,o,s,h,c,l,a){function it(n,t,i){var a=n[0],b=n[1],k=n[2],d=n[3],e=-1,v=null,y=null,p=null,w=null,r=u.splitFunction;i?(v=i[0],y=i[1],p=i[2],w=i[3]):(v=u._dummyCornerBase[0],y=u._dummyCornerBase[1],p=u._dummyCornerBase[2],w=u._dummyCornerBase[3]);var ot=a.x,st=a.y,ht=a.z,o=a.w,ct=v.x,lt=v.y,at=b.x,vt=b.y,ft=b.z,yt=y.x,pt=y.y,wt=k.x,bt=k.y,kt=k.z,dt=p.x,gt=p.y,ni=d.x,ti=d.y,et=d.z,ii=w.x,ri=w.y,g=r(t,ot,at,ct,yt),s=r(t,st,vt,lt,pt),ui=r(t,ht,ft,e,e),h=r(t,at,wt,yt,dt),nt=r(t,vt,bt,pt,gt),fi=r(t,ft,kt,e,e),tt=r(t,wt,ni,dt,ii),c=r(t,bt,ti,gt,ri),ei=r(t,kt,et,e,e),l=r(t,ot,ni,ct,ii),it=r(t,st,ti,lt,ri),oi=r(t,ht,et,e,e),si=r(t,h.xy,l.xy,h.uv,l.uv),hi=r(t,s.xy,c.xy,s.uv,c.uv),ci=r(t,ft,et,e,e),rt=new f(si.xy,hi.xy,ci.xy,o),ut=new f(si.uv,hi.uv,0,1);return{xy:[[a,new f(g.xy,s.xy,ui.xy,o),rt,new f(l.xy,it.xy,oi.xy,o),],[new f(g.xy,s.xy,ui.xy,o),b,new f(h.xy,nt.xy,fi.xy,o),rt,],[rt,new f(h.xy,nt.xy,fi.xy,o),k,new f(tt.xy,c.xy,ei.xy,o),],[new f(l.xy,it.xy,oi.xy,o),rt,new f(tt.xy,c.xy,ei.xy,o),d,],],uv:i?[[v,new f(g.uv,s.uv,0,1),ut,new f(l.uv,it.uv,0,1),],[new f(g.uv,s.uv,0,1),y,new f(h.uv,nt.uv,0,1),ut,],[ut,new f(h.uv,nt.uv,0,1),p,new f(tt.uv,c.uv,0,1),],[new f(l.uv,it.uv,0,1),ut,new f(tt.uv,c.uv,0,1),w,],]:null}}var v,y,k;if(h||(h=function(n,t,i){n.squares.push(t);n.texelSquares.push(i)}),n.length!=4)throw new Error("Invalid square array supplied.");if(i==0){var p=n[0],w=n[2],d=o?(p.x+w.x)/2:p.x,g=o?(w.y+p.y)/2:w.y;n.x=r?Math.floor((d-r.initialX)/r.widthFr):0;n.y=r?Math.floor(r.total-(g-r.initialY)/r.heightFr):0;e&&h(e,n,t||s,c,l,a);return}var b=n[0],nt=n[1],tt=n[3];for(r=r||function(){var n=Math.pow(2,i),t=b.x,r=b.y;return{total:n,widthFr:Math.abs((tt.x-t)/n),heightFr:Math.abs((nt.y-r)/n),initialX:t,initialY:r}}(),v=it(n,o,t),i--,y=0,k=v.xy.length;y<k;y++)u.splitSquareRecursive(v.xy[y],v.uv?v.uv[y]:null,i,r,e,o,s,h,c,l,a);return};u.splitFunction=function(n,t,i,r,f){function e(n,t,i,r,u){var f=Math.sqrt(u+n*n),e=Math.sqrt(u+t*t),o=e/(f+e),s=f/(f+e);return{xy:n*o+t*s,uv:i*o+r*s}}function o(n,t,i,r){return{xy:(n+t)/2,uv:(i+r)/2}}return n?e(t,i,r,f,u._halfCubeSquared):o(t,i,r,f)};u.CalculatePolyArea=function(n,t){var i=t?[]:n,f=0,r,o,e,u;if(t)for(e=0;e<n.length;e++)r=n[e],i.push(new h(r.x*t.width,r.y*t.height));for(u=0;u<i.length-1;u++)r=i[u],o=i[u+1],f+=r.x*o.y-o.x*r.y;return f+=i[i.length-1].x*i[0].y-i[0].x*i[i.length-1].y,f/=2,Math.abs(f)};u.AreIntersecting=function(t,i){function v(n,t){for(var r,i=null,u=0;u<n.length;u++)r=n[u].x*t.x+n[u].y*t.y,i==null&&(i={min:r,max:r}),r<i.min?i.min=r:r>i.max&&(i.max=r);return i}function y(n){for(var f=[],i=n.length-1,t=0;t<n.length;t++){var r=n[t].x-n[i].x,u=n[t].y-n[i].y,e=Math.sqrt(r*r+u*u),o={x:r/e,y:-u/e};i=t;f.push(o)}return f}var p=y(t),w=y(i),r=p.concat(w),u,s,f,h,a,e,o,c,l;n:for(u=0;u<r.length;u++)for(s=r[u],f=u+1;f<r.length-1;f++)if(h=r[f],a=n.isZero(1-Math.abs(s.x*h.x+s.y*h.y)),a){delete r[u];continue n}for(e=0;e<r.length;e++)if((o=r[e],o)&&(c=v(t,o),l=v(i,o),c.max<l.min||l.max<c.min))return!1;return!0};u.applyWorldTransformation=function(n,t){for(var r=[],u=n.length,i=0;i<u;i++)r.push(t.transformVector4(n[i]));return r};u.calculateTexelToPixelRatioAtFov=function(n,t,i,r){var u=n*Math.tan(r/2);return t*u/i};u.calculateFovAtTexelToPixelRatio=function(n,t,i,r){return Math.atan(r*i/(t*n))*2};var it={debug:!1,forceIERenderPath:!0,outputMultiLODTiles:!0,scanConvertSize:40,polyInflate:.05},ei=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.webkitRequestAnimationFrame||function(n){setTimeout(n,1e3/60)},hr=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;i={getCssColorString:function(n){return i.getCssColorStringRGBA(n.r,n.g,n.b,n.a)},getCssColorStringRGBA:function(n,t,i,r){return"rgba("+n*255+","+t*255+","+i*255+","+r+")"},deleteFromArray:function(n,t){for(var i=0,r=n.length;i<r;)t(n[i])&&n.splice(i,1),i++},log:function(n){window.console&&g.debugEnabled&&window.console.log(n)},_eventListeners:{},bind:function(n,t,r,u){for(var e=t.split(" "),f=0;f<e.length;++f)t=e[f],i._eventListeners[n]||(i._eventListeners[n]={}),i._eventListeners[n][t]||(i._eventListeners[n][t]=[]),n.addEventListener?(t=="mousewheel"&&n.addEventListener("DOMMouseScroll",r,u),n.addEventListener(t,r,u)):n.attachEvent&&(n.attachEvent("on"+t,r),u&&n.setCapture&&n.setCapture()),i._eventListeners[n][t].push([r,u])},_unbindAll:function(n){var t,r;if(i._eventListeners[n])for(t in i._eventListeners[n])for(r=0;r<i._eventListeners[n][t].length;++r)i.unbind(n,t,i._eventListeners[n][t][r][0],i._eventListeners[n][t][r][1])},unbind:function(n,t,r,u){if(n&&!t)i._unbindAll(n);else{for(var f,h,o,s=t.split(" "),e=0;e<s.length;++e)if(t=s[e],n.removeEventListener?(t=="mousewheel"&&n.removeEventListener("DOMMouseScroll",r,u),n.removeEventListener(t,r,u)):n.detachEvent&&(n.detachEvent("on"+t,r),u&&n.releaseCapture&&n.releaseCapture()),i._eventListeners[n]&&i._eventListeners[n][t]){for(f=0;f<i._eventListeners[n][t].length;++f)i._eventListeners[n][t][f][0]===r&&i._eventListeners[n][t][f].splice(f,1);i._eventListeners[n][t].length===0&&delete i._eventListeners[n][t]}if(o=0,i._eventListeners[n]){for(h in i._eventListeners[n])++o;o===0&&delete i._eventListeners[n]}}},setOpacity:function(){function t(n,t){n.style.opacity=t}function i(n,t){t*=100;var i;try{i=n.filters.item("DXImageTransform.Microsoft.Alpha");t<100?(i.Opacity=t,i.enabled||(i.enabled=!0)):i.enabled=!1}catch(r){t<100&&(n.style.filter=(n.currentStyle||n.runtimeStyle).filter+" progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")")}}var n=document.createElement("div");return typeof n.style.opacity!="undefined"&&t||typeof n.style.filter!="undefined"&&i||function(){}}(),css:function(n,t){for(var r in t)t.hasOwnProperty(r)&&(r==="opacity"?i.setOpacity(n,t[r]):n.style[r]=t[r])},getWheelDelta:function(n){return n.detail?n.detail*-1:n.wheelDelta/40},isDataUrl:function(n){return/^data:/.test(n)},isRelativeUrl:function(n){var t=/^ftp:\/\//.test(n)||/^http:\/\//.test(n)||/^https:\/\//.test(n)||/^file:\/\//.test(n);return!t},hostnameRegexp:new RegExp("^(?:f|ht)tp(?:s)?://([^/]+)","im"),filehostnameRegexp:new RegExp("^file://([^/]+)","im"),getHostname:function(n){var t=i.hostnameRegexp.exec(n);return t&&t.length===2||(t=i.filehostnameRegexp.exec(n)),t&&t.length===2?t[1].toString():""},areSameDomain:function(n,t){var r=i.getHostname(n).toLowerCase(),u=i.getHostname(t).toLowerCase();return r===u},addScriptElement:function(n){var t=document.createElement("script");t.type="text/javascript";t.language="javascript";t.src=n;document.getElementsByTagName("head")[0].appendChild(t)},partialDotNetStringFormat:function(n){var t,o,u,e,s,i,f,r;if(arguments.length===0)return"";if(arguments.length===1)return n;for(t="",o=0;o<n.length;){if(u=n.indexOf("{"),u===-1)return t+n;if(t+=n.substr(0,u),n=n.substr(u),e=n.indexOf("}"),s=n.substr(1,e-1),n=n.substr(e+1),i=s.split(":"),f=arguments[parseInt(i[0])+1],i.length===1)t+=f.toString();else if(i[1]==="X")t+=f.toString(16).toUpperCase();else{for(r=f.toString();r.length<i[1].length;)r="0"+r;t+=r}}return t}};ut.prototype.map={};ut.prototype._innerArray=[];ut.prototype._changed=!0;ut.prototype.add=function(n,t){this.map[n]=t;this._changed=!0};ut.prototype.remove=function(n){this._changed|=!!this.map[n];delete this.map[n]};ut.prototype.getArray=function(){var n=this._innerArray,t,i;if(this._changed){t=this.map;n.length=0;for(i in t)n.push(t[i]);this._changed=!1}return n};ut.prototype.dispose=function(){this.map=null;this._innerArray.length=0;this._innerArray=null};o={};o.getFlattening=function(){return 1/298.257222101};o.getEccentricity2=function(){return o.getFlattening()*(2-o.getFlattening())};o.getInvOneMinusEcc=function(){return 1/(1-o.getEccentricity2())};o.getMajorRadiusInUnits=function(){return 6378137};o.fromLatLongAlt=function(t,i,r){var s=n.degreesToRadians(t),h=n.degreesToRadians(i),u=Math.sin(s),c=Math.cos(s),l=Math.sin(h),a=Math.cos(h),f=o.getMajorRadiusInUnits()/Math.sqrt(1-o.getEccentricity2()*u*u);return new e((f+r)*c*a,(f+r)*c*l,(f*(1-o.getEccentricity2())+r)*u)};o.toLatLongAlt=function(t){if(t.x==0&&t.y==0&&t.z==0)return new e(0,0,0);var h,c,u,f=Math.sqrt(t.x*t.x+t.y*t.y),r=t.z,i,s,a,v,l;return(v=Math.atan2(t.y,t.x),isNaN(v)&&(v=Math.atan2(t.y,t.x),isNaN(v)))?new e(0,0,0):(i=f*(1-o.getFlattening()),s=1/Math.sqrt(r*r+i*i),a=Math.atan2(r,i),h=r*s,c=i*s,u=o.getMajorRadiusInUnits(),l=f>1?f/c-u:t.z>0?t.z-o.getMajorRadiusInUnits()*(1-o.getFlattening()):-t.z-o.getMajorRadiusInUnits()*(1-o.getFlattening()),i=f*(1-o.getEccentricity2()*u/(u+l)),s=1/Math.sqrt(r*r+i*i),a=Math.atan2(r,i),h=r*s,c=i*s,u=o.getMajorRadiusInUnits()/Math.sqrt(1-o.getEccentricity2()*h*h),l=f>1?f/c-u:t.z>0?t.z-o.getMajorRadiusInUnits()*(1-o.getFlattening()):-t.z-o.getMajorRadiusInUnits()*(1-o.getFlattening()),i=f*(1-o.getEccentricity2()*u/(u+l)),s=1/Math.sqrt(r*r+i*i),a=Math.atan2(r,i),h=r*s,c=i*s,u=o.getMajorRadiusInUnits()/Math.sqrt(1-o.getEccentricity2()*h*h),l=f>1?f/c-u:t.z>0?t.z-o.getMajorRadiusInUnits()*(1-o.getFlattening()):-t.z-o.getMajorRadiusInUnits()*(1-o.getFlattening()),i=f*(1-o.getEccentricity2()*u/(u+l)),s=1/Math.sqrt(r*r+i*i),a=Math.atan2(r,i),h=r*s,c=i*s,u=o.getMajorRadiusInUnits()/Math.sqrt(1-o.getEccentricity2()*h*h),l=f>1?f/c-u:t.z>0?t.z-o.getMajorRadiusInUnits()*(1-o.getFlattening()):-t.z-o.getMajorRadiusInUnits()*(1-o.getFlattening()),new e(n.radiansToDegrees(a),n.radiansToDegrees(v),l))};o.getSurfaceNormalFromLatLong=function(n,t){var i=o.fromLatLongAlt(n,t,0);return i.z*=o.getInvOneMinusEcc(),i.normalize()};o.getSurfaceNormalFromPoint=function(n){var t=o.toLatLongAlt(n);return o.getSurfaceNormalFromLatLong(t.x,t.y)};o.getLocalToGlobalRotation=function(i,r){var u=t.createRotationX(Math.PI-i),f=t.createRotationZ(n.halfPI+r),e=t.createRotationY(Math.PI);return f.multiply(u).multiply(e)};o.getGlobalToLocalRotation=function(n,t){return o.getLocalToGlobalRotation(n,t).inverse()};ai.prototype.GetVertex=function(n){return this._vertexCache=this._vertexCache||new Array(this.geometryPolyArr.length),this._vertexCache[n]===undefined&&(this._vertexCache[n]={g:this.screenArray[n],t:this.textureArray[n]}),this._vertexCache[n]};rt.Wrap={CLAMP_TO_EDGE:1,REPEAT:2};rt.Filter={NEAREST:0,LINEAR:1,LINEAR_MIPMAP_LINEAR:2};s(rt,Object);rt.prototype.loadImageInDOM=function(){this._image=new Image;var n=this;this._image.onload=function(){n._loadCallback&&n._loadCallback(n._url,n._loadCallbackInfo,n);n._isReady=!0;n._isDirty=!0};this._image.crossOrigin="";this._image.src=this._url};s(bt,Object);bt.prototype.apply=function(){throw new Error("You should not have reached base Material.apply().");};s(ki,bt);s(di,t);di.prototype.apply=function(){throw new Error("You should not have reached base Transform.apply().");};s(ar,Object);s(v,Object);v.prototype.render=function(){throw new Error("The renderer you are using does not implement the render() method.");};v.prototype.setViewModel=function(n){this._viewModel=n};v.prototype._checkColor=function(n){if(!n||n.r==null||n.g==null||n.b==null||n.a==null)throw new Error("Color must include r,g,b,a numeric properties.");};v.prototype.setBackGroundColor=function(n){n?(this._checkColor(n),this._backgroundDiv.style.display="block",this._backgroundDiv.style.backgroundColor=i.getCssColorString(n)):this._backgroundDiv.style.display="none"};v.prototype._updateBackgroundSize=function(n,t){i.css(this._backgroundDiv,{width:n+"px",height:t+"px"})};v.prototype._layerIdBackground="BACKGROUND";v.prototype._initBackground=function(){var n=document.createElement("div"),t=this._width,r=this._height;this._backgroundDiv=n;this._window.appendChild(n);n.id=this._layerIdBackground;i.css(n,{width:t+"px",height:r+"px",position:"absolute",opacity:1,zIndex:0})};v.prototype._error=function(n){if(it.debug)throw new Error(n);};v.prototype.setViewProjectionMatrix=function(n){this._viewProjMatrix=n};v.prototype.getType=function(){throw new Error("Renderer must support one of the rendering techniques such as '2D', '3D' etc.");};v.prototype.initLayer=function(){throw new Error("Reached Renderer.prototype.initLayer() instead of concrete implementation.");};v.prototype.finalizeLayer=function(){throw new Error("Reached Renderer.prototype.finalizeLayer() instead of concrete implementation.");};v.prototype.disposeLayer=function(n){var t=this._layers[n];t&&(this._window.removeChild(t),delete this._layers[n])};v.prototype.updateAnimation=function(n,t,i){n.animation===undefined&&(n.animation=i());var r=n.animation;r&&(n.id.levelOfDetail!=n.worldLod.value?(r.finalize(n),n.animation=null):(r.apply(n),r.isComplete()&&(r.finalize(n),n.animation=null)))};s(or,ar);y.InitRenderableFor3D=function(n){var s=2,t=n.geometryPolygon[0],i=n.geometryPolygon[1],r=n.geometryPolygon[2],u=n.geometryPolygon[3],f;n.geometryPolygon._vertices=[t.x,t.y,t.z,i.x,i.y,i.z,r.x,r.y,r.z,u.x,u.y,u.z,];f=n.texturesWithPolygons[0].polygon;t=f[0];i=f[1];r=f[2];u=f[3];var h=n.texturesWithPolygons[0].texture,e=h.dataSourceWidth+s,o=h.dataSourceHeight+s;n.geometryPolygon._texCoords=[i.x/e,i.y/o,t.x/e,t.y/o,u.x/e,u.y/o,r.x/e,r.y/o,];n.geometryPolygon._indices=[0,1,2,0,2,3];n.geometryPolygon._texCoordSize=2;n.geometryPolygon._isDirty=!0};y.DrawPolyLine=function(n,t,r){n.beginPath();r&&(i.log("===================Quad========================="),i.log("x: "+t[0].x+" y: "+t[0].y));n.moveTo(t[0].x,t[0].y);for(var u=1;u<t.length;u++)r&&i.log("x: "+t[u].x+" y: "+t[u].y),n.lineTo(t[u].x,t[u].y);n.lineTo(t[0].x,t[0].y);r&&i.log("===================STROKE=========================");n.stroke()};y.FilterType={NORMFACTOR:8};y.FilterType.NO_FILTER=[0,0,0,0,1,0,0,0,0];y.FilterType.GAUSSIAN=[1/16,2/16,1/16,2/16,4/16,2/16,1/16,2/16,1/16,];y.FilterType.LAPLACIAN=[-1/y.FilterType.NORMFACTOR,-1/y.FilterType.NORMFACTOR,-1/y.FilterType.NORMFACTOR,-1/y.FilterType.NORMFACTOR,17/y.FilterType.NORMFACTOR,-1/y.FilterType.NORMFACTOR,-1/y.FilterType.NORMFACTOR,-1/y.FilterType.NORMFACTOR,-1/y.FilterType.NORMFACTOR,];k=new function(){var n=navigator.userAgent,o=navigator.vendor==="Apple Computer, Inc.",h=n.indexOf("Webkit"),u=n.indexOf("Chrome"),t=u!==-1,f=n.indexOf("Firefox"),i=f!==-1,r=t?parseInt(n.substring(u+7)):-1,e=i?parseInt(n.substring(f+8)):-1,s=n.indexOf("Trident")!==-1;this.isWebGLCORSSupported=t&&r>=13||i&&e>=8;this.failsToRenderItemsNearContainerBorder=t&&r<=19;this.isWebGLCORSRequired=i&&e>4||t&&r>=13;this.useImageDisposer=o;this.supportsPreserve3D=!s&&!i};st={};st.isValidBrowser=function(){var u=window.CSSMatrix||window.WebKitCSSMatrix||window.MSCSSMatrix||window.MozCSSMatrix,f,e,i,t,n,r;return u==null||k.failsToRenderItemsNearContainerBorder?(st.isValidBrowser=function(){return!1},!1):(f=new u,!f)?(st.isValidBrowser=function(){return!1},!1):(e=document.createElement("div"),i=e.style,i.webkitTransform===undefined&&i.msTransform===undefined&&i.mozTransform===undefined)?(st.isValidBrowser=function(){return!1},!1):k.supportsPreserve3D?(t=document.createElement("div"),n=t.style,n.width="0px",n.height="0px",n.position="absolute",n.overflowX="hidden",n.overflowY="hidden",n.backgroundColor="rgb(0, 0, 0)",t.innerHTML='<div style="position: absolute; z-index: -10; -webkit-transform: matrix3d(772.413793, 0, 0, 0, 0, 772.413793, 0, 0, -537600, -315000, -1050.021, -1050, -772.413793, -112072.413793, 525.0085, 525); -ms-transform: matrix3d(772.413793, 0, 0, 0, 0, 772.413793, 0, 0, -537600, -315000, -1050.021, -1050, -772.413793, -112072.413793, 525.0085, 525); -moz-transform: matrix3d(772.413793, 0, 0, 0, 0, 772.413793, 0, 0, -537600, -315000, -1050.021, -1050, -772.413793, -112072.413793, 525.0085, 525); transform: matrix3d(772.413793, 0, 0, 0, 0, 772.413793, 0, 0, -537600, -315000, -1050.021, -1050, -772.413793, -112072.413793, 525.0085, 525); "><div id="_rwwviewer_cssrenderer_test_id" style="width: 256px; height: 256px;"><\/div><\/div>',document.body.appendChild(t),r=document.getElementById("_rwwviewer_cssrenderer_test_id").getClientRects()[0],document.body.removeChild(t),Math.abs(r.width-377)<=1&&Math.abs(r.height-377)<=1?(st.isValidBrowser=function(){return!0},!0):(st.isValidBrowser=function(){return!1},!1)):(st.isValidBrowser=function(){return!0},!0)};ht={};ht.getWebGLContext=function(n){var i,t,r;if(n.getContext)for(i=["webgl","experimental-webgl","webkit-3d","moz-webgl",],t=0;t<i.length;++t)try{if(r=n.getContext(i[t],{antialias:!0}),r!=null)return r}catch(u){}return null};ht.isValidBrowser=function(){if(navigator.userAgent.indexOf("Trident/7.0")>=0)return!1;var n=document.createElement("canvas"),t=ht.getWebGLContext(n);if(t){if(k.isWebGLCORSRequired&&!k.isWebGLCORSSupported)return i.log("CORS image textures are not supported in this browser"),ht.isValidBrowser=function(){return!1},!1}else return i.log("WebGL is not supported."),ht.isValidBrowser=function(){return!1},!1;return ht.isValidBrowser=function(){return!0},!0};fi=window.CSSMatrix||window.WebKitCSSMatrix||window.MSCSSMatrix||window.MozCSSMatrix;s(c,v);c.prototype._initNewCss3dDiv=function(n,t){var u=document.createElement("div"),f,r;u.width=this._width;u.height=this._height;u.zIndex=t;f=document.createElement("div");i.css(f,{width:this._width+"px",height:this._height+"px",position:"absolute",webkitTransformStyle:"flat",msTransformStyle:"flat",mozTransformStyle:"flat",zIndex:t});r=document.createElement("div");r.width=this._width;r.height=this._height;r.style.position="absolute";r.style.zIndex=t;f.appendChild(r);u.appendChild(f);k.supportsPreserve3D&&!it.forceIERenderPath&&(r.style.webkitTransformStyle="preserve-3d",r.style.webkitTransform="matrix3d(1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1)",r.style.mozTransformStyle="preserve-3d",r.style.mozTransform="matrix3d(1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1)");this._window.appendChild(u);this._layers[n]={rootElement:u,flatten3D:f,viewportDiv:r,zOrder:t}};c.prototype.ignoreEvent=function(){return!1};c.prototype.setStyleProperties=function(n){k.supportsPreserve3D&&!it.forceIERenderPath&&(n.style.webkitTransformStyle="preserve-3d",n.style.mozTransformStyle="preserve-3d");n.style.position="absolute"};c.prototype.clearStyleProperties=function(n){n.style.webkitTransformStyle="";n.style.msTransformStyle="";n.style.mozTransformStyle="";n.style.position=""};c.prototype.setViewportSize=function(n,t){var o,i,r,f,e;this._width=n;this._height=t;this._updateBackgroundSize(n,t);for(o in this._layers)i=this._layers[o],r=i.rootElement,r.width=n,r.height=t,f=i.flatten3D,f.width=n,f.height=t,e=i.viewportDiv,e.width=n,e.height=t;this._viewportToScreenTransform=u.createViewportToScreen(this._width,this._height)};c.prototype.invertYAxisMatrix=t.createScale(1,-1,1);c.prototype.transformOrigin="0px 0px 0";c.prototype.transformStyle="preserve-3d";gi=function(n,t){n.style.webkitTransform=t;n.style.msTransform=t;n.style.mozTransform=t};c.prototype.updateTransforms=function(n,t,i){var u,r;if(r=new fi,r.m11=1,r.m12=0,r.m13=0,r.m14=0,r.m21=0,r.m22=1,r.m23=0,r.m24=0,r.m31=0,r.m32=0,r.m33=1,r.m34=0,r.m41=0,r.m42=0,r.m43=0,r.m44=1,n||(n=i.rootElement),t||(t=r),n.$$matrixTransform&&(t=t.multiply(n.$$matrixTransform)),n.childNodes.length===0||n.$$isLeaf)gi(n,t);else for(gi(n,r),u=0;u<n.childNodes.length;++u)this.updateTransforms(n.childNodes[u],t,null)};c.prototype.render=function(n,t,i,r){var l=!1,f=this._layers[n],b,a,d,u,c,p,e,v,y,o,s,w,h;if(!f)throw new Error("trying to render on a non-existing div "+n);if(t?(t.apply(f.rootElement),f.associatedAnimation=t,l=!0):f.associatedAnimation!=null&&(f.associatedAnimation.finalize(f.rootElement),f.associatedAnimation=null),f.finalized)return!0;for(b=this._viewportToScreenTransform.multiply(this._viewProjMatrix.multiply(this.invertYAxisMatrix)),this.setCSS3DViewProjection(b,f),p=this._viewModel.getRenderables(n).getArray(),d=p.length,a=0;a<d;a++)if(e=p[a],v=e.id,u=null,c=e.texturesWithPolygons[0].texture,c._isReady&&(u=c._image),u!==null){if(y=f.zOrder+v.levelOfDetail,!c._isDirty){u.parentNode&&this.setCSS3DTransform(u.parentNode,u,e.transform,y);this.updateAnimation(e,t,r);l|=e.animation!=null;continue}u._order=y;u.style.zIndex=y;u.parentNode&&this._error("Expected imageElement with no parent");this.setStyleProperties(u);o=document.createElement("div");s=o.style;o.id=v.id;s.position="absolute";s.zIndex=u.style.zIndex;k.supportsPreserve3D&&!it.forceIERenderPath?(s.webkitTransformOrigin=this.transformOrigin,s.webkitTransformStyle=this.transformStyle,s.mozTransformOrigin=this.transformOrigin,s.mozTransformStyle=this.transformStyle):o.$$isLeaf=!0;o.appendChild(u);this.setCSS3DTransform(o,u,e.transform,v.levelOfDetail);f.viewportDiv.appendChild(o);c._isDirty=!1;this.updateAnimation(e,t,r);l|=e.animation!=null}if((!k.supportsPreserve3D||it.forceIERenderPath)&&this.updateTransforms(null,null,f),w=!1,this._frameCallbacks){for(h=0;h<this._frameCallbacks.length;h++)this._frameCallbacks[h].count>0?w=!0:this._frameCallbacks[h].count==0&&this._frameCallbacks[h].cb(),this._frameCallbacks[h].count--;w||(this._frameCallbacks=[])}return l};c.prototype.preTransform=t.createIdentity();c.prototype.elementTransform=t.createIdentity();c.prototype.setCSS3DTransform=function(n,i,r){var e=Math.max(i.height||0,i.naturalHeight||0),f,u;this.invertYAxisMatrix.multiplyOut(t.createTranslation(0,-e,0),this.preTransform);r.multiplyOut(this.preTransform,this.elementTransform);f=this.invertYAxisMatrix.multiply(this.elementTransform);f=f.transpose();u=new fi;u.m11=f.m11;u.m12=f.m12;u.m13=f.m13;u.m14=f.m14;u.m21=f.m21;u.m22=f.m22;u.m23=f.m23;u.m24=f.m24;u.m31=f.m31;u.m32=f.m32;u.m33=f.m33;u.m34=f.m34;u.m41=f.m41;u.m42=f.m42;u.m43=f.m43;u.m44=f.m44;k.supportsPreserve3D&&!it.forceIERenderPath?(n.style.webkitTransform=u,n.style.mozTransform=u,n.style.msTransform=u):n.$$matrixTransform=u};c.prototype.setCSS3DViewProjection=function(n,t){var r=n.transpose(),i=new fi,u;i.m11=r.m11;i.m12=r.m12;i.m13=r.m13;i.m14=r.m14;i.m21=r.m21;i.m22=r.m22;i.m23=r.m23;i.m24=r.m24;i.m31=r.m31;i.m32=r.m32;i.m33=r.m33;i.m34=r.m34;i.m41=r.m41;i.m42=r.m42;i.m43=r.m43;i.m44=r.m44;u=t.viewportDiv;k.supportsPreserve3D&&!it.forceIERenderPath?(u.style.webkitTransform=i,u.style.mozTransform=i,u.style.msTransform=i):u.$$matrixTransform=i};c.prototype.initLayer=function(n,t){this._initNewCss3dDiv(n,t)};c.prototype.finalizeLayer=function(n){var t=this._layers[n];t&&(t.finalized=!0)};c.prototype.disposeLayer=function(n){var t=this._layers[n];t&&this._window.removeChild(t.rootElement)};c.prototype.getType=function(){return"3D"};c.prototype.syncRemovedRenderables=function(n){for(var f,o,t,r,e=this._viewModel.getDelta(n).removed,s=this._viewModel.getRenderables(n).map,u=0,h=e.length;u<h;u++)(f=e[u].viewElementId.id,o=s[f],o)&&(r=this._window.querySelector("#"+f),r?(t=r.firstChild,t?(this.clearStyleProperties(t),t.parentNode&&t.parentNode.removeChild(t)):this._error("Expected imgElement"),r.parentNode&&r.parentNode.removeChild(r)):i.log("Cannot find and remove element"))};s(w,v);w.prototype.MAX_CONTEXTS=5;w.prototype._getCanvasFromCache=function(n,t){for(var i,r,f,u=0,e=this._contextCache.length;u<e;u++)if(i=this._contextCache[u],i){if(i.isFree)return i.id=n,i.style.zIndex=t,i.isFree=!1,i.width=this._width,i.height=this._height,r=i._gl,r.viewportWidth=this._width,r.viewportHeight=this._height,r.viewport(0,0,r.viewportWidth,r.viewportHeight),r.clear(r.DEPTH_BUFFER_BIT),i;continue}else return f=this._initNewCanvas(n,t),this._contextCache[u]=f,f;throw new Error("Out of canvas context cache! Too many datasources to render.");};w.prototype._initNewCanvas=function(n,t){var u=document.createElement("canvas"),r;if(u.id=n,u.width=this._width,u.height=this._height,u._gl=ht.getWebGLContext(u),u._gl){if(k.isWebGLCORSRequired&&!k.isWebGLCORSSupported)throw new Error("CORS image textures are not supported in this browser");}else throw new Error("WebGL is not supported.");return r=u._gl,r.viewportWidth=this._width,r.viewportHeight=this._height,r.viewport(0,0,r.viewportWidth,r.viewportHeight),r.clearDepth(1),r.disable(r.DEPTH_TEST),r.disable(r.CULL_FACE),this.init(u),i.css(u,{position:"absolute",left:0,top:0,zIndex:t}),u};w.prototype.init=function(n){var t=n._gl,e,i,u,o,r,f;if(n._vs=lr(t,t.VERTEX_SHADER,"                 uniform mat4 u_modelViewProjMat;                  uniform mat4 u_localMat;                                   /* the following can be optimized into one vec4 */                  uniform vec2 u_opacityBE, u_xBE, u_yBE, u_rotateBE;                  uniform vec2 u_sxBE, u_syBE;                  uniform float u_texW, u_texH;                  attribute vec3 a_pos;                  attribute vec2 a_texCoord;                  varying vec2 v_texCoord;                  varying float v_opacity;                                   void main()                  {                     float opacity, x, y, rotate;                     mat4 finalMat;                     float a;                                          finalMat = u_modelViewProjMat;                     opacity = u_opacityBE[0];                                          vec4 pos = finalMat * vec4(a_pos, 1.0);                     v_texCoord = a_texCoord.xy;                     v_opacity = opacity;                     gl_Position = pos;                  }"),n._ps=lr(t,t.FRAGMENT_SHADER,"precision mediump float; \n#define KERNEL_SIZE 9 \nuniform sampler2D u_diffuseTex; \nuniform vec4 u_colorMult; \nuniform vec2 u_kernelOffsets[9]; \nuniform float u_kernel[9]; \nvarying float v_opacity; \nvarying vec2 v_texCoord; \nvoid main() { \n    vec2 texCoord = vec2(v_texCoord.x, 1.0 - v_texCoord.y); \n    /*vec4 color = texture2D(u_diffuseTex, texCoord); */\n    vec4 color = vec4(0); \n    for(int i=0; i<9; i++ ) { \n        vec4 tmp = texture2D(u_diffuseTex, texCoord.st + u_kernelOffsets[i]); \n        color += tmp * u_kernel[i]; \n    } \n    gl_FragColor = color * vec4(1,1,1,v_opacity); \n}"),n._vs==null||n._ps==null)throw new Error("Failure initializing webgl: shader");if(n._shaderProgram=t.createProgram(),t.attachShader(n._shaderProgram,n._vs),t.attachShader(n._shaderProgram,n._ps),t.linkProgram(n._shaderProgram),!t.getProgramParameter(n._shaderProgram,t.LINK_STATUS)){t.deleteProgram(n._shaderProgram);t.deleteShader(n._vs);t.deleteShader(n._ps);return}for(e=t.getProgramParameter(n._shaderProgram,t.ACTIVE_ATTRIBUTES),n._attribs=new Array(e),n._attribLocations={},i=0;i<e;i++)u=t.getActiveAttrib(n._shaderProgram,i),n._attribs[i]=u,n._attribLocations[u.name]=t.getAttribLocation(n._shaderProgram,u.name);for(o=t.getProgramParameter(n._shaderProgram,t.ACTIVE_UNIFORMS),n._uniforms=new Array(o),n._uniformLocations={},r=0;r<o;r++)f=t.getActiveUniform(n._shaderProgram,r),n._uniforms[r]=f,n._uniformLocations[f.name]=t.getUniformLocation(n._shaderProgram,f.name)};w.prototype.setViewportSize=function(n,t){var r,i;this._width=n;this._height=t;this._updateBackgroundSize(n,t);for(r in this._layers)i=this._layers[r],i.width=n,i.height=t,i._gl.viewportWidth=this._width,i._gl.viewportHeight=this._height,i._gl.viewport(0,0,n,t)};w.prototype.render=function(t,i,r,u){var s,h,o=this._layers[t],d=!1,f,nt,b,v,k,tt,e,p,w,g,c,it,rt,ut;if(!o)return!1;if(f=o._gl,i!=null?(i.apply(o),o.associatedAnimation=i,d=!0):o.associatedAnimation!=null&&(o.associatedAnimation.finalize(o),o.associatedAnimation=null),o.finalized)return!0;for(f.clear(f.DEPTH_BUFFER_BIT),f.useProgram(o._shaderProgram),nt=new Float32Array(y.FilterType.NO_FILTER),b=this._viewModel.getRenderables(t).getArray(),b.sort(this.SortRenderableFucntion),v=0;v<2;v++)for(v==1?(f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA)):f.disable(f.BLEND),k=0,tt=b.length;k<tt;k++)if((e=b[k],s=null,h=e.texturesWithPolygons[0].texture,h._isReady&&(s=h._image),s!=null&&e.geometryPolygon!=null)&&(e.geometryPolygon._vertices||y.InitRenderableFor3D(e),this.updateAnimation(e,i,u),d|=e.animation!=null,v!=0||!(s.style.opacity<1))){if(e.geometryPolygon._isDirty&&(e.geometryPolygon.__gl_posBuffer&&f.deleteBuffer(e.geometryPolygon.__gl_posBuffer),e.geometryPolygon.__gl_posBuffer=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,e.geometryPolygon.__gl_posBuffer),f.bufferData(f.ARRAY_BUFFER,new Float32Array(e.geometryPolygon._vertices),f.STATIC_DRAW),e.geometryPolygon.__gl_texCoordBuffer&&f.deleteBuffer(e.geometryPolygon.__gl_texCoordBuffer),e.geometryPolygon.__gl_texCoordBuffer=f.createBuffer(),f.bindBuffer(f.ARRAY_BUFFER,e.geometryPolygon.__gl_texCoordBuffer),f.bufferData(f.ARRAY_BUFFER,new Float32Array(e.geometryPolygon._texCoords),f.STATIC_DRAW),e.geometryPolygon._indices&&(e.geometryPolygon.__gl_indexBuffer&&f.deleteBuffer(e.geometryPolygon.__gl_indexBuffer),e.geometryPolygon.__gl_indexBuffer=f.createBuffer(),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,e.geometryPolygon.__gl_indexBuffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.geometryPolygon._indices),f.STATIC_DRAW)),e.geometryPolygon._isDirty=!1),p=s.width,w=s.height,h._isDirty){h.__gl_texture&&f.deleteTexture(h.__gl_texture);h.__gl_texture=f.createTexture();f.bindTexture(f.TEXTURE_2D,h.__gl_texture);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR_MIPMAP_LINEAR);g=f.CLAMP_TO_EDGE;f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,g);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,g);try{n.isPowerOfTwo(p)&&n.isPowerOfTwo(w)?f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,s):(c=document.createElement("canvas"),c.width=n.nextHighestPowerOfTwo(p),c.height=n.nextHighestPowerOfTwo(w),it=c.getContext("2d"),it.drawImage(s,0,0,p,w,0,0,c.width,c.height),s=c,f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,c))}catch(ot){continue}f.generateMipmap(f.TEXTURE_2D);h._isDirty=!1}rt=this._viewProjMatrix.multiply(e.transform);ut=new Float32Array(rt.flattenColumnMajor());f.uniformMatrix4fv(o._uniformLocations.u_modelViewProjMat,!1,ut);var l=1/p,a=1/w,ft=[-l,-a,0,-a,l,-a,-l,0,0,0,l,0,-l,a,0,a,l,a,],et=new Float32Array(ft);f.uniform2fv(o._uniformLocations["u_kernelOffsets[0]"],et);f.uniform1fv(o._uniformLocations["u_kernel[0]"],nt);f.uniform2f(o._uniformLocations.u_opacityBE,s.style.opacity,s.style.opacity);f.uniform1f(o._uniformLocations.u_t,-1);f.enableVertexAttribArray(o._attribLocations.a_pos);f.enableVertexAttribArray(o._attribLocations.a_texCoord);f.bindBuffer(f.ARRAY_BUFFER,e.geometryPolygon.__gl_posBuffer);f.vertexAttribPointer(o._attribLocations.a_pos,3,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,e.geometryPolygon.__gl_texCoordBuffer);f.vertexAttribPointer(o._attribLocations.a_texCoord,e.geometryPolygon._texCoordSize,f.FLOAT,!1,0,0);e.geometryPolygon._indices&&f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,e.geometryPolygon.__gl_indexBuffer);f.activeTexture(f.TEXTURE0);f.bindTexture(f.TEXTURE_2D,h.__gl_texture);f.uniform1i(o._uniformLocations.u_diffuseTex,0);f.drawElements(f.TRIANGLES,e.geometryPolygon._indices.length,f.UNSIGNED_SHORT,0)}return d};w.prototype.animate=function(){};w.prototype.initLayer=function(n,t){var i=this._getCanvasFromCache(n,t);this._layers[n]=i;this._window.appendChild(i)};w.prototype.finalizeLayer=function(n){var t=this._layers[n];t&&(t.finalized=!0)};w.prototype.disposeLayer=function(n,t){var i=this._layers[n];i&&(i.isFree=!0,delete i.finalized,t&&this.releaseGL(i));v.prototype.disposeLayer.call(this,n)};w.prototype.releaseGL=function(n){var t,i,r;n&&(t=n._gl,t&&(i=n._shaderProgram,i&&(t.detachShader(i,n._vs),t.detachShader(i,n._ps),t.deleteShader(n._vs),t.deleteShader(n._ps),t.deleteProgram(i)),r=t.getExtension("WEBGL_lose_context"),r&&r.loseContext()))};w.prototype.dispose=function(){for(var i,n=0,t=this._contextCache.length;n<t;n++)i=this._contextCache[n],this.releaseGL(i),this._contextCache[n]=null};w.prototype.getType=function(){return"3D"};w.prototype.syncRemovedRenderables=function(n){var f=this._layers[n],r,o,t;if(!f)throw new Error("trying to render on a non-existing context "+n);var i=f._gl,e=this._viewModel.getDelta(n).removed,s=this._viewModel.getRenderables(n).map,u;for(r=0;r<e.length;r++)(o=e[r].viewElementId.id,t=s[o],t)&&(t.geometryPolygon.__gl_posBuffer&&i.deleteBuffer(t.geometryPolygon.__gl_posBuffer),t.geometryPolygon.__gl_indexBuffer&&i.deleteBuffer(t.geometryPolygon.__gl_indexBuffer),u=t.texturesWithPolygons[0].texture,u.__gl_texture&&i.deleteTexture(u.__gl_texture),t.geometryPolygon.__gl_texCoordBuffer&&i.deleteBuffer(t.geometryPolygon.__gl_texCoordBuffer))};s(nt,v);nt.STD_PIXEL_EXPANSION=window.chrome?.01:.5;nt.prototype.setViewportSize=function(n,t){var r,i;this._width=n;this._height=t;this._updateBackgroundSize(n,t);for(r in this._layers)i=this._layers[r],i.width=n,i.height=t};nt.prototype._initNewCanvas=function(n,t){var r=document.createElement("canvas"),u;return this._layers[n]=r,r.id=n,r.width=this._width,r.height=this._height,i.css(r,{position:"absolute",left:0,top:0,zIndex:t}),u=r.getContext("2d"),r.ctx=u,this._window.appendChild(r),u};nt.prototype.render=function(n,t,i,r){function yt(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){var b=gt,k=b(r,u,f,e,o,s),d=b(f,e,r,u,o,s),g=b(o,s,f,e,r,u),w;if(r=k.x,u=k.y,f=d.x,e=d.y,o=g.x,s=g.y,n.save(),i<1?(n.globalAlpha=i,self._expansionInPixels=.25):self._expansionInPixels=nt.STD_PIXEL_EXPANSION,n.beginPath(),n.moveTo(r,u),n.lineTo(f,e),n.lineTo(o,s),n.closePath(),p&&(n.strokeStyle="blue",n.stroke()),n.clip(),w=h*(y-a)-l*y+v*a+(l-v)*c,w==0)return n.restore(),!1;var tt=-(c*(o-f)-a*o+y*f+(a-y)*r)/w,it=(a*s+c*(e-s)-y*e+(y-a)*u)/w,rt=(h*(o-f)-l*o+v*f+(l-v)*r)/w,ut=-(l*s+h*(e-s)-v*e+(v-l)*u)/w,ft=(h*(y*f-a*o)+c*(l*o-v*f)+(v*a-l*y)*r)/w,et=(h*(y*e-a*s)+c*(l*s-v*e)+(v*a-l*y)*u)/w;return n.transform(tt,it,rt,ut,ft,et),n.drawImage(t,0,0),n.restore(),!0}function gt(n,t,i,r,u,f){var h=i-n,c=r-t,l=u-n,a=f-t,e=Math.sqrt(h*h+c*c),o,s,v,y,w,p;return e!=0&&(h/=e,c/=e),e=Math.sqrt(l*l+a*a),e!=0&&(l/=e,a/=e),o=h+l,s=c+a,e=Math.sqrt(o*o+s*s),e!=0&&(o/=e,s/=e),v=h-l,y=c-a,e=Math.sqrt(v*v+y*y),w=e/2,p=Math.min(2,self._expansionInPixels/w),o*=p,s*=p,{x:n-o,y:t-s}}var l,st,ht=this._viewModel.getRenderables(n).getArray(),tt,ct,lt,at,f,u,w,it,pt,vt,ut,wt,ft,ot,d,bt;if(ht.sort(this.SortRenderableFucntion),this.renderImageryB=!0,tt=!1,g.debugEnabled&&(ct=document.getElementById("tiles"),ct&&(this.showSquareB=ct.checked),lt=document.getElementById("triangles"),lt&&(this.showTrianglesB=lt.checked),at=document.getElementById("images"),at&&(this.renderImageryB=at.checked)),f=this._layers[n],!f)throw new Error("trying to render on a non-existing canvas "+n);if(u=f.ctx,t?(t.apply(f),f.associatedAnimation=t,tt=!0):f.associatedAnimation!=null&&(f.associatedAnimation.finalize(f),f.associatedAnimation=null),f.finalized)return!0;for(u.clearRect(0,0,this._width,this._height),w=0,it=0,pt=ht.length;it<pt;it++){var b=ht[it],rt=b.geometryPolygon,kt=b.texturesWithPolygons[0];if(st=kt.texture,l=st._isReady?st._image:null,l!=null&&rt!=null){for(this.updateAnimation(b,t,r),tt|=b.animation!=null,vt=rt.intileTesselated,ut=0,wt=vt.length;this.renderImageryB&&ut<wt;ut++)if(ft=vt[ut],ft){var e=ft.screenArray,a=ft.textureArray,v=e[0],p=a[0],o,s,h,c;if(e.length==4)o=e[1],s=a[1],h=e[2],c=a[2],yt(u,l,l.style.opacity,v.x,v.y,o.x,o.y,h.x,h.y,p.x,p.y,s.x,s.y,c.x,c.y,this.showTrianglesB),o=e[2],s=a[2],h=e[3],c=a[3],yt(u,l,l.style.opacity,v.x,v.y,o.x,o.y,h.x,h.y,p.x,p.y,s.x,s.y,c.x,c.y,this.showTrianglesB),w+=2;else for(var et=1,k=1,dt=e.length-1;k<dt;et=k)k=et+1,o=e[et],s=a[et],h=e[k],c=a[k],yt(u,l,l.style.opacity,v.x,v.y,o.x,o.y,h.x,h.y,p.x,p.y,s.x,s.y,c.x,c.y,this.showTrianglesB),w++}if(g.debugEnabled){if(!this.renderImageryB&&this.showTrianglesB)for(u.strokeStyle="teal",ot=rt.intileTesselated,d=0;d<ot.length;d++)ot[d]&&y.DrawPolyLine(u,ot[d].screenArray,null);this.showSquareB&&(bt=!1,u.strokeStyle=b.isClipped?"red":"cyan",y.DrawPolyLine(u,rt.screenArray,bt),u.strokeStyle="black")}}}return g.debugEnabled&&(u.font="14px Tahoma",u.strokeStyle=w>1e3?"red":"blue",u.strokeText("Rendered triangles: "+w,this._width-300,this._height-50)),tt};nt.prototype.initLayer=function(n,t){this._initNewCanvas(n,t)};nt.prototype.finalizeLayer=function(n){var t=this._layers[n];t&&(t.finalized=!0)};nt.prototype.getType=function(){return"2D"};nt.prototype.syncRemovedRenderables=function(){};si.prototype.Tesselate=function(){throw new Error("interface function called instead of implementation");};si.prototype.GetRawDensity=function(){throw new Error("interface function called instead of implementation");};s(b,si);b._isSpheric=!0;b.ScreenQuadSize=64;b.ScreenQuadSizeThreshold=b.ScreenQuadSize*b.ScreenQuadSize;b.setScreenQuadSize=function(n){var i,t;if(b.ScreenQuadSize=n,b.ScreenQuadSizeThreshold=n*n,g.debugEnabled)for(i=document.getElementsByName("tess"),t=0;t<i.length;t++)if(i[t].value==n){i[t].checked=!0;break}};b.prototype.Tesselate=function(n,t,i){var f,r;return t===0?{squares:[n.geometryPolygon],texelSquares:[n.texturePolygon],density:0}:(t=t||-1,t<0?(r=this.GetRawDensity(n,i),r=r>t?r:t):r=t,r=r>=1?r:1,f={squares:[],texelSquares:[],density:r},u.splitSquareRecursive(n.geometryPolygon,n.texturePolygon,r,null,f,b._isSpheric,n.texturePolygon,null,null,null,null),f.density=r,!f.density,f)};b.prototype.GetRawDensity=function(t,i){var e=i.getViewport(),a=e.getWidth(),v=e.getHeight(),w=v<=a,o=t.geometryPolygon[0].y,s=t.geometryPolygon[1].y,h=i.getVerticalFov(),y=v,c,f,r;if(w||(h=at.convertVerticalToHorizontalFieldOfView(e.getAspectRatio(),h),o=t.geometryPolygon[1].x,s=t.geometryPolygon[2].x,y=a),c=b.ScreenQuadSize,g.debugEnabled)for(f=document.getElementsByName("tess"),r=0;r<f.length;r++)if(f[r].checked==!0){c=f[r].value;break}var k=Math.sqrt((o-s)*(o-s)),d=u.calculateTexelToPixelRatioAtFov(u._cubeSide,c,y,h),p=k/d,l=Math.floor(n.logBase(p,2)),nt=Math.pow(2,l);return nt>p?l-1:l};s(a,si);a._isSpheric=!0;a.ScreenQuadSize=64;a.setScreenQuadSize=function(n){var i,t;if(a.ScreenQuadSize=n,a.ScreenQuadSizeThreshold=n*n,g.debugEnabled)for(i=document.getElementsByName("tess"),t=0;t<i.length;t++)if(i[t].value==n){i[t].checked=!0;break}};a.prototype.Tesselate=function(n,t,i){function g(n,t,i,r,f,e){if(f!=0){var o=u.splitFunction(a._isSpheric,n,t,i,r),s=e.length;e[s]=o;g(n,o.xy,i,o.uv,f-1,e);g(o.xy,t,o.uv,r,f-1,e)}}function bt(n,t){return n.xy<t.xy?-1:n.xy>t.xy?1:0}var o,h,nt,tt,s,v,yt,y,pt,wt;if(t===0)return{squares:[n.geometryPolygon],texelSquares:[n.texturePolygon],density:0};t=t||-1;t<0?(nt=i.getViewport(),tt=i.getVerticalFov(),a.prototype._updateTesselatorQuadSize(),o=a.prototype._getNumberOfSplits(n.geometryPolygon[1].x,n.geometryPolygon[2].x,at.convertVerticalToHorizontalFieldOfView(nt.getAspectRatio(),tt),a.ScreenQuadSize,nt.getWidth()),h=this.GetRawDensity(n,i)):o=h=t;o<1&&(o=1);h<1&&(h=1);var c=n.geometryPolygon,p=n.texturePolygon,r=c[0].z,e=c[0].w,it=c[1].x,rt=c[2].x,ut=p[1].x,ft=p[2].x,et=c[0].y,ot=p[0].y,st=c[1].y,ht=p[1].y,l=[{xy:it,uv:ut},{xy:rt,uv:ft},];g(it,rt,ut,ft,o,l);l.sort(bt);s=[{xy:et,uv:ot},{xy:st,uv:ht},];g(et,st,ot,ht,h,s);s.sort(bt);var ct=(l.length-1)*(s.length-1),kt=0,dt=0,lt=[ct],vt=[ct];for(v=0,yt=l.length-1;v<yt;v++)for(y=0,pt=s.length-1;y<pt;y++){var w=l[v],b=s[y+1],k=l[v+1],d=s[y];lt[kt++]=[new f(w.xy,b.xy,r,e),new f(w.xy,d.xy,r,e),new f(k.xy,d.xy,r,e),new f(k.xy,b.xy,r,e),];vt[dt++]=[new f(w.uv,b.uv,r,e),new f(w.uv,d.uv,r,e),new f(k.uv,d.uv,r,e),new f(k.uv,b.uv,r,e),]}return wt=o==h?o:-1,{squares:lt,texelSquares:vt,density:wt}};a.prototype.GetRawDensity=function(n,t){var i=t.getViewport(),r=t.getVerticalFov();return a.prototype._updateTesselatorQuadSize(),a.prototype._getNumberOfSplits(n.geometryPolygon[0].y,n.geometryPolygon[1].y,r,a.ScreenQuadSize,i.getHeight())};a.prototype._updateTesselatorQuadSize=function(){var t,n;if(g.debugEnabled)for(t=document.getElementsByName("tess"),n=0;n<t.length;n++)t[n].checked==!0&&(a.ScreenQuadSize=t[n].value)};a.prototype._getNumberOfSplits=function(t,i,r,f,e){var o=Math.sqrt((i-t)*(i-t)),s=u.calculateTexelToPixelRatioAtFov(u._cubeSide,f,e,r);return Math.floor(n.logBase(o/s,2))};d.TRANSITION_TYPE={IN:1,OUT:2};d.DataSourceRegistryItem=function(n,t,i){this.id=n.getDataSourceName();this.dataSource=n;this.callback=t;this.transitionType=i};d.DataSourceRegistryItem.prototype.id=null;d.DataSourceRegistryItem.prototype.dataSource=null;d.DataSourceRegistryItem.prototype.callback=function(){};d.DataSourceRegistryItem.prototype.transitionType=null;d.DataSourceRegistryItem.prototype.notifyCallback=function(){this.callback&&this.callback(this.dataSource)};pt.lowerVisibleBoundary=new f(-1,-1,-1,null);pt.higherVisibleBoundary=new f(1,1,1,null);r.number=0;r.DefaultDurationMs=1e3;r.prototype._start=0;r.prototype._durationMs=r.DefaultDurationMs;r.prototype.guid=0;r.prototype._finalized=!1;r.prototype.apply=function(n){this._start||(this._start=Date.now());this.isComplete(n)&&this.finalize(n)};r.prototype.finalize=function(){this._finalized=!0};r.prototype.isComplete=function(){return this._finalized||this._start!=0&&Date.now()>this._start+this._durationMs};r.TYPE={FadeIn:1,FadeOut:2,HalfFadeOut:3,ImmediateFadeIn:4};r.createAnimation=function(n,t){switch(n){case r.TYPE.FadeIn:return new kt(t);case r.TYPE.FadeOut:return new ri(t);case r.TYPE.HalfFadeOut:return new ui(t);case r.TYPE.ImmediateFadeIn:return new ci(t);default:throw new Error("unknown animation type: "+n);}};r.createCSSAnimation=function(n,t){switch(n){case r.TYPE.FadeIn:return new ii(t);case r.TYPE.FadeOut:return new ot(t);case r.TYPE.HalfFadeOut:return new nr(t);default:throw new Error("unknown animation type: "+n);}};r._getOpacityObject=function(n){if(n.style)return n;if(n instanceof hi)return n.texturesWithPolygons[0].texture._image;throw new Error("could not find Image object in "+n);};s(kt,r);kt.prototype.apply=function(n){if(r.prototype.apply.call(this,n),!this._finalized){var i=r._getOpacityObject(n),t=(Date.now()-this._start)/this._durationMs;t=t>1?1:t;(i.style.opacity==""||i.style.opacity<t)&&(i.style.opacity=t)}};kt.prototype.finalize=function(n){r.prototype.finalize.call(this,n);var t=r._getOpacityObject(n);t.style.opacity=1};s(ci,kt);ci.prototype.apply=function(n){this.finalize(n)};r._CSSAnimationHelper={styleNotImportatnt:"none !important;",setCSS3DOpacity:function(n,t,i){n.style.webkitTransition="opacity "+i+"s linear";n.style.mozTransition="opacity "+i+"s linear";n.style.msTransition="opacity "+i+"s linear";n.style.oTransition="opacity "+i+"s linear";n.style.opacity=t},transitionEndCallback:function(){this.animationInProgress=!1;this.removeEventListener("webkitTransitionEnd",r._CSSAnimationHelper.transitionEndCallback,!1);this.removeEventListener("mozTransitionEnd",r._CSSAnimationHelper.transitionEndCallback,!1);this.removeEventListener("MSTransitionEnd",r._CSSAnimationHelper.transitionEndCallback,!1);this.removeEventListener("oTransitionEnd",r._CSSAnimationHelper.transitionEndCallback,!1)},setCssOpacityChangeAnimation:function(n,t,i,u){var f=r._getOpacityObject(n),e;f.style.opacity===""?f.style.opacity=t:f.style.opacity==t||f.animationInProgress?f.style.opacity==i||f.animationInProgress||(e=r._CSSAnimationHelper.transitionEndCallback,f.addEventListener("webkitTransitionEnd",e,!1),f.addEventListener("MSTransitionEnd",e,!1),f.addEventListener("mozTransitionEnd",e,!1),f.addEventListener("oTransitionEnd",e,!1),f.animationInProgress=!0,r._CSSAnimationHelper.setCSS3DOpacity(f,i,u),setTimeout(function(){f.animationInProgress||e.apply(f)},u*1e3+50)):r._CSSAnimationHelper.dismissCssAnimation(f)},dismissCssAnimation:function(n){var u=r._getOpacityObject(n),t=u.style,i=r._CSSAnimationHelper.styleNotImportatnt;t&&(t.webkitTransition=i,t.mozTransition=i,t.msTransition=i,t.oTransition=i);r._CSSAnimationHelper.transitionEndCallback.apply(u)}};s(ii,r);ii.prototype.apply=function(n){(r.prototype.apply.call(this,n),this._finalized)||r._CSSAnimationHelper.setCssOpacityChangeAnimation(n,0,1,this._durationMs/1e3)};ii.prototype.finalize=function(n){r.prototype.finalize.call(this,n);r._CSSAnimationHelper.dismissCssAnimation(n);var t=r._getOpacityObject(n);t.style.opacity=1};s(ri,r);ri.prototype.apply=function(n){if(r.prototype.apply.call(this,n),!this._finalized){var i=r._getOpacityObject(n),t=(Date.now()-this._start)/this._durationMs;t=t>1?1:t;t=1-t;(i.style.opacity==""||i.style.opacity>t)&&(i.style.opacity=t)}};ri.prototype.finalize=function(n){r.prototype.finalize.call(this,n);var t=r._getOpacityObject(n);t.style.opacity=0};s(ui,r);ui.prototype.apply=function(n){if(r.prototype.apply.call(this,n),!this._finalized){var i=r._getOpacityObject(n),t=(Date.now()-this._start)/this._durationMs/2;t=t>.5?.5:t;t=1-t;(i.style.opacity==""||i.style.opacity>t)&&(i.style.opacity=t)}};ui.prototype.finalize=function(n){r.prototype.finalize.call(this,n);var t=r._getOpacityObject(n);t.style.opacity=.5};s(ot,r);ot.prototype.startOpacity=1;ot.prototype.endOpacity=0;ot.prototype.apply=function(n){(r.prototype.apply.call(this,n),this._finalized)||r._CSSAnimationHelper.setCssOpacityChangeAnimation(n,this.startOpacity,this.endOpacity,this._durationMs/1e3)};ot.prototype.finalize=function(n){r.prototype.finalize.call(this,n);r._CSSAnimationHelper.dismissCssAnimation(n);var t=r._getOpacityObject(n);t.style.opacity=this.endOpacity};s(nr,ot);ot.prototype.startOpacity=1;ot.prototype.endOpacity=.5;at.convertHorizontalToVerticalFieldOfView=function(n,t){var i=.5/Math.tan(t*.5);return 2*Math.atan(.5*1/n/i)};at.convertVerticalToHorizontalFieldOfView=function(n,t){var i=.5*1/n/Math.tan(t*.5);return 2*Math.atan(.5/i)};at.prototype={getWidth:function(){return this._width},getHeight:function(){return this._height},getAspectRatio:function(){return this._aspectRatio},getNearDistance:function(){return this._nearDistance},getFarDistance:function(){return this._farDistance}};ti.prototype={step:function(n){function h(){return i._timeInMillis&&i._timeInMillis!=-1}function c(){return h()&&n!=i._startTime&&n-i._startTime>i._timeInMillis}function l(){return r<u&&r>-u&&t<u&&t>-u}var i,t,r,f,e,o,u,s;return this._isSettled?!0:(this._startTime==-1&&(this._startTime=n),i=this,t=0,this._t>=0&&(e=n-this._t,e>0&&(r=this._current-this._target,this._velocity+=-this._springConstant*r-this._damperConstant*this._velocity,t=this._velocity*e,(!this._allowOvershoot||e>100)&&(o=-r,Math.abs(o)<Math.abs(t)&&(t=o,this._velocity=0)),h()?(s=(n-this._startTime+1)/this._timeInMillis,this._current=this._initialValue+(this._target-this._initialValue)*s):this._current+=t)),r=this._current-this._target,u=1e-7,f=c()||l(),f?this.setCurrentToTarget():this._t=n,this._isSettled=f,f)},isSettled:function(){return this._isSettled},setTarget:function(n,t){this.target!=n&&(this._target=n,this._timeInMillis=t,t&&(this._startTime=-1,this._initialValue=this._current),this._isSettled=!1)},setCurrent:function(n){this._current=n;this._isSettled=!1},setCurrentAndTarget:function(n){this._target=n;this.setCurrentToTarget()},setCurrentToTarget:function(){this._current=this._target;this._velocity=0;this._isSettled=!0;this._t=-1;this._initialValue=-1;this._timeInMillis=-1},getTarget:function(){return this._target},getCurrent:function(){return this._current}};sr.prototype={step:function(n){var i,t,r;if(this._internalSpring._isSettled)return!0;for(i=this._internalSpring.step(n),t=0,r=this._current.length;t<r;t++)if(i)this._current[t]=this._target[t];else{var f=this._target[t],u=this._initial[t],e=(f-u)*this._internalSpring.getCurrent();this._current[t]=u+e}return i},isSettled:function(){return this._internalSpring._isSettled},setTarget:function(n){var i=!0,r=n.length,t;if(r==this._target.length)for(t=0;t<r;t++)this._target[t]!=n[t]&&(i=!1);else i=!1;i||(this._internalSpring.setTarget(this._internalSpringTargetValue,null),this._target=n,this._internalSpring._isSettled=!1)},setCurrent:function(n){this._internalSpring.setCurrent(this._internalSpringCurrentValue);this._current=n;this._initial=[];for(var t=0;t<n.length;t++)this._initial.push(n[t]);this._internalSpring._isSettled=!1},setCurrentAndTarget:function(n){this._internalSpring.setCurrentAndTarget(this._internalSpringTargetValue);this._target=n;this.setCurrentToTarget()},setCurrentToTarget:function(){for(var n=0,t=this._current.length;n<t;n++)this._current[n]=this._target[n]},getTarget:function(){return this._target},getCurrent:function(){return this._current}};wi.prototype={calculatePitchAndHeading:function(){var i=this.getPitch(),t=this.getHeading();return t<0&&(t+=n.twoPI),{pitch:i,heading:t}},setViewTarget:function(n,t,i,r,u,f){this._zoomingToPoint=!1;var e=!1;(n!==null||t!=null)&&(n=n!=0?n||this.getPitch():n,t=t!=0?t||this.getHeading():t,this.setPitchAndHeading(n,t,r,u,f),e=!0);i!==null&&(this.setVerticalFov(i,r,u),e=!0);e&&this.targetViewChangeCallback&&this.targetViewChangeCallback()},getView:function(){return this._currentView.pitch=this.getPitch(),this._currentView.heading=this.getHeading(),this._currentView.verticalFov=this.getVerticalFov(),this._currentView},getPitch:function(){return this._pitchSpring.getCurrent()},getHeading:function(){return this._headingSpring.getCurrent()},getVerticalFov:function(){return this._fieldOfViewSpring.getCurrent()},getMinVerticalFov:function(){return this._minFieldOfView},getMaxVerticalFov:function(){return this._maxFieldOfView},getBounds:function(){return{left:this._lowerHeadingLimit,right:this._upperHeadingLimit,bottom:this._lowerPitchLimit,top:this._upperPitchLimit,minFov:this._minFieldOfView,maxFov:this._maxFieldOfView}},zoomIn:function(n){this.setViewTarget(null,null,Math.max(this._minFieldOfView,this._camera.getVerticalFov()*this._discreteZoomFactor),n,null)},zoomOut:function(n){this.setViewTarget(null,null,Math.min(this._maxFieldOfView,this._camera.getVerticalFov()/this._discreteZoomFactor),n,null)},setPitchAndHeading:function(t,i,r,u,f){if(this._zoomingToPoint=!1,t=this.constrainPitch(t),i=this.constrainHeading(i),r){this._pitchSpring.setTarget(t,u);var e=this._headingSpring.getCurrent();f||(e=n.pickStartHeadingToTakeShortestPath(e,i));this._headingSpring.setCurrent(e);this._headingSpring.setTarget(i,u)}else this._pitchSpring.setCurrentAndTarget(t),this._headingSpring.setCurrentAndTarget(i),this.updateCameraProperties()},setVerticalFov:function(t,i,r){this._zoomingToPoint=!1;var u=n.clamp(t,this._minFieldOfView,this._maxFieldOfView);i?this._fieldOfViewSpring.setTarget(u,r):this._fieldOfViewSpring.setCurrentAndTarget(u);this.updateCameraProperties()},tryPitchHeadingToPixel:function(n,t){var r=this.calculateLookFromPitchAndHeading(n,t,this._worldLook,this._worldUp,this._worldSide,null),i;return this._camera.getLook().dot(r)<=0?null:(i=this._camera.projectTo2D(r),new h(i.x,i.y))},tryPixelToPitchHeading:function(t){var u=this._camera.getViewport(),h=this._camera.getFocalLength(),c=u.getWidth()/2,f=u.getHeight()/2,e=h*f,l=t.x-c,a=t.y-f,v=-Math.atan2(a,e),y=Math.atan2(l,e),i=this.calculateLookFromPitchAndHeading(v,y,this._look,this._up,this._side,!0),r=i.dot(this._worldUp),p=i.dot(this._worldSide),w=i.dot(this._worldLook),o=Math.atan2(r,Math.max(0,Math.sqrt(1-r*r))),s=n.normalizeRadian(Math.atan2(p,w));return isNaN(o)||isNaN(s)?null:{pitch:o,heading:s}},calculateLookFromPitchAndHeading:function(n,t,i,r,u,f){return l.fromAxisAngleOut(u,n,this._tempPitchRotationQuaternion),l.fromAxisAngleOut(r,-t,this._tempHeadingRotationQuaternion),f?this._tempPitchRotationQuaternion.multiplyOut(this._tempHeadingRotationQuaternion,this._tempQuaternion):this._tempHeadingRotationQuaternion.multiplyOut(this._tempPitchRotationQuaternion,this._tempQuaternion),this._tempQuaternion.transform(i)},constrainPitch:function(t){return n.clamp(t,this._lowerPitchLimit,this._upperPitchLimit)},constrainHeading:function(t){if(!this._upperHeadingLimit)return t;if(t<0&&(t+=n.twoPI),this._lowerHeadingLimit<this._upperHeadingLimit)return n.clamp(t,this._lowerHeadingLimit,this._upperHeadingLimit);if(t>this._lowerHeadingLimit&&t<this._upperHeadingLimit+n.twoPI||t+n.twoPI>this._lowerHeadingLimit&&t+n.twoPI<this._upperHeadingLimit+n.twoPI)return t;var i=Math.min(Math.abs(t-this._lowerHeadingLimit),Math.abs(t+n.twoPI-this._lowerHeadingLimit)),r=Math.min(Math.abs(t-this._upperHeadingLimit-n.twoPI),Math.abs(t-this._upperHeadingLimit));return i<r?this._lowerHeadingLimit:this._upperHeadingLimit},constrainVerticalFieldOfView:function(t){return n.clamp(t,this._minFieldOfView,this._maxFieldOfView)},onDiscreteZoom:function(t,i){function p(n){function f(){var r,i;return t.wheelDelta?r=Math.max(1.2,Math.abs(t.wheelDelta)):(i=1+(t.scale-Math.floor(t.scale)),n._previousTempZoomScale===null&&(n._previousTempZoomScale=i),r=1+Math.abs(n._previousTempZoomScale-i)*10,n._previousTempZoomScale=i),r}var i,r;if(t.mouseInteractionType&&t.mouseInteractionType=="mousewheel"||t.type&&t.type=="gestureChange")if(r=f(),c)if(u<n._maxFieldOfView-n._wheelZoomFudgeFactor)i=n.constrainVerticalFieldOfView(u*r);else return n._maxFieldOfView;else if(u>n._minFieldOfView+n._wheelZoomFudgeFactor)i=n.constrainVerticalFieldOfView(u/r);else return n._minFieldOfView;else i=n.constrainVerticalFieldOfView(u/2);return i}this._zoomingToPoint=!0;var o=this.calculatePitchAndHeading(),s=this.tryPixelToPitchHeading({x:t.clientX,y:t.clientY}),r=o.heading,f=s.heading;r=r-Math.floor(r/n.twoPI)*n.twoPI;Math.abs(r-f)>Math.PI&&(f<r?f+=n.twoPI:r+=n.twoPI);var c=t.direction&&t.direction>0||i>1,u=this._camera.getVerticalFov(),e=p(this),h=this._zoomToPointSpring.getTarget()[2];if((e!=this._minFieldOfView||h!=this._minFieldOfView)&&(e!=this._maxFieldOfView||h!=this._maxFieldOfView)){var l=e*((s.pitch-o.pitch)/u),a=e*((f-r)/u),v=s.pitch-l,y=f-a;this._zoomToPointSpring.setCurrent([o.pitch,r,u,]);this._zoomToPointSpring.setTarget([v,y,e,])}},onKeyDown:function(n){function i(n){t._scrollAccY=n;t.moveCamera()}function r(n){t._scrollAccX=n;t.moveCamera()}var t=this;n.keyCode=="37"?r(-1):n.keyCode=="38"?this._upArrowHandler?this._upArrowHandler(n,!0):i(1):n.keyCode=="39"?r(1):n.keyCode=="40"?this._downArrowHandler?this._downArrowHandler(n,!0):i(-1):n.keyCode=="107"||n.keyCode=="187"||n.keyCode=="61"?t.zoomIn(!0):(n.keyCode=="109"||n.keyCode=="189"||n.keyCode=="173")&&t.zoomOut(!0)},onKeyUp:function(n){function i(){t._scrollAccY=0}function r(){t._scrollAccX=0}var t=this;n.keyCode=="37"||n.keyCode=="39"?r():n.keyCode=="38"?this._upArrowHandler?this._upArrowHandler(n,!1):i():n.keyCode=="40"&&(this._downArrowHandler?this._downArrowHandler(n,!1):i())},moveCamera:function(){if(!this._motionHandle){var n=this;this._motionHandle=setInterval(function(){n._scrollSpeedX+=n._scrollAccX;n._scrollSpeedY+=n._scrollAccY;n._scrollSpeedX*=n._scrollSpeedDamper;n._scrollSpeedY*=n._scrollSpeedDamper;var t=n.getPitch(),i=n.getHeading();if(t+=n._scrollSpeedY/n._scrollSpeedAdjustmentFactor,i+=n._scrollSpeedX/n._scrollSpeedAdjustmentFactor,n.setPitchAndHeading(t,i,null,null),Math.abs(n._scrollSpeedX)<.1&&Math.abs(n._scrollSpeedY)<.1){n.stopMovingCamera();return}},33)}},stopMovingCamera:function(){this._motionHandle&&(clearInterval(this._motionHandle),this._motionHandle=0)}};s(yi,wi);s(oi,wi);s(pi,oi);var yt=function(n){var i=this,u={},f;u.assert=function(){};var e=n,o=3,r="$$count",t=[{}];t[0][r]=0;i.get=function(n,r){u.assert(typeof n=="string","Argument: key");for(var f,e=t.length,o=!0;e--;){if(f=t[e][n],f!==undefined)return r&&!o&&i.insert(n,f),f;o=!1}};i.insert=function(n,s){var h,l,c,a;if(u.assert(typeof n=="string","Argument: key"),u.assert(s!==undefined,"Argument: value"),h=t[t.length-1],h[n]===undefined)if(h[r]<e)h[r]++;else if(h={},h[r]=1,t.push(h),t.length>o&&(l=t.shift(),f))for(c in l)c!==r&&l.hasOwnProperty(c)&&(a=l[c],a!==i.get(c,null)&&f(a));h[n]=s};i.useDisposer=function(n){f=n};i.size=function(){for(var i,u=0,n=0;n<t.length;++n)if(t[n])for(i in t[n])t[n].hasOwnProperty(i)&&i!==r&&++u;return u}},uu=function(n,t,r){function ft(){var n,t;this[p]||(n=this[h].url,a(this,n),b.insert(n,!0),t=this[h].token,this[ut]=t,u.AllCompleted.insert(t,this),s.insert(n,this),y++,r(l,y))}function nt(){if(!this[p]){var n=this[h].url;a(this,n);k.useImageDisposer&&(this.src=w);v.insert(n,tt.failed);l++;t(l,y)}}function et(){if(!this[p]){var n=this[h].url;a(this,n);k.useImageDisposer&&(this.src=w);v.insert(n,tt.timedout);l++;t(l,y)}}function a(n,t){n[p]=!0;n.onload=null;n.onerror=null;n.onabort=null;window.clearTimeout(n[g]);for(var r=n[h],i=f.length;i--;)f[i]===r&&f.splice(i,1);c--;delete e[t]}var u=this;u.useCORS=n||!1;var w="data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",it=5e3,rt=6,f=[],c=0,e={},o=120,s=new yt(o),v=new yt(30),b=new yt(o),y=0,l=0;t=t||function(){};r=r||function(){};k.useImageDisposer&&s.useDisposer(function(n){n&&n.src&&(n.src=w)});var d="$$",h=d+"downloadRequest",g=d+"timeoutid",p=d+"processed",ut="token";u.hasABlockingDownload=!1;u.blockingDownloadTargetCount=-1;u.blockingDownloadSuccessCount=0;u.blockingDownloadFailureCount=0;u.blockingDownloadProgressCallback=null;u.blockingDownloadFinishCallback=null;u.prefetchedTiles={};u.AllCompleted=new yt(o);u.resetCaches=function(){f.length=0;for(var n in e)a(e[n],n);e={};c=0;s=new yt(o);v=new yt(30);b=new yt(o);u.AllCompleted=new yt(o)};u.hasBlockingDownload=function(){if(u.hasABlockingDownload)if(u.blockingDownloadSuccessCount+=u.AllCompleted.Size(),u.update(),u.blockingDownloadProgressCallback(u.blockingDownloadSuccessCount),u.blockingDownloadSuccessCount+u.blockingDownloadFailureCount==u.blockingDownloadTargetCount)u.blockingDownloadFinishCallback(u.blockingDownloadSuccessCount,u.blockingDownloadFailureCount),u.resetDownloadAll();else return!0;return!1};u.getState=function(n){if(s.get(n))return tt.ready;var t=v.get(n);return t!==undefined?t:e[n]?tt.downloading:b.get(n)?tt.cacheExpired:tt.none};u.downloadImage=function(n,t,i){var r=u.getState(n);r===tt.ready?u.AllCompleted.insert(i,s.get(n)):r!=tt.downloading&&(f.push({url:n,priority:t,token:i}),f.length>900&&(f=f.slice(0,600)))};u.updatePriority=function(n,t){for(var r=!1,i=0;i<f.length;++i)if(f.url===n){r=!0;f.priority=t;break}if(!r)throw new Error("Expected item to be in queue.");};u.cancel=function(n){e[n]&&a(e[n],n)};u.getCacheSize=function(){return s.size()};u.currentlyDownloading=function(){return c!=0};u.update=function(){var r,n,o;for(f.sort(function(n,t){return t.priority-n.priority}),r=0;r<f.length;r++){var s=f[r],t=s.url,l=u.getState(t);switch(l){case tt.none:case tt.timedout:case tt.cacheExpired:c<rt&&(e[t]||(c++,n=document.createElement("img"),e[t]=n,n[h]=s,n.onload=ft,n.onerror=nt,n.onabort=nt,n[g]=setTimeout(function(){var t=n;return function(){et.call(t)}}(),it),o=!1,u.useCORS&&(o=!i.isDataUrl(t)&&!i.isRelativeUrl(t)&&!i.areSameDomain(t,window.location.toString())),o&&(n.crossOrigin=""),typeof FunctionalTestHooks!="undefined"&&FunctionalTestHooks.validateUrl(t),n.src=t))}}};u.resetDownloadAll=function(){u.blockingDownloadTargetCount=0;u.blockingDownloadSuccessCount=0;u.blockingDownloadFailureCount=0;u.hasABlockingDownload=!1;u.customFailFunc=null;u.blockingDownloadProgressCallback=null;u.blockingDownloadFinishCallback=null}},tt={none:0,downloading:1,ready:2,failed:3,timedout:4,cacheExpired:5};vi.prototype={animationDurationMS:250,getInitialCameraParams:function(){return this.initialCameraParams},getDataSourceName:function(){return this.dataSourceName},getWorldConfiguration:function(){return this.worldConfiguration},getViewElements:function(n,t){return this.viewElementContainers[0].getGeometry().getViewElements(n,t)},getViewElementById:function(n,t){return this.viewElementContainers[0].getGeometry().getViewElementById(n,t)},getInteractionController:function(){return this.interactionController},getMinimumLod:function(){return this.viewElementContainers[0].getGeometry().getMinimumLod()},getMaximumLod:function(){return this.viewElementContainers[0].getGeometry().getMaximumLod()},tesselate:function(n,t,i){return this.tesselator.Tesselate(n,t,i)},getElementRawTesselationDensity:function(n,t){return this.tesselator.GetRawDensity(n,t)},covertToScreenSpace:function(n,t,i,r){return this.viewElementContainers[0].getGeometry().covertToScreenSpace(n,t,i,r)},getElementTransform:function(n){return this.viewElementContainers[0].getGeometry().getElementTransform(n)},getZOrder:function(){return 1}};it.SivDataSourceExists=!0;s(et,vi);et.prototype.swapUrlBase=function(n,t){var i,r,u;if(t==null)return n;i=n.split("/");r=t.split("/");for(u in r)i[u]=r[u];return i.join("/")};et.prototype.overrideHost=function(n,t){for(var r,u,i=0;i<t.length;i++)if(r=t[i][0],u=t[i][1],n.slice(-r.length)===r)return u;return n};et.prototype.forceToHttps=function(n,t){var i=this.uriRegex.exec(n),r,u;return i==null||i.length<4?n:(r=i[2],u=i[3],r=this.overrideHost(r,t),"https://"+r+u)};et.prototype.createFromJsonUri=function(n,t,i,r,u){n||t(null,new gt("The specified jsonUri cannot be null or empty",null));window.WinJS?this.createFromFullUrl(n,t,null,!1,u):r?this.createFromFullUrl(n,t,i,r,u):this.createFromFullUrl(this.defaultHttpsPhotosynthServer+this.jsonWrapper.replace("{0}",encodeURIComponent(n)),t,null,r,u)};et.prototype.createFromFullUrl=function(n,t,r,u,f){var o=this,e,s,h;if(window.WinJS)WinJS.xhr({url:n}).then(function(n){var i=null;try{i=JSON.parse(n.responseText)}catch(r){t(null,new gt("The data returned for the pano is not valid json",r));return}this.createFromJson(i,null);o.worldConfiguration==null?t(null,new gt("The data returned for the pano is valid json but is not valid panorama data",null)):t(o.worldConfiguration)},function(n){t(null,new li("The url specified for the pano json data did not return a 200 success",n))});else if(f){if(e=new Microsoft.Maps.Internal.originalXMLHttpRequest,"withCredentials"in e)e.open("GET",n,!0);else if(window.XDomainRequest)e=new XDomainRequest,e.onprogress=function(){},e.ontimeout=function(){},e.open("GET",n);else{t(null,new Error("The browser does not support CORS"));return}e.onload=function(){try{var n=JSON.parse(e.responseText);o.createFromJson(n,r);t(o.getWorldConfiguration())}catch(i){t(null,new gt("The data returned for the pano is not valid json",i));return}};e.onerror=function(){t(null,new li("The url specified for the pano json data did not return a 200 success",null))};setTimeout(function(){e.send()},0)}else{for(s="PhotosynthCallback",h=0;window[s+h]!=null;)h++;s=s+h;window[s]=function(n){o.createFromJson(n,r);t(o.getWorldConfiguration());delete window[s]};u?i.addScriptElement(n):i.addScriptElement(n+o.jsonpWrapperParam.replace("{0}",s))}};et.prototype.createFromJson=function(t,r,f){var w,b,k,s,o,v,l,y,et,nt,tt,a,it,h,c,at,rt,vt,p;try{if(t._json_synth&&t._json_synth>=1.01){for(y in t.l)if(t.l.hasOwnProperty(y)){l=t.l[y];break}var ot=l.x[0],st=ot.cubemaps[0],d=st.field_of_view_bounds,ht=ot.r[0],ut=ht.j,g=ht.start_relative_rotation,ct=0,lt=0;if(w=l.b,b=l.attribution_url,k=l.c,g!=null){var yt=new e(0,0,1),pt=u.parseQuaternion(ut[4],ut[5],ut[6]),wt=u.parseQuaternion(g[0],g[1],g[2]),bt=pt.multiply(wt),ft=bt.transform(yt);ct=n.halfPI-Math.acos(ft.y);lt=Math.atan2(ft.z,ft.x)}for(et=null,l.highlight_map&&l.highlight_map.default_highlight&&(et=l.highlight_map.default_highlight),this.worldConfiguration={id:"panorama"+y,type:"panorama",source:{attribution:{author:w,attributionUrl:b,licenseUrl:k},dimension:0,tileSize:254,tileOverlap:1,tileBorder:1,minimumLod:8,bounds:{left:n.degreesToRadians(d[0]),right:n.degreesToRadians(d[1]),top:n.degreesToRadians(d[3]),bottom:n.degreesToRadians(d[2])},startingPitch:ct,startingHeading:lt,projectorAspectRatio:1,projectorFocalLength:.5,highlights:et}},nt=0;nt<this.faceNames.length;nt++)s=this.faceNames[nt],o=st[s],o!=null&&(tt=this.swapUrlBase(o.u,f.contentBaseUri),f.forceToHttps&&(tt=this.forceToHttps(tt,f.overrideList)),this.worldConfiguration.source[s+"Face"]={tileSource:new vr(tt).getTileUrl,clip:o.clip.vertices},this.worldConfiguration.source.dimension=Math.max(this.worldConfiguration.source.dimension,o.d[0],o.d[1]))}else if(t.cubemap_json_version<2)for(c=1,t.tile_overlap_borders?c=t.tile_overlap_borders+0:t.tile_overlaps_borders&&(c=t.tile_overlaps_borders+0),c=t.tile_overlap_borders===!1?0:1,a=t.face_size,this.worldConfiguration={id:"panorama",type:"panorama",source:{dimension:a,tileSize:t.tile_size||510,tileOverlap:c,tileBorder:c,minimumLod:Math.ceil(Math.log(t.tile_size/Math.LN2)),bounds:{left:0,right:n.twoPI,top:n.halfPI,bottom:-n.halfPI},startingPitch:0,startingHeading:0,projectorAspectRatio:1,projectorFocalLength:.5}},t.field_of_view_bounds&&(this.worldConfiguration.source.bounds={left:n.degreesToRadians(t.field_of_view_bounds[0]),right:n.degreesToRadians(t.field_of_view_bounds[1]),bottom:n.degreesToRadians(t.field_of_view_bounds[2]),top:n.degreesToRadians(t.field_of_view_bounds[3])}),t.initial_look_direction&&(this.worldConfiguration.source.startingPitch=n.degreesToRadians(t.initial_look_direction[0]),this.worldConfiguration.source.startingHeading=n.degreesToRadians(t.initial_look_direction[1])),t.orientation&&(this.worldConfiguration.source.orientation={},this.worldConfiguration.source.orientation.roll=t.orientation[0],this.worldConfiguration.source.orientation.pitch=t.orientation[1],this.worldConfiguration.source.orientation.heading=t.orientation[2]||0),this.worldConfiguration.source.faceSize=a,this.worldConfiguration.source.imageContentType=t.image_content_type||"image/jpeg",this.worldConfiguration.source.imageExtension=t.image_extension||"jpg",this.worldConfiguration.source.hasAtlas=t.has_atlas===!1?!1:!0,it=0;it<this.faceNames.length;it++)s=this.faceNames[it],o=t[s],o!=null&&(o.tile_boundaries?(h=o.tile_boundaries,v=[h.left,h.top,h.left,h.bottom,h.right,h.bottom,h.right,h.top,]):v=[0,0,0,a,a,a,a,0],this.worldConfiguration.source[s+"Face"]={tileSource:new ur(r,"formats/cubemap/"+s).getTileUrl,clip:v},this.worldConfiguration.source.maximumLod=Math.ceil(Math.log(this.worldConfiguration.source.faceSize)/Math.LN2),this.worldConfiguration.source.minimumLod=Math.ceil(Math.log(this.worldConfiguration.source.tileSize)/Math.LN2));else if(t.json_pano||t.panorama_json_version)for(c=t.tile_overlap_borders===!1?0:1,w=t.author,t.attribution_uri_format_string&&(b=i.partialDotNetStringFormat(t.attribution_uri_format_string,0,0)),k=null,at=t.publisher,this.worldConfiguration={id:"panorama"+y,type:"panorama",source:{attribution:{author:w,attributionUrl:b,licenseUrl:k,publisher:at},dimension:0,tileSize:t.tile_size,tileOverlap:c,tileBorder:c,minimumLod:Math.ceil(Math.log(t.tile_size/Math.LN2)),bounds:{left:0,right:n.twoPI,top:n.halfPI,bottom:-n.halfPI},startingPitch:0,startingHeading:0,projectorAspectRatio:1,projectorFocalLength:.5}},t.field_of_view_bounds&&(this.worldConfiguration.source.bounds={left:n.degreesToRadians(t.field_of_view_bounds[0]),right:n.degreesToRadians(t.field_of_view_bounds[1]),bottom:n.degreesToRadians(t.field_of_view_bounds[2]),top:n.degreesToRadians(t.field_of_view_bounds[3])}),t.initial_look_direction&&(this.worldConfiguration.source.startingPitch=n.degreesToRadians(t.initial_look_direction[0]),this.worldConfiguration.source.startingHeading=n.degreesToRadians(t.initial_look_direction[1])),rt=0;rt<this.faceNames.length;rt++)s=this.faceNames[rt],o=t[s],o!=null&&(v=o.clip&&o.clip.vertices?o.clip.vertices:[0,0,0,o.dimensions[1],o.dimensions[0],o.dimensions[1],o.dimensions[0],0,],p=o.tile_image_uri_format_string,f.imageTileUriSuffix&&(p+=f.imageTileUriSuffix),f.forceToHttps&&(p=this.forceToHttps(p,f.overrideList)),vt=t.panorama_json_version?new ur(r,s).getTileUrl:new pr(p,o.dimensions[0],o.dimensions[1],t.tile_size,o.finest_lod,o.number_of_lods).getTileUrl,this.worldConfiguration.source[s+"Face"]={tileSource:vt,clip:v},this.worldConfiguration.source.dimension=Math.max(this.worldConfiguration.source.dimension,o.dimensions[0],o.dimensions[1]),this.worldConfiguration.source.minimumLod=Math.ceil(Math.log(this.worldConfiguration.source.tileSize)/Math.LN2));this.viewElementContainers.push(new tr(this.worldConfiguration));this._minimumLod=this.worldConfiguration.source.minimumLod;this._maximumLod=this.worldConfiguration.source.maximumLod||n.ceilLog2(this.worldConfiguration.source.dimension);this.baseImageWidth=this.baseImageHeight=this.worldConfiguration.source.dimension;this.tileHeight=this.tileWidth=this.worldConfiguration.source.tileSize}catch(kt){window.console&&i.log(kt)}};et.prototype.createController=function(t,i){var r=null;return t&&(r=u.calculateFovAtTexelToPixelRatio(u._cubeSide,t.dimension,i.getViewport().getHeight(),1.1)),this.interactionController=new yi(i,null,null,null,r),t&&(t.startingPitch!=undefined&&this.interactionController.setPitchAndHeading(t.startingPitch,t.startingHeading,null),this.interactionController.setBounds(t.bounds),this.interactionController.setDimension(t.dimension),this.interactionController.setVerticalFov(n.degreesToRadians(80),null)),this.interactionController};s(p,vi);p.prototype.animationDurationMS=0;p.prototype.createController=function(t,i,r,f){var s=null,e,o;return t&&(s=u.calculateFovAtTexelToPixelRatio(u._cubeSide,t.maximumResolution,f||i.getViewport().getHeight(),.3)),e=0,o=0,t&&(t.startingPitch!=undefined&&(e=t.startingPitch),t.startingHeading!=undefined&&(o=t.startingHeading)),this.interactionController=this.isCursorAndLabelEnabled?new pi(i,r,n.degreesToRadians(89.9),n.degreesToRadians(-89.9),s,o,e,this.localToGlobal,this.bubbleCenterInGlobal):new oi(i,r,n.degreesToRadians(89.9),n.degreesToRadians(-89.9),s,o,e),this.interactionController.setViewTarget(e,o,null,!1),this.interactionController};p.prototype.createCameraParameters=function(t,i,r,u){var f=this.createRotationMatrix(t,i,r);return{verticalFov:u||n.degreesToRadians(80),position:new e(0,0,0),look:f.transformVector3(new e(0,0,-1)),up:f.transformVector3(new e(0,1,0)),side:f.transformVector3(new e(1,0,0))}};p.prototype.createRotationMatrix=function(n,i,r){var u=t.createRotationZ(n),f=t.createRotationX(-i),e=t.createRotationY(r);return u.multiply(f.multiply(e))};p.prototype.setRoadVector=function(n){for(var t=0;t<n.length;++t)this.roadVectorGroup.push(n[t]);this.isRoadVectorReady=!0};p.prototype.generateLabelRenderables=function(n,t){for(var i=this.labelConfiguration.labelOffsetFromBubbleInMeters,r=this.labelConfiguration.labelOffsetMaxInMeters,u=this.labelConfiguration.labelOffsetIncreaseStepInMeters;!this.tryFindLabelsAndMakeIfExist(n,i,t)&&i<r;)i+=u;this.isRoadVectorReady=!1};p.prototype.tryFindLabelsAndMakeIfExist=function(i,r,u){var ut=document.createElement("canvas"),g=ut.getContext("2d"),p=87,ft,w,h,b,et,k,v,d,c,ht,ct,s,f;g.canvas.height=p;g.font=this.labelConfiguration.font;var it=this.labelConfiguration.entityId,lt=this.worldConfiguration.source.cameraHeight,ii=this.worldConfiguration.source.latitude,ri=this.worldConfiguration.source.longitude,l=new e(0,1,0),a=[];for(s=0;s<this.roadVectorGroup.length;++s)for(ft=this.roadVectorGroup[s].latLonArray.length,w=this.roadVectorGroup[s].latLonArray,h=0;h<ft-1;++h){var at=w[h].latitude,vt=w[h].longitude,yt=w[h+1].latitude,pt=w[h+1].longitude,wt=o.fromLatLongAlt(at,vt,0),bt=o.fromLatLongAlt(yt,pt,0),kt=this.bubbleCenterInGlobal.subtract(wt),dt=this.bubbleCenterInGlobal.subtract(bt),nt=this.globalToLocal.transformVector3(kt),tt=this.globalToLocal.transformVector3(dt),gt=this.surfaceNormalInLocal.multiplyScalar(nt.dot(l)/this.surfaceNormalInLocal.dot(l)),ni=this.surfaceNormalInLocal.multiplyScalar(tt.dot(l)/this.surfaceNormalInLocal.dot(l));if(nt=nt.subtract(gt),tt=tt.subtract(ni),b=this.findIntersectAndGetLabelLines(nt,tt,l,r),et=t.createTranslation(0,-lt,0),b)for(k=0;k<b.length;++k)if(v=b[k][0],d=b[k][1],!this.checkLabelFullyOverlapped(a,v,d)){var ot=""+this.roadVectorGroup[s].name,rt=g.measureText(ot).width,ti=this.createLabelTexture(ut,g,ot,rt,p,22),st=v.add(d.multiplyScalar(rt*this.labelConfiguration.textureToGeometryRatio)),y=d.cross(l);y=y.multiplyScalar(p*this.labelConfiguration.textureToGeometryRatio/2);c=[];c[0]=st.subtract(y);c[1]=st.add(y);c[2]=v.add(y);c[3]=v.subtract(y);ht=0;f=new hi(c,[ti],it,ht);f.dimension=rt;ct=f.texturesWithPolygons[0].texture;ct.loadImageInDOM();f.transform=et;f.startPoint=v;f.direction=d;f.geometryPolygon=c;a.push(f)}}for(this.pushLabelsForwardIfNeeded(a),s=0;s<a.length;++s)f=a[s],f.id={id:it+s,levelOfDetail:24},i.add(it+s,f),f.startPoint.w=1,u&&(f.transform=f.transform.multiply(t.createTranslation(f.startPoint.x,0,f.startPoint.z).multiply(t.createRotationY(Math.atan2(f.direction.x,f.direction.z)+n.degreesToRadians(90))).multiply(t.createRotationZ(n.degreesToRadians(180))).multiply(t.createRotationX(n.degreesToRadians(90))).multiply(t.createScale(1/p,1/p,1))));return a.length>0?!0:!1};p.prototype.createLabelTexture=function(n,t,i,r,u,f){var s,e,o;return t.clearRect(0,0,r,u),t.canvas.width=r,t.font=this.labelConfiguration.font,t.fillStyle="white",t.font=this.labelConfiguration.font,t.fillText(i,0,u-f),s=n.toDataURL(),e=[],e[0]=new h(r,0),e[1]=new h(r,u),e[2]=new h(0,u),e[3]=new h(0,0),o={texture:new rt(s,null,null,null,null,null,null),polygon:e},o.texture.dataSourceWidth=r,o.texture.dataSourceHeight=u,o};p.prototype.findIntersectAndGetLabelLines=function(n,t,i,r){var u=t.subtract(n).normalize(),y=u.cross(i),f=-u.dot(n),e=Math.pow(-f,2)-(n.lengthSquared()-Math.pow(r,2)),h=t.subtract(n).length(),o=[],s;if(!(e<0)){if(e==0){f>=0&&f<=h&&o.push([n+f*u,u]);return}var c=f-Math.sqrt(e),l=f+Math.sqrt(e),a=n.add(u.multiplyScalar(c)),v=n.add(u.multiplyScalar(l));return c>=0&&c<=h&&(s=a.dot(u)>0?1:-1,o.push([a,u.multiplyScalar(s)])),l>=0&&l<=h&&(s=v.dot(u)>0?1:-1,o.push([v,u.multiplyScalar(s)])),o}};p.prototype.make2DLabelPolygon=function(n){for(var r=[],i=n.geometryPolygon,t=0;t<i.length;++t)r[t]=new h(i[t].x,i[t].z);return r};p.prototype.pushLabelsForwardIfNeeded=function(n){var k,w,o,l,a,v,i,r,c,p;if(!(n.length<2))for(k=new e(0,1,0),w=this.worldConfiguration.source.cameraHeight,o=1;o<n.length;++o)for(l=0;l<o;++l){var s=n[o],h=n[l],tt=this.make2DLabelPolygon(s),it=this.make2DLabelPolygon(h);if(u.AreIntersecting(tt,it)){i=s.direction;r=h.direction;i.cross(r).dot(k)>0?(a=this.getEdgeOfLabel(s,1)[0],v=this.getEdgeOfLabel(h,0)[0]):(a=this.getEdgeOfLabel(s,0)[0],v=this.getEdgeOfLabel(h,1)[0]);var rt=a.x,d=a.z,ut=v.x,g=v.z,y=i.x,f=i.z,nt=r.x,b=r.z,ft=f*nt-y*b;Math.abs(ft)>1e-6&&Math.abs(f)>1e-6&&(c=(f*rt-f*ut-y*d+y*g)/(f*nt-y*b),p=(b*c-d+g)/f,c>1e-6&&p>1e-6&&(s.transform=t.createTranslation(p*i.x,-w,p*i.z),h.transform=t.createTranslation(c*r.x,-w,c*r.z)))}}};p.prototype.getEdgeOfLabel=function(n,t){var i=[];return t==0?(i[0]=n.geometryPolygon[2],i[1]=n.geometryPolygon[1]):t==1&&(i[0]=n.geometryPolygon[3],i[1]=n.geometryPolygon[0]),i};p.prototype.checkLabelFullyOverlapped=function(n,t,i){for(var u,f,r=0;r<n.length;++r)if(u=n[r].startPoint,f=n[r].direction,t.subtract(u).length()<2&&i.dot(f)>.9848077)return!0;return!1};p.prototype.generateCursorRenderableIfNecessary=function(n){var l=n.map,f,r,c,o;if(!l[this.cursorConfiguration.entityId]){var i=this.cursorConfiguration.textureSize,s=this.cursorConfiguration.textureExpansion,u=[];u[0]=new h(i,0);u[1]=new h(i,i);u[2]=new h(0,i);u[3]=new h(0,0);f={texture:new rt("",null,null,null,null,null,null),polygon:u};f.texture.dataSourceWidth=i-s;f.texture.dataSourceHeight=i-s;r=[];r[0]=new e(1,0,-1);r[1]=new e(1,0,1);r[2]=new e(-1,0,1);r[3]=new e(-1,0,-1);c=0;o=new hi(r,[f],this.cursorConfiguration.entityId,c);o.transform=t.createIdentity();o.id={id:this.cursorConfiguration.entityId,levelOfDetail:24};n.add(this.cursorConfiguration.entityId,o)}};p.prototype.updateCursorRenderableTranslation=function(i,r,u){var f=i.map;f[this.cursorConfiguration.entityId]&&(f[this.cursorConfiguration.entityId].transform=u?r.multiply(t.createTranslation(-.5,0,.5).multiply(t.createRotationY(n.degreesToRadians(90))).multiply(t.createRotationX(n.degreesToRadians(90))).multiply(t.createScale(2/this.cursorConfiguration.textureSize,2/this.cursorConfiguration.textureSize,1))):r)};p.prototype.prepareCursorTextureIfNecessary=function(n){var r=n.map,i=r[this.cursorConfiguration.entityId],t;i&&(t=i.texturesWithPolygons[0].texture,t._image==null&&(t._image=new Image,t._image.style.opacity=.5,t._image.src=this.cursorConfiguration.textureData,t._isDirty=!0,t._isReady=!0))};it.StreetsidePanoramaExists=!0;lt.prototype={hasParent:function(){return this.levelOfDetail>0},getParent:function(){if(!this.hasParent())throw new Error("0 level does not have a parent");return new lt(this.levelOfDetail-1,this.x>>1,this.y>>1,this.faceName,this.idFunction)},getChildren:function(){var n=this.x<<1,t=this.y<<1;return[new lt(this.levelOfDetail+1,n,t,this.faceName,this.idFunction),new lt(this.levelOfDetail+1,n+1,t,this.faceName,this.idFunction),new lt(this.levelOfDetail+1,n,t+1,this.faceName,this.idFunction),new lt(this.levelOfDetail+1,n+1,t+1,this.faceName,this.idFunction),]},isChildOf:function(n){if(this.levelOfDetail<n.levelOfDetail)return!1;var t=this.levelOfDetail-n.levelOfDetail;return this.x>>t===n.x&&this.y>>t===n.y},equals:function(n){return this.x===n.x&&this.y===n.y&&this.levelOfDetail===this.levelOfDetail},toString:function(){return"("+this.x+","+this.y+","+this.levelOfDetail+")"}};dt.prototype.getGeometry=function(){return this._geometry};s(tr,dt);s(ir,dt);ni.prototype={getTileSize:function(){return this._worldConfiguration.source.tileSize},getMinimumLod:function(){return this._minimumLod},getMaximumLod:function(){return this._maximumLod},getViewElements:function(n,t,i,r){function h(t,i,r,e,o,s){for(var h,w,l,v,c,b,y=n._tileOverlap,p=[],k=r.length,a=0;a<k;a++)h=r[a],p.push(new f(y+h.x*o,y+h.y*s,h.z,h.w));w=e.uuid;l=new lt(e.lod,i.x,i.y,e.faceName,function(n){return w+"_"+n.faceName+n.levelOfDetail+"_"+n.x+"_"+n.y});e.getFullTransforms?(v=e.datasource.getElementTransform(l),c=e.datasource.getTileSize(),i=[new f(0,c,0,1),new f(0,0,0,1),new f(c,0,0,1),new f(c,c,0,1),]):v=e.datasource.getFaceTransform(1,u);b=new nu(i,p,v,e.tileSource,l,o,s);t[l.id]=b}var e,u,o,s;if(i<n._minimumLod||i>n._maximumLod)return null;if(n._viewElementsByLod[i])return n._viewElementsByLod[i];for(n._viewElementsByLod[i]={},e=0;e<n._faceNames.length;e++)u=n._faceNames[e],o=n._worldConfiguration.source,o&&o[u]&&(s={getFullTransforms:r,datasource:n,tileSource:o[u].tileSource,lod:i,uuid:n._worldConfiguration.id+"_"+u,faceName:u},t(h,s));return n._viewElementsByLod[i]},getFaceTransform:function(i,r){var f=t.createTranslation(-.5,-.5,0).multiply(t.createScale(1/i,1/i,1)),e=.5,u;switch(r){case"frontFace":u=t.createTranslation(0,0,-e).multiply(f);break;case"backFace":u=t.createTranslation(0,0,e).multiply(t.createRotationY(n.degreesToRadians(180)).multiply(f));break;case"leftFace":u=t.createTranslation(-e,0,0).multiply(t.createRotationY(n.degreesToRadians(90)).multiply(f));break;case"rightFace":u=t.createTranslation(e,0,0).multiply(t.createRotationY(n.degreesToRadians(-90)).multiply(f));break;case"topFace":u=t.createTranslation(0,e,0).multiply(t.createRotationX(n.degreesToRadians(90)).multiply(f));break;case"bottomFace":u=t.createTranslation(0,-e,0).multiply(t.createRotationX(n.degreesToRadians(-90)).multiply(f));break;default:throw new Error("unexpected cube face name");}return u},covertToScreenSpace:function(n,t,i,r){for(var f,s,h=n.length,l=t,c=new Array(h),e=u._halfCube,o=0;o<h;++o)f=n[o],s=f.w,f.x=(f.x/s*e+e)*i,f.y=r-(f.y/s*e+e)*r,f.z=f.z/s,c[o]=f;return new ai(c,l)},getElementTransform:function(n){var r=Math.pow(2,this._maximumLod-n.levelOfDetail),u=1,e=this._baseImageWidth/r,i=this._baseImageHeight/r,o=t.createScale(u,u,1),s=n.x*this._tileWidth,v=this._tileHeight,f=n.y*this._tileHeight+this._tileHeight,h=f<i?this._tileHeight:this._tileHeight-(f-i),c=i-(h+n.y*this._tileHeight),l=t.createTranslation(-this._tileOverlap,-this._tileOverlap,0),a=t.createTranslation(s,c,0);return this.getFaceTransform(e,n.faceName).multiply(o.multiply(a.multiply(l)))}};s(fr,ni);s(er,ni);var vr=function(n){this.getTileUrl=function(t,i,r){return n+r+"/"+t+"_"+i+".jpg"}},ur=function(n,t){this.getTileUrl=function(i,r,u){return n()+t+"/"+u+"/"+i+"_"+r+".jpg"}},pr=function(n,t,r,u,f,e){var o=Math.ceil(Math.log(Math.max(t,r))/Math.LN2),s=o-f;this.getTileUrl=function(t,r,u){var o=u-s;return o>f||o<=f-e?null:i.partialDotNetStringFormat(n,o,t,r)}};var bi={fromTileId:function(n){for(var t="",i=n.x,r=n.y,u=0;u<n.levelOfDetail;u++)t=((i&1)+2*(r&1)).toString()+t,i>>=1,r>>=1;return t},isInBounds:function(n){if(n.x<0||n.y<0)return!1;var t=1<<n.levelOfDetail;return n.x>=t||n.y>=t?!1:!0}},ru=function(n){var u=this,t;u.lastAttribution=null;var a=['<div id="attributionControl" class="panoramaAttributionControl panoramaAttributionControlContainer" >','<a id="icon_anchor" class="panoramaAttributionControl">','<div class="panoramaAttributionControl  panoramaAttributionControlIcon" id="by_icon"><\/div>','<div class="panoramaAttributionControl  panoramaAttributionControlIcon" id="nc_icon"><\/div>','<div class="panoramaAttributionControl  panoramaAttributionControlIcon" id="nd_icon"><\/div>','<div class="panoramaAttributionControl  panoramaAttributionControlIcon" id="sa_icon"><\/div>','<div class="panoramaAttributionControl  panoramaAttributionControlIcon" id="pd_icon"><\/div><\/a>','<div class="panoramaAttributionControl  panoramaAttributionControlIcon" id="copyright_icon"><\/div>','<a class="panoramaAttributionControl" id="authorTextAnchor" href=""><span class="panoramaAttributionControl panoramaAttributionControlText"  id="authorText"><\/span><\/a>','<span class="panoramaAttributionControl panoramaAttributionControlText"  id="authorTextNoAnchor"><\/span>','<span class="panoramaAttributionControl panoramaAttributionControlText" id="attributionDash">&ndash;<\/span>','<span id="publisherText"class="panoramaAttributionControl panoramaAttributionControlText" ><\/span>',"<\/div>",].join(" "),c="$$$$",h=document.createElement("div");n.appendChild(h);h.innerHTML=a;n.removeChild(h);t=h.firstChild;n.appendChild(t);var f=function(n){if(!n[c+"displayValue"]){var t=n.style.display||window.getComputedStyle(n,null).getPropertyValue("display");n[c+"displayValue"]}i.css(n,{display:"none"})},e=function(n){var t=n[c+"displayValue"]||(n.tagName==="A"||n.tagName==="SPAN"?"inline":"inline-block");i.css(n,{display:t})},r=function(n,t){return t||(t=document),t.querySelector(n)},o=function(n,t){n.textContent=t};i.css(t,{display:"block"});f(t);var l=["pd_icon","by_icon","sa_icon","nc_icon","nd_icon","copyright_icon",],s={publicDomain:{pattern:"/publicdomain/",text:"This work is identified as Public Domain.",url:"https://creativecommons.org/licenses/publicdomain/",iconsToShow:["pd_icon"]},by:{pattern:"/by/",text:"This work is licensed to the public under the Creative Commons Attribution license.",url:"https://creativecommons.org/licenses/by/3.0/",iconsToShow:["by_icon"]},bySa:{pattern:"/by-sa/",text:"This work is licensed to the public under the Creative Commons Attribution-ShareAlike license.",url:"https://creativecommons.org/licenses/by-sa/3.0/",iconsToShow:["by_icon","sa_icon"]},byNd:{pattern:"/by-nd/",text:"This work is licensed to the public under the Creative Commons Attribution-NoDerivatives license.",url:"https://creativecommons.org/licenses/by-nd/3.0/",iconsToShow:["by_icon","nd_icon"]},byNc:{pattern:"/by-nc/",text:"This work is licensed to the public under the Creative Commons Attribution-Non-commercial license.",url:"https://creativecommons.org/licenses/by-nc/3.0/",iconsToShow:["by_icon","nc_icon"]},byNcSa:{pattern:"/by-nc-sa/",text:"This work is licensed to the public under the Creative Commons Attribution-Non-commercial-ShareAlike license.",url:"https://creativecommons.org/licenses/by-nc-sa/3.0/",iconsToShow:["by_icon","nc_icon","sa_icon"]},byNcNd:{pattern:"/by-nc-nd/",text:"This work is licensed to the public under the Creative Commons Attribution-Non-commercial-NoDerivatives license.",url:"https://creativecommons.org/licenses/by-nc-nd/3.0/",iconsToShow:["by_icon","nc_icon","nd_icon"]},copyright:{pattern:"",text:"This work is copyrighted.",url:"",iconsToShow:["copyright_icon"]}},v=function(){f(t)},y=function(n){var c,u,a,i,h=s.copyright;for(f(t),i=r("#publisherText",t),f(i),o(i,""),i=r("#authorText",t),f(i),o(i,""),i=r("#authorTextAnchor",t),f(i),i.title="",i.href="",i=r("#authorTextNoAnchor",t),f(i),o(i,""),i=r("#attributionDash",t),f(i),u=0;u<l.length;++u)i=r("#"+l[u],t),f(i);i=r("#icon_anchor",t);i.href="";i.title="";for(c in s)if(s.hasOwnProperty(c)&&n&&n.licenseUrl&&n.licenseUrl.indexOf(s[c].pattern)!=-1){h=s[c];break}for(u=0;u<h.iconsToShow.length;++u)a=h.iconsToShow[u],i=r("#"+a,t),e(i);i=r("#icon_anchor",t);i.title=h.text;i.href=h.url||n.attributionUrl;!n.author&&n.publisher?(i=r("#publisherText",t),f(i),o(i,""),n.attributionUrl?(i=r("#authorText",t),e(i),o(i,n.publisher),i=r("#authorTextAnchor",t),e(i),i.href=n.attributionUrl,i.title=n.attributionUrl):(i=r("#authorTextNoAnchor",t),e(i),o(i,n.publisher))):(n.publisher?(i=r("#publisherText",t),e(i),o(i,n.publisher),i=r("#attributionDash",t),e(i)):(i=r("#publisherText",t),f(i),o(i,"")),n.author&&(n.attributionUrl?(i=r("#authorText",t),e(i),o(i,n.author),i=r("#authorTextAnchor",t),e(i),i.href=n.attributionUrl,i.title=n.attributionUrl):(i=r("#authorTextNoAnchor",t),e(i),o(i,n.author))));e(t)};u.setAttribution=function(n){(u.lastAttribution!=null&&n.author===u.lastAttribution.author&&n.publisher===u.lastAttribution.publisher&&n.attributionUrl===u.lastAttribution.attributionUrl&&n.licenseUrl===u.lastAttribution.licenseUrl||u.lastAttribution===null)&&(y(n),u.lastAttribution=n)};u.clearAttrubution=function(){u.lastAttribution=null;v()};u.dispose=function(){t&&t.parentNode&&(t.parentNode.removeChild(t),t=null)}},su=function(n,t){function gi(n,t){arguments.length==1&&arguments[0]&&typeof arguments[0]=="object"&&(t=arguments[0].height,n=arguments[0].width);i.css(p,{width:n+"px",height:t+"px"});i.css(d,{width:n-2+"px",height:t-2+"px",backgroundColor:"#00000000"});s.setViewportSize(n,t);y.setViewport(new at(n,t,y.getViewport().getNearDistance(),y.getViewport().getFarDistance()));b.setViewChanged(!0)}function hi(){return u[e].getInteractionController().getPitch()}function ci(n,t,i){u[e].getInteractionController().setViewTarget(n,null,null,t,i)}function li(){return u[e].getInteractionController().getHeading()}function ai(n,t,i,r){u[e].getInteractionController().setViewTarget(null,n,null,t,i,r)}function vr(){return u[e].getInteractionController().getVerticalFov()}function yr(n,t,i){u[e].getInteractionController().setViewTarget(null,null,n,t,i)}function nr(n){u[e].getInteractionController().zoomIn(n)}function tr(n){u[e].getInteractionController().zoomOut(n)}function pr(n){n.type==="discreteZoom"&&n.mouseInteractionType!=="mousewheel"?l.doubleTappedEvent&&l.doubleTappedEvent.fire(n):n.type==="keydown"?l.keyDownEvent&&l.keyDownEvent.fire(n):n.type==="keyup"&&l.keyUpEvent&&l.keyUpEvent.fire(n)}function ir(n,t){rt=!1;t&&t(n)}function ni(){var i,y,n,t,p,k;if(!pi){if(i=window.stats,i!==undefined&&i.begin(),o&&o.control)y=o.control(y,ot?v.getQueuedEvents():[]);else{h=null;return}if(n=y.getPose(),a.hasBlockingDownload()||n.height<=0||n.width<=0){ti&&(h=ei(ni));return}var d=bi?.1:1,f=v.userCurrentlyInteracting(),w=wt!=null&&!wt.isFuzzyEqualTo(n,d),s=(new Date).valueOf();f?yt=null:wi&&(yt==null&&(yt=s+1e3),yt>s?f=!0:yt=null);var c=f||w,g=c!==ki,r=g||c||a.currentlyDownloading()||!wt.isFuzzyEqualTo(n,.001);if(r?vt=null:pt&&(vt==null&&(vt=s+500),vt>s?r=!0:vt=null),wt=n,wi=f,bi=w,ki=c,t=!0,p=!1,u[e].isCursorAndLabelEnabled&&(p=o.getIsNewHitTestResult(),o.setIsNewHitTestResult(!1)),(rt||r||pt||p)&&(t=b.RenderFrame(c)),u[e].isCursorAndLabelEnabled&&(o.getIsPancakeClicked()?(k=o.getPancakeLocation(),l.tappedEvent.fire(k),o.setIsPancakeClicked(!1)):o.isUpArrowPressed?o.navigateForward():o.isDownArrowPressed&&o.navigateForward(!1)),t&&!r&&pt&&(l.doneRenderingEvent&&l.doneRenderingEvent.fire(l.getView()),!ot)){h=null;return}pt=r||!t;t&&kt!==null&&(l.viewChangeEndEvent.fire(kt),kt=null);h&&(ti||!t||u[e].isCursorAndLabelEnabled)&&(h=ei(ni));i!==undefined&&i.end()}}function wr(){for(var t=f.dataSources,i=t.length,n=0;n<i;n++)rr(t[n])}function rr(n){e=n.getDataSourceName();u[n.getDataSourceName()]=n;u.push(n);h||(h=ei(ni))}function ur(n){if(n){er();for(var t=0;t<u.length;t++)u[e]===u[t]&&u.splice(t,1);delete u[e];rr(n);y.setCameraParameters(n.initialCameraParams);cr();fr()}}function fr(){var n=u[e].getInteractionController();n.viewChangeEvent.addEventListener(or);n.viewChangeEndEvent.addEventListener(sr)}function er(){var n=u[e].getInteractionController();n.viewChangeEvent.removeEventListener(or);n.viewChangeEndEvent.removeEventListener(sr)}function or(n){l.viewChangeEvent.fire(n)}function sr(n){kt=n}function br(n,t){var r={width:n+"px",height:t+"px",position:"absolute",direction:"ltr",overflow:"hidden",tabIndex:0,"-ms-touch-action":"none","touch-action":"none"},u={width:n+"px",height:t+"px",position:"absolute",webkitTapHighlightColor:"rgba(0,0,0,1)",tabIndex:0,zIndex:99,"-ms-touch-action":"none","touch-action":"none"};f.top&&(r.top=f.top+"px",u.top=f.top+"px");f.left&&(r.left=f.left+"px",u.left=f.left+"px");i.css(p,r);i.css(d,u)}function dr(){var t=.2617993877991494,i=.4363323129985824;st(ii,tt,"sivZoomInButton","+",65,20,function(n){k(n);nr(!0)},1);st(ri,tt,"sivZoomOutButton","-",20,20,function(n){k(n);tr(!0)},2);st(oi,tt,"sivPitchUpButton","^",42,85,function(n){k(n);ci(hi()+t,!0,null)},5);st(ui,tt,"sivHeadingLeftButton","<",65,130,function(n){k(n);ai(li()-i,!0,null)},3);st(fi,tt,"sivHeadingRightButton",">",20,130,function(n){k(n);ai(li()+i,!0,null)},4);st(si,tt,"sivPitchDownButton","v",42,170,function(n){k(n);ci(hi()-t,!0,null)},6);tt.type="text/css";n.appendChild(tt)}function st(t,r,u,f,e,o,s,h){r.innerHTML+=" ."+u+" { width: 35px; height: 35px; position: absolute; right: "+e+"px; top: "+o+"px; z-index: 777; tabIndex: "+h+" }";t.id=u;t.textContent=f;t.className=u;i.bind(t,"touchend",s,null);i.bind(t,"touchstart",k,null);i.bind(t,"touchend",k,null);i.bind(t,"touchcancel",k,null);i.bind(t,"click",s,null);i.bind(t,"dblclick",k,null);n.appendChild(t)}function k(n){n.stopPropagation();n.stopImmediatePropagation();n.preventDefault()}function gr(){var n=f.renderer,t;n=n?n.toLowerCase():"";switch(n){case"webgl":if(!ht("webgl"))throw new Error("WebGL is not supported");break;case"css3d":if(!ht("css3d"))throw new Error("CSS3D is not supported");break;case"canvas2d":if(!ht("canvas2d"))throw new Error("Canvas is not supported");break;default:if(!ht("webgl")&&!ht("css3d")&&!ht("canvas2d"))throw new Error("Could not create webgl, css3d or canvas renderers: "+n);}t=g.debugEnabled?{r:.4,g:.4,b:.4,a:1}:f.backgroundColor;s&&s.setBackGroundColor(t)}function ht(n){try{switch(n){case"webgl":s=new w(p,ft,et);vi=!0;break;case"css3d":s=new c(p,ft,et);break;case"canvas2d":s=new nt(p,ft,et)}}catch(t){return!1}return s!=null}function nu(){var t,n;if(f.dataSources)for(t=u.length,n=0;n<t;n++)yi.add(u[n].getWorldConfiguration());else throw new Error("expected worldConfiguration property passed in the options object");}function tu(){var t=null,n;return f.dataSources&&f.dataSources.length>0&&(f.dataSources.length==1?(n=f.dataSources[0],n&&n.worldConfiguration&&n.worldConfiguration.source&&n.worldConfiguration.source.attribution&&(t=n.worldConfiguration.source.attribution)):i.log("Attribution: More than one datasource encountered")),t}function fu(){var t=tu();f.hideAttribution||t&&(lt=new ru(n),lt.setAttribution(t));t&&lr(t)}function cr(){for(var n,t,r=u.length,i=0;i<r;i++)n=u[i],n.createController&&(t=n.createController(n.worldConfiguration.source,y,y.getCameraParameters(),f.height),o&&(t._scrollAccX=o._scrollAccX,t._scrollAccY=o._scrollAccY,o.stopMovingCamera()),o=t,n.outputMultiLODTiles!=null&&(it.outputMultiLODTiles=n.outputMultiLODTiles),n.scanConvertSize!=null&&(it.scanConvertSize=n.scanConvertSize))}function eu(){a.customFailFunc&&a.customFailFunc();f.tileDownloadFailed&&f.tileDownloadFailed();it.tileDownloadFailed&&it.tileDownloadFailed()}var v,dt,di,gt;if(!n)throw new Error("expected div argument");var ut="button",l=this,f=t||{},lr=f.attributionChanged||function(){},ti=!0,p=document.createElement("div"),d=document.createElement("div"),vi=!1,s=null,yi=new iu,u=[],e=null,ft=f.width||n.offsetWidth,et=f.height||n.offsetHeight,lt=null,o=null,h,ot=!0,rt=!1,pi=!1,pt=null,wt=null,wi=null,bi=null,ki=null,vt=null,yt=null,bt=300,ar=new at(ft,et,1e-5,100),y=null,a=null,b=null,kt=null,ii=document.createElement(ut),ri=document.createElement(ut),ui=document.createElement(ut),fi=document.createElement(ut),oi=document.createElement(ut),si=document.createElement(ut),tt=document.createElement("style");for(wr(),br(ft,et),gr(),nu(),fu(),n.appendChild(p),n.appendChild(d),f.hideDefaultControls||dr(),v=new kr(d,pr),f.noInteraction||v.enable(),a=new uu(vi,eu,f.tileDownloadSucceeded),dt=null,di=u.length,gt=0;gt<di;gt++){dt=u[gt].getInitialCameraParams();break}y=new hu(ar,dt);b=new ou(s,u,y,a);gi(ft,et);cr();f.height=null;this.viewChangeEvent=new ct;this.viewChangeEndEvent=new ct;this.doneRenderingEvent=new ct;this.keyDownEvent=new ct;this.keyUpEvent=new ct;this.doubleTappedEvent=new ct;this.tappedEvent=new ct;this.removeDataSource=function(n,t,f){t=t||r.TYPE.FadeOut;for(var e=0,o=u.length;e<o;e++)if(n&&u[e].dataSourceName===n){b.registerDataSourceForRemoval(n,t,bt,function(n){var t=n.getDataSourceName();i.deleteFromArray(u,function(n){return n&&n.getDataSourceName()===t});a.resetCaches();u.length===0&&(hr(h),h=null);f&&f(t)});rt=!0;return}if(n&&u[n]){b.registerDataSourceForRemoval(n,t,bt,function(n){var t=n.getDataSourceName();i.deleteFromArray(u,function(n){return n&&n.getDataSourceName()===t});u[t]=null;f&&f(t)});rt=!0;return}i.log(n+" was not found in the list of active datasources");return};this.addDataSource=function(n,t,i,u,f,e,o){i=i||r.TYPE.FadeIn;ur(n);e=e!==undefined?e:null;f=f!==undefined?f:null;o=o!==undefined?o:null;this.setView(e,f,o,!1,0);a.resetCaches();b.registerDataSourceForAdd(n,i,bt,function(n){u&&u(n);rt=!1});rt=!0};this.dispose=function(){if(!this.disposed){pi=!0;v&&(v.disable(),v=null);p.parentNode&&(p.parentNode.removeChild(p),p=null);d.parentNode&&(d.parentNode.removeChild(d),d=null);lt&&(lt.dispose(),lt=null);ti=!1;er();hr(h);h=null;a.resetDownloadAll();a.resetCaches();a=null;b.dispose();b=null;yi=null;y=null;dt=null;i._unbindAll(ii);i._unbindAll(ri);i._unbindAll(ui);i._unbindAll(fi);i._unbindAll(oi);i._unbindAll(si);ii=null;ri=null;ui=null;fi=null;oi=null;si=null;tt=null;this.viewChangeEvent=null;this.viewChangeEndEvent=null;this.doneRenderingEvent=null;this.keyDownEvent=null;this.keyUpEvent=null;this.doubleTappedEvent=null;this.tappedEvent=null;s=null;n=null;u.length=0;for(var t in u)u.hasOwnProperty(t)&&delete u[t]}};this.setViewportSize=gi;this.getViewportSize=function(){return{width:y.getViewport().getWidth(),height:y.getViewport().getHeight()}};this.getView=function(){return u[e].getInteractionController().getView()};this.setView=function(n,t,i,r,f,o){u[e].getInteractionController().setViewTarget(n,t,i,r,f,o)};this.getPitch=hi;this.setPitch=ci;this.getHeading=li;this.setHeading=ai;this.getBounds=function(){return u[e].getInteractionController().getBounds()};this.getVerticalFov=vr;this.setVerticalFov=yr;this.zoomIn=nr;this.zoomOut=tr;this.getIsInteractive=function(){return ot};this.setIsInteractive=function(n){ot=n;v&&(ot&&!v.isEnabled()&&v.enable(),!ot&&v.isEnabled()&&v.disable());n&&!h&&(h=ei(ni));d.style.visibility=n?"visible":"hidden"};this.setFocus=function(){var n=document.getElementById("focusElement");n.setAttribute("tabindex","0");n&&n.focus()};this.getRendererType=function(){if(s){if(s instanceof c)return"css3d";if(s instanceof w)return"webgl";if(s instanceof nt)return"canvas2d"}return""};this.transitionBetweenDataSources=function(n,t,u,f,e,o){function s(n){i.log("'"+n.getDataSourceName()+" ds is out!")}function h(n){i.log("'"+n.getDataSourceName()+"' ds is in! ");ir(n,u)}b.registerDataSourceForRemoval(n.getDataSourceName(),r.TYPE.HalfFadeOut,f+bt,s);ur(t);o=o!==undefined?o:null;e=e!==undefined?e:null;this.setView(o,e,null,!1,0);a.resetCaches();b.registerDataSourceForAdd(t,r.TYPE.FadeIn,f,h)||ir(null,u);rt=!0};fr()},rr=window.Microsoft||(window.Microsoft={}),wt=rr.ImmersiveViewer||(rr.ImmersiveViewer={});wt.SharedImmersiveViewer=su;wt.PhotosynthSivDataSource=et;wt.StreetsideSivDataSource=p;wt.JsonDownloadFailedError=li;wt.JsonMalformedError=gt;wt.Utils=i;wt.DebugHelper=g})();var po=function(n){function t(t,i,r,u,f){var o=n.call(this,"_$siv$",["am-siv","sivControl"])||this,e;return o._bubbleTransitionTime=400,o.currentDataSource=null,o.minLookupsMeters=[50,25,15,10],e=o,e.serviceEndpoints=f,e._tileUrl=f.tileUrl,e._rootElement.setAttribute("aria-label","Streetside Control"),e._rootElement.setAttribute("role","button"),e._rootElement.style.height=u+"px",e.cameraOptions=t,e.controlOptions=i,e.serviceOptions=r,e.bubbleSource=new wb(f),o}return s(t,n),t.prototype.getSivViewer=function(){return this.sivViewer},t.prototype.trySetCamera=function(n,t){return u(this,void 0,void 0,function(){var i;return f(this,function(r){switch(r.label){case 0:return[4,this.getBubbleInfo(n,t)];case 1:return i=r.sent(),i?(this._addSiv(i),this._addControlOverlay(i),[2,this._transitionToNewBubble(i,n)]):[2,!1]}})})},t.prototype.loadBubbleById=function(n){return u(this,void 0,void 0,function(){var t;return f(this,function(i){switch(i.label){case 0:return[4,this.bubbleSource.getBubbleById(n)];case 1:return t=i.sent(),[2,this._transitionToNewBubble(t)]}})})},t.prototype.getBubblesSource=function(){return this.bubbleSource},t.prototype.getCurrentView=function(){return this.sivViewer.getView()},t.prototype.getCurrentCameraOptions=function(){return this.cameraOptions},t.prototype.getCurrentBubble=function(){return this.currentBubble},t.prototype.updateOverlayOptions=function(){this.controlsOverlay&&this.controlsOverlay.updateOptions()},t.prototype.setSize=function(n,t){var i,r;n&&(this._rootElement.style.width=n+"px");t&&(this._rootElement.style.height=t+"px");(i=this.sivViewer)===null||i===void 0?void 0:i.setViewportSize(n,t);(r=this.controlsOverlay)===null||r===void 0?void 0:r.setWidth(n)},t.prototype.updateCurrentRoadShapes=function(n){var t;(t=this.controlsOverlay)===null||t===void 0?void 0:t.updateCurrentRoadShapes(n)},t.prototype.getBubbleInfo=function(n,t){return u(this,void 0,void 0,function(){var r,c,i,s,h,u,o;return f(this,function(f){switch(f.label){case 0:return n.bubbleId?[4,this.bubbleSource.getBubbleById(n.bubbleId)]:[3,2];case 1:return[2,f.sent()];case 2:return r=n.bounds,c=n.center||e.data.BoundingBox.getCenter(r),n.center&&(t=Math.round(t),i=this.controlOptions.bubbleLookupRadius,i<0&&(s=20,h=Math.min(s,t),i=Math.pow(2,s-h),u=this.minLookupsMeters[h-17],isNaN(u)&&(u=this.minLookupsMeters[0]),i=Math.max(i,u)),r=eo(n.center,i)),[4,this.bubbleSource.getBubbles(r,c,1)];case 3:return o=f.sent(),[2,o&&o.length>0?o[0]:null]}})})},t.prototype.dispose=function(){var t=this;t.controlsOverlay&&t.controlsOverlay.dispose();t.controlsOverlay=null;t.bubbleSource=null;t.currentDataSource=null;t.currentBubble=null;t.nextBubble=null;t.pendingBubbleUpdate=null;t.sivViewChangeHandler=null;t.sivViewer&&t.sivViewer.dispose();t.sivViewer=null;n.prototype.dispose.call(this)},t.prototype._addControlOverlay=function(n){var t=this;t.controlsOverlay||(t.controlsOverlay=new lk(t,t.controlOptions,n,this.serviceOptions,t.serviceEndpoints),t.controlsOverlay._addEventListener("exit",function(){t._invokeEvent("exit",null)},!0),t.controlsOverlay._addEventListener("mapOverviewModeChanging",function(n){t._invokeEvent("mapOverviewModeChanging",n)},!1),t._rootElement.appendChild(t.controlsOverlay.getRootElement()))},t.prototype._addSiv=function(n){var t=this;t.sivViewer||(this.currentBubble=n,t.currentDataSource=t._getDataSource(n,t.cameraOptions),t.viewerOptions={dataSources:[t.currentDataSource],hideDefaultControls:!0},t.sivViewer=new Microsoft.ImmersiveViewer.SharedImmersiveViewer(t._rootElement,t.viewerOptions),t.sivViewChangeHandler=function(i){t._updateCameraOptions(i,n.id);t._invokeEvent("viewchange",i)},t.controlOptions.setFocusOnLoad&&t.sivViewer.setFocus(),t._updateCameraOptions(t.sivViewer.getView(),n.id),t.sivViewer.viewChangeEvent.addEventListener(t.sivViewChangeHandler),t.sivViewer.viewChangeEndEvent.addEventListener(function(n){t._invokeEvent("viewchangeend",n)}),t.sivViewer.doneRenderingEvent.addEventListener(function(n){t._invokeEvent("idle",n)}))},t.prototype._updateCameraOptions=function(n,t){this.cameraOptions.pitch=ri(n.pitch);this.cameraOptions.heading=ri(n.heading);this.cameraOptions.bubbleId=t},t.prototype._getDataSource=function(n){var t=n;return new Microsoft.ImmersiveViewer.StreetsideSivDataSource(this._tileUrl,this.convertBubbleIdToQuad(t.id),t.he,t.pi,t.ro,t.ml,t.la,t.lo)},t.prototype.convertBubbleIdToQuad=function(n){var t=n.toString(4);return("0000000000000000"+t).slice(-16)},t.prototype._transitionToNewBubble=function(n,t){var i=this,r=i.sivViewer.getView(),u=t&&t.heading?so(t.heading):r.heading,f=t&&t.pitch?so(t.pitch):r.pitch;return new Promise(function(e){if(n&&!i.transitioning)if(i.currentBubble.id===n.id)i.sivViewer.setView(f,u,r.verticalFov,!0),i._invokeEvent("bubbleupdated",i.currentBubble),e(!0);else{i.nextBubble=n;var o=i._getDataSource(n,t);i.transitioning=!0;i.sivViewer.transitionBetweenDataSources(i.currentDataSource,o,function(n){i._dataSourceAdded(n);e(!0)},i._bubbleTransitionTime,u,f)}else n&&(i.pendingBubbleUpdate=n);e(!1)})},t.prototype._dataSourceAdded=function(n){if(n&&(this.cameraOptions.center=[this.nextBubble.lo,this.nextBubble.la],this.currentBubble=this.nextBubble,this.currentDataSource=n,this.controlsOverlay.update(this.currentBubble),this._invokeEvent("bubbleupdated",this.currentBubble),this.nextBubble=null),this.transitioning=!1,this.pendingBubbleUpdate){var t=this.pendingBubbleUpdate;this.pendingBubbleUpdate=null;this._transitionToNewBubble(t)}},t}(a),wo=function(n){function t(t){var i=n.call(this)||this;return i._startObservingSizeChange(t),i}return s(t,n),t.prototype._startObservingSizeChange=function(n){var t=this;typeof ResizeObserver!="undefined"?(this.resizeObserver=new ResizeObserver(function(i){for(var f,r=0,u=i;r<u.length;r++)f=u[r],f.target===n&&t._invokeEvent("resize",f.contentRect)}),this.resizeObserver.observe(n)):(this.currentSize=n.getBoundingClientRect(),window.addEventListener("resize",function(){var i=n.getBoundingClientRect();(i.height!==t.currentSize.height||i.width!==t.currentSize.width)&&(t.currentSize=i,t._invokeEvent("resize",i))}))},t.prototype.dispose=function(){this.resizeObserver&&this.resizeObserver.disconnect();this.resizeObserver=null},t}(t.internal.EventEmitter),ko=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.streetsideBubbleUrl="https://t.ssl.ak.tiles.virtualearth.net/tiles/cmd/StreetSideBubbleMetaData?count=500&north={north}&south={south}&east={east}&west={west}",t.streetsideBubbleByIdUrl="https://t.ssl.ak.tiles.virtualearth.net/tiles/cmd/StreetSideBubbleMetaData?id={bubbleId}",t.tileUrl="https://t.ssl.ak.tiles.virtualearth.net/tiles/hs{quadkey}.jpg?g=0&n=z&key=",t.privacyReportForm="https://www.bing.com/maps/privacyreport/privacyreportform.aspx?bubbleid={id}",t.reverseGeocoderUrl="https://{domain}/search/address/reverse/json?subscription-key={subscription-key}&api-version=1.0&query={latitude},{longitude}",t.streetsideCoverageMapUrl="https://t.ssl.ak.dynamic.tiles.virtualearth.net/comp/ch/{quadkey}?mkt=en-US&it=Z,HC&og=0&src=h",t}return s(t,n),t}(tr),go=function(n){function t(t,i){var f=n.call(this)||this,r=f,u,e;return r.isActive=!1,r._serviceEndpoints=new ko,f._cameraOptions=(new ir).merge(v(i)),r._controlOptions=(new uo).merge(v(i)),r._controlOptions.rootElement||(r._controlOptions.rootElement=t.getMapContainer()),r._map=t,u=r._controlOptions.rootElement,u=typeof u=="string"?document.getElementById(u):u,r._controlOptions.rootElement=u,r._rootElement=u,e=u.getBoundingClientRect(),r._width=e.width,r._height=e.height,r._cameraOptions.center=f._cameraOptions.center||f._map.getCamera().center,r._cameraOptions.pitch=r._cameraOptions.pitch||r._map.getCamera().pitch,r._serviceOptions=r._map.getServiceOptions(),f}return s(t,n),t.prototype.activate=function(n){return u(this,void 0,void 0,function(){var t,i;return f(this,function(r){switch(r.label){case 0:return t=this,n&&(t._cameraOptions=n.center||n.bubbleId?(new ir).merge(v(n)):t._cameraOptions.merge(v(n))),[4,t.isStreetsideAvailable(t._cameraOptions)];case 1:return(i=r.sent(),!i)?[3,3]:(t._initializeSivControl(),t._initializeControls(),[4,t.trySetCamera(t._cameraOptions)]);case 2:r.sent();r.label=3;case 3:return[2,i]}})})},t.prototype.deactivate=function(){var n=this;n.isActive=!1;n._isInitialized=!1;n._detachDataLoadedEvent();n._sivControl&&n._sivControl.dispose();n._sivControl=null;n._detachOverviewMap();n._sizeObserver&&n._sizeObserver.dispose();n._sizeObserver=null},t.prototype.isStreetsideAvailable=function(n){return u(this,void 0,void 0,function(){var t,i;return f(this,function(r){switch(r.label){case 0:return this._initializeSivControl(),t=this._map.getCamera(),n||(n={center:this._cameraOptions.center||t.center}),[4,this._sivControl.getBubbleInfo(n,t.zoom)];case 1:return i=r.sent(),[2,!!i]}})})},t.prototype.getRootElement=function(){return this._rootElement},t.prototype.getOptions=function(){return this._controlOptions},t.prototype.getCamera=function(){return this._sivControl.getCurrentCameraOptions()},t.prototype.getOverviewMap=function(){var n;if((n=this._overviewMapControl)!==null&&n!==void 0)return n.overviewMap},t.prototype.getBubbleId=function(){var n,t=(n=this._sivControl)===null||n===void 0?void 0:n.getCurrentBubble();if(t!==null&&t!==void 0)return t.id},t.prototype.setOptions=function(n){var t=this,i=t._controlOptions.rootElement!==n.rootElement;t._controlOptions=t._controlOptions.merge(v(n));(t._isInitialized||n.visible)&&(i?(t.deactivate(),t.activate()):n.visible?t.activate():(t._sivControl.updateOverlayOptions(),t._updateVisibility(),t._controlOptions.overviewMapMode==="hidden"?t._detachOverviewMap():t._attachOverviewMap(),t._tryAttachingDataLoadedEvent()))},t.prototype.trySetCamera=function(n){return u(this,void 0,void 0,function(){var u,e,o,t,i,r;return f(this,function(f){switch(f.label){case 0:return n?(u=!n.bubbleId&&(n.center||n.bounds),this._cameraOptions=this._cameraOptions.merge(v(n)),u&&delete this._cameraOptions.bubbleId,e=this.getOverviewMap()||this._map,o=e.getCamera(),t=v(this._cameraOptions),i=this.getOverviewMap(),i&&(t.bounds=i.getCamera().bounds,t.center=undefined),[4,this._sivControl.trySetCamera(t,this._map.getCamera().zoom)]):[3,2];case 1:return r=f.sent(),this.isActive=this.isActive||r,[2,r];case 2:return[2,!1]}})})},t.prototype.dispose=function(){var n=this;n.deactivate();n._map=null;n._cameraOptions=null;n._controlOptions=null;n._rootElement=null;n._serviceOptions=null},t.prototype._setServiceEndpoints=function(n){this._serviceEndpoints=this._serviceEndpoints.merge(v(n))},t._updateLocalizedResources=function(n){n&&(o.ArrowTapAndHoldTooltip=n.ArrowTapAndHoldTooltip,o.CompassButton=n.CompassButton,o.ExitButtonTooltip=n.ExitButtonTooltip,o.OverviewMapSwitchOffTip=n.OverviewMapSwitchOffTip,o.OverviewMapSwitchOnTip=n.OverviewMapSwitchOnTip,o.ReportAProblem=n.ReportAProblem,o.ZoomInButton=n.ZoomInButton,o.ZoomOutButton=n.ZoomOutButton)},t.prototype._initializeSivControl=function(){var n=this;n._sivControl||(n._sivControl=new po(n._cameraOptions,n._controlOptions,n._serviceOptions,n._height*n._getSivHeightRatio(),n._serviceEndpoints))},t.prototype._updateVisibility=function(){var n=this;n._controlOptions.visible?n.isActive||n.activate():n.deactivate()},t.prototype._initializeControls=function(){var t=this,n=this;n._isInitialized||(n._isInitialized=!0,n._rootElement.appendChild(n._sivControl.getRootElement()),n._sivControl._addEventListener("exit",function(){t._invokeEvent("exit",{map:n._map,type:"exit"});n.deactivate()},!0),n._sivControl._addEventListener("viewchange",function(i){n._overviewMapControl&&n._overviewMapControl.update(ri(i.heading));n._invokeEvent("viewchange",t._getViewChangeEventArgs("viewchange"))},!1),n._sivControl._addEventListener("viewchangeend",function(){n._invokeEvent("viewchangeend",t._getViewChangeEventArgs("viewchangeend"))},!1),n._sivControl._addEventListener("idle",function(){n._invokeEvent("idle",t._getViewChangeEventArgs("idle"))},!1),n._sivControl._addEventListener("bubbleupdated",function(i){if(i){var r=[i.lo,i.la];n._overviewMapControl&&n._overviewMapControl.update(ri(n._sivControl.getCurrentView().heading),r)}n._invokeEvent("bubblechanged",t._getViewChangeEventArgs("bubblechanged"))},!1),n._sivControl._addEventListener("mapOverviewModeChanging",function(t){n._sivControl.setSize(n._width,n._height*t.ratio);n._overviewMapControl&&n._overviewMapControl.setHeight(n._height*(1-t.ratio));t.completed&&n._invokeEvent("overviewmodechanged",{overviewMapMode:n.getOptions().overviewMapMode,map:n._map,type:"overviewmodechanged"})},!1),n._attachOverviewMap(),n._sizeObserver=new wo(n._rootElement),n._sizeObserver._addEventListener("resize",function(t){n._onResize(t)},!1),this._updateVisibility(),n._tryAttachingDataLoadedEvent())},t.prototype._getViewChangeEventArgs=function(n){var t=this.getCamera(),i=this.getBubbleId();return{heading:t.heading,pitch:t.pitch,location:t.center,bubbleId:i,map:this._map,type:n}},t.prototype._detachDataLoadedEvent=function(){var n=this,t=n._overviewMapControl&&n._overviewMapControl.overviewMap;n._dataLoadedEventHandler&&(n._map&&n._map.events.remove("idle",n._dataLoadedEventHandler),t&&t.events.remove("idle",n._dataLoadedEventHandler));n._dataLoadedEventHandler=null},t.prototype._attachOverviewMap=function(){var n=this;n._overviewMapControl||n._controlOptions.overviewMapMode==="hidden"||(n._overviewMapControl=new sb(n._rootElement,n._cameraOptions,n._serviceOptions,n._height*(1-n._getSivHeightRatio()),n._serviceEndpoints),n._overviewMapControl._addEventListener("moveend",function(t){n.trySetCamera({center:t,bubbleId:null})},!1))},t.prototype._detachOverviewMap=function(){this._overviewMapControl&&this._overviewMapControl.dispose();this._overviewMapControl=null},t.prototype._tryAttachingDataLoadedEvent=function(){var n=this,i=n._overviewMapControl&&n._overviewMapControl.overviewMap,t;this._detachDataLoadedEvent();t=i?i:this._map;t&&(n._dataLoadedEventHandler=function(){var i,r=t.getCamera().center,u=t.layers.getRenderedShapes(eo(r,100));(i=n._sivControl)===null||i===void 0?void 0:i.updateCurrentRoadShapes(u)},t.events.add("idle",n._dataLoadedEventHandler))},t.prototype._onResize=function(n){this._width=n.width;this._height=n.height;this._sivControl.setSize(n.width,n.height*this._getSivHeightRatio());this._overviewMapControl&&this._overviewMapControl.setHeight(n.height*(1-this._getSivHeightRatio()))},t.prototype._getSivHeightRatio=function(){var n=this._controlOptions.overviewMapMode;return n==="expanded"?c.expanded:n==="minimized"?c.minimized:c.hidden},t}(e.internal.EventEmitter),fc=Object.freeze({__proto__:null,StreetsideControl:go,StreetsideControlOptions:uo,StreetsideCameraOptions:ir}),ec=or.merge("atlas.control",fc);n.control=ec;Object.defineProperty(n,"__esModule",{value:!0})});atlas.control.StreetsideControl._updateLocalizedResources({ArrowTapAndHoldTooltip:r.L_ArrowTapAndHoldTooltip,CompassButton:r.L_CompassButton_Title,ExitButtonTooltip:r.L_ExitButtonTooltip,OverviewMapSwitchOffTip:r.L_OverviewMapSwitchOffTip,OverviewMapSwitchOnTip:r.L_OverviewMapSwitchOnTip,ReportAProblem:r.L_ReportAProblem_LinkText,ZoomInButton:r.L_ZoomInButton_Title,ZoomOutButton:r.L_ZoomOutButton_Title});var w=function(n){function t(t,i,r){var e=this,c=t.getAzureMap(),nt;e=n.call(this,c,r)||this;e._isMainMapsInstance=!1;e._onKeyup=function(n){n&&n.keyCode===27&&e.toggleCoverage(!1)};e._disposables=[];e._map=c;e._mapShell=t;var w=s.tileSourceParam?"&src=".concat(s.tileSourceParam):"",l=s.dynamicProperties,y=l.sessionKey,g=l.streetsideMetadataGenerationId,a=o._updateTfeUrlDomain;return e._reverseGecoder=new p,nt={privacyReportForm:u.reportAProblemUrlFormat,streetsideBubbleByIdUrl:a(u.getBubblesByIdUrlFormat).replace("{credentials}",y).replace("{hsmsgenid}",g),streetsideBubbleUrl:a(u.getBubblesByLocationRectUrlFormat).replace("{credentials}",y).replace("{hsmsgenid}",g),streetsideCoverageMapUrl:a(u.coverageLayerTileUrlFormat).replace("{srcparam}",w).replace("{lang}",l.uiLanguage).replace("{odmgenid}",l.compositionHandlerGenerationId),tileUrl:a(u.tileUrlFormat).replace("{credentials}",y).replace("{srcparam}",w).replace("{hsgenid}",l.streetsideImageryGenerationId),reverseGeocoderUrl:{url:e._reverseGecoder.getReverseGeocoderUrl(null,!1),responseParser:function(n){return e._reverseGecoder.getFirstFormattedAddress(n)}}},e._disposables.push(e.onActivate=new h,e.onExit=new h),e._setServiceEndpoints(nt),i&&(e._isMainMapsInstance=!0,i.then(function(n){n.register("StreetsideControl",e)}),e._disposables.push(e.serializableObjectChanged=new h,f.add(c,"viewchangeend",e,function(){e.serializableObjectChanged.invoke()}),f.add(c,"bubblechanged",e,function(){e.serializableObjectChanged.invoke()}),f.add(c,"exit",e,function(){e.serializableObjectChanged.invoke()}),f.add(c,"overviewmodechanged",e,function(){e.serializableObjectChanged.invoke()}))),e._isMainMapsInstance&&(e._disposables.push(e._ssCoverage=new b(c)),e._disposables.push(e._ssCoverage.onClick.add(function(n){return e._onCoverageMapClick(n)})),e._disposables.push(e._ssCursor=new k(c))),v.enableStreetsideFdbk&&(e._ssFeedbackButton=new d,e.onActivate.add(function(){e.getRootElement()&&!e.getRootElement().classList.contains("standaloneStreetside")&&e._ssFeedbackButton.activate(e._mapShell,e)})),e}return l(t,n),t.prototype.toggleCoverage=function(n){var t,i;this._ssCoverage&&(this._ssCoverage.toggleCoverage(n),this._ssCoverage.getIsDisplayed()?((t=this._ssCursor)===null||t===void 0?void 0:t.attach(),e(window).add_event("keyup",this._onKeyup)):((i=this._ssCursor)===null||i===void 0?void 0:i.detach(),e(window).remove_event("keyup",this._onKeyup)))},t.prototype.getCoverage=function(){return this._ssCoverage},t.prototype.activate=function(t){var i=this,r;return this._activationPromise||((r=this._ssCursor)===null||r===void 0?void 0:r.setCursorMode(1),this._activationPromise=new Promise(function(r){i._isMainMapsInstance&&c.setStartTime("Maps_SSTTG");n.prototype.activate.call(i,t).then(function(n){var s,o,t,h;i._activationPromise=null;n?(i._isMainMapsInstance&&(e(window).remove_event("keyup",i._onKeyup),o=i._map.getCamera(),i._disposables.push(f.addOnce(i._map,"exit",i,function(){i.onExit.invoke();o.center=i.getCamera().center;o.type="jump";i._map.setCamera(o);e(window).add_event("keyup",i._onKeyup)}),f.addOnce(i._map,"idle",i,function(){window.sj_evt&&sj_evt.fire("OverlayTaskComplete","Maps_SSTTG");c.log("Maps_SSTTG")}))),t=i.getOverviewMap(),t&&(i._disposables.push(Microsoft.Maps.BingMapStyle.init(t)),h=t.getCamera().zoom,t.setCamera({maxZoom:h,minZoom:h}),t.setUserInteraction({scrollZoomInteraction:!0,dblClickZoomInteraction:!1}),t.setStyle({style:i._map.getStyle().style}),i._hideNearbyContainerIfActive(!0)),i.onActivate.invoke()):(c.removeKey("Maps_SSTTG"),(s=i._ssCursor)===null||s===void 0?void 0:s.setCursorMode(2),y.setTimeout(function(){var n,t;((n=i._ssCursor)===null||n===void 0?void 0:n.getCursorMode())===2&&((t=i._ssCursor)===null||t===void 0?void 0:t.setCursorMode(0))},u.cursorSwapDelayTimeInMilliseconds));i.enableTabFocus(!1);r(n)})})),this._activationPromise},t.prototype.serialize=function(){return null},t.prototype.deserialize=function(){},t.prototype.deactivate=function(){var t;n.prototype._invokeEvent.call(this,"exit",{map:this._map,type:"exit"});this._hideNearbyContainerIfActive(!1);n.prototype.deactivate.call(this);(t=this.onExit)===null||t===void 0?void 0:t.invoke();this.enableTabFocus()},t.prototype.enableTabFocus=function(n){var i,u,r,f,t;n===void 0&&(n=!0);u=document.getElementsByClassName("top-right subcontrol-container");r=(i=u[0])===null||i===void 0?void 0:i.getElementsByTagName("button");for(f in r)t=r[f],n?t.removeAttribute&&t.removeAttribute("tabindex"):t.setAttribute&&t.setAttribute("tabindex","-1")},t.prototype._hideNearbyContainerIfActive=function(n){var t=e(".bm_nearbyMapContainer");t&&t.length>0&&(n&&!t.has_class("bm_ssActive")?t.add_class("bm_ssActive"):n||t.remove_class("bm_ssActive"))},t.prototype.getLiveUrlParams=function(){var n={};if(this.isActive){var t=this.getCamera(),r=t.center,i=o.roundToInterval;r&&(n.cp="".concat(i(r[1],1e-6),"~").concat(i(r[0],1e-6)));t.heading&&(n.dir=i(t.heading,.1).toString());t.pitch&&(n.pi=i(t.pitch,.1).toString());n.style="x";this.getOptions().overviewMapMode==="expanded"&&(n.mo="om.1")}return n},t.prototype.dispose=function(){n.prototype.dispose.call(this);o._clearDisposables(this._disposables);this._map=null},t.prototype._onCoverageMapClick=function(n){this.activate({center:n})},t}(atlas.control.StreetsideControl),b=function(){function n(n){var t=this;this._auto=!0;this._onZoomChange=function(){if(!t._displayed&&t._auto){var n=t._map.getCamera().zoom;t._changeVisibility(n>=18)}};this._onClick=function(n){var r,i,f,e,o;if(u.showStreetside){if(n.shapes)for(i=0,f=n.shapes;i<f.length;i++)if(e=f[i],o=((r=e.layer)===null||r===void 0?void 0:r.type)==="symbol",o)return;t.onClick.invoke(n.position)}};this._onKeyup=function(n){n&&n.keyCode===27&&t.toggleCoverage(!1)};this._disposables=[this.onClick=new h];this._map=n;n.events.add("zoomend",this._onZoomChange);this._onZoomChange()}return n.prototype.getIsDisplayed=function(){return this._displayed},n.prototype.toggleCoverage=function(n){this._displayed=typeof n=="boolean"?n:!this._displayed;this._changeVisibility(this._displayed)},n.prototype.autoCoverage=function(n){this._auto!==n&&(this._auto=n,n?this._onZoomChange():this._changeVisibility(!1))},n.prototype._changeVisibility=function(n){n?this._map.events.add("click",this._onClick):this._map.events.remove("click",this._onClick);this._map.setLayoutProperty("microsoft.bing.maps.ssCoverage.ssCoverage","visibility",n?"visible":"none")},n.prototype.dispose=function(){this._map&&(this._map.events.remove("zoomend",this._onZoomChange),this._map.events.remove("click",this._onClick),e(window).remove_event("keyup",this._onKeyup));o._clearDisposables(this._disposables);this._map=null},n}(),k=function(){function n(n){var t=this;this._classMap=new Map([[0,"bm_streetsideCursorManNormal"],[1,"bm_streetsideCursorManWaiting"],[2,"bm_streetsideCursorManNoCoverage"]]);this._onMouseMove=function(n){var i;(i=t._marker)===null||i===void 0?void 0:i.setOptions({position:n.position})};this._map=n;this._marker=new atlas.HtmlMarker;this.setCursorMode(0)}return n.prototype.attach=function(){var n;this._disposables=[f.add(this._map,"mousemove",this._onMouseMove)];this.setCursorMode(0);(n=this._map)===null||n===void 0?void 0:n.markers.add(this._marker)},n.prototype.detach=function(){var n;o._clearDisposables(this._disposables);(n=this._map)===null||n===void 0?void 0:n.markers.remove(this._marker)},n.prototype.getCursorMode=function(){return this._cursorMode},n.prototype.setCursorMode=function(n){var t,i;this._cursorMode=n;i=this._getCursorHtml(n);(t=this._marker)===null||t===void 0?void 0:t.setOptions({htmlContent:i})},n.prototype.dispose=function(){this.detach();this._map=null;this._marker=null},n.prototype._getCursorHtml=function(n){var t=this._classMap.get(n)||this._classMap.get(0);return"\n            <div class='bm_streetsideCursorMan ".concat(t,"'>\n                ").concat(n===2?"\n                        <div class= 'bm_streetsideCursorNoCoverageMessage' >\n                            ".concat(r.L_StreetsideNoCoverageInstructions_Text,"\n                        <\/div>\n                    "):"","\n            <\/div>\n        ")},n}(),d=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return l(t,n),t.prototype.onAdd=function(){return this.uiContainer},t.prototype.activate=function(n,t){var r=this,i=this.getOverlay(t),u=i===null||i===void 0?void 0:i.querySelector(".bm_flexWrapper"),f;if(u){u.style.display="block";return}f=n.getContainer();f.instanceAsync("MapsFeedback",function(u){var s=u.getFeedbackControl(2),e=s.getRootElement(),f,o;t&&e&&(f=r.getSSFeedbackButtonContainer(t),f||(o=n.getAzureMap(),f=r.buildContainer(o,atlas.ControlStyle.auto),f.className="bm_streetsideFeedbackButtonContainer",f.append(e)),e.style.display="block",i===null||i===void 0?void 0:i.append(f),f.style.display="block",t.onExit.addOne(function(){u.resetFeedback.invoke()}))})},t.prototype.getOverlay=function(n){var t=n.getRootElement();return t.querySelector("#ssControlsOverlay")},t.prototype.getSSFeedbackButtonContainer=function(n){var t=n.getRootElement();return t.querySelector(".bm_streetsideFeedbackButtonContainer")},t.prototype.getControlsContainer=function(){return document.querySelector(".bm_controlsContainer")},t}(atlas.control.ControlBase);i.StreetsideControl=w}catch(a){if(i&&i.logger)i.logger.logCriticalError(a);else throw a;}}.call(window)