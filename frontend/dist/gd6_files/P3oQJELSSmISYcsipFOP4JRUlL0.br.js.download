(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("azure-maps-control")):typeof define=="function"&&define.amd?define(["exports","azure-maps-control"],t):(n=n||self,t(n.atlas=n.atlas||{},n.atlas))})(this,function(n,t){"use strict";function le(n,t){function i(){this.constructor=n}ot(n,t);n.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}function e(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})}function o(n,t){function o(n){return function(t){return s([n,t])}}function s(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=e[0]&2?u["return"]:e[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[e[0]&2,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i,e;return e={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&(e[Symbol.iterator]=function(){return this}),e}function ae(){this.__data__=[];this.size=0}function ve(n,t){return n===t||n!==n&&t!==t}function ye(n,t){for(var i=n.length;i--;)if(yt(n[i][0],t))return i;return-1}function be(n){var t=this.__data__,i=st(t,n),r;return i<0?!1:(r=t.length-1,i==r?t.pop():we.call(t,i,1),--this.size,!0)}function ke(n){var t=this.__data__,i=st(t,n);return i<0?undefined:t[i][1]}function de(n){return st(this.__data__,n)>-1}function ge(n,t){var i=this.__data__,r=st(i,n);return r<0?(++this.size,i.push([n,t])):i[r][1]=t,this}function l(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function no(){this.__data__=new g;this.size=0}function to(n){var t=this.__data__,i=t["delete"](n);return this.size=t.size,i}function io(n){return this.__data__.get(n)}function ro(n){return this.__data__.has(n)}function pt(n,t){return t={exports:{}},n(t,t.exports),t.exports}function co(n){var r=so.call(n,tt),u=n[tt],t,i;try{n[tt]=undefined;t=!0}catch(f){}return i=ho.call(n),t&&(r?n[tt]=u:delete n[tt]),i}function yo(n){return vo.call(n)}function ko(n){return n==null?n===undefined?bo:wo:ir&&ir in Object(n)?lo(n):po(n)}function go(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}function us(n){if(!it(n))return!1;var t=v(n);return t==ts||t==is||t==ns||t==rs}function es(n){return!!ur&&ur in n}function cs(n){if(n!=null){try{return hs.call(n)}catch(t){}try{return n+""}catch(t){}}return""}function bs(n){if(!it(n)||os(n))return!1;var t=rr(n)?ws:ls;return t.test(s(n))}function ks(n,t){return n==null?undefined:n[t]}function ds(n,t){var i=er(n,t);return fr(i)?i:undefined}function th(){this.__data__=ut?ut(null):{};this.size=0}function ih(n){var t=this.has(n)&&delete this.__data__[n];return this.size-=t?1:0,t}function oh(n){var t=this.__data__,i;return ut?(i=t[n],i===uh?undefined:i):eh.call(t,n)?t[n]:undefined}function lh(n){var t=this.__data__;return ut?t[n]!==undefined:ch.call(t,n)}function ah(n,t){var i=this.__data__;return this.size+=this.has(n)?0:1,i[n]=ut&&t===undefined?hr:t,this}function y(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function vh(){this.size=0;this.__data__={hash:new bt,map:new(rt||g),string:new bt}}function yh(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null}function ph(n,t){var i=n.__data__;return ar(t)?i[typeof t=="string"?"string":"hash"]:i.map}function wh(n){var t=ft(this,n)["delete"](n);return this.size-=t?1:0,t}function bh(n){return ft(this,n).get(n)}function kh(n){return ft(this,n).has(n)}function dh(n,t){var i=ft(this,n),r=i.size;return i.set(n,t),this.size+=i.size==r?0:1,this}function p(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function gh(n,t){var i=this.__data__,r;if(i instanceof g){if(r=i.__data__,!rt||r.length<kr-1)return r.push([n,t]),this.size=++i.size,this;i=this.__data__=new br(r)}return i.set(n,t),this.size=i.size,this}function w(n){var t=this.__data__=new g(n);this.size=t.size}function nc(n,t){for(var i=-1,r=n==null?0:n.length;++i<r;)if(t(n[i],i,n)===!1)break;return n}function rc(n,t,i){t=="__proto__"&&nu?nu(n,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[t]=i}function ec(n,t,i){var r=n[t];fc.call(n,t)&&yt(r,i)&&(i!==undefined||t in n)||tu(n,t,i)}function oc(n,t,i,r){var s=!i,e,o,u,f;for(i||(i={}),e=-1,o=t.length;++e<o;)u=t[e],f=r?r(i[u],n[u],u,i,n):undefined,f===undefined&&(f=n[u]),s?tu(i,u,f):kt(i,u,f);return i}function sc(n,t){for(var i=-1,r=Array(n);++i<n;)r[i]=t(i);return r}function hc(n){return n!=null&&typeof n=="object"}function cc(n){return b(n)&&v(n)==ru}function wc(){return!1}function gc(n,t){var i=typeof n;return t=t==null?kc:t,!!t&&(i=="number"||i!="symbol"&&dc.test(n))&&n>-1&&n%1==0&&n<t}function nl(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=su}function tl(n){return b(n)&&hu(n.length)&&!!r[v(n)]}function il(n){return function(t){return n(t)}}function ol(n,t){var r=dt(n),u=!r&&yc(n),f=!r&&!u&&eu(n),o=!r&&!u&&!f&&ul(n),s=r||u||f||o,e=s?iu(n.length,String):[],h=e.length;for(var i in n)!(t||el.call(n,i))||s&&(i=="length"||f&&(i=="offset"||i=="parent")||o&&(i=="buffer"||i=="byteLength"||i=="byteOffset")||ou(i,h))||e.push(i);return e}function sl(n){var t=n&&n.constructor,i=typeof t=="function"&&t.prototype||au;return n===i}function hl(n,t){return function(i){return n(t(i))}}function yl(n){var i,t;if(!ht(n))return ll(n);i=[];for(t in Object(n))vl.call(n,t)&&t!="constructor"&&i.push(t);return i}function pl(n){return n!=null&&hu(n.length)&&!rr(n)}function wl(n){return ti(n)?ni(n):yu(n)}function bl(n,t){return n&&et(t,ct(t),n)}function kl(n){var t=[],i;if(n!=null)for(i in Object(n))t.push(i);return t}function ta(n){var r,i,t;if(!it(n))return dl(n);r=ht(n);i=[];for(t in n)t=="constructor"&&(r||!na.call(n,t))||i.push(t);return i}function ia(n){return ti(n)?ni(n,!0):wu(n)}function ra(n,t){return n&&et(t,lt(t),n)}function ua(n,t){var i=-1,r=n.length;for(t||(t=Array(r));++i<r;)t[i]=n[i];return t}function fa(n,t){for(var i=-1,f=n==null?0:n.length,e=0,u=[],r;++i<f;)r=n[i],t(r,i,n)&&(u[e++]=r);return u}function ea(){return[]}function ca(n,t){return et(n,ii(n),t)}function la(n,t){for(var i=-1,r=t.length,u=n.length;++i<r;)n[u+i]=t[i];return n}function pa(n,t){return et(n,ef(n),t)}function wa(n,t,i){var r=t(n);return dt(n)?r:uf(r,i(n))}function ba(n){return ri(n,ct,ii)}function ka(n){return ri(n,lt,ef)}function lv(n){var i=n.length,t=new n.constructor(i);return i&&typeof n[0]=="string"&&cv.call(n,"index")&&(t.index=n.index,t.input=n.input),t}function yv(n){var t=new n.constructor(n.byteLength);return new pf(t).set(new pf(n)),t}function pv(n,t){var i=t?at(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}function wv(n){var t=new n.constructor(n.source,bf.exec(n));return t.lastIndex=n.lastIndex,t}function kv(n){return df?Object(df.call(n)):{}}function dv(n,t){var i=t?at(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}function dy(n,t,i){var r=n.constructor;switch(t){case sy:return at(n);case ny:case ty:return new r(+n);case hy:return wf(n,i);case cy:case ly:case ay:case vy:case yy:case py:case wy:case by:case ky:return gv(n,i);case iy:return new r;case ry:case ey:return new r(n);case uy:return bv(n);case fy:return new r;case oy:return gf(n)}}function ip(n){return typeof n.constructor=="function"&&!ht(n)?tp(ff(n)):{}}function rp(n){return b(n)&&si(n)==ie}function sp(n){return b(n)&&si(n)==op}function vt(n,t,r,u,f,e){var o,h=t&ap,c=t&vp,w=t&yp,l,s,a,v,p,y;if(r&&(o=f?r(n,u,f,e):r(n)),o!==undefined)return o;if(!it(n))return n;if(l=dt(n),l){if(o=av(n),!h)return du(n,o)}else{if(s=si(n),a=s==ee||s==pp,eu(n))return ku(n,h);if(s==oe||s==fe||a&&!f){if(o=c||a?{}:te(n),!h)return c?sf(n,bu(o,n)):rf(n,pu(o,n))}else{if(!i[s])return f?n:{};o=gy(n,s,h)}}return(e||(e=new gr),v=e.get(n),v)?v:(e.set(n,o),lp(n)?n.forEach(function(i){o.add(vt(i,t,r,i,n,e))}):ep(n)&&n.forEach(function(i,u){o.set(u,vt(i,t,r,u,n,e))}),p=w?c?da:hf:c?lt:ct,y=l?undefined:p(n),tc(y||n,function(i,u){y&&(u=i,i=n[u]);kt(o,u,vt(i,t,r,u,n,e))}),o)}function dp(n){return wp(n,bp|kp)}function gp(n){return Math.log(n)/se}function he(n,t,i){for(var r="",u=n,f=t,e=0;e<=i;e++)r=((u&1)+2*(f&1)).toString()+r,u>>=1,f>>=1;return r}function ce(n,t){var i,r,u;if(n&&t&&n[0].length===t.length){var e=n.length,o=t[0].length,f=new Array(e),s=t.length;for(i=0;i<e;i++)for(f[i]=new Array(o),r=0;r<o;r++)for(f[i][r]=0,u=0;u<s;u++)f[i][r]+=n[i][u]*t[u][r];return f}}var ot,d,li,ai,yt,vi,yi,pi,wi,g,bi,ki,di,gi,nt,v,fr,er,or,sr,hr,cr,bt,lr,ar,ft,vr,yr,pr,wr,br,kr,dr,gr,kt,et,iu,b,ru,ou,su,cu,ni,au,ht,yu,ti,ct,pu,wu,lt,bu,ku,du,gu,rf,sf,ri,hf,at,wf,bf,gf,te,ie,hi,se,ci,u;t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t["default"]:t;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.
    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.
    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
ot=function(n,t){return ot=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},ot(n,t)};d=function(){return d=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},d.apply(this,arguments)};li=function(){function n(){}return n.merge=function(n,t){for(var u,i=window||global,e=n.split("."),r=0,f=e;r<f.length;r++)if(u=f[r],i[u])i=i[u];else return t;return d(d({},i),t)},n}();ai=ae;yt=ve;var st=ye,pe=Array.prototype,we=pe.splice;vi=be;yi=ke;pi=de;wi=ge;l.prototype.clear=ai;l.prototype["delete"]=vi;l.prototype.get=yi;l.prototype.has=pi;l.prototype.set=wi;g=l;bi=no;ki=to;di=io;gi=ro;nt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};var uo=typeof nt=="object"&&nt&&nt.Object===Object&&nt,nr=uo,fo=typeof self=="object"&&self&&self.Object===Object&&self,eo=nr||fo||Function("return this")(),f=eo,oo=f.Symbol,a=oo,tr=Object.prototype,so=tr.hasOwnProperty,ho=tr.toString,tt=a?a.toStringTag:undefined;var lo=co,ao=Object.prototype,vo=ao.toString;var po=yo,wo="[object Null]",bo="[object Undefined]",ir=a?a.toStringTag:undefined;v=ko;var it=go,ns="[object AsyncFunction]",ts="[object Function]",is="[object GeneratorFunction]",rs="[object Proxy]";var rr=us,fs=f["__core-js_shared__"],wt=fs,ur=function(){var n=/[^.]+$/.exec(wt&&wt.keys&&wt.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();var os=es,ss=Function.prototype,hs=ss.toString;var s=cs,ls=/^\[object .+?Constructor\]$/,as=Function.prototype,vs=Object.prototype,ys=as.toString,ps=vs.hasOwnProperty,ws=RegExp("^"+ys.call(ps).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");fr=bs;er=ks;var h=ds,gs=h(f,"Map"),rt=gs,nh=h(Object,"create"),ut=nh;or=th;var rh=ih,uh="__lodash_hash_undefined__",fh=Object.prototype,eh=fh.hasOwnProperty;var sh=oh,hh=Object.prototype,ch=hh.hasOwnProperty;sr=lh;hr="__lodash_hash_undefined__";cr=ah;y.prototype.clear=or;y.prototype["delete"]=rh;y.prototype.get=sh;y.prototype.has=sr;y.prototype.set=cr;bt=y;lr=vh;ar=yh;ft=ph;vr=wh;yr=bh;pr=kh;wr=dh;p.prototype.clear=lr;p.prototype["delete"]=vr;p.prototype.get=yr;p.prototype.has=pr;p.prototype.set=wr;br=p;kr=200;dr=gh;w.prototype.clear=bi;w.prototype["delete"]=ki;w.prototype.get=di;w.prototype.has=gi;w.prototype.set=dr;gr=w;var tc=nc,ic=function(){try{var n=h(Object,"defineProperty");return n({},"",{}),n}catch(t){}}(),nu=ic;var tu=rc,uc=Object.prototype,fc=uc.hasOwnProperty;kt=ec;et=oc;iu=sc;b=hc;ru="[object Arguments]";var uu=cc,fu=Object.prototype,lc=fu.hasOwnProperty,ac=fu.propertyIsEnumerable,vc=uu(function(){return arguments}())?uu:function(n){return b(n)&&lc.call(n,"callee")&&!ac.call(n,"callee")},yc=vc,pc=Array.isArray,dt=pc;var bc=wc,eu=pt(function(n,t){var i=t&&!t.nodeType&&t,r=i&&!0&&n&&!n.nodeType&&n,e=r&&r.exports===i,u=e?f.Buffer:undefined,o=u?u.isBuffer:undefined,s=o||bc;n.exports=s}),kc=9007199254740991,dc=/^(?:0|[1-9]\d*)$/;ou=gc;su=9007199254740991;var hu=nl,r={};r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0;r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1;cu=tl;var gt=il,k=pt(function(n,t){var u=t&&!t.nodeType&&t,i=u&&!0&&n&&!n.nodeType&&n,f=i&&i.exports===u,r=f&&nr.process,e=function(){try{var n=i&&i.require&&i.require("util").types;return n?n:r&&r.binding&&r.binding("util")}catch(t){}}();n.exports=e}),lu=k&&k.isTypedArray,rl=lu?gt(lu):cu,ul=rl,fl=Object.prototype,el=fl.hasOwnProperty;ni=ol;au=Object.prototype;ht=sl;var vu=hl,cl=vu(Object.keys,Object),ll=cl,al=Object.prototype,vl=al.hasOwnProperty;yu=yl;ti=pl;ct=wl;pu=bl;var dl=kl,gl=Object.prototype,na=gl.hasOwnProperty;wu=ta;lt=ia;bu=ra;ku=pt(function(n,t){function s(n,t){if(t)return n.slice();var i=n.length,r=e?e(i):new n.constructor(i);return n.copy(r),r}var i=t&&!t.nodeType&&t,r=i&&!0&&n&&!n.nodeType&&n,o=r&&r.exports===i,u=o?f.Buffer:undefined,e=u?u.allocUnsafe:undefined;n.exports=s});du=ua;gu=fa;var nf=ea,oa=Object.prototype,sa=oa.propertyIsEnumerable,tf=Object.getOwnPropertySymbols,ha=tf?function(n){return n==null?[]:(n=Object(n),gu(tf(n),function(t){return sa.call(n,t)}))}:nf,ii=ha;rf=ca;var uf=la,aa=vu(Object.getPrototypeOf,Object),ff=aa,va=Object.getOwnPropertySymbols,ya=va?function(n){for(var t=[];n;)uf(t,ii(n)),n=ff(n);return t}:nf,ef=ya;sf=pa;ri=wa;hf=ba;var da=ka,ga=h(f,"DataView"),ui=ga,nv=h(f,"Promise"),fi=nv,tv=h(f,"Set"),ei=tv,iv=h(f,"WeakMap"),oi=iv,cf="[object Map]",rv="[object Object]",lf="[object Promise]",af="[object Set]",vf="[object WeakMap]",yf="[object DataView]",uv=s(ui),fv=s(rt),ev=s(fi),ov=s(ei),sv=s(oi),c=v;(ui&&c(new ui(new ArrayBuffer(1)))!=yf||rt&&c(new rt)!=cf||fi&&c(fi.resolve())!=lf||ei&&c(new ei)!=af||oi&&c(new oi)!=vf)&&(c=function(n){var t=v(n),i=t==rv?n.constructor:undefined,r=i?s(i):"";if(r)switch(r){case uv:return yf;case fv:return cf;case ev:return lf;case ov:return af;case sv:return vf}return t});var si=c,hv=Object.prototype,cv=hv.hasOwnProperty;var av=lv,vv=f.Uint8Array,pf=vv;at=yv;wf=pv;bf=/\w*$/;var bv=wv,kf=a?a.prototype:undefined,df=kf?kf.valueOf:undefined;gf=kv;var gv=dv,ny="[object Boolean]",ty="[object Date]",iy="[object Map]",ry="[object Number]",uy="[object RegExp]",fy="[object Set]",ey="[object String]",oy="[object Symbol]",sy="[object ArrayBuffer]",hy="[object DataView]",cy="[object Float32Array]",ly="[object Float64Array]",ay="[object Int8Array]",vy="[object Int16Array]",yy="[object Int32Array]",py="[object Uint8Array]",wy="[object Uint8ClampedArray]",by="[object Uint16Array]",ky="[object Uint32Array]";var gy=dy,ne=Object.create,np=function(){function n(){}return function(t){if(!it(t))return{};if(ne)return ne(t);n.prototype=t;var i=new n;return n.prototype=undefined,i}}(),tp=np;te=ip;ie="[object Map]";var up=rp,re=k&&k.isMap,fp=re?gt(re):up,ep=fp,op="[object Set]";var hp=sp,ue=k&&k.isSet,cp=ue?gt(ue):hp,lp=cp,ap=1,vp=2,yp=4,fe="[object Arguments]",ee="[object Function]",pp="[object GeneratorFunction]",oe="[object Object]",i={};i[fe]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object DataView]"]=i["[object Boolean]"]=i["[object Date]"]=i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Map]"]=i["[object Number]"]=i[oe]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object Symbol]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0;i["[object Error]"]=i[ee]=i["[object WeakMap]"]=!1;var wp=vt,bp=1,kp=4;hi=dp;se=Math.log(2);ci=function(){function n(i,r,u){var e=this,f;this._trueResolutionZoom=20;this._fadeAnimationTime=500;this._layers=[];this._layerOptions=[];this._transitionDataSource=null;this._fadeAnimationStart=null;this._fadeAnimation=null;this._addLayersInMapView=function(){var n=e,r=n._birdseyeOptions.birdseyeImageryBelowLayer||"labels",i=n._map.getCamera();n._layerOptions=n._layerOptions.filter(function(u){var f=u.imageLayerOptions,e;return i.zoom<(f.maxZoom||100)&&i.zoom>=(f.minZoom||0)&&t.data.BoundingBox.intersect(i.bounds,u.bounds)?(e=new t.layer.ImageLayer(f),n._map.layers.add(e,r),n._layers.push(e),!1):!0})};f=this;f._trueResolutionZoom=20;f._fadeAnimationTime=500;f._map=i;f.metadata=r;f._layers=[];f._layerOptions=[];f._birdseyeOptions=u;f.metadata.maxNumXTiles=Math.floor(f.metadata.width/n.defaultTileSize);f.metadata.maxNumYTiles=Math.floor(f.metadata.height/n.defaultTileSize);f._createLayers();f._addLayersToMap();f._map.events.add("moveend",this._addLayersInMapView)}return n.getImageryUrl=function(t,i,r,u){var o,f,s;if(i){var l=i.projectToXY(t[1],t[0]),y=Math.max(Math.min(l[0],i.width),0),p=Math.max(Math.min(l[1],i.height),0),a=n.imageryStartZoom,v=n.defaultTileSize,h=Math.max(Math.min(i.endingZoomLevel,u),a),c=v*Math.pow(2,i.endingZoomLevel-h),e=Math.floor(y/c);return e===Math.ceil(i.width/c)-1&&i.width%c!=0&&(e=Math.max(e-1,0)),o=v*Math.pow(2,i.endingZoomLevel-h),f=Math.floor(p/o),f===Math.ceil(i.height/o)-1&&i.height%o!=0&&(f=Math.max(f-1,0)),s=he(e,f,h-a),r.birdseyeTilesUrl.replace("{subdomain}",s[s.length-1]).replace("{base4SceneId}",i.base4SceneId).replace("{birdseyeV2Quadkey}",s)}},n.prototype.fade=function(n){var t=this;return new Promise(function(i){if(t._layers.length){t._fadeAnimation&&(window.cancelAnimationFrame(t._fadeAnimation),t._fadeAnimationStart=null,t._fadeAnimation=null);var r=t._layers[t._layers.length-1].getOptions().opacity,u=function(f){if(t._fadeAnimationStart||(t._fadeAnimationStart=f),t._layers){var o=(f-t._fadeAnimationStart)*(1/t._fadeAnimationTime),e=n?Math.min(1,r+o):Math.max(0,r-o);t._setOptions({opacity:e});n&&e<1||!n&&e>0?window.requestAnimationFrame(u):(t._fadeAnimationStart=null,t._fadeAnimation=null,i())}else i()};t._fadeAnimation=window.requestAnimationFrame(u)}})},n.prototype.dispose=function(){this._removeLayersFromMap();this._layers=null;this._layerOptions=null;this._map.events.remove("moveend",this._addLayersInMapView);this._map=null;this.metadata=null},n.prototype._createLayers=function(){for(var o,f,e,i=this,r=[{resolution:i._trueResolutionZoom,maxZoom:n.imageryStartZoom},{resolution:i.metadata.endingZoomLevel,minZoom:n.imageryStartZoom},],l=1<<i.metadata.endingZoomLevel-r[0].resolution,p=Math.floor(i.metadata.maxNumXTiles/l),w=Math.floor(i.metadata.maxNumYTiles/l),u=0;u<r.length;u++){var a=r[u].resolution-r[0].resolution,s=p<<a,h=w<<a,v=1<<i.metadata.endingZoomLevel-r[u].resolution;for(u==0&&i._birdseyeOptions.displaySceneBorder&&i._createTransitionLayer(s,h,v),o=i._createImageAnchors(s,h,v),f=0;f<h;f++)for(e=0;e<s;e++){var c=he(e,f,r[u].resolution-18),b=i.metadata.base4SceneId,k=i._birdseyeOptions.birdseyeTilesUrl.replace("{base4SceneId}",b).replace("{birdseyeV2Quadkey}",c).replace("{subdomain}",c[c.length-1]),d=o[f][e],g=o[f][e+1],nt=o[f+1][e],tt=o[f+1][e+1],y=[d,g,tt,nt];this._layerOptions.push({bounds:t.data.BoundingBox.fromPositions(y),imageLayerOptions:{url:k,coordinates:y,maxZoom:r[u].maxZoom,minZoom:r[u].minZoom}})}}},n.prototype._createTransitionLayer=function(i,r,u){var f=this,e,o,s;f._transitionDataSource=new t.source.DataSource;f._map.sources.add(f._transitionDataSource);e=i*n.defaultTileSize*u;o=r*n.defaultTileSize*u;f._transitionDataSource.add(new t.data.LineString([f._convertXYToPosition(0,0),f._convertXYToPosition(e,0),f._convertXYToPosition(e,o),f._convertXYToPosition(0,o),f._convertXYToPosition(0,0),]));s=new t.layer.LineLayer(f._transitionDataSource,f.metadata.base4SceneId+"_transition",f._birdseyeOptions.sceneBorderOptions);f._layers.push(s)},n.prototype._convertXYToPosition=function(n,t){var i=this.metadata.projectToLatLong(n,t);return[i[1],i[0]]},n.prototype._createImageAnchors=function(t,i,r){for(var e,u,c=this,o=[],s=[0,0],f=0;f<=i;f++){for(e=[],u=0;u<=t;u++){var h=n.defaultTileSize*r,l=s[0]+h*u,a=s[1]+h*f;e.push(c._convertXYToPosition(l,a))}o.push(e)}return o},n.prototype._setOptions=function(n){this._layers.forEach(function(t){t.setOptions(n)})},n.prototype._addLayersToMap=function(){var n=this,t=n._birdseyeOptions.birdseyeImageryBelowLayer||"labels";n._layers.forEach(function(i){n._map.layers.add(i,t)});n._addLayersInMapView()},n.prototype._removeLayersFromMap=function(){var n=this;n._map&&(n._layers&&(n._layers.forEach(function(t){n._map.layers.remove(t)}),n._layers=null),n._transitionDataSource&&(n._map.sources.remove(n._transitionDataSource),n._transitionDataSource.dispose(),n._transitionDataSource=null))},n.defaultTileSize=512,n.imageryStartZoom=18,n}(),function(n){n[n.north=0]="north";n[n.east=90]="east";n[n.south=180]="south";n[n.west=270]="west"}(u||(u={}));var nw=function(){function n(n){var t=this,i;t._cameraLocation=[0,0,0];t.width=0;t.height=0;t._originalWidth=0;t._originalHeight=0;t._imageScaleFactor=1;t.topLeftCorner=[0,0,0];t.topRightCorner=[0,0,0];t.bottomLeftCorner=[0,0,0];t.bottomRightCorner=[0,0,0];t._gtpMatrix=[0,0,0,0,0,0,0,0,0];t._ecc={x:0,y:0,z:0};t._version=n.ver===0?0:1;t.sceneId=n.id;i=t.sceneId.toString(4);t.base4SceneId="000000000000000".substring(0,15-i.length)+i;t.productId=n.pids&&n.pids.join(",")||"";this._version===1&&(t._cameraType=t._getCameraType(n.cam),n.camlla&&n.camlla.length===3&&(t._cameraLocation=[n.camlla[0],n.camlla[1],n.camlla[2],]));t.cLook=t._getHeading(n.clook);t._focalLength=n.fl;n.size&&n.size.length===2&&n.osize&&n.osize.length===2&&(t.width=n.size[0],t.height=n.size[1],t._originalWidth=n.osize[0],t._originalHeight=n.osize[1],t._imageScaleFactor=t.width/t._originalWidth);t.endingZoomLevel=Math.min(22,18+Math.ceil(gp(Math.max(t.width/512,t.height/512)))-1);t.maxNumXTiles=Math.ceil(t.width/512);t.maxNumYTiles=Math.ceil(t.height/512);n.ullla&&n.ullla.length===3&&n.urlla&&n.urlla.length===3&&n.lllla&&n.lllla.length===3&&n.lrlla&&n.lrlla.length===3&&(t.topLeftCorner=[n.ullla[1],n.ullla[0],n.ullla[2],],t.topRightCorner=[n.urlla[1],n.urlla[0],n.urlla[2],],t.bottomLeftCorner=[n.lllla[1],n.lllla[0],n.lllla[2],],t.bottomRightCorner=[n.lrlla[1],n.lrlla[0],n.lrlla[2],]);t._avgAltitude=(t.topLeftCorner[2]+t.topRightCorner[2]+t.bottomLeftCorner[2]+t.bottomRightCorner[2])/4;t._gtpMatrix=n.gtp;t._ptgMatrix=n.ptg;n.ecc&&n.ecc.length===3&&(t._ecc={x:n.ecc[0],y:n.ecc[1],z:n.ecc[2]});t._version===1&&(t._altitudeScaleFactor=t._ecc.z/t._cameraLocation[2],t._rawSceneWidth=t._originalWidth,t._sceneWidthOffset=0,t._cameraType!==5&&t._cameraType!==6&&t._originalWidth===6870&&(t._rawSceneWidth=13450,(t._cameraType===2||t._cameraType===3)&&(t._sceneWidthOffset=t._rawSceneWidth-t._originalWidth)));t._v1PixelOffsetX=0;t._v1PixelOffsetY=0;t._calculatePixelOffset()}return n.prototype.projectToXY=function(n,t){var r=this,h,e,u,i=r._gtpMatrix,l,o;if(this._version===1){var c=r._latLongtoEcc(n,t),f=[-(c[0]-this._ecc.x),c[1]-this._ecc.y,c[2]-this._ecc.z,],s=[i[0]*f[2]+i[1]*f[0]+i[2]*f[1],i[3]*f[2]+i[4]*f[0]+i[5]*f[1],i[6]*f[2]+i[7]*f[0]+i[8]*f[1],];e=s[0]/s[1]*r._focalLength;u=-(s[2]/s[1]*r._focalLength);e=r._rawSceneWidth/2+e-r._sceneWidthOffset;u=r._originalHeight/2+u;e*=r._imageScaleFactor;u*=r._imageScaleFactor;u=r.height-u;h=[e,u]}else l=[[t],[n],[1]],o=ce([[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],i[8]]],l),e=o[0][0]/o[2][0],u=o[1][0]/o[2][0],h=[e+r._v1PixelOffsetX,u+r._v1PixelOffsetY];return h},n.prototype.projectToLatLong=function(n,t){var c;if(this._version===1){t=this.height-t;n/=this._imageScaleFactor;t/=this._imageScaleFactor;n=n+this._sceneWidthOffset-this._rawSceneWidth/2;t=t-this._originalHeight/2;var e=n,o=t,r=this._focalLength,i=this._gtpMatrix,u=this._ecc,b=this._getCurrentAltitude()*this._altitudeScaleFactor,s=b-u.z,l=r*i[1]-e*i[4],a=e*i[5]-r*i[2],p=r*s*i[0]+r*i[1]*u.x-r*i[2]*u.y-e*s*i[3]-e*u.x*i[4]+e*u.y*i[5],v=-o*i[4]-r*i[7],y=o*i[5]+r*i[8],w=r*i[8]*u.y-r*s*i[6]-r*i[7]*u.x+o*i[5]*u.y-s*i[3]*o-o*i[4]*u.x,k=(p*y-a*w)/(l*y-a*v),d=(p*v-l*w)/(a*v-l*y);c=this._eccToLatLong(k,d)}else{var g=[[n-this._v1PixelOffsetX],[t-this._v1PixelOffsetY],[1]],f=this._ptgMatrix,h=ce([[f[0],f[1],f[2]],[f[3],f[4],f[5]],[f[6],f[7],f[8]]],g),nt=h[0][0]/h[2][0],tt=h[1][0]/h[2][0];c=[tt,nt]}return c},n.prototype.isLocationInside=function(n){var t=this.projectToXY(n[1],n[0]),i=!1;return t[0]>0&&t[0]<this.width&&t[1]>0&&t[1]<this.height&&(i=!0),i},n.prototype._latLongtoEcc=function(n,t){var r=(t+180)/360*256*Math.pow(2,23),i=Math.sin(n*Math.PI/180),u=(.5-Math.log((1+i)/(1-i))/(4*Math.PI))*256*Math.pow(2,23);return[r,u,this._getCurrentAltitude()*this._altitudeScaleFactor,]},n.prototype._eccToLatLong=function(n,t){var r=360*n/(256*Math.pow(2,23))-180,i=Math.pow(Math.E,(.5-t/(256*Math.pow(2,23)))*4*Math.PI),u=(i-1)/(i+1),f=Math.asin(u)*180/Math.PI;return[f,r]},n.prototype._getCurrentAltitude=function(){var n=this.approxAltitude;return n&&Math.abs(n-this._avgAltitude)>20?n:this._avgAltitude},n.prototype._getHeading=function(n){var t;switch(n){case"E":t=u.east;break;case"S":t=u.south;break;case"W":t=u.west;break;case"N":default:t=u.north}return t},n.prototype._getCameraType=function(n){var t;switch(n){case 2:t=1;break;case 3:t=2;break;case 4:t=3;break;case 5:t=4;break;case 6:t=5;break;case 7:t=6;break;case 0:default:t=0}return t},n.prototype._calculatePixelOffset=function(){var n=this;if(n._version===0){var t=n.projectToXY(n.topLeftCorner[1],n.topLeftCorner[0]),i=n.projectToXY(n.topRightCorner[1],n.topRightCorner[0]),r=n.projectToXY(n.bottomLeftCorner[1],n.bottomLeftCorner[0]),u=n.projectToXY(n.bottomRightCorner[1],n.bottomRightCorner[0]),f=2*n.width-(t[0]+i[0]+r[0]+u[0]),e=2*n.height-(t[1]+i[1]+r[1]+u[1]);n._v1PixelOffsetX=f/4;n._v1PixelOffsetY=e/4}},n}(),tw=function(){function n(n){this._capacity=n;this._count=0;this._dictionary={}}return n.prototype.addItem=function(n,t,i){if(t){var r=this._dictionary[n];r?(this._dictionary[n].item=t,this._moveNodeToHead(r)):this._addNewItem(n,t,i)}},n.prototype.getItem=function(n){var t,i=this._dictionary[n];return i?(t=i.item,this._moveNodeToHead(i)):t=null,t},n.prototype.clear=function(){while(this._count>0)this._deleteTailNode()},n.prototype.getInternalDictionary=function(){return this._dictionary},n.prototype._addNewItem=function(n,t,i){var r=this,u;r._count===r._capacity&&(i?r._capacity++:r._deleteTailNode());u={key:n,item:t};r._count===0?r._headNode=r._tailNode=u:(u.next=r._headNode,r._headNode.previous=u,r._headNode=u);r._dictionary[n]=u;r._count++},n.prototype._removeNode=function(n){if(this._count===1){this._headNode=null;this._tailNode=null;return}var t=n.previous,i=n.next;t?t.next=i:this._headNode=i;i?i.previous=t:this._tailNode=t},n.prototype._moveNodeToHead=function(n){var t=this;n!==t._headNode&&(t._removeNode(n),t._headNode&&(t._headNode.previous=n),n.previous=null,n.next=t._headNode,t._headNode=n)},n.prototype._deleteTailNode=function(){var t=this,i,n,r,f,u;if(t._tailNode&&(i=t._tailNode,t._removeNode(i),delete t._dictionary[i.key],t._count--,n=i.item,n&&n.dispose&&n.dispose(),Array.isArray(n))){for(r=0,f=n.length;r<f;r++)u=n[r],u&&u.dispose&&u.dispose();n.length=0}},n}(),iw=function(){function n(n){this._lastQueriedLocation=null;this._metadataCache=new tw(200);this._queryLatLongRange=.1;this._locationQueriedPrecision=4;this._sceneMetadataUrl=n;this.bounds=[0,1,1,0]}return n.prototype.getBestMetadata=function(n,i){return e(this,void 0,void 0,function(){var r,u,f;return o(this,function(e){switch(e.label){case 0:return(r=this,r._abortPendingMetadataCall(),u=r._selectBestScene(n,i),!(!u&&!t.data.Position.areEqual(r._lastQueriedLocation,n.center,r._locationQueriedPrecision)))?[3,2]:[4,r._requestNewScenesAndUpdateCache(n.center)];case 1:f=e.sent();f&&(r._lastQueriedLocation=n.center,u=r._selectBestScene(n,i));e.label=2;case 2:return u?(r.sceneMetadata=u,u.approxAltitude=r._getApproxAltitude(n.center,u),[2,u]):[2,null]}})})},n.prototype.dispose=function(){this._metadataCache&&this._metadataCache.clear();this.sceneMetadata=null},n.prototype._abortPendingMetadataCall=function(){this._controller&&this._controller.abort();this._controller=null},n.prototype._getMetadataAvilableInCache=function(){for(var t=this._metadataCache.getInternalDictionary(),i=Object.keys(t),r=[],n=0;n<i.length;n++)r.push(t[i[n]].item);return r},n.prototype._selectBestScene=function(n,t){for(var u,f=this._getMetadataAvilableInCache(),i=[],r=0;r<f.length;r++)u=f[r],this._isSceneValid(n,t,u)&&i.push(u);return i=this._filterScenesByProvider(i),this._selectMaxPannableScene(n.center,i)},n.prototype._requestNewScenesAndUpdateCache=function(n){return e(this,void 0,void 0,function(){var t,h,u,f,e,c,l,a,v,y,p,i,r,s,w;return o(this,function(o){switch(o.label){case 0:t=this;t._controller=new AbortController;h=t._controller.signal;u=n;f=u[1];e=u[0];c=f+t._queryLatLongRange;l=f-t._queryLatLongRange;a=e+t._queryLatLongRange;v=e-t._queryLatLongRange;y=t._sceneMetadataUrl.replace("{subdomain}",Math.floor(Math.random()*4).toString()).replace("{north}",c.toString()).replace("{south}",l.toString()).replace("{east}",a.toString()).replace("{west}",v.toString());o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch(y,{signal:h})];case 2:return p=o.sent(),[4,p.json()];case 3:if(i=o.sent(),this._controller=null,i.length>1)for(r=i.length-1;r>0;r--)s=new nw(i[r]),t._metadataCache.addItem(s.sceneId.toString(),s);return[3,5];case 4:return w=o.sent(),[2,!1];case 5:return[2,!0]}})})},n.prototype._selectMaxPannableScene=function(n,t){for(var u=Number.MAX_VALUE,f=null,r=0;r<t.length;r++){var i=t[r],e=i.projectToXY(n[1],n[0]),s=e[0],h=e[1],o=Math.pow(Math.abs(s-i.width/2),2)+Math.pow(Math.abs(h-i.height/2),2);o<u&&(u=o,f=i)}return f},n.prototype._isSceneValid=function(n,t,i){var r=i.cLook===t;return r&&i.isLocationInside(n.center)},n.prototype._filterScenesByProvider=function(n){var t=n.filter(function(n){return n.productId==="236"});return t.length>0?t:n},n.prototype._getApproxAltitude=function(n,t){var i=[],r=[],u=this._metadataCache.getInternalDictionary(),e=Object.keys(u),f;return e.forEach(function(f){var o=u[f].item,y,c,l,s,h,e,a,v;if(!t||o.productId===t.productId)for(y=[o.topLeftCorner,o.topRightCorner,o.bottomLeftCorner,o.bottomRightCorner,],c=0,l=y;c<l.length;c++)if(s=l[c],h=Math.pow(n[1]-s[1],2)+Math.pow(n[0]-s[0],2),i.length===0)i.push(h),r.push(s[2]);else for(e=0;e<i.length;e++)if(a=i[e],a<h||e===i.length-1){(e>0||e===i.length-1)&&(v=e===i.length-1&&a>h?e+1:e,i.splice(v,0,h),r.splice(v,0,s[2]),i.length>4&&(i.splice(0,1),r.splice(0,1)));break}}),f=r.reduce(function(n,t){return n+t},0),f/r.length},n}(),rw=function(){function n(){}return n.prototype.merge=function(){for(var f,u,e,i,t,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];for(u=0,e=o;u<e.length;u++)if(i=e[u],i)for(t in i)i.hasOwnProperty(t)&&this.hasOwnProperty(t)&&(i[t]!==undefined&&i[t]!=null?this[t]instanceof n?this[t].merge(i[t]):this[t]=i[t]:(f||(f=new(Object.getPrototypeOf(this).constructor)),this[t]=f[t]));return this},n}(),uw=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.defaultMapStyle="satellite_road_labels",t.supportMapStyles=["satellite_road_labels","satellite"],t.birdseyeImageryBelowLayer="labels",t.zoomCutOff=13,t.maxPitch=45,t.defaultZoom=18,t.enabled=!0,t.displaySceneBorder=!0,t.sceneBorderOptions={strokeColor:"#fdff32",strokeOpacity:.4,strokeWidth:50,blur:10},t.birdseyeTilesUrl="https://t.ssl.ak.tiles.virtualearth.net/tiles/be{base4SceneId}01{birdseyeV2Quadkey}?g=0",t.birdseyeMetadataUrl="https://t.ssl.ak.tiles.virtualearth.net/tiles/cmd/BirdsEyeSceneMetaData?north={north}&south={south}&east={east}&west={west}&count=100&dir=&ver=0",t}return le(t,n),t}(rw),fw=function(){function n(n,t){var i=this,r;this._onMoveEnd=function(){return e(i,void 0,void 0,function(){var n,t,r,i;return o(this,function(u){switch(u.label){case 0:return(n=this,!n._isSupportedZoomLevel())?[3,3]:(t=n._map.getCamera(),!(!n._currectScene||!n._currectScene.metadata.isLocationInside(t.center)||n._getNormalizedCameraHeading(t.bearing)!==n._currectScene.metadata.cLook))?[3,3]:[4,n._loadBirdseyeScene()];case 1:return(r=u.sent(),!(r&&n._previousScene))?[3,3]:[4,n._previousScene.fade(!1)];case 2:u.sent();(i=n._previousScene)===null||i===void 0?void 0:i.dispose();n._previousScene=null;u.label=3;case 3:return[2]}})})};this._onStyleChange=function(){var n=i._map.getStyle().style;i._currentMapStyle!==n&&(i._currentMapStyle=n,i._isSupportedMapStyle()||i._deactivateInternal(!1))};this._onZoomEnded=function(){var n=i;!n._isSupportedZoomLevel()&&n._currectScene?(n._currectScene.dispose(),n._currectScene=null):n._currectScene&&n._map.setCamera({pitch:n._getPitchByZoom(n._map.getCamera().zoom)})};r=this;r._map=n;r._options=(new uw).merge(hi(t));r._metadataProvider=new iw(r._options.birdseyeMetadataUrl);r.isActive=!1}return n.prototype.getOptions=function(){return this._options},n.prototype.setOptions=function(n){var t=this,i=t._options.enabled,r=t._options.zoomCutOff;t._options=t._options.merge(hi(n));i!==t._options.enabled&&(t._options.enabled?t.activate():t._deactivateInternal(!0));r!==t._options.zoomCutOff&&t._onMoveEnd();t._isSupportedMapStyle()||t._deactivateInternal(!1)},n.prototype.activate=function(n,t){return e(this,void 0,void 0,function(){var i,e,u,r,f;return o(this,function(o){switch(o.label){case 0:return(i=this,!i._options.enabled)?[3,3]:(i.isActive=!0,[4,i.isBirdseyeAvailable(n,t)]);case 1:return e=o.sent(),e&&(i._isSupportedMapStyle()||i._map.setStyle({style:i._options.defaultMapStyle}),this._currentMapStyle=i._map.getStyle().style,u=i._map.getCamera(),typeof i._originalPitch!="number"&&(i._originalPitch=u.pitch),r={type:"fly",duration:500},f=i._options.defaultZoom,n&&(r.center=n),t&&(r.bearing=t),f&&(r.zoom=Math.max(u.zoom,f)),r.pitch=i._getPitchByZoom(r.zoom||u.zoom),i._map.setCamera(r)),[4,i._loadBirdseyeScene()];case 2:o.sent();i._setupEvents();o.label=3;case 3:return[2]}})})},n.prototype.deactivate=function(){this._deactivateInternal(!0)},n.prototype.isBirdseyeAvailable=function(n,t){return e(this,void 0,void 0,function(){var i;return o(this,function(r){switch(r.label){case 0:return[4,this._getBestMetadata(n,t)];case 1:return i=r.sent(),[2,!!i]}})})},n.prototype.getBirdseyeImage=function(n,t,i){return t===void 0&&(t=0),i===void 0&&(i=19),e(this,void 0,void 0,function(){var r;return o(this,function(u){switch(u.label){case 0:return[4,this._getBestMetadata(n,t)];case 1:return r=u.sent(),r?[2,ci.getImageryUrl(n,r,this._options,i)]:[2,null]}})})},n.prototype.getCurrentSceneProductId=function(){var n,t;if((t=(n=this._currectScene)===null||n===void 0?void 0:n.metadata)!==null&&t!==void 0)return t.productId},n.prototype.dispose=function(){this._metadataProvider&&this._metadataProvider.dispose();this._deactivateInternal(!0);this._map=null},n.prototype._deactivateInternal=function(n){var t=this;t.isActive=!1;t._map.events.remove("moveend",t._onMoveEnd);t._map.events.remove("zoomend",t._onZoomEnded);n&&t._map.events.remove("styledata",t._onStyleChange);t._previousScene&&t._previousScene.dispose();t._currectScene&&t._currectScene.dispose();t._previousScene=t._currectScene=null;typeof t._originalPitch=="number"&&t._map.setCamera({pitch:t._originalPitch});t._originalPitch=null},n.prototype._getBestMetadata=function(n,t){return e(this,void 0,void 0,function(){var i;return o(this,function(r){switch(r.label){case 0:return i=this._map.getCamera(),n&&(i.center=n,i.bearing=t||u.north),[4,this._metadataProvider.getBestMetadata(i,this._getNormalizedCameraHeading(i.bearing))];case 1:return[2,r.sent()]}})})},n.prototype._loadBirdseyeScene=function(){return e(this,void 0,void 0,function(){var n,t;return o(this,function(i){switch(i.label){case 0:return(n=this,!n._isSupportedMapStyle()||!n._isSupportedZoomLevel())?[2,!1]:[4,n._getBestMetadata()];case 1:return(t=i.sent(),t)?(n._currectScene&&t.base4SceneId===n._currectScene.metadata.base4SceneId||(n._previousScene&&n._previousScene.dispose(),n._previousScene=n._currectScene,n._currectScene=new ci(n._map,t,n._options)),[2,!0]):[2,!1]}})})},n.prototype._setupEvents=function(){this._map.events.add("moveend",this._onMoveEnd);this._map.events.add("zoomend",this._onZoomEnded);this._map.events.add("styledata",this._onStyleChange)},n.prototype._getPitchByZoom=function(n){var t,i,r,u;return(n=Math.round(n),t=18,i=this._options.maxPitch,!i||n>=t)?0:(r=t-this._options.zoomCutOff,u=t-n,Math.round(i*u/r))},n.prototype._isSupportedMapStyle=function(){for(var r=this._map.getStyle(),i=this._options.supportMapStyles,n=!1,t=0;t<i.length;t++)n=n||r.style===i[t];return n},n.prototype._isSupportedZoomLevel=function(){return this._map.getCamera().zoom>=this._options.zoomCutOff},n.prototype._getNormalizedCameraHeading=function(n){n=(n||0)%360;n<0&&(n+=360);var t=u.north;return Math.abs(n-u.east)<=45?t=u.east:Math.abs(n-u.south)<=45?t=u.south:Math.abs(n-u.west)<=45&&(t=u.west),t},n}(),ew=Object.freeze({__proto__:null,BirdseyeControl:fw}),ow=li.merge("atlas.control",ew);n.control=ow;Object.defineProperty(n,"__esModule",{value:!0})})