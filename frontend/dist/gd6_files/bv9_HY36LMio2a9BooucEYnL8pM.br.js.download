(function(){var t={L_Link_Generating_Text:"Creating the link …",L_Link_GenerationFailed_Text:"There was a problem creating the link. If you are sharing a lot of content, you may try trimming it down and try again.",L_Permalink_Prompt:"Share this map",L_TaskBar_Label_SearchBox:"Add a search",L_TaskBar_Placeholder_SearchBox:"Find places and landmarks on Bing Maps",L_TaskBar_Label_Clear:"Clear Search Term",L_TaskBar_Label_Search:"Search",L_TaskBar_Label_Directions:"Directions",L_TaskBar_Label_Traffic:"Traffic",L_TaskBar_Label_Favorites:"My Places",L_TaskBar_Label_More:"More",L_SearchNearbyTransit:"Nearby Transit",L_SearchNearbyParking:"Parking",L_Permalink_Email_Button_Tooltip:"Email link",L_Print_Submit:"Print",L_PrintPreview:"Print Preview",L_PrintMapAndText:"Map & Text",L_PrintMapOnly:"Map only",L_PrintTextOnly:"Text only",L_PermalinkCopy_Text:"Copy",L_PermalinkEmail_Text:"Email",L_Permalink_Email_Button_Text:"Email",L_PermalinkFacebook_Text:"Facebook",L_PermalinkTwitter_Text:"Twitter",L_Twitter_Tag_Text:"on #BingMaps",L_PermalinkHeaderPrompt_Text:"Share",ShareHeaderTitle:"Select what to share",L_PermalinkLink_Text:"Link",L_PermalinkPrompt_Text:"Select the cards that you would like to share",L_Link_TooManyItemsSelected_Text:"Unable to share. Please unselect some items and try sharing in smaller groupings (5-10 items at a time).",L_Link_EmailTitleManyCards_Text:"Bing Maps session shared with you",L_Link_EmailFooter_Text:"Shared from Bing Maps",L_LengthenButton_Text:"Show full URL",L_ShortenButton_Text:"Shorten",L_EditMapDone_Text:"Done",L_EditMap_Text:"Move or zoom map",L_SlideOutMenu_MapType:"Map",L_SlideOutMenu_MapType_Road:"Road View",L_SlideOutMenu_MapType_Aerial:"Aerial View",L_SlideOutMenu_MapType_Birdseye:"Birds View",L_SlideOutMenu_SeeAllCards:"See all card",L_SlideOutMenu_BingHome:"Bing Home",L_SlideOutMenu_Feedback:"Feedback",L_SlideOutMenu_ExitPreview:"Exit preview",L_PrintNotes:"Notes",L_PrintNotesWatermark:"Type your notes here",L_PermalinkEmbed_Text:"Embed",L_Menu_Exit_Text:"Previous Version",L_Menu_Feedback_Text:"Feedback",L_TaskBar_Label_Print:"Print",L_TaskBar_Label_Embed:"Embed a map",L_TaskBar_Label_Share:"Share",L_Menu_Tips_Text:"Tips",L_TaskBar_Label_Fullscreen:"Full Screen",Taskbar_Label_ExitFullScreen:"Exit Full Screen",TaskBarLogoTitle:"Back to Bing search",BEV2DetailsInstruction:"1. In cards",BEV2Introduction:"New and crisp Bird's Eye imagery is available in many metropolitan areas.",BEV2TransientLensInstruction:"2. Right-click on the map",BEV2WelcomeText:"Bird's Eye has changed",BEV2ImageIntroduction:"There are two ways of viewing the new Bird's Eye.",BEV2TipNote:"Note: Bird's Eye may not be available in your area as outdated imagery is no longer available.",L_CategoryLayerDropdownButton:"All {0}",L_CategoryLayerDropdownTitle:"Show on map",L_CategoryLayer_Schools:"Schools",L_CategoryLayer_Transit:"Public Transport",L_CategoryLayer_Commutability:"Commute",ShareEmailToolTip:"Send in email",ShareFBToolTip:"Share to Facebook",ShareTwitterToolTip:"Post to Twitter",L_CmtControlTitleText:"Enter your location to see a 15 min commute range.",L_CmtControlAddLocationText:"Add location",L_CmtControlCommuteTime30Text:"30 min",L_CmtControlCommuteTime45Text:"45 min",L_CmtControlCommuteTime60Text:"1 hr",L_CmtControlCommuteTime15Text:"15 min",L_CmtControlCommutePeak_Text:"Peak",L_CmtControlCommuteOffPeak_Text:"Off Peak",L_CmtControlPushpinTitle:"A",L_CmtControlPushpinTwoTitle:"B",L_CmtEditText:"Options",L_CmtDoneText:"Done",L_CmtPlaceHolderText:"Commute to (e.g. work, home, school)",L_CmtTitle:"{time} min commute to {addresses} in {trafficCondition} traffic",L_CmtTooltipTitle:"{time} min drive time",L_CmtTooltipDescription:"click to change address or drag to new location",L_CmtTitleAddresses:"both {addr1} and {addr2}",L_CmtErrorMessage:"Can't retrieve boundary, please try again later",ShareClose:"Close",ShareUrlLabel:"Copy URL",L_CategoryUserTip_Header:"Show on map",L_CategoryUserTip_Message1:"We've turned on the map layers you selected",L_CategoryUserTip_Message2:"Pan and Zoom to see more results",L_ZoomInUserTip_Message:"Zoom in or use filters to narrow your search",L_Tooltip_Itinerary_Saved_Text:"Itinerary saved to My Places",L_Tooltip_Rename_Button:"Rename",L_Tooltip_Update_Button:"Update",SearchGhostText:"Search Bing Maps",ViewAllSearches:" View all your searches",L_MoreSearchTip:"Search for more businesses",L_RemoveFromMap:"Remove from map",L_EditYourSearch:"Edit your search",BingMapsLogo:"Bing Maps logo",AddAnotherSearchGhostText:"Add another search",PrintMiniMapAltText:"Mini map",ShareActionsTitle:"Choose where to share",OrSeparatorText:"Or",OverflowActivateSearchText:"Select a search to activate",OverflowClearAllText:"Clear All",ClearSearch:"Clear search",ClearText:"Clear text",CloseMapView:"Close the map view",LocalGuide_Title:"Local Guide",L_TaskBar_Label_LocalGuide:"Local",L_TaskBar_Label_MyContributions:"My Contributions",TaskBar_Banner_New:"*",FlyoverFeedbackTitle:"What did you think of the 3D Flyover?",Landmarks3DFeedbackTitle:"What did you think of the 3D landmark experience?",Map3DFeedbackTitle:"What did you think of the 3D experience?",UnableToLoadMediaPlayer:"There was a problem loading the player. Please try again in a few minutes.",CommuteRewards_FlyoutDescription:"All you need to do is save your home and work addresses for better traffic updates.",CommuteRewards_FlyoutTitle:"Earn <strong>{0}<\/strong> points towards <strong>gift cards!<\/strong>",CommuteRewards_EarnButton:"Earn points",CommuteRewards_DismissButton:"Not now",L_TaskBar_Label_MyRoutes:"My Routes"},n=window.$MicrosoftMaps8,i;n.ResourceManager?n.ResourceManager.init("InternalControls",t):(i=n.ResourcesObject=n.ResourcesObject||{},i.InternalControls=t)})(),function(){var t={L_Fdbk_Submit:"Send feedback",L_Fdbk_GeneralCardInputHeader:"Share your likes, dislikes and suggestions about Bing Maps here…",L_Fdbk_GeneralCardTextWatermark:"To protect your privacy, do not include any personal information.",L_Fdbk_Exit:"Previous Version",L_Fdbk_Reminder:"Let us know what you think about Bing Maps.",L_Fdbk_Link:"Feedback",L_Fdbk_DlgHdr:"Help us improve this site by rating your experience and sharing your comments.",L_Fdbk_EmailWatermark:"Allows us to follow-up with you, if needed.",L_Fdbk_Comments:"Tell us more about your experience.",L_Fdbk_Other:"Something else",L_Fdbk_Email:"Email (optional)",L_Fdbk_PrivacyPolicyLink:"See our Privacy Policy",L_Fdbk_Business_More_Details:"Tell us more about the business",L_Fdbk_MapIssueDescription:"Tell us more about the problem",L_Fdbk_Problem:"Tell us the problem area",L_Fdbk_SubProblem:"Tell us the specific issue",L_Fdbk_AddressZipIncorrect:"Postcode is incorrect",L_Fdbk_AddressMissing:"Address is missing from road",L_Fdbk_AddressLocationIncorrect:"Address is in the wrong location",L_Fdbk_AddressSideIncorrect:"Address is on the wrong side of the road",L_Fdbk_AddressZipMissing:"Postcode is missing",L_Fdbk_AdminDistrictsCountryBoundary:"The boundary between countries/regions is incorrect",L_Fdbk_AdminDistrictsCountryName:"Country/Region has incorrect or missing name",L_Fdbk_AdminDistrictsCountyBoundary:"County boundaries incorrect.",L_Fdbk_AdminDistrictsCountyName:"County has missing or incorrect name",L_Fdbk_AdminDistrictsEntityMissing:"A political entity is missing (country/region, state/province, county...)",L_Fdbk_AdminDistrictsStateBoundary:"The boundary between states/provinces is incorrect",L_Fdbk_AdminDistrictsStateName:"State/province has incorrect or missing name",L_Fdbk_AdminDistrictsWrongEntity:"Political entity is wrong type",L_Fdbk_AirportIncorrect:"Airport is missing",L_Fdbk_AirportMissing:"Airport has incorrect or missing name",L_Fdbk_nameIncorrect:"Name is incorrect",L_Fdbk_MarkIncorrect:"Mark Incorrect",L_Fdbk_locationIncorrect:"Location is incorrect",L_Fdbk_AddressOfLocationIncorrect:"Address of this location is incorrect.",L_Fdbk_AirportWrongLocation:"Airport is in the wrong location",L_Fdbk_BridgeClosed:"Bridge is closed",L_Fdbk_BridgeMissing:"Bridge is missing",L_Fdbk_BridgeNameIncorrect:"Bridge name is incorrect or missing",L_Fdbk_BridgeRemoved:"Bridge needs to be removed",L_Fdbk_BridgeLocationIncorrect:"Bridge is in the wrong location",L_Fdbk_CityLocationIncorrect:"City location is incorrect",L_Fdbk_CityMissing:"City is missing",L_Fdbk_CityNameIncorrect:"City name is incorrect",L_Fdbk_CityNeighborhood:"City should be neighbourhood",L_Fdbk_LandFeatureMissing:"Land feature is missing",L_Fdbk_LandFeatureNameIncorrect:"Name of land feature is incorrect",L_Fdbk_LandLocationIncorrect:"Land feature is in the wrong location",L_Fdbk_LandTypeIncorrect:"Land feature is the wrong type (eg: forest should be desert)",L_Fdbk_NeighborhoodCity:"Neighbourhood should be city",L_Fdbk_NeighborhoodLocationIncorrect:"Neighbourhood location is incorrect",L_Fdbk_NeighborhoodMissing:"Neighbourhood is missing",L_Fdbk_NeighborhoodNameIncorrect:"Neighbourhood name is incorrect",L_Fdbk_ProblemAddress:"Address",L_Fdbk_ProblemAdministrativeDistricts:"Country/Region/County",L_Fdbk_ProblemAirport:"Airport",L_Fdbk_ProblemBridge:"Bridge",L_Fdbk_ProblemCity:"City",L_Fdbk_ProblemLand:"Landform",L_Fdbk_ProblemNeighborhood:"Neighbourhood",L_Fdbk_ProblemRoad:"Roads",L_Fdbk_ProblemWater:"Waterbody",L_Fdbk_ProblemImagery:"Imagery",L_Fdbk_ImageryOutOfDate:"Imagery is out of date",L_Fdbk_ImageryBlurry:"Imagery is cloudy or blurry",ImageryTooDark:"Imagery too dark",ImageryOverexposed:"Imagery overexposed",L_Fdbk_ImageryRoadMismatch:"Imagery and roads do not match",L_Fdbk_RoadClosed:"Road is closed",L_Fdbk_RoadLocationIncorrect:"Road location is incorrect",L_Fdbk_RoadMissing:"Road is missing",L_Fdbk_RoadNameIncorrect:"Road name is incorrect or missing",L_Fdbk_RoadOneWay:"Road should be one-way",L_Fdbk_RoadOneWayOpposite:"Road is one-way in the wrong direction",L_Fdbk_RoadRemove:"Road needs to be removed",L_Fdbk_RoadTwoWay:"Road should be two-way",L_Fdbk_RoadTypeIncorrect:"Road type is incorrect (motorway vs street)",L_Fdbk_WaterLocationIncorrect:"Waterbody is in the incorrect location",L_Fdbk_WaterNameIncorrect:"Waterbody has incorrect name",L_Fdbk_WaterTypeIncorrect:"Incorrect type of Waterbody (eg: ocean should be sea)",L_Fdbk_WaterMissing:"Waterbody is missing",L_Fdbk_None:"None",L_Fdbk_SelectProblem:"Select ...",L_Fdbk_ReportAProblem:"Report a map problem",L_Fdbk_GeneralFeedback:"Tell us what you think",L_Fdbk_ActiveCard:"Problem with {0}",L_Fdbk_DescribeProblem:"Describe the problem here",L_Fdbk_ShowOnMap:"Click on the map to place a pushpin on the problem area (Zoom by double-clicking)",L_Fdbk_Hdr:"Help us understand any problems you noticed with the map.",L_Fdbk_SelectSubProblem:"Select ...",L_Fdbk_SpecificMapIssue:"Did you encounter a specific problem on the map?",L_Fdbk_ReportAProblemOnMap:"Click here to report",L_Fdbk_NotProblemOnMap:"Not a problem on the map?",L_Fdbk_SendGeneralFeedback:"Tell us what you think",L_Fdbk_ReportSomethingElse:"Report something else",L_Fdbk_ReportAProblemOnSearchResult:"Report a Problem",L_Fdbk_HelpUsUnderstand:"Help us understand more about the problem.",L_Fdbk_Option_DidNotFind:"I was not looking for {0}",L_Fdbk_Option_IssueWithSearchResult:"Issue with {0}",L_Fdbk_SpecificIssueWith:"Tell us the specific issue with {0}",L_Fdbk_MovePinToCorrect_Message:"Drag the drawing pin on the map to the correct location.",L_Fdbk_MovePinToCorrect_Message_For_Missing_Entity:"Drag the map pushpin to the business location.",L_Fdbk_DidNotFindLookingFor_Message:"What were you looking for?",L_Fdbk_TellUsAboutMissingBusiness_Message:"Enter business details",L_Fdbk_AddMissingBusinessCardTitle:"Add missing business",L_Fdbk_WhenISearch_Message:"When I searched for {0}, I was looking for",L_Fdbk_IfYouKnow_Message:"Drag the drawing pin on the map to the correct location.",L_Fdbk_DontKnowWhere:"I don't know where this place is.",L_Fdbk_Pin_Not_Move_Reminder:"You have not yet moved the drawing pin on the map to the correct location. Please move the drawing pin to the location mentioned in your description.",L_Fdbk_Overall_Experience:"How was your overall experience?",L_Fdbk_Overall_Happy:"Happy",L_Fdbk_Overall_Unhappy:"Unhappy",L_Fdbk_Send:"Send",L_Fdbk_Submit_Text:"Submit",L_Fdbk_SubmitAnyway_Text:"Submit Anyway",L_Fdbk_Edit:"Edit",L_Fdbk_BackToEdit_Text:"Back To Edit",L_Fdbk_Dismiss_Text:"Dismiss",L_Fdbk_Dismiss:"Dismiss",L_Fdbk_Done:"Done",L_Fdbk_Next:"Next",L_Fdbk_ReturnToSearchResult:"return to search result",L_Fdbk_Back:"Back",L_Fdbk_NoFoundSelect:"Select...",L_Fdbk_NoFoundAddress:"An address",L_Fdbk_NoFoundBusiness:"A business",L_Fdbk_NoFoundPopulatedPlace:"A populated place (city, neighbourhood, country/region, postcode, etc.)",L_Fdbk_NoFoundPopulatedOther:"Something else",L_Fdbk_Pushpin_Message:"Drag the drawing pin on the map to describe the problem (if necessary).",L_Fdbk_ClickAgain_Message:"Click again to adjust your selection (if necessary).",L_Fdbk_ThankYou:"Thank you for submitting feedback!",L_Fdbk_ProblemType_Reminder:"Please select a problem type.",L_Fdbk_ProblemArea_Reminder:"Please select a problem area.",L_Fdbk_Pushpin_Reminder:"You have not yet moved the pushpin on the map to the problem area. Please move the pushpin to the location mentioned in your description.",L_Fdbk_Require_Alias_Reminder:"Please fill in employee alias.",L_Fdbk_GeneralFeedback_Reminder:"You have not filled in the feedback form. Please give us more information.",L_Fdbk_BusinessNotFound_RequiredFields_Missing_ErrorMessage:"Enter all the required fields",L_Fdbk_BusinessNotFound_PushpinNotMoved_ErrorMessage:"Move the drawing pin on the map to the correct location",L_Fdbk_ReportAProblemOnMap_Reminder:"Please complete all required fields.",L_Fdbk_ReportAProblemOnMap_Required:"Required field",L_Fdbk_ReportNoFound_Required:"Required",L_Fdbk_ReportAProblemOnMap_RequiredSign:"*",L_Fdbk_Drag_Pin_Tip:"Drag to the location of the problem",L_Fdbk_Business_Name:"Name",L_Fdbk_Business_Name_Placeholder_Text:"Business Name",L_Fdbk_Business_Name_With_RequiredSign:"*Business Name",L_Fdbk_Business_Name_Required_Error_Message:"Enter Business Name",L_Fdbk_Business_Address:"Address",L_Fdbk_Business_Address_Required_Error_Message:"Enter Addressline / Street / Town or City",L_Fdbk_Business_City_Required_Error_Message:"Enter City",L_Fdbk_Business_City:"City",L_Fdbk_Business_City_With_RequiredSign:"*City",L_Fdbk_Business_State:"Region or County",L_Fdbk_Business_State_PostalCode_Label:"County & Postcode",L_Fdbk_Business_PostalCode:"Postcode",L_Fdbk_Business_Phone:"Phone",L_Fdbk_Business_Website:"Website",L_Fdbk_Business_Closed:"Closed or does not exist",L_Fdbk_Business_NameIs:"{0} is:",L_Fdbk_Business_DetailsIncorrect:"Details Incorrect",L_Fdbk_Business_MarkIncorrect:"Details incorrect",L_Fdbk_Optional:"Optional",L_Fdbk_UserComments:"Comments",L_Fdbk_Business_Contact:"Phone",L_Fdbk_Business_PermanentlyClosed:"Permanently Closed",L_Fdbk_Business_DosentExist:"Does Not Exist",L_Fdbk_Business_Private:"Private",L_Fdbk_Business_Duplicate:"Duplicate",L_Fdbk_Business_Spam:"Spam",L_Fdbk_Provide_More_Feedback:"Additional details (Phone and Website)",L_Fdbk_New_ThankYou:"Thank you!",L_Fdbk_Bing_Better:"Your feedback helps make Bing better!",L_Fdbk_Map_Location:"Map Location",L_Fdbk_Add_Entity:"Are you trying to add a missing business?",L_Fdbk_Move_Pushpin:"Move Drawing Pin",L_Fdbk_UserComments_Alt:"Please provide additional details that can help us verify the business.",L_Menu_SuggestAnEdit_Link_Text:"Suggest an edit",L_Tooltip_Expand_Text:"Expand",L_Tooltip_Collapse_Text:"Collapse",L_Tooltip_Undo_Text:"Undo",L_Fdbk_Not_Avaliable:"Not Available",L_Fdbk_WrongDirections:"Wrong directions",L_Fdbk_LocationInDirectionsIncorrect:"{0} is in the wrong location",L_Fdbk_WhichStepIsWrong:"Which step is wrong?",L_Fdbk_AddStep:"Add step",L_Fdbk_BetterRoute:"I know of a better route that is not shown",L_Fdbk_IncorrectTimesTransit:"Incorrect times for transit services",L_Fdbk_IncorrectLocationTransitStop:"Incorrect location of a transit stop",L_Tooltip_Close_Text:"Close",L_Fdbk_Business_HoursOfOperation:"Hours of Operations",L_Fdbk_Select_Issue_Message:"Please click on the problem area.",MarkIncorrect:"Mark Incorrect",AddHours:"Add hours",WhichDays:"Which days?",DayFriday:"Friday",DayFridayShort:"Fri",DayMonday:"Monday",DayMondayShort:"Mon",DaySaturday:"Saturday",DaySaturdayShort:"Sat",DaySunday:"Sunday",DaySundayShort:"Sun",DayThursday:"Thursday",DayThursdayShort:"Thu",DayTuesday:"Tuesday",DayTuesdayShort:"Tue",DayWednesday:"Wednesday",DayWednesdayShort:"Wed",ErrorIncorrectHours:"Close time cannot be less than open time",ErrorMissingHours:"Add some hours",ErrorSelectDays:"Select which days",AddMoreHours:"Add more hours",ButtonUpdate:"Update",Open24x7:"Open 24 x 7",ButtonCancel:"Cancel",ButtonAdd:"Add",SendEmail:"Email me about my changes",DidYouMean:"Did you mean?",DidYouMeanThisPlace:"Wait, did you mean this place?",SimilarBusinessOnBing:"We found similar business on Bing!",L_FdbkEditButtonLabel:"Click to edit {0}",FdbkTeolinOptOutLabel:"Map data transition information",FdbkBusinessOwner:"Are you the business owner?",FdbkBingPlacesText:"If so, manage your business listing on {0}",FdbkBingPlacesLink:"Bing Places",FdbkAddressErrorWithPin:"Please complete all required fields, and drag the drawing pin to the location of the issue on the map.",FdbkGeneralAddressReminder:"You have not filled out the feedback form. Please give us more information including dragging the pin to the location of the issue on the map.",FdbkPinToolTip:"Drag the pin to the location of the issue on the map",FdbkNumberAndStreetGhost:"Street Name, Number",FdbkStreetGhost:"Street Name",FdbkStreetLabel:"Street address",FdbkPostcodeLabel:"Postcode",FdbkMainSelectionLabel:"Select the problem area",FdbkMoreInfoLabel:"Give us a little more information",FdbkAreaDirections:"Directions",FdbkAreaRealEstate:"Issue with listing for {0}",FdbkAreaMap:"The map",FdbkAddYourBusiness:"Add your business to {0}",FdbkProblemMyPlaces:"My Places",FdbkSubProbCollections:"Collections",FdbkSubProbFavorites:"Favourites",FdbkSubProbHomeWork:"Home or Work",FdbkSubProbItineraries:"Itineraries",FdbkSubProbMissingMyPlaces:"I don't see any of my saved places",FdbkProblemAccessibility:"Accessibility and Performance",FdbkProblemLocalGuide:"Local Guide",FdbkProblemMeasure:"Measure distance",FdbkProblemContributions:"My Contributions",FdbkManageContribution:"Manage {0}",FdbkProblemPrintShare:"Print or Share",FdbkProblemWrongLang:"Wrong language",FdbkProblemMapDisplay:"Map displaying incorrectly (overlapping, all white, etc)",FdbkProblemSatelliteBE:"Satellite or Birds Eye",FdbkProblemZoom:"Zoom",FdbkSubProbPolitic:"A political entity is missing or incorrect (country/region, state/province, county etc.)",FdbkSubProbBoundaryVisible:"The boundary between countries, states, provinces, or counties is hard to see",FdbkSubProbBoundaryIncorrect:"The boundary between countries, states, province, or county is incorrect",FdbkNotMyLocale:"My location is incorrect",fdbkOther:"Other",FdbkSelectArea:"Select ...",FdbkDirectionIncorrect:"Directions are incorrect or could be better",FdbkProblemFlyover:"City Flyover",FdbkProblemRoadView:"Road View or Dark Mode View",FdbkProblemLookBusiness:"I was looking for a business",FdbkProblemLookPlace:"I was looking for a populated place (city, neighbourhood, country/region, postcode, etc.)",FdbkProblemLookAddress:"I was looking for an address",FdbkRouteTime:"Route time is incorrect",FdbkProblemTraffic:"Traffic",FdbkDirectionRoadClose:"Road closure missing",FdbkAddMissingBusinessTitle:"Add missing business",FdbkLandmarks:"Landmark on Map",FdbkSubProblemError:"Please select a specific issue.",FdbkProblemError:"Please tell us a little more information.",PrintAndMore:"Print, My Places, and more",StreetsideMapStyle:"Streetside ®",ReportAProblem:"Report a privacy concern with this image",ReportAProblemInstruction:'To report a privacy concern, make sure you are already in the Streetside ® view and then select the "Report a privacy concern with this image" button from within that map view. This helps us identify exactly what view in Streetside you are reporting a concern about.',ReturnToDirections:"Return to directions",TerrainProblemType:"Terrain",StreetsideFeedbackTitle:"{0} {1}"},n=window.$MicrosoftMaps8,i;n.ResourceManager?n.ResourceManager.init("Feedbacks",t):(i=n.ResourcesObject=n.ResourcesObject||{},i.Feedbacks=t)}(),function(){var ui,nt,cu,lu,fi,ot,pu,wu,kr,gu,nf,di;try{var h=Microsoft.Maps,c=h.Internal,gt=c.__assign,v=c.__extends,gi=c.__spreadArray,u=h.globalConfig,tu=c.coreConfig,k=u.features,ni=k.advertising,pt=k.autosuggest,ht=k.calendar,l=k.collections,rh=k.directions,w=k.feedback,uh=k.flyover,fh=k.landmarks3D,eh=k.map3D,oh=k.richMapsInfobox,sh=k.labels,hh=k.layerManager,er=k.localGuide,li=k.localSearch,si=k.mapDelay,ch=k.optIn,ei=k.print,ut=k.sharing,at=k.streetside,lh=k.birdseye,p=k.taskBar,ti=k.taskFramework,ah=k.trafficControl,vh=k.traffic,iu=k.trafficExperiences,or=k.transit,ct=k.travel,yh=k.xsr,ph=atlas.math,ai=atlas.data,wh=atlas.layer,ff=atlas.Pixel,nr=atlas.data.BoundingBox,vt=c.AzureMapEvents,vi=c.AzureMapInteractions,bh=c.Binding,kh=c.BoundsAccumulator,dh=c.Debug,n=c.Gimme,e=c.AtlasHelper,st=c.EntityHelper,b=c.Helper,gh=c.LocationRectHelper,nc=c.LocalStorageCache,yi=c.LruCache,tc=c.MapMath,wt=c.Network,s=c.JSEvent,ef=c.ObjectWithId,ic=c.Observable,oi=c.ObservableCollection,bt=c.ObservableObject,rc=c.Overlay,uc=c.PyramidTileSpatialIndex,ft=c.TaskDataHandlerHelper,fc=c.TileSystemHelper,sf=c.PerfV2Logger,ec=c.VectorMath,a=c.TimeoutWrapper,oc=h.Anchor,sr=h.BingMapStyle,sc=h.Color,tr=h.globalContainer,hc=c.InstrumentationBase,cc=h.LatLonCrs,ii=h.Location,lc=h.LatLonEncoder,ac=c.ObservableObjectChangedArgs,hf=h.Point,vc=h.Rectangle,hr=h.ResourceManager,yc=h.SimpleAreaPrimitive,pc=h.SimpleLinePrimitive,pi=h.SimplePointPrimitive,ru=h.Size,uu=h.Delegates,wc=h.DirectionsControl,fu=c.BaseTask,ri=c.BaseTaskViewModel,kt=c.Control,it=c.ControlTemplate,eu=h.DeviceInfo,cf=c.ExternalPromise,cr=c.LocalSearchEntity,lr=c.MapsInfobox,ou=c.OverlayEntity,yt=c.Permalink,wi=c.PrimitiveOverlayHelper,lf=c.ReverseGeocoder,bc=h.FlyoverData,af=c.RichEntityInfoboxContentProcessor,kc=c.dependencyResolver,ar=h.ResourceManager.MapCore,t=hr.Feedbacks,r=h.GlobalDataEventHandler,d=hr.MapDelay,tt=h.MapQuadrant,o=hr.InternalControls,f=h.ResourceManager.CommonControls,su=h.ResourceManager.TaskFramework,dc=c.PrintContent,vr=h.CommonControls,vf=vr.AutosuggestV2,yf=vr.AutosuggestViewModel,pf=vr.SearchBoxAutosuggestDataModel,wf='<div class="bm_dropdownContainer">    <a class="{TemplateBinding DisplayDropdown Converter=dropdownOpenClass}" data-tag="dropdownButton" event:click="onDropdownButtonClick" event:mouseleave="mouseexitDropdown" event:mouseenter="mouseoverDropdown" role="button" aria-expanded="{TemplateBinding DisplayDropdown}" href="#">        <span class="{TemplateBinding ButtonIcon}"><\/span>        <span>            <TextBlock Text="{TemplateBinding ButtonName}" />        <\/span>        <span class="chevron"><\/span>    <\/a>    <div class="dropdownParent">        <div class="multiselectDropdown popOutTop" style:display="{TemplateBinding DisplayDropdown Converter=boolToDisplay}" event:mouseleave="mouseexitDropdown" event:mouseenter="mouseoverDropdown">            <div class="dropdownTitle" style:display="{TemplateBinding DropdownTitle Converter=boolToDisplay}">                <TextBlock Text="{TemplateBinding DropdownTitle}" />            <\/div>            <ItemsControl ItemsSource="{TemplateBinding ItemList}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <div>                            <a class="multiselectItem" data-tag="multiselectItem" data-entityid="{Binding Name}" event:click="onItemClick" role="checkbox" aria-checked="{Binding Checked}" href="#">                                <span class="{Binding Checked Converter=itemCheckedClass}"><\/span>                                <span class="{Binding Icon}"><\/span>                                <span class="itemName">                                    <TextBlock Text="{Binding Name}" />                                <\/span>                            <\/a>                        <\/div>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div><\/div>',bf='<div>    <div class="sliBack" event:click="clickBackgroundHandler"><\/div>    <div class="sliMenu">        <ItemsControl ItemsSource="{Binding menuItems}">            <ItemsControl.Template>                <DataTemplate>                    <ul class="sliMenuList"><ItemsPresenter /><\/ul>                <\/DataTemplate>            <\/ItemsControl.Template>            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li class="{Binding type}" >                        <a href="#" id="{Binding htmlId}" class="{Binding cssClass}" event:click="clickHandler">                            <TextBlock text="{Binding name}" />                        <\/a>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <\/div>  <\/div>',kf='<div class="CalendarSync calendarIcon">\t<div class="calendarSelect" data-tag="calendarSyncSelect">\t\t<SelectControl ItemsSource="{Binding calendarTypes}" IgnorePopOutButtonText="{Binding hasPresetStartEndTime}" SelectedItem="{Binding calendarType Mode=TwoWay}" event:dropdown="onDropdown" />\t<\/div>    <div style:display="{Binding showStartEndTimeLinks Converter=boolToDisplay}">        <div id="startCalendar">            <div>                <span class="startTimeLabel">                    <TextBlock Text="{Binding resources.L_CalendarSync_StartTime}" />                <\/span>                <span class="startDateAndTime" >                    <a class="dateTimeSelector dropdownBtn" event:click="onStartTimeClick" href="#" role="button" aria-expanded="{Binding showStartCalendarSelector}">                        <TextBlock Text="{Binding startDateTime}" />                    <\/a>                <\/span>            <\/div>            <div style:display="{Binding showStartCalendarSelector Converter=boolToDisplay}">                <div class="calendarSyncStartDate" data-tag="calendarSyncDate"><\/div>                <div class="calendarTime">                    <TimeControl Time="{Binding startTime Mode=TwoWay}" Editing="{Binding startEditingTime Mode=TwoWay}" Disabled="{Binding timeControlDisabled}" taskId="{Binding startTaskId}" />                    <div class="allDayEventCheckbox">                        <CheckBox Checked="{Binding isAllDayEvent Mode=TwoWay}" Value="{Binding resources.L_CalendarSync_AllDayEvent}" Content="{Binding resources.L_CalendarSync_AllDayEvent}" />                    <\/div>                <\/div>            <\/div>        <\/div>        <div class="endTimeLink" style:display="{Binding showEndTimeLink Converter=boolToDisplay}">            <a event:click="onEndTimeLinkClick" href="#"><TextBlock Text="{Binding resources.L_CalendarSync_EndTimeLink}" /><\/a>        <\/div>        <div class="endCalendar" style:display="{Binding showEndCalendar Converter=boolToDisplay}">            <div>                <span class="endTimeLabel">                    <TextBlock Text="{Binding resources.L_CalendarSync_EndTime}" />                <\/span>                <span class="endDateAndTime">                    <a class="dateTimeSelector dropdownBtn" event:click="onEndTimeClick" href="#">                        <TextBlock Text="{Binding endDateTime}" />                    <\/a>                <\/span>            <\/div>            <div style:display="{Binding showEndCalendarSelector Converter=boolToDisplay}">                <div class="calendarSyncEndDate" data-tag="calendarSyncDate"><\/div>                <div class="calendarTime">                    <TimeControl Time="{Binding endTime Mode=TwoWay}" Editing="{Binding endEditingTime Mode=TwoWay}" Disabled="{Binding timeControlDisabled}" taskId="{Binding startTaskId}" />                    <div class="allDayEventCheckbox">                        <CheckBox Checked="{Binding isAllDayEvent Mode=TwoWay}" Value="{Binding resources.L_CalendarSync_AllDayEvent}" Content="{Binding resources.L_CalendarSync_AllDayEvent}" />                    <\/div>                <\/div>            <\/div>        <\/div>        <div class="calendarSyncExportButton">            <a title="{Binding resources.L_CalendarSync_Export}" event:click="onExportClick" href="#" role="button" data-tag="calendarSyncExportButton">                <span class="cbtn b_highlighted">                    <input type="submit" value="{Binding resources.L_CalendarSync_Export}" />                <\/span>            <\/a>        <\/div>        <div class="calendarSyncTimeZoneDisclaimer" style:display="{Binding showTimeZoneDisclaimer Converter=boolToDisplay}">            <TextBlock Text="{Binding resources.L_CalendarSync_TimeZoneDisclaimer}" />        <\/div>    <\/div><\/div>',df='<div class="dropdownTitleSelection">    <Dropdown ItemsSource="{Binding dropdownList}" event:onEntryClicked="onEntryClicked" Class="{Binding dropdownClass}">        <Dropdown.ItemTemplate>            <DataTemplate>                <div class="{Binding cssClass}">                    <CheckBox Content="{Binding name}" Checked="{Binding isSelected}" Value="" />                <\/div>            <\/DataTemplate>        <\/Dropdown.ItemTemplate>    <\/Dropdown><\/div>',gf='<div class="bm_filtersBar" data-tag="filtersBar" role="search" aria-label="{Binding resources.L_Landmark_FiltersBar_Aria_Label}">    <ItemsControl ItemsSource="{Binding _filtersViewModels}">        <ItemsControl.Template>            <DataTemplate>                <ul class="filters"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li class="filter" data-tag="filter">                    <a href="#" class="{Binding filterItem.cssClass}" data-instrumentation="{Binding filterItem.instrumentationData}" event:click="clickHandler" role="button"><TextBlock text="{Binding filterItem.displayName}" /><\/a>                    <div class="{Binding filterItem.cssClass}"><div class="routesPopOut"><\/div><\/div>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <a href="#" class="expandFiltersButton" role="button"><\/a><\/div>',ne='<div class="bm_filtersStatusBar" data-tag="filtersStatusBar" aria-label="{Binding resources.L_Landmark_FiltersBar_Aria_Label}" style:display="{Binding isVisible Converter=boolToDisplay}">    <ItemsControl ItemsSource="{Binding selectedItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="filtersStatus"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li class="{Binding cssClass}" data-tag="filterStatus">                    <div><TextBlock Text="{Binding id Converter=itemToString}" /><\/div>                    <a href="#" class="{Binding id}" data-instrumentation="{Binding instrumentationData}" event:click="onDiscardFilterItemSelection" role="button"><\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl><\/div>',yr='<div class="dropdownTitleList" data-tag="dropdownTitleList">    <a class="dropdownFocusDummy" tabindex="-1" title="{Binding resources.L_DropdownMenuDescription}"><\/a>    <Dropdown ItemsSource="{Binding dropdownList}" event:onEntryClicked="onEntryClicked" event:onEntryMouseover="onEntryMouseover" event:onEntryMouseout="onEntryMouseout" Class="{Binding dropdownClass}" AriaLabel="{Binding ariaLabel}">        <Dropdown.ItemTemplate>            <DataTemplate>                <div class="{Binding cssClass}" role="button">                    <div class="{Binding iconClass}"><\/div>                    <TextBlock Text="{Binding name}" />                <\/div>            <\/DataTemplate>        <\/Dropdown.ItemTemplate>    <\/Dropdown><\/div>',te='<div id="settingsWrapper" class="MicrosoftMap collapsed b_cards">    <div class="b_divdef">        <div class="contentRoot mapSetting">            <div class="moduleRoot b_divdef">                <p class="moduleTitle">MAP STYLES<\/p>                <div class="legendTable">                    <table role="presentation">                        <tbody>                            <tr>                                <td>                                    <div class="tableRow">                                        <div class="tableCell"><a class="roadStyle" event:click="onRoadMapStyleClick"><\/a><\/div>                                        <div class="tableCell"><div><TextBlock Text="{Binding resources.MobileMapStyleRoad}" /><\/div><\/div>                                    <\/div>                                <\/td>                                <td>                                    <div class="tableRow">                                        <div class="tableCell"><a class="aerialStyle" event:click="onAerialMapStyleClick"><\/a><\/div>                                        <div class="tableCell"><div><TextBlock Text="{Binding resources.MobileMapStyleAerial}" /><\/div><\/div>                                    <\/div>                                <\/td>                            <\/tr>                        <\/tbody>                    <\/table>                <\/div>            <\/div>        <\/div>        <div class="mobileSettingContainer mapSetting" event:click="onTrafficClick">            <div class="labelToggle_Container labelStyle">                <div class="labelStyleSwitch">                    <input id="mapStyleToggle" type="checkbox" class="labelToggle_Input" checked="{Binding trafficOn Mode=TwoWay}" />                    <label class="labelToggle_label">                        <TextBlock Text="{Binding resources.MobileShowTraffic}" />                    <\/label>                <\/div>            <\/div>        <\/div>        <div id="zoomBtnsToggle" class="mobileSettingContainer mapSetting hidden" event:click="onZoomBtnsClick">            <div class="labelToggle_Container labelStyle">                <div class="labelStyleSwitch">                    <input id="zoomBtnsToggleInput" type="checkbox" class="labelToggle_Input" checked="{Binding zoomBtnsOn Mode=TwoWay}" />                    <label class="labelToggle_label">                        <TextBlock Text="{Binding resources.MobileShowZoomBtns}" />                    <\/label>                <\/div>            <\/div>        <\/div>        <div class="mobileSettingContainer pageSetting supportHidden">            <div class="labelToggle_Container labelStyle">                <div class="labelStyleSwitch">                    <a class="mobileSetting" href="/maps/myplaces/">                        <TextBlock Text="{Binding resources.MobileMyPlaces}" />                    <\/a>                <\/div>            <\/div>        <\/div>        <div class="mobileSettingContainer pageSetting supportHidden">            <div class="labelToggle_Container labelStyle">                <div class="labelStyleSwitch">                    <a class="mobileSetting" href="/maps/mycontributions/">                        <TextBlock Text="{Binding resources.MobileMyContributions}" />                    <\/a>                <\/div>            <\/div>        <\/div>        <div class="mobileSettingContainer pageSetting supportHidden" event:click="onExploreNearYouClick">            <div class="labelToggle_Container labelStyle">                <div class="labelStyleSwitch">                    <label class="mobileSetting">                        <TextBlock Text="{Binding resources.MobileExploreNearYou}" />                    <\/label>                <\/div>            <\/div>        <\/div>        <div class="mobileSettingContainer pageSetting" event:click="onFeedbackClick">            <div class="labelToggle_Container labelStyle">                <div class="labelStyleSwitch">                    <label class="mobileSetting">                        <TextBlock Text="{Binding resources.MobileFeedback}" />                    <\/label>                <\/div>            <\/div>        <\/div>        <div class="mobileSettingContainer">            <div class="labelToggle_Container labelStyle">                <div class="labelStyleSwitch">                    <a class="mobileSetting doneLabel" event:click="onDoneClick">                        <TextBlock Text="{Binding resources.MobileClose}" />                    <\/a>                <\/div>            <\/div>        <\/div>    <\/div><\/div>',ie='<PopOutButton PopOutContent="{Binding popOutContent}" PopOutTemplate="{Binding popOutTemplate}" IsDisplayed="{Binding isDisplayed Mode=TwoWay}" ButtonClass="{Binding buttonClass}"><\/PopOutButton>',re='<div class="popupMessage" data-tag="popupMessage">    <PopOut Content="{Binding PopOut}">        <PopOut.ContentTemplate>            <DataTemplate>                <div class="messageContainer" event:click="onPopOutClick" tabindex="-1" role="dialog" aria-labelledby="saveMessage" >                    <div class="saveMessage" id="saveMessage" data-tag="saveMessage">                        <TextBlock text="{Binding title}" />                        <PopUpMessageControl linkTitle="{Binding linkTitle}" showLink="{Binding showLink}" showChangeLink="{Binding showChangeLink}" event:popupLinkClicked="onPopOutLinkClick"  event:popupChangeLinkClicked="onPopOutChangeLinkClick"/>                    <\/div>                    <div style:display="{Binding ShowAnnotate Converter=boolToDisplay}">                        <div class="annotateContainer" data-tag="AnnotateContainer" style:display="{Binding showFooter}">                            <div id="annotationLabel">                                <TextBlock text="{Binding updateNicknameMessage}" />                            <\/div>                            <div class="nameInputContainer">                                <input type="text" class="nameEditBox" data-tag="editItemTitleControl" maxlength="100" value="{Binding NickName Mode=TwoWay}" event:keydown="onPopOutKeyPressed" aria-labelledby="annotationLabel" />                                <a href="#" class="popoutSaveButton" data-tag="popoutSaveButton" event:click="onPopOutSaveLinkClick" event:touchend="onPopOutSaveLinkClick" role="button">                                    <TextBlock Text="{Binding saveButtonTitle}" />                                <\/a>                            <\/div>                        <\/div>                    <\/div>                <\/div>            <\/DataTemplate>        <\/PopOut.ContentTemplate>    <\/PopOut><\/div>',ue='<div class="dropdownTitleList" data-tag="dropdownTitleList">    <Dropdown ItemsSource="{Binding dropdownList}" event:onEntryClicked="onEntryClicked" Class="{Binding dropdownClass}">        <Dropdown.ItemTemplate>            <DataTemplate>                <div class="{Binding cssClass}">                    <div class="ratingStars"><div class="yellowStars"><\/div><div class="regularStars"><\/div><\/div>                    <div><TextBlock Text="{Binding name}" /><\/div>                <\/div>            <\/DataTemplate>        <\/Dropdown.ItemTemplate>    <\/Dropdown><\/div>',fe='<div class="signInPopup">    <PopOut Content="{Binding PopOut}">        <PopOut.ContentTemplate>            <DataTemplate>                <div>                    <SignInPopUpControl SignInMessage="{Binding title}" event:signInClicked="onPopOutLinkClick" event:signedIn="onSignedIn"/>                <\/div>            <\/DataTemplate>        <\/PopOut.ContentTemplate>    <\/PopOut><\/div>',ee='<div class="dropdownTitleList" data-tag="dropdownTitleList">    <Dropdown ItemsSource="{Binding dropdownList}" event:onEntryClicked="onEntryClicked" event:onEntryMouseover="onEntryMouseover" event:onEntryMouseout="onEntryMouseout" Class="{Binding dropdownClass}">        <Dropdown.ItemTemplate>            <DataTemplate>                <div class="{Binding cssClass}">                    <div class="{Binding iconClass}">                    <\/div>                    <div class="listItemText">                        <TextBlock Text="{Binding name}" />                    <\/div>                    <div class="arrow" style:display="{Binding showArrow Converter=boolToDisplay}"><\/div>                <\/div>            <\/DataTemplate>        <\/Dropdown.ItemTemplate>    <\/Dropdown><\/div>',oe='<div class="{Binding primitive.mapTypeClass}" data-tag="transientLensRoot">    <div id="transientLens" event:click="clickHandler" event:touchend="clickHandler" event:keydown="clickHandler" data-tag="transientLens" style="visibility:hidden;">        <div class="transientLensImg"><\/div>        <div class="transientLensActions" role="menu">                        <ItemsControl ItemsSource="{Binding primitive.entity.actions}" panelTagName="ul">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li role="none">                            <a href="#" class="{Binding cssClass}" event:click="handler" event:touchend="handler" event:keydown="handler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" data-instrumentation="{Binding instData}" data-tag="{Binding cssClass}" role="menuitem">                                <div class="icon" ><\/div>                                <div class="actionText">                                    <TextBlock Text="{Binding text}" />                                <\/div>                                <div class="{Binding secTextClass}" style:display="{Binding showSecText Converter=boolToDisplay}"  event:click="secTextLinkHandler" event:touchend="clickHandler" data-tag="{Binding secTextClass}">                                    <TextBlock Text="{Binding secText}"/>                                <\/div>                                <div class="arrow" style:display="{Binding showArrow Converter=boolToDisplay}"><\/div>                            <\/a>                            <div class="transientLensSeparator" style:display="{Binding showSeparator Converter=boolToDisplay}"><\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>        <div class="directionsPopOut" data-tag="directionsPopOut">        <\/div>        <div class="travelPopOut" data-tag="travelPopOut">        <\/div>        <div class="collectionsPopOut" data-tag="collectionsPopOut">        <\/div>        <div class="nearbyPopOut" data-tag="nearbyPopOut">        <\/div>    <\/div><\/div>',se='<ul class="bm_controlsContainer"><\/ul>',he='<div class="bm_flexWrapper" data-tag="Feedback.Links.Container">    <div class="bm_feedbackBetaButton" data-tag="Feedback.Button">        <a class="bm_feedbackBetaButtonLink" event:click="onFeedbackClick" event:keydown="onKeydown" event:mouseover="onMouseOver" event:mouseout="onMouseOut" event:mousemove="onMouseMove" href="#" id="mapsFeedback" aria-label="Feedback" role="button" data-tag="Feedback.Links.MapFeedback" aria-expanded="false" aria-haspopup="true" aria-controls="feedbackPopOut">            <div class="bm_feedbackButtonContentContainer">                <div id="bm_feedbackBetaButtonIcon"><\/div>                <div id="bm_feedbackBetaButtonText">                    <TextBlock Text="{TemplateBinding resources.L_Fdbk_Link}" />                <\/div>            <\/div>        <\/a>    <\/div><\/div>',ce='<div class="feedbackPanelRoot">    <div class="feedbackPanel">        <div class="feedbackHeader" style:display="{Binding showFeedbackHeader Converter=boolToDisplay}">            <div class="feedbackTitle" role="heading" aria-level="2">                <TextBlock Text="{Binding resources.L_Fdbk_GeneralFeedback}" />            <\/div>            <a href="#" class="feedbackPanelClose" title="{Binding resources.L_CloseTask_Text}" role="button" event:click="onFeedbackDoneClick">                <div class="icon"><\/div>            <\/a>        <\/div>        <div class="feedbackDivPanel" style:display="{Binding showGeneralFeedbackPanel Converter=boolToDisplay}" data-tag="generalFeedbackPanel">            <div class="generalFeedbackOverall">                <div class="feedbackCardLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_Overall_Experience}" />                <\/div>                <div class="overallSelections">                    <a class="happyButton" title="{Binding resources.L_Fdbk_Overall_Happy}" href="#" event:click="onOverallHappyButtonClick" data-tag="overallFeedbackHappyButton" role="button" aria-pressed="{Binding happySelected}" event:focus="onClearError">                    <\/a>                    <a class="unhappyButton" title="{Binding resources.L_Fdbk_Overall_Unhappy}" href="#" event:click="onOverallUnhappyButtonClick" data-tag="overallFeedbackUnhappyButton" role="button" aria-pressed="{Binding unHappySelected}" event:focus="onClearError">                    <\/a>                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="commentsGeneralDiv">                <div class="feedbackCardLabel" id="feedbackCardCommentsLabel">                    <TextBlock Text="{Binding newFeedbackInputHeader}" />                <\/div>                <div class="feedbackCardText">                    <textarea class="feedbackComments" rows="6" placeholder="{Binding newFeedbackTextWatermark}" value="{Binding commentsGeneral Mode=TwoWay}" maxlength="2000" data-tag="commentsGeneral" aria-labelledby="feedbackCardCommentsLabel" event:focus="onClearError" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" style:display="{Binding emailDisplay}" data-tag="emailDiv">                <div class="feedbackCardLabel" id="feedbackCardEmailLabel">                    <TextBlock Text="{Binding emailLabel}" />                <\/div>                <div class="feedbackCardText">                    <input type="text" placeholder="{Binding resources.L_Fdbk_EmailWatermark}" value="{Binding email Mode=TwoWay}" maxlength="400" data-tag="email" aria-labelledby="feedbackCardEmailLabel" />                <\/div>                <a href="{Binding privacyPolicyLink}" target="_blank" class="privacyPolicyLink" style:display="{Binding privacyPolicyLinkDisplay}" role="link">                    <TextBlock Text="{Binding resources.L_Fdbk_PrivacyPolicyLink}" />                <\/a>            <\/div>            <div class="feedbackCardLink" data-tag="reportAProblemOnMapLinkDiv" style:display="{Binding isMobile Converter=boolToNotDisplay}">                <div class="feedbackCardLabel" id="fdbkCardMapIssueLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_SpecificMapIssue}" />                <\/div>                <a href="#" class="reportProblemOnMapLink" role="button" event:click="onReportAProblemOnMapClick" data-tag="reportAProblemOnMapLink" aria-labelledby="fdbkCardMapIssueLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap}" />                <\/a>            <\/div>            <div class="feedbackCardFoot">                <a class="textButton closeButton" title="{Binding resources.L_Fdbk_Done}" event:click="onFeedbackDoneClick" href="#" role="button" tabindex="0" data-tag="feedbackDoneButton" style:display="{Binding isMobile Converter=boolToDisplay}">                    <TextBlock Text="{Binding resources.L_Fdbk_Done}" />                <\/a>                <a class="textButton" title="{Binding resources.L_Fdbk_Send}" event:click="onGeneralFeedbackSendClick" href="#" role="button" data-tag="generalFeedbackSendButton">                    <TextBlock Text="{Binding resources.L_Fdbk_Send}" />                <\/a>            <\/div>        <\/div>        <div class="feedbackDivPanel" style:display="{Binding showProblemOnMapPanel Converter=boolToDisplay}" data-tag="problemOnMapPanel">            <div class="pushpinMessage">                <TextBlock Text="{Binding resources.L_Fdbk_Pushpin_Message}" />            <\/div>            <div class="feedbackCardInputDiv problemSelect" data-tag="problemTypesDropDownDiv">                <div class="feedbackCardLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_Problem}" />                    <span class="requireSign">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                <\/div>                <div class="feedbackSelect" data-tag="problemTypesDropDown" event:click="onClearError">                    <SelectControl ItemsSource="{Binding problemTypes}" SelectedItem="{Binding problemType Mode=TwoWay}" event:dropdown="onDropdown" PopOutId="feedbackProblem" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="subProblemTypesDropDownDiv">                <div class="feedbackCardLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_SubProblem}" />                <\/div>                <div class="feedbackSelect" data-tag="subProblemTypesDropDown" event:click="onClearError">                    <SelectControl ItemsSource="{Binding subProblemTypes}" SelectedItem="{Binding subProblemType Mode=TwoWay}" event:dropdown="onDropdown" PopOutId="feedbackSubProblem" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="addressInput" style:display="{Binding showAddressInput Converter=boolToDisplay}">                <div class="feedbackCardLabel" id="feedbackAddressInput">                    <TextBlock Text="{Binding resources.FdbkStreetLabel}" />                    <span class="requireSign">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                <\/div>                <div class="feedbackCardText">                    <textarea rows="1" class="feedbackAddressInput" placeholder="{Binding addressGhostText}" value="{Binding userAddress Mode=TwoWay}" maxlength="600" data-tag="userAddressInput" aria-labelledby="feedbackAddressInput" event:focus="onClearError" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="postcodeInput" style:display="{Binding showPostcodeInput Converter=boolToDisplay}">                <div class="feedbackCardLabel" id="feedbackPostcodeInput">                    <TextBlock Text="{Binding resources.FdbkPostcodeLabel}" />                <\/div>                <div class="feedbackCardText">                    <textarea rows="1" class="feedbackPostcodeInput" value="{Binding userPostcode Mode=TwoWay}" maxlength="60" data-tag="userPostcodeInput" aria-labelledby="feedbackPostcodeInput" event:focus="onClearError" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="commentsBaseMapDiv">                <div class="feedbackCardLabel" id="feedbackCardIssueLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_MapIssueDescription}" />                    <span class="requireSign">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                <\/div>                <div class="feedbackCardText">                    <textarea rows="6" class="feedbackDescribeProblem" placeholder="{Binding resources.L_Fdbk_DescribeProblem}" value="{Binding commentsBaseMap Mode=TwoWay}" maxlength="2000" data-tag="commentsBaseMap" aria-labelledby="feedbackCardIssueLabel" event:focus="onClearError" />                <\/div>            <\/div>            <div class="requireMessage">                <span class="requireSign">                    <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                <\/span>                <span class="requireLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_Required}" />                <\/span>            <\/div>            <div class="feedbackCardLink" data-tag="sendGeneralFeedbackLinkDiv">                <div class="feedbackCardLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_NotProblemOnMap}" />                <\/div>                <a href="#" event:click="onSendGeneralFeedbackClick" data-tag="sendGeneralFeedbackLink">                    <TextBlock Text="{Binding resources.L_Fdbk_SendGeneralFeedback}" />                <\/a>            <\/div>            <div class="feedbackCardFoot">                <a class="textButton" title="{Binding resources.L_Fdbk_Send}" event:click="onProblemOnMapSendClick" href="#" role="button" data-tag="problemOnMapSendButton">                    <TextBlock Text="{Binding resources.L_Fdbk_Send}" />                <\/a>            <\/div>        <\/div>        <div class="thankYouPanel" style:display="{Binding showThankYouPanel Converter=boolToDisplay}" role="status" aria-labelledby="thankYouMessageBase" aria-expanded="{Binding showThankYouPanel}" data-tag="thankYouPanel">            <div class="thankYouMessage" id="thankYouMessageBase">                <TextBlock Text="{Binding resources.L_Fdbk_ThankYou}" />            <\/div>            <div class="feedbackCardFoot">                <a class="textButton thankYouPanel" title="{Binding resources.L_Fdbk_Done}" event:click="onFeedbackDoneClick" href="#" role="button" tabindex="0" data-tag="feedbackDoneButton">                    <TextBlock Text="{Binding resources.L_Fdbk_Done}" />                <\/a>            <\/div>        <\/div>        <div class="messagePanel" style:display="{Binding showMessagePanel Converter=boolToDisplay}" role="status" aria-expanded="{Binding showMessagePanel}" data-tag="messagePanel">            <div class="reminderMessage" data-tag="reminderMessage">                <TextBlock Text="{Binding reminderMessage}" />            <\/div>        <\/div>    <\/div><\/div>',le='<div class="feedbackPanelRoot">    <div class="feedbackPanel">        <div style:display="{Binding showSuggestions Converter=boolToDisplay}" class="meautosuggesttext">            <div>                <span class="feedbackDidYouMeanText">                    <TextBlock Text="{Binding resources.DidYouMeanThisPlace}" />                <\/span>            <\/div>            <div>                <span class="similarBusinessOnBingText">                    <TextBlock Text="{Binding resources.SimilarBusinessOnBing}" />                <\/span>            <\/div>        <\/div>        <textarea class="dummyfocus" style:display="none" tabindex="-1"><\/textarea>        <div class="me-overlay-listings" style:display="{Binding showSuggestions Converter=boolToDisplay}">            <div class="me-entity-listing-container">                <div class="me-b_rich">                    <ul class="me-b_vList"><\/ul>                <\/div>            <\/div>        <\/div>        <div class="feedbackDivPanel" data-tag="reportMissingEntityPanel" style:display="{Binding showFeedbackForm Converter=boolToDisplay}">            <div class="feedbackLookingforSelection meFeedback" data-tag="feedbackLookingforSelection">                <div class="requireMessage meFeedback">                    <span class="requireSign">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                    <span class="requireLabel">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportNoFound_Required}" />                    <\/span>                <\/div>                <div class="feedbackCardLabel">                    <span class="businessOwnerText">                        <TextBlock Text="{Binding resources.FdbkBusinessOwner}" />                    <\/span>                    <span class="businessOwnerLink"><\/span>                <\/div>                <div class="feedbackBusinessDiv meFeedback" data-tag="feedbackBusinessDiv">                    <div class="inputFieldBlock name">                        <label><TextBlock Text="{Binding resources.L_Fdbk_Business_Name}" /><\/label>                        <span class="requireSign">*<\/span>                        <input type="text" class="mefbBusinessName" placeholder="{Binding resources.L_Fdbk_Business_Name_Placeholder_Text}" value="{Binding businessName Mode=TwoWay}" event:blur="onBlurFBRequiredInputFieldName" maxlength="400" data-tag="fbBusinessName" />                    <\/div>                    <div class="validationErrorMessage">                        <TextBlock Text="{Binding resources.L_Fdbk_Business_Name_Required_Error_Message}" />                    <\/div>                    <div class="inputFieldBlock address">                        <label><TextBlock Text="{Binding resources.L_Fdbk_Business_Address}" /><\/label>                        <span class="requireSign">*<\/span>                        <input type="text" class="fbBusinessAddress" placeholder="{Binding resources.L_Fdbk_Business_Address}" value="{Binding businessAddress Mode=TwoWay}" event:blur="onBlurFBRequiredInputFieldAddress" maxlength="400" data-tag="fbBusinessAddress" />                    <\/div>                    <div class="validationErrorMessage">                        <TextBlock Text="{Binding resources.L_Fdbk_Business_Address_Required_Error_Message}" />                    <\/div>                    <div class="inputFieldBlock city">                        <label><TextBlock Text="{Binding resources.L_Fdbk_Business_City}" /><\/label>                        <span class="requireSign">*<\/span>                        <input type="text" class="mefbBusinessCity" placeholder="{Binding resources.L_Fdbk_Business_City}" value="{Binding businessCity Mode=TwoWay}" event:blur="onBlurFBRequiredInputFieldAddress" maxlength="400" data-tag="fbBusinessCity" />                    <\/div>                    <div class="validationErrorMessage">                        <TextBlock Text="{Binding resources.L_Fdbk_Business_City_Required_Error_Message}" />                    <\/div>                    <div class="inputFieldBlock">                        <label><TextBlock Text="{Binding resources.L_Fdbk_Business_State_PostalCode_Label}" /><\/label>                        <input type="text" class="mefbBusinessState" placeholder="{Binding resources.L_Fdbk_Business_State}" value="{Binding businessState Mode=TwoWay}" event:blur="onBlurFBRequiredInputFieldAddress" maxlength="400" data-tag="fbBusinessState" />                        <input type="text" class="mefbBusinessPostalCode" placeholder="{Binding resources.L_Fdbk_Business_PostalCode}" value="{Binding businessPostalCode Mode=TwoWay}" event:blur="onBlurFBRequiredInputFieldAddress" maxlength="400" data-tag="fbBusinessPostalCode" />                    <\/div>                    <div class="feedbackCardInputDiv meFeedback inputFieldBlock feedbackCardText" data-tag="commentsSearchResultNotFoundDiv">                        <label><TextBlock Text="{Binding resources.L_Fdbk_UserComments}" /><\/label>                        <textarea class="feedbackComments" rows="3" placeholder="{Binding resources.L_Fdbk_Business_More_Details}" value="{Binding commentsSearchResultNotFound Mode=TwoWay}" maxlength="2000" data-tag="commentsSearchResultNotFound" />                        <br class="clearFloat meFeedback" />                    <\/div>                    <div class="meProvideMoreFeedback">                        <CheckBox Content="{Binding resources.L_Fdbk_Provide_More_Feedback}" Checked="{Binding showAllFields Mode=TwoWay}" Value="" />                    <\/div>                    <div class="inputFieldBlock" style:display="{Binding showAllFields Converter=boolToDisplay}">                        <label><TextBlock Text="{Binding resources.L_Fdbk_Business_Phone}" /><\/label>                        <input type="text" class="mefbBusinessPhone" placeholder="{Binding resources.L_Fdbk_Business_Phone}" value="{Binding businessPhone Mode=TwoWay}" maxlength="400" data-tag="fbBusinessPhone" />                    <\/div>                    <div class="inputFieldBlock" style:display="{Binding showAllFields Converter=boolToDisplay}">                        <label><TextBlock Text="{Binding resources.L_Fdbk_Business_Website}" /><\/label>                        <input type="text" class="mefbBusinessWebsite" placeholder="{Binding resources.L_Fdbk_Business_Website}" value="{Binding businessWebsite Mode=TwoWay}" maxlength="400" data-tag="fbBusinessWebsite" />                    <\/div>                <\/div>            <\/div>            <div class="{Binding showDragPushPinErrorMessage Converter=boolToDragPinMessageClass}" data-tag="movePushpinMessage">                <span>                    <TextBlock Text="{Binding resources.L_Fdbk_MovePinToCorrect_Message_For_Missing_Entity}" />                <\/span>            <\/div>            <div class="feedbackCardSearchResultButton meFeedback" data-tag="submitButtonDiv">                <a class="textButton meSendButton" title="{Binding resources.L_Fdbk_Send}" event:click="onMeFeedbackSubmitClick" href="#" role="button" data-tag="resultFeedbackNoFoundSendButton">                    <TextBlock Text="{Binding resources.L_Fdbk_Submit_Text}" />                <\/a>            <\/div>        <\/div>        <div class="feedbackCardSearchResultButton meFeedbackEditSubmit" data-tag="editSubmitAnywayButtonDiv" style:display="{Binding showSuggestions Converter=boolToDisplay}">            <div>                <a class="textButtonme meBacktoEditButton" title="{Binding resources.L_Fdbk_Edit}" event:click="onMeFeedbackBackToEditClick" href="#" role="button" data-tag="resultFeedbackBacktoEditButton" style:display="{Binding showBackToEditButton Converter=boolToDisplay}">                    <TextBlock Text="{Binding resources.L_Fdbk_BackToEdit_Text}" />                <\/a>                <a class="textButtonme meBacktoEditButton" title="{Binding resources.L_Fdbk_Dismiss}" event:click="onMeFeedbackBackToEditClick" href="#" role="button" data-tag="resultFeedbackDismissButton" style:display="{Binding showBackToEditButton Converter=boolToNotDisplay}">                    <TextBlock Text="{Binding resources.L_Fdbk_Dismiss_Text}" />                <\/a>                <a class="textButton meSubmitAnywayButton" title="{Binding resources.L_Fdbk_Send}" event:click="onMeFeedbackSubmitAnywayClick" href="#" role="button" data-tag="resultFeedbackSubmitAnywayButton">                    <TextBlock Text="{Binding resources.L_Fdbk_SubmitAnyway_Text}" />                <\/a>            <\/div>        <\/div>        <div class="thankYouPanel meFeedback" style:display="{Binding showThankYouPanel Converter=boolToDisplay}" role="status" aria-expanded="{Binding showThankYouPanel}" data-tag="searchResulThankYouPanel">            <div style="font-size:15px;" id="ms_ThankYou">                <TextBlock Text="{Binding resources.L_Fdbk_New_ThankYou}" />            <\/div>            <div style="font-size:15px;padding-top:10px" id="ms_ThankYouMessage">                <TextBlock Text="{Binding resources.L_Fdbk_Bing_Better}" />            <\/div>        <\/div>    <\/div><\/div>',ae='<div class="feedbackPanelRoot new">    <div class="feedbackPanel">        <div class="feedbackSlideHeader" style:display="{Binding hideBackButton Converter=boolToDisplay}">            <div class="returnArrowDiv" data-tag="returnArrowDiv">                <a class="commonButton backArrowButton feedbackBackButton" title="{Binding resources.L_Fdbk_ReturnToSearchResult}" event:click="onReturnToSearchResultClick" href="#" role="button" data-tag="returnToSearchResultButton">                    <div class="feedbackBackButtonText">                        <TextBlock Text="{Binding backButtonText}" />                    <\/div>                <\/a>            <\/div>            <div class="feedbackHeaderText">                <TextBlock Text="{Binding resources.L_Fdbk_Link}" />            <\/div>        <\/div>        <div class="feedbackDivPanel" data-tag="feedbackDivPanel" style:display="{Binding showThankYouPanel Converter=boolToNotDisplay}">            <div class="feedbackCardInputDiv problemAreaSelect" data-tag="areaProblemSelect" style:display="{Binding showRequiredArea Converter=boolToDisplay}">                <div class="feedbackCardLabel">                    <TextBlock Text="{Binding resources.FdbkMainSelectionLabel}" />                    <span class="requireSign">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                <\/div>                <div class="feedbackSelect" data-tag="areaDropDown" event:click="onClearError">                    <SelectControl ItemsSource="{Binding problemAreas}" SelectedItem="{Binding problemArea Mode=TwoWay}" event:dropdown="onDropdown" PopOutId="feedbackArea" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv problemSelect" data-tag="problemTypesDropDownDiv" style:display="{Binding showProblemTypes Converter=boolToDisplay}">                <div class="feedbackCardLabel">                    <TextBlock Text="{Binding resources.FdbkMoreInfoLabel}" />                    <span class="requireSign">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                <\/div>                <div class="feedbackSelect" data-tag="problemTypesDropDown" event:click="onClearError">                    <SelectControl ItemsSource="{Binding problemTypes}" SelectedItem="{Binding problemType Mode=TwoWay}" event:dropdown="onDropdown" PopOutId="feedbackProblem" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="subProblemTypesDropDownDiv" style:display="{Binding showSubProblems Converter=boolToDisplay}">                <div class="feedbackCardLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_SubProblem}" />                    <span class="requireSign">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                <\/div>                <div class="feedbackSelect" data-tag="subProblemTypesDropDown" event:click="onClearError">                    <SelectControl ItemsSource="{Binding subProblemTypes}" SelectedItem="{Binding subProblemType Mode=TwoWay}" event:dropdown="onDropdown" PopOutId="feedbackSubProblem" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="directionsIssueDropDownDiv" style:display="{Binding showDirectionsFeedback Converter=boolToDisplay}">                <div class="feedbackCardLabel">                    <span class="labelDirectionsIssue">                        <TextBlock Text="{Binding resources.FdbkMoreInfoLabel}" />                        <span class="requireSign">                            <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                        <\/span>                    <\/span>                <\/div>                <div class="feedbackSelect" data-tag="directionsIssueDropDown">                    <SelectControl ItemsSource="{Binding directionsIssueTypes}" SelectedItem="{Binding directionsIssueType Mode=TwoWay}" event:dropdown="onDropdown" PopOutId="feedbackDirIssue" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="directionStepsIssueDiv" style:display="{Binding showStepsDiv Converter=boolToDisplay}">                <DraggableList ItemsSource="{Binding steps}">                    <DraggableList.ItemTemplate>                        <DataTemplate>                            <div>                                <div class="feedbackCardInputDiv">                                    <div class="feedbackCardLabel">                                        <span class="labelDirectionsStepIssue">                                            <TextBlock Text="{Binding resources.L_Fdbk_WhichStepIsWrong}" />                                        <\/span>                                    <\/div>                                    <div class="feedbackSelect" data-tag="directionsStepIssueDropDown">                                        <SelectControl ItemsSource="{Binding directionsSteps}" SelectedItem="{Binding directionsIssueStep Mode=TwoWay}" event:dropdown="onDropdown" PopOutId="feedbackDirStep" />                                    <\/div>                                <\/div>                                <div class="feedbackCardInputDiv" data-tag="commentsDirectionStepDiv">                                    <div class="feedbackCardLabel">                                        <TextBlock Text="{Binding resources.L_Fdbk_MapIssueDescription}" />                                    <\/div>                                    <div class="feedbackCardText">                                        <textarea class="stepComments" rows="3" value="{Binding commentsDirectionsStep Mode=TwoWay}" maxlength="2000" />                                    <\/div>                                <\/div>                            <\/div>                        <\/DataTemplate>                    <\/DraggableList.ItemTemplate>                <\/DraggableList>                <a title="{Binding resources.L_Fdbk_AddStep}" class="fbDirStepAdd" href="#" event:click="onAddStepClick" data-tag="fbDirStepAdd">                    <span>                        <TextBlock text="{Binding resources.L_Fdbk_AddStep}" />                    <\/span>                <\/a>            <\/div>            <div class="feedbackCardInputDiv" data-tag="addressInput" style:display="{Binding showAddressInput Converter=boolToDisplay}">                <div class="feedbackCardLabel" id="feedbackAddressInput">                    <TextBlock Text="{Binding resources.FdbkStreetLabel}" />                    <span class="requireSign">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                <\/div>                <div class="feedbackCardText">                    <textarea rows="1" class="feedbackAddressInput" placeholder="{Binding addressGhostText}" value="{Binding userAddress Mode=TwoWay}" maxlength="600" data-tag="userAddressInput" aria-labelledby="feedbackAddressInput" event:focus="onClearError" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="postcodeInput" style:display="{Binding showPostcodeInput Converter=boolToDisplay}">                <div class="feedbackCardLabel" id="feedbackPostcodeInput">                    <TextBlock Text="{Binding resources.FdbkPostcodeLabel}" />                    <span class="requireSign" style:display="{Binding showPostRequire Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                <\/div>                <div class="feedbackCardText">                    <textarea rows="1" class="feedbackPostcodeInput" value="{Binding userPostcode Mode=TwoWay}" maxlength="60" data-tag="userPostcodeInput" aria-labelledby="feedbackPostcodeInput" event:focus="onClearError" />                <\/div>            <\/div>            <div class="feedbackCardInputDiv" data-tag="lookingForSelection" style:display="{Binding showLookingforDiv Converter=boolToDisplay}">                <div class="feedbackLookingforSelection" data-tag="feedbackLookingforSelection">                    <div class="feedbackBusinessDiv" data-tag="feedbackBusinessDiv">                        <div class="businessNameContainer">                            <input type="text" class="fbBusinessName" placeholder="{Binding resources.L_Fdbk_Business_Name_Placeholder_Text}" value="{Binding businessName Mode=TwoWay}" event:blur="onBlurFBRequiredInputField" maxlength="400" data-tag="fbBusinessName" event:focus="onClearError" />                            <span class="requireSign"><TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" /><\/span>                        <\/div>                        <input type="text" class="fbBusinessAddress" placeholder="{Binding resources.L_Fdbk_Business_Address}" value="{Binding businessAddress Mode=TwoWay}" maxlength="400" data-tag="fbBusinessAddress" />                        <div class="cityNameContainer">                            <input type="text" class="fbBusinessCity" placeholder="{Binding resources.L_Fdbk_Business_City}" value="{Binding businessCity Mode=TwoWay}" event:blur="onBlurFBRequiredInputField" maxlength="400" data-tag="fbBusinessCity" event:focus="onClearError" />                            <span class="requireSign"><TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" /><\/span>                        <\/div>                        <input type="text" class="fbBusinessState" placeholder="{Binding resources.L_Fdbk_Business_State}" value="{Binding businessState Mode=TwoWay}" maxlength="400" data-tag="fbBusinessState" />                        <input type="text" class="fbBusinessPostalCode" placeholder="{Binding resources.L_Fdbk_Business_PostalCode}" value="{Binding businessPostalCode Mode=TwoWay}" maxlength="400" data-tag="fbBusinessPostalCode" />                        <input type="text" class="fbBusinessPhone" placeholder="{Binding resources.L_Fdbk_Business_Phone}" value="{Binding businessPhone Mode=TwoWay}" maxlength="400" data-tag="fbBusinessPhone" />                        <input type="text" class="fbBusinessWebsite" placeholder="{Binding resources.L_Fdbk_Business_Website}" value="{Binding businessWebsite Mode=TwoWay}" maxlength="400" data-tag="fbBusinessWebsite" />                    <\/div>                <\/div>            <\/div>            <div class="feedbackCardMovePinReminderDiv" style:display="{Binding showMovePushpinMessage Converter=boolToDisplay}" data-tag="movePushpinMessage">                <span>                    <TextBlock Text="{Binding resources.L_Fdbk_MovePinToCorrect_Message}" />                <\/span>                <span class="requireSign" style:display="{Binding showRequirePinMoveSign Converter=boolToDisplay}">                    <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                <\/span>            <\/div>            <div class="feedbackCardInputDiv" data-tag="commentsBaseMapDiv" style:display="{Binding showCommentsDiv Converter=boolToDisplay}">                <div class="feedbackCardLabel" id="feedbackCommentLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_MapIssueDescription}" />                    <span class="requireSign" style:display="{Binding showRequireComments Converter=boolToDisplay}">                        <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                    <\/span>                <\/div>                <div class="feedbackCardText">                    <textarea rows="6" class="feedbackDescribeProblem" placeholder="{Binding resources.L_Fdbk_DescribeProblem}" value="{Binding commentsFeedback Mode=TwoWay}" maxlength="2000" data-tag="commentsBaseMap" aria-labelledby="feedbackCardIssueLabel" event:focus="onClearError" />                <\/div>            <\/div>            <div class="requireMessage" style:display="{Binding showRequireMessage Converter=boolToDisplay}">                <span class="requireSign">                    <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_RequiredSign}" />                <\/span>                <span class="requireLabel">                    <TextBlock Text="{Binding resources.L_Fdbk_ReportAProblemOnMap_Required}" />                <\/span>            <\/div>            <div class="feedbackCardFoot" style:display="{Binding showSendButton Converter=boolToDisplay}">                <a class="{Binding buttonClassName}" aria-label="{Binding resources.L_Fdbk_Send}" event:click="onProblemSendClick" href="#" role="button" data-tag="problemOnMapSendButton" data-type="{Binding feedbackType}">                    <TextBlock Text="{Binding resources.L_Fdbk_Send}" />                <\/a>            <\/div>        <\/div>        <div class="thankYouPanel" style:display="{Binding showThankYouPanel Converter=boolToDisplay}" role="status" aria-labelledby="thankYouMessageBase" aria-expanded="{Binding showThankYouPanel}" data-tag="thankYouPanel">            <div class="thankYouMessage" id="thankYouMessageBase">                <TextBlock Text="{Binding resources.L_Fdbk_ThankYou}" />            <\/div>            <div class="feedbackCardFoot">                <a class="textButton thankYouPanel" title="{Binding resources.L_Fdbk_Done}" event:click="onFeedbackDoneClick" href="#" role="button" tabindex="0" data-tag="feedbackDoneButton">                    <TextBlock Text="{Binding resources.L_Fdbk_Done}" />                <\/a>            <\/div>        <\/div>        <div class="messagePanel" style:display="{Binding showMessagePanel Converter=boolToDisplay}" role="status" aria-expanded="{Binding showMessagePanel}" data-tag="messagePanel">            <div class="reminderMessage" data-tag="reminderMessage">                <TextBlock Text="{Binding reminderMessage}" />            <\/div>        <\/div>    <\/div><\/div>',ve='<div class="taskBar" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">    <ul>        <li class="sbElement">            <a href="/" class="logo" data-tag="TaskBar.Logo"><\/a>        <\/li>        <li class="inputbox">            <div id="maps_sb_container" data-tag="maps_sb_container">                <div class="searchbox">                    <input id="maps_sb" type="search" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" data-tag="TaskBar.SearchBox"><\/input>                    <a href="#" class="clrSb" title="{Binding resources.L_TaskBar_Label_Clear}" role="button" data-tag="TaskBar.SearchBoxCancel"><\/a>                <\/div>            <\/div>            <div class="searchButton">                <a href="#" class="searchIcon" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />            <\/div>        <\/li>    <\/ul>    <ItemsControl ItemsSource="{Binding taskBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="actions"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                    <a href="#" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" title="{Binding name}" role="button" data-tag="{Binding dataTag}">                        <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                            <TextBlock Text="{Binding name}" />                        <\/span>                    <\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>        <div class="clear"><\/div><\/div>',ye='<div class="printDialog" data-tag="printDialog" role="dialog">    <p class="printDlgHdr">        <div class="printPreviewTitle">            <TextBlock Text="{TemplateBinding resources.L_PrintPreview}" />        <\/div>        <div class="mapAndTextPrint">            <ul>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintMapAndText}" class="printMapAndText mapTextOptions selected" data-tag="printMapAndText" event:click="onMapTextClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapAndText}" />                    <\/a>                <\/li>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintMapOnly}" class="printMapOnly mapTextOptions" data-tag="printMapOnly" event:click="onMapOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintMapOnly}" />                    <\/a>                <\/li>                <li>                    <a href="#" role="button" aria-label="{TemplateBinding resources.L_PrintTextOnly}" class="printTextOnly mapTextOptions" data-tag="printTextOnly" event:click="onTextOnlyClick">                        <TextBlock Text="{TemplateBinding resources.L_PrintTextOnly}" />                    <\/a>                <\/li>            <\/ul>        <\/div>    <\/p>    <div>        <div class="printContent" data-tag="printContent" event:mousewheel="onMouseWheel">            <div class="printHeader" style:display="block">                <img class="bingMapsLogo" alt="{TemplateBinding resources.BingMapsLogo}" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAAATCAMAAADS32EkAAAAP1BMVEX///9RUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFBRUFAbX/lHAAAAFHRSTlMAECAwQFBgcHSAkKCwuMDQ4Obw8rSbhEIAAAGTSURBVHhe1ZLdjtwwCEY/DHbqn2KX8v7P2mGSrLKNVrPSqBc9F8jGcGQh4KMk/AP8gfznXi8IkIa85+WEK14RgH17z1t8bnz3vj+H5e6ryYc31QKAhMD8OFNkuVZhRiCQeOd9lVKORmKkshtypsO7+ROrCHzGeYO4QJc9yEB9FuhRsJrxXOoSD9oXQbTbsElINoYfXrJdfLR5JZ6enl6vRDbBrkL1LOhAsQ7UAcSnW4H4IJB21HrZB6rr4l0Aim9PrwHojuoJwDq8DKQIst+ROyTuKIbaL17kq7ch+urTG6nqGB4CPbxnIAW4T58KmYiEI+mU0yv6aQ59X7Krt33670dQJN8SysULbFbDW06rr4zADUBzvnqLF4D97o0RY+g5hyhAcrj/6H5Q6dy91ZYPXL00fXS/eyGLUCy8mlAsIxNo4fdP34n0gW7DrRFYGa0dv+BuVvXuRbc1s0K0u3kFmunM+HUZwWvWwB1KEUWRhBBwJPs5ghdkjtqCrxD9u8FiBC/xoOP7XqSM7yDbxvgabrjwB0awHHyuA7RgAAAAAElFTkSuQmCC" />            <\/div>            <div class="baseMapPrint" data-tag="baseMapPrint">                <div>                        <ul>                            <li data-tag="baseMapNotes" class="baseMapNotes">                                <div id="printNotesLabel">                                    <TextBlock Text="{TemplateBinding resources.L_PrintNotes}" />                                <\/div>                                <div class="baseMapTextArea screenNotes">                                    <textarea rows="9" cols="45" id="baseMapNotes" role="textbox" aria-label="{TemplateBinding resources.L_PrintNotesWatermark}" class="baseMapNotes" placeholder="{TemplateBinding resources.L_PrintNotesWatermark}" maxlength="{TemplateBinding notesMaxCharSize}"> <\/textarea>                                <\/div>                                <div class="printedNotes">                                <\/div>                            <\/li>                            <li data-tag="baseMapMiniMap" class="baseMapOverviewMap">                                <img src="{TemplateBinding overviewContextMap}" alt="{TemplateBinding resources.PrintMiniMapAltText}"/>                            <\/li>                        <\/ul>                        <div>                                <div class="printArea" data-tag="printArea">                                    <div class="printMap" data-tag="printMap">                                    <\/div>                                <\/div>                        <\/div>                <\/div>            <\/div>            <div class="taskPrintContent" data-tag="taskPrintContent">            <\/div>        <\/div>            <div class="printFooter" style:display="block">            <p class="printDlgFoot printButton">                <a class="textButton" aria-label="{TemplateBinding resources.L_Print_Submit}" event:click="onPrintClick" href="#" role="button" data-tag="printButton">                    <TextBlock Text="{TemplateBinding resources.L_Print_Submit}" />                <\/a>            <\/p>        <\/div>    <\/div><\/div>',pe='<div class="bm_sharePanel" data-tag="Share.SharePanel">    <div class="shareHeader" data-tag="Share.Header">        <h2 class="shareTextTitle">            <TextBlock text="{Binding titleText}" />        <\/h2>        <a href="#" class="panelClose" title="{StaticBinding resources.ShareClose}" role="button" data-tag="Share.CloseButton" data-share=\'{ "action": "closeShare" }\'><div class="icon svg"><\/div><\/a>    <\/div>    <div class="content">        <div class="body">            <div class="textAndEmbed" style:display="{Binding hasAtLeastOneSharableStack Converter=boolToDisplay}">                <div class="text">                    <TextBlock text="{StaticBinding resources.L_PermalinkPrompt_Text}" />                <\/div>            <\/div>            <div class="taskList" style:display="{Binding hasAtLeastOneSharableStack Converter=boolToDisplay}">                <ul class="taskListContainer" role="list">                <\/ul>            <\/div>            <div class="actions">                <div class="actionTitle">                    <h2>                        <TextBlock text="{StaticBinding resources.ShareActionsTitle}" />                    <\/h2>                <\/div>                <div class="actionsContainer">                    <div class="actionContainer" style:display="{Binding enableSocialSharing Converter=boolToDisplay}">                        <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="facebookIcon" data-tag="Share.Facebook" event:click="openFacebook" role="button" title="{StaticBinding resources.ShareFBToolTip}">                            <div class="actionText">                                <TextBlock text="{StaticBinding resources.L_PermalinkFacebook_Text}" />                            <\/div>                        <\/a>                    <\/div>                    <div class="actionContainer" style:display="{Binding enableSocialSharing Converter=boolToDisplay}">                        <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="twitterIcon" data-tag="Share.Twitter" event:click="openTwitter" role="button" title="{StaticBinding resources.ShareTwitterToolTip}">                            <div class="actionText">                                <TextBlock text="{StaticBinding resources.L_PermalinkTwitter_Text}" />                            <\/div>                        <\/a>                    <\/div>                    <div class="actionContainer">                        <a href="#" class="{Binding sharingLinkAvailable Converter=availableToShareButtonClass}" id="emailIcon" data-tag="Share.Email" event:click="openEmail" role="button" title="{StaticBinding resources.ShareEmailToolTip}">                            <div class="actionText">                                <TextBlock text="{StaticBinding resources.L_Permalink_Email_Button_Text}" />                            <\/div>                        <\/a>                    <\/div>                <\/div>            <\/div>            <div class="orSeparator">                <hr class="separator" />                <div class="orText">                    <TextBlock text="{StaticBinding resources.OrSeparatorText}" />                <\/div>                <hr class="separator" />            <\/div>            <div class="copyAndLinkText">                <div class="inputContainer">                    <input class="text urlBox" data-tag="Share.UrlBox" type="text" role="textbox" readonly="readonly" aria-readonly="true" value="{Binding permalinkString}" event:click="urlBoxClick" aria-label="{StaticBinding resources.ShareUrlLabel}" />                    <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" role="button" id="copyButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" data-tag="Share.Copy" event:click="copyToClipboard" >                        <TextBlock text="{StaticBinding resources.L_PermalinkCopy_Text}" />                    <\/a>                <\/div>            <\/div>            <div class="linkBox">                <a href="#" class="{Binding sharingLinkAvailable Converter=availableToLinkClass}" id="linkStyleButton" style:display="{Binding errorMessage Converter=errorMessageToNotDisplay}" style:visibility="{Binding enableSharingVisibility}" data-tag="Share.ToggleLinkLength" event:click="toggleLinkLength" role="button">                    <TextBlock text="{Binding isShortPermalinkDisplayed Converter=displayStateToLinkText}" />                <\/a>            <\/div>            <div class="errorMessage" data-tag="Share.ErrorMessage" style:visibility="{Binding errorMessage Converter=errorMessageToVisibility}">                <TextBlock text="{Binding errorMessage}" />            <\/div>        <\/div>    <\/div><\/div>',we='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">    <div id="as_screenreader" aria-live="assertive"><\/div>    <ul>        <li class="sbElement">            <a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">                <h1 class="b_logo b_taskLogo"><\/h1>            <\/a>        <\/li>        <li class="inputbox">            <div id="maps_sb_container" data-tag="maps_sb_container">                <div class="searchbox">                    <a class="bm_overflowCountContainer" href="#" style:display="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToDisplay}" role="button" event:click="overflowClick" event:mouseover="overflowMouseOver" event:mouseout="overflowMouseOut" event:touchend="overflowClick" event:keydown="overflowKeyDown" data-tag="TaskBar.overflowContainer" aria-label="{StaticBinding resources.ViewAllSearches}" aria-expanded="{Binding overflowExpanded}">                        <div class="bm_overflowCounter">                            <div class="bm_overflowBox">                                <div class="bm_overflowLink" aria-label="{StaticBinding resources.ViewAllSearches}" data-tag="TaskBar.overflowButton">                                    <TextBlock Text="{Binding OverflowCapsuleListCount Converter=overflowCapsuleListToCount}" />                                    <div class="bm_overflowDropDown">                                    <\/div>                                <\/div>                            <\/div>                        <\/div>                    <\/a>                    <input id="maps_sb" type="search" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-autocomplete="both" aria-controls="sb_as_container" aria-owns="sb_as_container" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox" placeholder="{Binding searchboxPlaceHolderText}"><\/input>                    <div class="inPrivateIcon" style:display="{Binding displayInPrivate}"><\/div>                    <div class="searchButton">                        <a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.SearchGhostText}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />                    <\/div>                <\/div>                <div class="bm_outsideBeak"><\/div>                <div class="bm_overflowPopout" style="display: none;" event:mouseover="popoutMouseoverHandler" event:mouseout="popoutMouseoutHandler" data-tag="TaskBar.overflowPopout">                    <div class="bm_popoutTop1">                        <div class="bm_clearallSection">                            <span class="bm_selectToActivateSection">                                <TextBlock Text="{Binding resources.OverflowActivateSearchText}" />                            <\/span>                            <a class="bm_clearAllLink" role="button" href="#" event:click="clearAllClickHandler" event:touchend="clearAllClickHandler" event:keydown="clearAllKeyDownHandler">                                <TextBlock Text="{Binding resources.OverflowClearAllText}" />                            <\/a>                        <\/div>                        <div class="bm_popOutInner1">                            <ItemsControl ItemsSource="{Binding OverflowCapsuleList}">                                <ItemsControl.ItemTemplate>                                    <DataTemplate>                                        <div class="bm_overflowItem" id="{Binding id}">                                            <a class="bm_overflowCardText" role="button" href="#" event:mouseover="overflowTitleMouseoverHandler" event:mouseout="overflowTitleMouseoutHandler" event:click="overflowTitleClickHandler" event:touchend="overflowTitleTouchHandler" event:keydown="overflowTitleKeyDownHandler" aria-label="{Binding title}" data-tag="TaskBar.overflowPopLink">                                                <div class="{Binding imageClass}" style:background-color="{Binding backgroundColor}" />                                                <span id="bm_overflowText">                                                    <TextBlock Text="{Binding title}" />                                                <\/span>                                            <\/a>                                            <a class="bm_overflowCardClose" role="button" href="#" event:click="cardCloseHandler" event:touchend="cardCloseHandler" event:keydown="cardCloseKeyDownHandler" title="{Binding closeTitle}" />                                        <\/div>                                    <\/DataTemplate>                                <\/ItemsControl.ItemTemplate>                            <\/ItemsControl>                        <\/div>                    <\/div>                <\/div>                <div class="sb_as_container" id="sb_as_container" aria-expanded="{Binding showSuggestionPanel}" role="combobox" aria-hidden="{Binding asExpanded Converter=invertBoolean}" style:display="{Binding asExpanded Converter=boolToDisplay}">                    <div class="as_container" id="as_containerSearch_maps_sb" style:visibility="hidden" data-tag="as_container">                    <\/div>                <\/div>            <\/div>        <\/li>    <\/ul>    <div id="PreviousSearchTip">        <TextBlock Text="{Binding resources.ViewAllSearches}" />    <\/div>    <ItemsControl ItemsSource="{Binding taskBarItems}">        <ItemsControl.Template>            <DataTemplate>                <ul class="actions"><ItemsPresenter /><\/ul>            <\/DataTemplate>        <\/ItemsControl.Template>        <ItemsControl.ItemTemplate>            <DataTemplate>                <li style:display="{Binding isActive Converter=boolToDisplay}" class="action">                    <a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding altName}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}" aria-haspopup="{Binding ariaHasPopout}" aria-controls="{Binding ariaControls}">                        <span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">                            <TextBlock Text="{Binding name}" />                        <\/span>                        <span style:display="{Binding isNew Converter=boolToDisplay}" class="bm_newBanner">                            <TextBlock Text="{Binding banner}" />                        <\/span>                    <\/a>                <\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="clear"><\/div>    <!-- The following is the close button for local overlay on serp -->    <div class="overlayCloseBtn">        <a role="button" class="overlayCloseLink" href="#" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked" event:keydown="onOverlayCloseKeydown">            <div class="icon svg"><\/div>        <\/a>    <\/div>    <div id="rewardsFlyout" class="rewardsFlyout" event:click="onCommuteRewardsEarnClick" style:visibility="{Binding showCommuteFlyout Converter=boolToVisibility}">        <div class="{Binding upsellImageClass}">            <div class="pointValue">                <TextBlock Text="{StaticBinding commutePointValue}" />            <\/div>        <\/div>        <div class="text">            <h6 class="title">                <FormattedTextBlock Formattedtext="{Binding commuteRewardsFlyoutTitle}" />            <\/h6>            <p class="description">                <TextBlock Text="{StaticBinding resources.CommuteRewards_FlyoutDescription}" />            <\/p>        <\/div>        <div class="flyoutActions">            <button class="earn" event:click="onCommuteRewardsEarnClick" aria-label="{StaticBinding resources.CommuteRewards_EarnButton}" title="{StaticBinding resources.CommuteRewards_EarnButton}" data-action="earn">                <TextBlock Text="{StaticBinding resources.CommuteRewards_EarnButton}" />            <\/button>            <button class="dismiss" event:click="onCommuteRewardsDismissClick" aria-label="{StaticBinding resources.CommuteRewards_DismissButton}" title="{StaticBinding resources.CommuteRewards_DismissButton}">                <TextBlock Text="{StaticBinding resources.CommuteRewards_DismissButton}" />            <\/button>        <\/div>    <\/div><\/div>',ve='<div class="{Binding className}" role="search" aria-label="{Binding resources.L_Landmark_TaskBar_Aria_Label}" data-tag="TaskBar">\t<ul>\t\t<li class="sbElement">\t\t\t<a href="/" class="b_logoArea" alt="{Binding resources.TaskBarLogoTitle}" title="{Binding resources.TaskBarLogoTitle}">\t\t\t\t<h1 class="b_logo b_taskLogo"><\/h1>\t\t\t<\/a>\t\t<\/li>\t\t<li class="inputbox">\t\t\t<div id="maps_sb_container" data-tag="maps_sb_container">\t\t\t\t<div class="searchbox">\t\t\t\t\t <input id="maps_sb" type="search" role="combobox" title="{Binding resources.L_TaskBar_Label_SearchBox}" length="20" maxlength="1000" value="{Binding searchTerm Mode=TwoWay}" autocomplete="off" aria-haspopup="true" aria-expanded="{Binding asExpanded}" aria-controls="as_containerSearch" aria-autocomplete="both" aria-activedescendant="{Binding selectedSuggestionId}" data-tag="TaskBar.SearchBox"><\/input>\t\t\t\t\t<div class="inPrivateIcon" style:display="{Binding displayInPrivate}"><\/div>\t\t\t\t\t<div class="searchButton">\t\t\t\t\t\t<a href="#" class="searchIcon" tabindex="-1" data-instrumentation="{Binding searchInstData}" title="{Binding resources.L_TaskBar_Label_Search}" role="button" event:click="invokeLocalSearchHandler" data-tag="TaskBar.SearchButton" />\t\t\t\t\t<\/div>\t\t\t\t<\/div>\t\t\t\t<div class="as_container" id="as_containerSearch" aria-owns="maps_sb" style:visibility="hidden"><\/div>\t\t\t<\/div>\t\t<\/li>\t<\/ul>\t<ItemsControl ItemsSource="{Binding taskBarItems}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<ul class="actions"><ItemsPresenter /><\/ul>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<li style:display="{Binding isActive Converter=boolToDisplay}" class="action">\t\t\t\t\t<a href="{Binding url}" class="{Binding cssClass}" data-task="{Binding taskOption Converter=stringify}" data-instrumentation="{Binding instrumentationData}" event:click="clickHandler" event:touchend="clickHandler" event:mouseover="mouseoverHandler" event:mouseout="mouseoutHandler" event:keydown="keydownHandler" title="{Binding altName}" role="button" data-tag="{Binding dataTag}" aria-expanded="{Binding ariaExpanded}" aria-haspopup="{Binding ariaHasPopout}" aria-controls="{Binding ariaControls}">\t\t\t\t\t\t<span style:display="{Binding showLabel Converter=boolToDisplay}" class="actionLabel">\t\t\t\t\t\t\t<TextBlock Text="{Binding name}" />\t\t\t\t\t\t<\/span>\t\t\t\t\t<\/a>\t\t\t\t<\/li>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>\t<div class="clear"><\/div>\t<!-- The following is the close button for local overlay on serp -->\t<div class="overlayCloseBtn">\t\t<a role="button" class="overlayCloseLink" href="#" title="{StaticBinding resources.L_CloseTask_Text}" event:click="onOverlayCloseButtonClicked">\t\t\t<div class="icon svg"><\/div>\t\t<\/a>\t<\/div><\/div>',be='<div class="bm_tooltips saveOnSerpConfirmation" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <div class="tooltipsText">        <div class="toolTipTitle">            <div class="tooltipsIcon">            <\/div>            <div class="tooltipsIconText">                <TextBlock Text="{TemplateBinding IconText}" />            <\/div>        <\/div>        <div class="tooltipsLinkMessage" style:display="{TemplateBinding Link Converter=nullToDisplayNone}">            <TextBlock Text="{TemplateBinding PreLink}" />            <a href="#" event:click="onLinkClicked" class="tooltipsLink">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <TextBlock Text="{TemplateBinding PostLink}" />        <\/div>    <\/div><\/div>',ke='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <div class="tooltipsText">        <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">        <\/a>        <div class="tooltipsMessage">            <TextBlock Text="{TemplateBinding resources.L_Tooltip_Itinerary_Saved_Text}" />        <\/div>        <div class="tooltipsMessage secondLine" style:display="{TemplateBinding showEditName Converter=boolToNotDisplay}">            <TextBlock Text="{TemplateBinding Name}" />            <TextBlock Text="{TemplateBinding separator}" />            <a class="bm_renameLink" href="#" event:click="renameClicked"><TextBlock Text="{TemplateBinding resources.L_Tooltip_Rename_Button}" /><\/a>        <\/div>        <div class="nameInputContainer" style:display="{TemplateBinding showEditName Converter=boolToDisplay}">            <input type="text" class="nameEditBox" maxlength="100" value="{StaticBinding Name Mode=TwoWay}" event:keydown="onKeyPressed" />            <a href="#" class="bm_tooltipSaveButton" event:click="onSaveLinkClick" event:touchend="onSaveLinkClick">                <TextBlock Text="{TemplateBinding resources.L_Tooltip_Update_Button}" />            <\/a>        <\/div>    <\/div><\/div>',de='<div class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipBeak" style:display="{TemplateBinding ShowBeak Converter=boolToDisplay}"><\/div>    <a class="tooltipsClose" href="#" title="{TemplateBinding resources.L_Tooltip_Close_Text}" event:click="closeClicked" style:display="{TemplateBinding ShowClose Converter=boolToDisplay}">    <\/a>    <div class="tooltipsText">        <div class="tooltipsHeader" style:display="{TemplateBinding Title Converter=nullToDisplayNone}">            <TextBlock Text="{TemplateBinding Title}" />        <\/div>        <ItemsControl ItemsSource="{TemplateBinding MessageLines}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <div class="tooltipsMessage">                        <TextBlock Text="{Binding $self$}" />                    <\/div>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>        <div class="tooltipsLinkMessage" style:display="{TemplateBinding Link Converter=nullToDisplayNone}">            <span>                <TextBlock Text="{TemplateBinding PreLink}" />            <\/span>            <a href="{TemplateBinding linkUrl}" event:click="onLinkClicked" class="tooltipsLink" target="_blank">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <span>                <TextBlock Text="{TemplateBinding PostLink}" />            <\/span>        <\/div>        <div style:display="{TemplateBinding SignInTitle Converter=nullToDisplayNone}">            <SignInPopUpControl SignInMessage="{TemplateBinding SignInTitle}" event:signedIn="onSignedIn" />        <\/div>    <\/div><\/div>';"use strict";var bi=function(){function n(){}return n.logEvent=function(t,i,f){f.SC=t;var e={logData:{feature:n.featureName,action:i,data:f},impressionGuid:u.dynamicProperties.mapsIG};r.invokeHandler("data-instrumentation",e)},n.featureName="ADS",n}(),pr=function(){function t(){}return t.isEnabled=function(){return!!(ni&&ni.isEnabled)},t.setShownAds=function(i,r,u,f){var v=0,o,c,e,y,s,p,k,l,w,h,b,a;if(r){for(c=r.length-1;c>=0;c--){if(e=n(r[c]).select(".mta_ad"),e&&e.length)for(y=e.length,v+=y,s=0;s<y;s++){for(p=e[s].getElementsByTagName("A"),k=function(n){var r=p[n];r&&t.updateAdLink(r,u,function(){return t.logAdClick(r,i,!1,f)})},l=0;l<p.length;l++)k(l);e[s].addEventListener("click",function(n){return t.listItemClickHandler(n,i,u,f)});ni&&ni.extraLogging&&(w=n(e[s]),h=w.select(".ad_dse"),h&&h.length&&(o=(o||"")+"M"),h=w.select(".imgExt"),h&&h.length&&(o=(o||"")+"I"))}t.bindWhyThisAdHandler(n(r[c]))}ni&&ni.truncateAdsExtension&&(b=r.select(".mapsTextAds .b_secondaryText"),b.length>0&&b.for_each(function(n){n&&!n.classList.contains("b_ads1line")&&n.classList.add("b_ads1line")}))}v>0&&(a={C:v},o&&(a.D=o,f&&(a.Q=f)),bi.logEvent(i,"R",a))},t.bindWhyThisAdHandler=function(n){if(ni&&ni.enableWhyThisAd){var t=n.select("a[ce]");t.length>0&&t.for_each(function(n){if(n){var t=n.getAttribute("ce");t==="adcc"&&(n.setAttribute("ce",""),n.setAttribute("href","#"),n.addEventListener("click",function(t){var i,r,u;t&&(r=n.firstElementChild,u=r&&r.getAttribute("data-id"),(u||((i=t.target)===null||i===void 0?void 0:i.tagName)!=="A")&&t.preventDefault(),t.stopPropagation());typeof ads_choice!="undefined"&&ads_choice(n)}))}})}},t.updateAdLink=function(n,i,r){if(n){var u=n.getAttribute("h")||n.getAttribute("data-h");u&&(n.removeAttribute("h"),n.removeAttribute("data-h"),n.setAttribute("h1",u),n.addEventListener("click",function(){t.callGLink(n,i);r&&r()}));n.target||(n.target="_blank")}},t.callGLink=function(n,t){var r=n.getAttribute("h1"),u,i;if(r){u=_G.IG;try{_G.IG=t;i="&"+r+"&url="+encodeURIComponent(n.href);_w.si_sbwu&&_w.si_sbwu(i)||_w.si_T&&_w.si_T(i)}finally{_G.IG=u}}},t.logAdClick=function(n,t,i,r){var u=n.getAttribute("data-log"),f;u&&(i&&(u=u.replace("T","S")),f={L:u},r&&(f.D=r),bi.logEvent(t,"C",f))},t.listItemClickHandler=function(n,i,r,u){function e(n){var e=n.getElementsByTagName("a"),f;e&&e.length>0&&(f=e[0],t.logAdClick(f,i,!0,u),t.callGLink(f,r),_w.open(f.href,"_blank"))}for(var f=n.target;f;){if(f.tagName==="A")return!0;if(f.className.indexOf("ad_sc")!==-1)break;if(f.getAttribute("role")==="button"||f.className.indexOf("infobubble_item")!==-1||f.className.indexOf("qv_noclick")!==-1)return!1;f=f.parentNode}return f?(e(f),n.stopPropagation(),!1):!1},t.logQueryEvent=function(n){bi.logEvent("WF","Q",{D:n})},t.logAdsShown=function(n){bi.logEvent("WF","V",{D:n})},t.logError=function(n,t){var i=typeof n=="string"?n:n&&n.message;bi.logEvent(t||"","E",{EX:i||""})},t}(),ge=function(){function n(){}return n.setShownAds=function(t,i,r,u,f){var e,s,o;if(r&&r.length){if(e=r.select(i),e&&e.length)for(n.logEvent(t,u,"CI.TnAAdsShown",f),s=function(i){var o=e[i].getElementsByTagName("A"),r=o&&o[0];r&&pr.updateAdLink(r,u,function(){return n.logEvent(t,u,"CI.TnAAdsClick",f,r.href)})},o=0;o<e.length;o++)s(o);pr.bindWhyThisAdHandler(r)}},n.logEvent=function(t,i,u,f,e){var o={SC:t},s;e&&(o.adsUrl=e);f&&(o.CAT=f);s={logData:{feature:n.featureName,action:u,data:o},impressionGuid:i};r.invokeHandler("data-instrumentation",s)},n.featureName="TnAAds",n}(),hu=function(t){function i(n,i,r,u,e,o,s,h,c,l,a,v){var y,k,p,w,b;return l===void 0&&(l=!1),a===void 0&&(a=!1),y=t.call(this)||this,y._map=i,y._container=r,y._label=u,y._message=e,y._calendarSync=n,y.resources=f,k=i.getContainer(),y.updatingStartTime=!1,y.updatingEndTime=!1,y._endCalendar=null,y._allowPastTimes=l,y._userUtcOffset=-(new Date).getTimezoneOffset(),h&&(y._utcOffset=h,y._userUtcOffset===y._utcOffset||c||(y._displayLocalTime=!0,o&&!isNaN(o)&&(o+=(y._utcOffset-y._userUtcOffset)*6e4),s&&!isNaN(s)&&(s+=(y._utcOffset-y._userUtcOffset)*6e4))),p=y._privates,p.defineProperty("hasPresetStartEndTime"),p.defineProperty("startDate",y._onStartDateTimeChanged),p.defineProperty("startTime",y._onStartDateTimeChanged),p.defineProperty("endDate",y._onEndDateTimeChanged),p.defineProperty("endTime",y._onEndDateTimeChanged),p.defineProperty("calendarType",y._onCalendarTypeChanged),p.defineProperty("isAllDayEvent",y._onIsAllDayEventChanged),p.defineProperty("startEditingTime"),p.defineProperty("endEditingTime"),p.defineProperty("showStartCalendarSelector"),p.defineProperty("showEndCalendarSelector"),p.defineProperty("showEndCalendar"),p.defineProperty("showEndTimeLink"),p.defineProperty("timeControlDisabled"),p.defineProperty("showTimeZoneDisclaimer"),p.defineProperty("showStartEndTimeLinks"),p.defineProperty("startTaskId"),p.defineProperty("endTaskId"),y._prePopulateCalendarTypeDropdowns(),y.startDateTime=y.endDateTime=f.L_CalendarSync_SelectDateTime,y.setShowStartCalendarSelector(!1),y.setShowEndCalendarSelector(!1),y.setHasPresetStartEndTime(a),y.setShowStartEndTimeLinks(!a),y.setShowEndCalendar(!!(s&&!isNaN(s))),y.setShowEndTimeLink(!1),y.setTimeControlDisabled(!1),y.setIsAllDayEvent(!1),y.setShowTimeZoneDisclaimer(y._displayLocalTime),v&&(y.setStartTaskId(v+"Start"),y.setEndTaskId(v+"End")),c&&o&&!isNaN(o)&&(y.setIsAllDayEvent(!0),y.setTimeControlDisabled(!0),o=Math.floor(o/864e5)*864e5,o-=y._userUtcOffset*6e4,s&&!isNaN(s)?(s=Math.floor(s/864e5)*864e5,s-=y._userUtcOffset*6e4,s===o&&(s=s+861e5)):s=o+861e5),w=new Date,o&&!isNaN(o)?(w=new Date(o),y._setDateAndTime(o,!1,!1)):y._setDateAndTime(w.getTime(),!1,!0),s&&!isNaN(s)?y._setDateAndTime(s,!0,!1):(b=!(o&&!isNaN(o)),w.setHours(w.getHours()+1),y._setDateAndTime(w.getTime(),!0,b)),y._initialStartDateTime=o,y._calendarControlAdded=!1,u.add_event("click",function(n){y._onLabelClick(n)}),y._showHideCalendarSyncControl(y.getHasPresetStartEndTime()),y}return v(i,t),i.prototype.addPrefixSpace=function(n){return n&&n.charAt(n.length-1)!==" "?n.concat(" "):n},i.prototype.adjustEndTime=function(){function t(n){return n.getHours()*3600+n.getMinutes()*60+n.getSeconds()}if(!this.updatingEndTime){this.updatingEndTime=!0;var n=new Date(this.getStartDate()+this.getStartTime()*1e3);n.setTime(n.getTime()+36e5);this.setEndTime(t(n));n.setHours(0,0,0,0);this.setEndDate(n.getTime());this.endDateTime=i.formatDateTimeString(this.getEndDate(),this.getEndTime(),this.getIsAllDayEvent());this._endCalendar&&this._endCalendar.SetDate(this.getEndDate());this.updatingEndTime=!1}},i.prototype._onStartDateTimeChanged=function(){var n,t,r;this.updatingStartTime||(this.updatingStartTime=!0,n=new Date(Date.now()),t=i.getDate(this.getStartDate(),this.getStartTime()),!this._allowPastTimes&&t<n&&(this.setStartTime(n.getHours()*36e5),this.setStartDate(n.getTime())),this.startDateTime=i.formatDateTimeString(this.getStartDate(),this.getStartTime(),this.getIsAllDayEvent()),this.updatingStartTime=!1,r=i.getDate(this.getEndDate(),this.getEndTime()),(r<t||!this.getShowEndCalendar())&&this.adjustEndTime(),this._showHideMessage(!1))},i.prototype._onEndDateTimeChanged=function(){if(!this.updatingEndTime){var n=i.getDate(this.getStartDate(),this.getStartTime()),t=i.getDate(this.getEndDate(),this.getEndTime());t<n&&this.adjustEndTime();this.endDateTime=i.formatDateTimeString(this.getEndDate(),this.getEndTime(),this.getIsAllDayEvent());this._showHideMessage(!1)}},i.prototype._onCalendarTypeChanged=function(){this._message.set_style({display:"none"})},i.prototype._onIsAllDayEventChanged=function(){this.setTimeControlDisabled(this.getIsAllDayEvent());this.startDateTime=i.formatDateTimeString(this.getStartDate(),this.getStartTime(),this.getIsAllDayEvent());this.endDateTime=i.formatDateTimeString(this.getEndDate(),this.getEndTime(),this.getIsAllDayEvent())},i.prototype._addCalendar=function(t,i){var r=this,u=this._map.getContainer(),e=t.select(".calendarSyncStartDate"),o,f,s;e&&u&&u.instanceAsync("SingleCalendar",function(n){n.init(e,i);n.onDateChangeEvent.add(function(n){n.setHours(0,0,0,0);r.setStartDate(n.getTime())})});o=i;f=t.select(".calendarSyncEndDate");f&&u&&u.instanceAsync("SingleCalendar",function(n){r._endCalendar=n;n.init(f,o);n.onDateChangeEvent.add(function(n){n.setHours(0,0,0,0);r.setEndDate(n.getTime())})});this.getHasPresetStartEndTime()&&(s=this._container.select(".bm_dropdownEntry"),s.for_each(function(t){var i=n(t);i.add_event("click",function(n){var t=parseInt(n.target.attributes.getNamedItem("data-dropdown").nodeValue);r.setCalendarType(r.calendarTypes[t]);r.onExportClick(n)})}))},i.prototype.onStartTimeClick=function(n){n.preventDefault();n.stopPropagation();this.setShowStartCalendarSelector(!this.getShowStartCalendarSelector());this.getShowStartCalendarSelector()&&(this.getShowEndCalendar()||this.setShowEndTimeLink(!0),this.setShowEndCalendarSelector(!1),this._calendarSync.log("C","STC"))},i.prototype.onEndTimeClick=function(n){n.preventDefault();n.stopPropagation();this.setShowEndCalendarSelector(!this.getShowEndCalendarSelector());this.getShowEndCalendarSelector()&&(this.setShowStartCalendarSelector(!1),this.setShowEndTimeLink(!1),this._calendarSync.log("C","ETDD"))},i.prototype.onEndTimeLinkClick=function(n){n.preventDefault();n.stopPropagation();this.getShowEndTimeLink()&&(this.setShowStartCalendarSelector(!1),this.setShowEndTimeLink(!1),this.setShowEndCalendar(!0),this.setShowEndCalendarSelector(!0),this._calendarSync.log("C","ETL"))},i.prototype.onExportClick=function(n){var t=this,i,r,u;n.preventDefault();n.stopPropagation();this.setStartEditingTime(!1);this.setEndEditingTime(!1);this.setShowEndCalendarSelector(!1);this.setShowStartCalendarSelector(!1);this.setShowEndCalendar(!0);this.setShowEndTimeLink(!1);i=this.getCalendarType().value;this._calendarSync.log("S",i.toString(),this._calendarSync.getEntityInfoForLogging());r=function(){var i=t.getStartDate()+t.getStartTime()*1e3,n=t.getEndDate()+t.getEndTime()*1e3,r,u,o,s;t._displayLocalTime&&(i-=(t._utcOffset-t._userUtcOffset)*6e4,n-=(t._utcOffset-t._userUtcOffset)*6e4);t.getIsAllDayEvent()&&(t._utcOffset?(i+=t._utcOffset*6e4,n+=t._utcOffset*6e4):t._userUtcOffset&&(i+=t._userUtcOffset*6e4,n+=t._userUtcOffset*6e4),n+=864e5);r=new Date(i);u=new Date(n);i>=n?(t._updateCalendarText(e._formatString(f.L_CalendarSync_StartEndDateError),!1),t._calendarSync.log("ERR",t.getCalendarType().value.toString(),"Start Date greater End Date Mismatch")):(o=function(){t.getCalendarType().value!==2?t._updateCalendarText(e._formatString(f.L_CalendarSync_Message,t.getCalendarType().text),!0):t._updateCalendarText(e._formatString(f.L_CalendarSync_ICS_Downloaded),!0)},s=function(){t._updateCalendarText(e._formatString(f.L_CalendarSync_APIErrorMessage),!1);t._calendarSync.log("ERR",t.getCalendarType().value.toString(),"Login Failed")},t._calendarSync.createEvent(r,u,t.getIsAllDayEvent(),t._calendarSync.entity,o,s))};u=function(){t._updateCalendarText(e._formatString(f.L_CalendarSync_LoginErrorMessage),!1)};this._calendarSync.logIn(i,r,u)},i.prototype._updateCalendarText=function(n,t){this._message.set_html(e._formatString(n));t?this._message.remove_class("failureMessage").add_class("successMessage"):this._message.remove_class("successMessage").add_class("failureMessage");this._showHideMessage(!0)},i.prototype._createCalendarDropdown=function(){var t=this,i=this._map.getContainer(),r={boolToDisplay:function(n){return t.boolToDisplay(n)},addPrefixSpace:function(n){return t.addPrefixSpace(n)}};this._container&&i&&i.instanceAsync("ControlTemplate",function(i){var r=i.applyDataTemplate(t);t._container.length>0&&(t._container[0].appendChild(r),t._addCalendar(n(r),t._initialStartDateTime),t._calendarControlAdded=!0,t._processOnLabelClick())},{templateText:kf,staticResources:r})},i.prototype._processOnLabelClick=function(){var i=this._container?this._container.get_style("display")==="none":!1,t;i&&this._calendarSync.getPermalink();this._container&&this._showHideCalendarSyncControl(i);t=n(".calendarSyncLabel");t&&t.length>0&&t[0].setAttribute("aria-expanded",i);this._showHideMessage(!1);this._calendarSync.preAuth();this._calendarSync.log("A")},i.prototype._onLabelClick=function(n){n.stopPropagation();n.preventDefault();this._calendarControlAdded?this._processOnLabelClick():this._createCalendarDropdown()},i.prototype._setDateAndTime=function(n,t,i){var r=new Date(n),u,f;i&&r.setHours(r.getHours()+1,0,0,0);u=r.getHours()*3600+r.getMinutes()*60+r.getSeconds()*60;t?this.setEndTime(u):this.setStartTime(u);r.setHours(0,0,0,0);f=r.getTime();t?this.setEndDate(f):this.setStartDate(f);t||!this._calendarSync.entity||this._calendarSync.entity.getDateTime&&this._calendarSync.entity.getDateTime()||this._calendarSync.entity.setDateTime(n)},i.prototype.getStartDateTime=function(){return this.getStartDate()+this.getStartTime()*1e3},i.prototype._prePopulateCalendarTypeDropdowns=function(){this.calendarTypes=[{text:f.L_CalendarSync_Outlook,value:0},{text:f.L_CalendarSync_Google,value:1},{text:f.L_CalendarSync_OutlookDesktop,value:2}];this.setCalendarType({text:f.L_CalendarSync_Outlook,value:0})},i.prototype._showHideCalendarSyncControl=function(n){this._container&&this._container.set_style({display:n?"block":"none"});var t="expandArrow",i="collapseArrow";n?(this._label.add_class(i),this._label.remove_class(t)):(this._label.add_class(t),this._label.remove_class(i))},i.prototype._showHideMessage=function(n){this._message.set_style({display:n?"inline":"none"})},i.getDate=function(n,t){var i=n+t*1e3;return new Date(i)},i.formatDateTimeString=function(n,t,i){return i?e._formatLongDateString(new Date(n)):e._formatLongDateString(new Date(n))+" "+e._formatUTCTimeString(new Date(t*1e3))},i}(ri),no=function(){function n(n){this._clientId=ht.gCalClientId;this._scopes=ht.gCalScopes;this.loggedIn=!1;this._calendarSync=n;this._addRemoteAPIScript()}return n.getInstance=function(t){return n._instance||(n._instance=new n(t)),n._instance},n.prototype.logOut=function(){gapi.auth.signOut();this.loggedIn=!1},n.prototype.logIn=function(n,t){var i=this;gapi.auth.authorize({client_id:this._clientId,scope:this._scopes,immediate:!1},function(r){return i._handleAuthenticationResult(r,n,t)})},n.prototype.preAuth=function(n){n&&n()},n.prototype._addRemoteAPIScript=function(){window.AM&&window.AM.push("google.com");var t=document.head,n=document.createElement("script");n.type="text/javascript";n.src=ht.gCalApiSource;t.appendChild(n)},n.prototype._handleAuthenticationResult=function(n,t,i){n&&!n.error?(gapi.client.load("calendar",ht.gCalVersion,function(){t&&t()}),this.loggedIn=!0):i&&i()},n.prototype.createOrUpdateEvent=function(n,t,i){this.createNewEvent(n,t,i)},n.prototype.createNewEvent=function(n,t,i){var r=this,u=this._parseEvent(n);gapi.client.load("calendar",ht.gCalVersion,function(){var n=gapi.client.calendar.events.insert({calendarId:"primary",resource:u});n.execute(function(n){n.error?i&&i():(r._calendarSync.createdEventIdGoogle=n.id,t&&t())})})},n.prototype.updateEvent=function(n,t,i,r){var u=this,f=this._parseEvent(n);gapi.client.load("calendar",ht.gCalVersion,function(){var n=gapi.client.calendar.events.update({calendarId:"primary",eventId:t,resource:f});n.execute(function(n){n.error?r&&r():(u._calendarSync.createdEventIdGoogle=n.id,i&&i())})})},n.prototype._parseEvent=function(n){return n.isAllDayEvent?{summary:n.title,location:n.location,description:n.description,start:{date:n.eventStart},end:{date:n.eventEnd}}:{summary:n.title,location:n.location,description:n.description,start:{dateTime:n.eventStart},end:{dateTime:n.eventEnd}}},n.prototype.getEventsByDateRange=function(n,t,i,r){var u=gapi.client.calendar.events.list({calendarId:"primary",timeMin:n,timeMax:t,maxResults:20,singleEvents:!0,orderBy:"startTime"});u.execute(function(n){n.error?r&&r():i&&i()})},n}(),g=window.sessionStorage,to=function(n){function t(t){var i=n.call(this)||this;return i._config=ht,i._calendarSync=t,i._privates.defineProperty("isSignedIn",function(n,t){return i._onSignInStateChange(n,t)}),i._consumersPayloadTypeId="9188040d-6c67-4c5b-b112-36a304b66dad",i._silentAuthUrl="{authUrl}&prompt=none&domain_hint={userDomainType}&login_hint={userSigninName}",i._issuerTenantId="https://login.microsoftonline.com/{payloadTid}/v2.0",i.isUserSignedIn()||i.clearUserState(),i}return v(t,n),t.prototype.CreateMapsAuthCallback=function(){var n=this;return function(t){if(t.accessToken&&t.idToken){g.removeItem("accessToken");g.removeItem("idToken");var i=g.getItem("authState");if(t.state!==i){g.removeItem("authState");g.removeItem("authNonce");return}g.setItem("authState","");g.setItem("accessToken",t.accessToken);g.setItem("tokenExpires",t.expires);g.setItem("idToken",t.idToken);n.validateIdToken(function(t){var r,u,i;t?(n.setIsSignedIn(!0),sj_evt&&sj_evt.fire("wl:auth"),Identity&&Identity.wlProfile&&Identity.popupLoginUrls&&(r=Identity.popupLoginUrls,r&&(u=r.WindowsLiveId,u&&(i=document.createElement("iframe"),i.style.display="none",i.src=u+"&checkda=1",document.body.appendChild(i))))):n.clearUserState();n._authCallback&&n._authCallback(t)})}else n.clearUserState(),n.getCalendarSync().log("ERR",0..toString(),t.error)}},t.prototype.isAuthenticated=function(){if(!this.isUserSignedIn())return this.clearUserState(),!1;var n=g.getItem("accessToken");return n!==null&&n.length>0},t.prototype.getCalendarSync=function(){return this._calendarSync},t.prototype.retrieveEmailIfSignedIn=function(){this.isUserSignedIn()&&this.getSignedInUserEmail(function(n){n&&g.setItem("WindowsLiveEmail",n)})},t.prototype.isUserSignedIn=function(){return typeof Identity!="undefined"&&Identity.wlProfile&&Identity.wlProfile()!==null},t.prototype.dispose=function(){if(this._disposables){for(var n=0;n<this._disposables.length;n++)this._disposables[n].dispose();this._disposables=null}},t.prototype.sendInvite=function(n,t){var i=this;this.getUserEmailAddress(function(r,u){u?t&&t(!1):i.sendCalendarInvite(r,n,function(n,i){i||t&&t(!0)})})},t.prototype.addDays=function(n,t){var i=new Date(n.valueOf());return i.setDate(i.getDate()+t),i},t.prototype.addHours=function(n,t){var i=new Date(n.valueOf());return i.setTime(i.getTime()+t*36e5),i},t.prototype._onSignInStateChange=function(n,t){this.notifySignedIn&&this.notifySignedIn.invoke(t)},t.prototype.buildAuthUrl=function(){var u=this.guid(),f=this.guid(),n,t,i,r;g.setItem("authState",u);g.setItem("authNonce",f);n={};n.response_type="id_token token";n.client_id=this._config.appId;n.redirect_uri=this._config.authorizationRedirectUrl;n.scope=this._config.scopes.replace("+"," ");n.state=u;n.nonce=f;n.response_mode="fragment";t=this._config.authorizationEndpointBase+this._config.authorizationEndpoint;i=0;for(r in n)t+=r+"="+n[r]+"&",i++;return i>1&&(t=t.slice(0,-1)),t},t.prototype.popupAuthenticate=function(n,t){var i=this.buildAuthUrl(),f=g.getItem("WindowsLiveEmail"),u,r;this.isUserSignedIn()&&t?(u=g.getItem("userDomainType"),r=g.getItem("userSigninName"),r=r||f,u=u||"consumers",r&&(i=this._silentAuthUrl.replace("{authUrl}",i).replace("{userDomainType}",u).replace("{userSigninName}",r),this.openPopupAuthWindow(i,n))):t?n&&n(!1):(this.isUserSignedIn()&&f&&(i=i+"&login_hint="+f),this.openPopupAuthWindow(i,n))},t.prototype.openPopupAuthWindow=function(n,t){var i=window.open(n,"_blank","resizable,scrollbars,status");t&&(this._authCallback=t)},t.prototype.validateIdToken=function(n){var i=g.getItem("idToken"),r,t,u;if(null===i||i.length<=0){n(!1);return}if(r=i.split("."),r.length!==3){n(!1);return}if(t=JSON.parse(atob(r[1])),t.nonce!==g.getItem("authNonce")){g.setItem("authNonce","");n(!1);return}if(t.aud!==this._config.appId){n(!1);return}if(u=this._issuerTenantId.replace("{payloadTid}",t.tid),t.iss!==u){n(!1);return}var f=new Date,e=new Date((t.nbf-300)*1e3),o=new Date((t.exp+300)*1e3);if(f<e||f>o){n(!1);return}g.setItem("userDisplayName",t.name);g.setItem("userSigninName",t.preferred_username);g.setItem("userDomainType",t.tid===this._consumersPayloadTypeId?"consumers":"organizations");n(!0)},t.prototype.makeSilentTokenRequest=function(n){this.popupAuthenticate(function(t){t&&n&&n(g.getItem("accessToken"))},!0)},t.prototype.getAccessToken=function(n){var i=g.getItem("tokenExpires"),t=g.getItem("accessToken"),r=Date.now(),u=r>parseInt(i);t&&!u?n&&n(t):this.makeSilentTokenRequest(n)},t.prototype.makeApiCall=function(n,t){var i={Authorization:"Bearer "+n.token,"client-request-id":this.guid(),"return-client-request-id":"true"},r;n.email&&(i["X-AnchorMailbox"]=n.email);n.method==="POST"&&(i["Content-Type"]="application/json",i.Accept="application/json");r={url:n.url,dataType:"json",type:n.method,headers:i};n.query&&(r.data=n.query);this.makeRequest(r,t)},t.prototype.makeRequest=function(n,t){n.type==="POST"?(n.onSuccess=function(n){t(n)},n.onError=function(n,i,r){i>400||!n?t(null,r+","+n):r==="Created"?t(n):t(null,r+","+n)},wt.doPost(n.url,n.data,n)):wt.downloadJson(n.url,"tokens",function(n){t(n)},function(n,i,r){t(null,r)},n,!1,0,!0,n.headers)},t.prototype.getSignedInUserEmail=function(n){this.isUserSignedIn()?wt.downloadGeneric(this._config.emailEndpoint,"email",function(t){n&&n(t)},null,function(){n&&n(null)}):n&&n(null)},t.prototype.getUserEmailAddress=function(n){var t=this,i=g.getItem("userEmail");return i?i:(this.getAccessToken(function(i){var r,u;i?(r={url:t._config.apiEndpoint+"/Me",token:i,method:"GET"},t.makeApiCall(r,function(t,i){i||!t?n(null,i):n({email:t.EmailAddress,name:t.DisplayName})})):(u={responseText:"Could not retrieve access token"},n(null,u))}),undefined)},t.prototype.sendCalendarInvite=function(n,t,i){var r=this,u=n.email,e=n.name,f=t.isAllDayEvent?Intl.DateTimeFormat().resolvedOptions().timeZone:"UTC",o='{"Subject": "'+t.title+'","Location":{"DisplayName": "'+t.location+'"},"Body": {"ContentType": "HTML","Content": "'+t.description+'" },"Start": {"DateTime": "'+t.eventStart+(t.isAllDayEvent?"T00:00:00":"")+'", "TimeZone": "'+f+'"}, "End": { "DateTime": "'+t.eventEnd+(t.isAllDayEvent?"T00:00:00":"")+'", "TimeZone": "'+f+'"}, "IsAllDay": '+t.isAllDayEvent+', "Attendees": [{"EmailAddress": {"Address": "'+u+'", "Name": "'+e+'" }, "Type": "Required" } ]}';this.getAccessToken(function(n){var t,f;n?(t={url:r._config.apiEndpoint+"/Me/events",token:n,method:"POST",email:u,query:o},r.makeApiCall(t,function(n,t){t?i(null,t):i(n.value)})):(f={responseText:"Could not retrieve access token"},i(null,f))})},t.prototype.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)})},t.prototype.clearUserState=function(){g.clear();this.setIsSignedIn(!1)},t.prototype.formatDate=function(n){var t=new Date(n);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},t}(bt),io=function(){function n(n){this.loggedIn=!1;this._calendarSync=n;this._calendarHelper=new to(n);window.MapsAuthCallback=this._calendarHelper.CreateMapsAuthCallback()}return n.getInstance=function(t){return n._instance||(n._instance=new n(t)),n._instance},n.prototype.createOrUpdateEventWithAPI=function(n,t,i){this._calendarSync.createdEventIdO365?this.updateEvent(n,this._calendarSync.createdEventIdO365,t,i):this.createNewEvent(n,t,i)},n.prototype.createOrUpdateEvent=function(n,t,i){var r=this;this._calendarHelper.popupAuthenticate(function(u){u?(r._writeInviteToCalendar(n),t&&t()):i&&i()})},n.prototype._writeInviteToCalendar=function(n){var i=new Date,t=this._calendarHelper;t.sendInvite(n,function(){})},n.prototype.createNewEvent=function(n,t,i){this.createOrUpdateEvent(n,t,i)},n.prototype.updateEvent=function(n,t,i,r){this.createOrUpdateEvent(n,i,r)},n.prototype._parseEvent=function(n){return JSON.stringify({Subject:n.title,Body:{ContentType:"HTML",Content:n.description},Location:{DisplayName:n.location},Start:n.eventStart,End:n.eventEnd})},n.prototype.logIn=function(n){n&&n()},n.prototype.preAuth=function(){this._calendarHelper.retrieveEmailIfSignedIn()},n.prototype.logOut=function(){this.loggedIn=!1},n.prototype.getEventsByDateRange=function(n,t,i,r){r&&r()},n}(),ro=function(){function n(){this.loggedIn=!0}return n.getInstance=function(){return n._instance||(n._instance=new n),n._instance},n.prototype.logIn=function(n){n&&n()},n.prototype.logOut=function(){},n.prototype.preAuth=function(n){n&&n()},n.prototype.createOrUpdateEvent=function(n,t){var r="BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nSUMMARY:"+n.title+"\nDESCRIPTION:"+n.description+"\nLOCATION:"+n.location+"\nDTSTART;"+(n.isAllDayEvent?"VALUE=DATE:":"TZID=UTC:")+n.eventStart+"\nDTEND;"+(n.isAllDayEvent?"VALUE=DATE:":"TZID=UTC:")+n.eventEnd+"\nEND:VEVENT\nEND:VCALENDAR",u,i;window.navigator.msSaveOrOpenBlob?(u=new Blob([r]),window.navigator.msSaveOrOpenBlob(u,n.title+".ics")):(i=document.createElement("a"),i.href="data:text/calendar;charset=utf-8,"+encodeURIComponent(r),i.setAttribute("download",n.title+".ics"),document.body.appendChild(i),i.click(),document.body.removeChild(i));t&&t()},n.prototype.updateEvent=function(){},n.prototype.getEventsByDateRange=function(){},n}(),uo=function(){function n(n,t,i,r,u,f){var e=this;this.APIs={};this._hasCalendarCustomizations=!1;n.getContainer().instanceAsyncAll([{name:"Permalink"},{name:"TaskManager"}],function(o){if(e.permalinkAPI=o.Permalink,e.taskManager=o.TaskManager,t){var s=t.get_attr("startDate"),h=t.get_attr("endDate"),c=s?Date.parse(s):null,l=h?Date.parse(h):null;e._hasCalendarCustomizations=s?!!h:!1;e._calendarSyncViewModel=f?new hu(e,n,t,i,r,c?c:f.getDateTime(),l?l:f.getEndDateTime(),f.getUtcOffset(),f.getIsAllDayEvent(),!0,e._hasCalendarCustomizations,u):new hu(e,n,t,i,r,c,l,null,null,!1,e._hasCalendarCustomizations,u)}});this.map=n;this.entity=f;this.taskId=u}return n.prototype.logOut=function(){this.selectedAPI.logOut()},n.prototype.logIn=function(n,t,i){this.selectedAPI=this.APIs[n];this.currentCalendarType=n;this.selectedAPI&&(this.selectedAPI.loggedIn?t():this.selectedAPI.logIn(t,i))},n.prototype.preAuth=function(n,t){ht.saveIntoCalendar&&(this.APIs[0]=io.getInstance(this),this.APIs[1]=no.getInstance(this),this.APIs[2]=ro.getInstance(this),this.APIs[0].preAuth(n,t))},n.prototype.getPermalink=function(n){var t=this;this.permalinkAPI.getGeneralPermalink(this.map,function(i){if(i){var r=i.permalink;t._permalink=r.toLowerCase().indexOf("form=")!==-1?r.replace(/(form=).*?(&|$)/,"$1"+ht.formCode+"$2"):r+"&form="+ht.formCode;t._shortLink=null;n&&n()}},function(){t.log("ERR","Permalink Generation","Error while building permalink");t._permalink=ht.defaultPermalink},null,!0)},n.prototype.createEvent=function(n,t,i,r,u,e){var l=this,h,c,s,o;r&&(h=r.getTitle(),h||(h=r.getAddress()),c=r.getAddress(),c||(c=r.getTitle()),s=this._hasCalendarCustomizations,o={},o.title=s?f.L_CalendarSync_OpenHouse_Subject+h:h,o.location=c,i?(o.eventStart=n.toISOString().substring(0,10),o.eventEnd=t.toISOString().substring(0,10),o.isAllDayEvent=!0):(o.eventStart=n.toISOString(),o.eventEnd=t.toISOString(),o.isAllDayEvent=!1),this._shortLink||this._permalink?this._ensureShortUrlAndCreateEvent(o,r,s,u,e):s?this.getPermalink(function(){l._ensureShortUrlAndCreateEvent(o,r,s,u,e)}):this._ensureShortUrlAndCreateEvent(o,r,s,u,e))},n.prototype._ensureShortUrlAndCreateEvent=function(n,t,i,r,u){var e=this._shortLink?this._shortLink:this._permalink,o=null,s=null;switch(this.currentCalendarType){case 0:o=i?f.L_CalendarSync_OpenHouse_EventMessage_HTML:f.L_CalendarSync_EventMessage_HTML;s='<a href=\\"'+e+'\\">'+e+"<\/a>";break;case 1:o=i?f.L_CalendarSync_OpenHouse_EventMessage_PlainText:f.L_CalendarSync_EventMessage_PlainText;s=e;break;default:case 2:o=i?f.L_CalendarSync_OpenHouse_EventMessage:f.L_CalendarSync_EventMessage;s=e}n.description=o.replace("{0}",t.getTitle())+s;this.selectedAPI.createOrUpdateEvent(n,r,u)},n.prototype.getStartDateTime=function(){var n;return this._calendarSyncViewModel&&(n=this._calendarSyncViewModel.getStartDateTime()),n},n.prototype.getEntityInfoForLogging=function(){var n=[];return this.entity&&(n.push(this.entity.id?this.entity.id:""),n.push(this.entity.getSegmentTypes()?this.entity.getSegmentTypes().join("~"):"")),n.join("|")},n.prototype.log=function(n,t,i){var f=this.taskManager.getTaskById(this.taskId),o=f&&fu.getImpressionGuid(f.panelRoot),e={logData:{feature:"CAL",action:n,data:{}},impressionGuid:o},u=e.logData.data;switch(n){case"ERR":u.TYP=t;u.Error=i;break;case"C":u.TYP=t;break;case"S":u.TYP=t;u.EntityInfo=i}r.invokeHandler("data-instrumentation",e)},n}(),wr;(function(t){function f(t){var i=n(document.createElement("div"));return i.set_html(t),i}function r(n){var t=n.select(".tabControlRoot");t&&t.length&&a.setTimeout(function(){sj_evt.fire("tab_init",tabcontrol)},200)}function e(n,t,e,o,s,h){var p=function(n){var i=f(n),u=i.select(".tab-container"),e=u.length&&u[0].id;t(i,e);r(i)},w=function(){},a=n.join("_"),c,v,y;return a=encodeURI(a),c=l.tabCreatorUrl.replace("{names}",a),c+="&count="+i,e&&e>=50&&(c+="&w="+e),o&&o<n.length&&(c+="&dft="+o),s&&(c+="&hero=1"),h&&(c+="&button=1"),u.testHooksEnabled&&(c+="&testhooks=1"),c.toLowerCase().indexOf("mcig")<0&&(v=u.dynamicProperties.mapsIG,v&&(c+="&MCIG="+v)),u.isOnCorpnet&&u.isOnChina&&u.dynamicProperties.clientIP&&(c+="&clientip="+u.dynamicProperties.clientIP),y=wt.downloadGeneric(c,"tabctrl",p,null,w),i++,y}var i=0;t.prepareTabControl=r;t.requestTabControl=e})(wr||(wr={})),function(n){var t,i,r;(function(n){n[n.success=0]="success";n[n.userMappingNotFound=5]="userMappingNotFound"})(t=n.AcceptableRewardsErrorCodes||(n.AcceptableRewardsErrorCodes={})),function(n){n.ShownIneligibleKey="CommuteRewardsShownIneligible";n.FlyoutDismissKey="CommuteRewardsFlyoutDismiss";n.FlyoutDismissCountKey="CommuteRewardsFlyoutDismissCount";n.FlyoutNotNowActionKey="CommuteRewardsNotNowActionCount";n.FlyoutImpressionCountKey="CommuteRewardsFlyoutImpressionCount"}(i=n.StorageKeys||(n.StorageKeys={})),function(n){n.AwardPoints="AP";n.JoinRewardsClick="JRC";n.LocationsTooFar="LTF";n.CommuteErrorCode="CEC";n.DismissClick="FD";n.ImplicitDismiss="IMD";n.FlyoutEarnClick="FEC";n.FlyoutClick="FC";n.FlyoutImpression="FI";n.RewardsUpsellImpression="RUI";n.RewardsIneligibleImpression="RII";n.RewardsJoinImpression="RJI";n.CommuteRegionExcluded="CRE"}(r=n.CommuteRewardsLogActionName||(n.CommuteRewardsLogActionName={}))}(nt||(nt={}));ui=function(n){function t(){var i=this;return t.instance?(t.instance.tryUpdateIsSignedIn(),t.instance):(i=n.call(this)||this,i._privates.defineProperty("isSignedIn",function(n,t){return i._onSignInStateChange(n,t)}),i.notifySignedInStarted=new s,i.notifySignedIn=new s,sj_evt&&sj_evt.bind("wl:auth",function(){i._updateIsSignedIn()}),l.enableAADAccountLinking&&l.useAADAccountForCollections&&sj_evt&&sj_evt.bind("aad:signedin",function(){i._updateIsSignedIn(!0)}),i._updateIsSignedIn(),t.instance=i,i)}return v(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);t.instance=null},t.prototype.signIn=function(){typeof Identity!="undefined"&&Identity.popupAuthenticate&&(Identity.headerLoginMode=1,Identity.popupAuthenticate("WindowsLiveId"))},t.prototype.tryUpdateIsSignedIn=function(){var t,n,i;u.testHooksEnabled||(t=this.getIsSignedIn(),n=!1,l.enableAADAccountLinking&&l.useAADAccountForCollections?n=!0:typeof Identity!="undefined"&&(i=Identity.wlProfile&&Identity.wlProfile(),n=!!i),n!==t&&(this.setIsSignedIn(n),r.invokeHandler("data-instrumentation",{logData:{feature:"CX",action:"SI",data:{BSI:this.getIsSignedIn()}},isMapsAction:!0})))},t.prototype._onSignInStateChange=function(n,t){this.notifySignedInStarted.invoke();this.notifySignedIn.invoke(t)},t.prototype._updateIsSignedIn=function(n){if(n||l.enableAADAccountLinking&&l.useAADAccountForCollections)this.setIsSignedIn(!0),r.invokeHandler("data-instrumentation",{logData:{feature:"CX",action:"SI",data:{BSI:this.getIsSignedIn(),AADSignIn:!0}},isMapsAction:!0});else if(typeof Identity!="undefined"){var t=Identity.wlProfile&&Identity.wlProfile();this.setIsSignedIn(!!t);r.invokeHandler("data-instrumentation",{logData:{feature:"CX",action:"SI",data:{BSI:this.getIsSignedIn()}},isMapsAction:!0})}},t.instance=null,t}(bt),function(n){function u(n){var t,i;return n.success&&((t=n.addressList)===null||t===void 0?void 0:t.length)>0&&(i=n.addressList[0]),i}function f(){return typeof t=="undefined"?new Promise(function(n){wt.downloadGeneric(l.rewardsCommutePromotionUrl,"commuteRewards",function(i){var r;i&&(r=JSON.parse(i),t=r);n(r)},undefined,function(){n(undefined)})}):Promise.resolve(t)}function e(t){return t in n.AcceptableRewardsErrorCodes}function o(n){var t=new cf,i=l.commuteRewardsExcludedCountries,f=l.commuteRewardsExcludedUSStates;return r.reverseGeocode(n,function(n){var o,s,r=u(n),e=(o=r===null||r===void 0?void 0:r.countryRegionIso2)===null||o===void 0?void 0:o.toUpperCase(),h=(s=r===null||r===void 0?void 0:r.adminDistrict)===null||s===void 0?void 0:s.toUpperCase(),c=h&&e==="US"&&!f.some(function(n){return n===h}),l=e&&e!=="US"&&!i.some(function(n){return n===e});t.resolve(c||l)},undefined,undefined,0),t}var i=new ui,t,r=new lf;i.notifySignedInStarted.add(function(){t=undefined});n.getPromotionAvailableCommuteResponse=f;n.isPromotionErrorCodeExpected=e;n.isCommuteRewardsAllowed=o}(nt||(nt={}));cu=function(n){function t(t){var i=n.call(this)||this,r,u;return i.setTemplate(new it(se)),r=i.rootElement=i.getRootElement(),u=t.getRootElement(),u.append(r),i}return v(t,n),t.prototype.append=function(n){var i=n.getControl&&n.getControl(),t;i&&(t=document.createElement("li"),t.append(i.getRootElement()),this.rootElement.append(t))},t}(kt);lu=function(t){function i(i,r,u,e,o){var s=t.call(this)||this,h,c;return s.resources=e||f,h=u||{},h.onCloseClick||(h.onCloseClick=function(n){n.preventDefault();n.stopPropagation();s.CloseDialog()}),h.onDlgKeydown=function(t){var i=t,f=i.keyCode||i.which,r,u;f===27&&s.CloseDialog();f===9&&(r=s.getFirstTabbableChild(s.getRootElement()),u=n(".dialogClose")[0],i.target!==u||i.shiftKey?i.target===r&&i.shiftKey&&(u.focus(),i.preventDefault()):(r.focus(),i.preventDefault()))},c=o?' id="'+o+'"':"",s.setTemplate(new it('<div class="bm_modalDialog MicrosoftMap" event:keydown="onDlgKeydown" tabindex="-1"><div><div class="'+r+'"'+c+">"+i+'<a href="#" class="dialogClose closeIcon" data-tag="Dialog.Close" event:click="onCloseClick" aria-label="'+f.L_Dlg_Close+'" role="button"><\/a><\/div><\/div><\/div >',h)),s}return v(i,t),i.prototype.OpenDialog=function(){var n=this.getRootElement();n&&(document.body.appendChild(n),n.focus())},i.prototype.CloseDialog=function(){n(this.getRootElement()).removeFromParent()},i}(kt),function(n){function t(n){var t="";switch(n){case 1:t="Problem with roads";break;case 2:t="Problem with addresses";break;case 5:t="Problem with admininistrative districts";break;case 9:t="Problem with airports";break;case 8:t="Problem with bridges";break;case 3:t="Problem with city";break;case 6:t="Problem with land features";break;case 4:t="Problem with neighborhoods";break;case 7:t="Problem with water bodies";break;case 11:t="Expected location result not returned";break;case 12:t="Problem with imagery";break;case 13:t="Some other problem";break;default:case 0:t="No problem selected"}return t}function i(n){var t="";switch(n){case 1:t="Road";break;case 2:t="Address";break;case 5:t="Admininistrative district";break;case 9:t="Airport";break;case 8:t="Bridge";break;case 3:t="City";break;case 6:t="Landform";break;case 4:t="Neighborhood";break;case 7:t="Waterbody";break;case 13:t="Something else";break;case 12:t="Imagery";break;default:case 0:t="No problem selected"}return t}function r(n){var t="";switch(n){case 1:t="Road name is incorrect or missing";break;case 2:t="Road needs to be removed";break;case 3:t="Road location is incorrect";break;case 4:t="Road is missing";break;case 5:t="Road is closed";break;case 6:t="Road type is incorrect (highway or street)";break;case 7:t="Road should be one way";break;case 8:t="Road should be two ways";break;case 9:t="Road is one way in the wrong direction";break;case 10:t="Address is missing from road";break;case 11:t="Address is in wrong location";break;case 12:t="Address is on the wrong side of the road";break;case 13:t="Postal code has incorrect zip code";break;case 14:t="Postal code is missing";break;case 15:t="City name is incorrect";break;case 16:t="City location is incorrect";break;case 17:t="City is missing";break;case 18:t="City should be neighborhood";break;case 19:t="Neighborhood name is incorrect";break;case 20:t="Neighborhood location is incorrect";break;case 21:t="Neighborhood is missing";break;case 22:t="Neighborhood should be city";break;case 23:t="The boundary between countries is incorrect";break;case 24:t="The boundary between states/provinces is incorrect";break;case 25:t="The boundary between counties is incorrect";break;case 26:t="A political entity is missing (country, state, county, province etc.)";break;case 27:t="Political entity is wrong type";break;case 28:t="Country has incorrect or missing name";break;case 29:t="State/province has incorrect or missing name";break;case 30:t="County has incorrect or missing name";break;case 31:t="Name of land feature is incorrect";break;case 32:t="Land feature is wrong type (forest should be a desert etc.)";break;case 33:t="Land feature is missing";break;case 34:t="Land feature is the wrong location";break;case 35:t="Water body is missing";break;case 36:t="Water body is in an incorrect location";break;case 37:t="Water body has incorrect name";break;case 38:t="Incorrect type of water body (ocean should be sea etc.)";break;case 39:t="Bridge is closed";break;case 40:t="Bridge name is incorrect or missing";break;case 41:t="Bridge is missing";break;case 42:t="Bridge needs to be removed";break;case 43:t="Bridge is in wrong location";break;case 44:t="Airport in wrong location";break;case 45:t="Airport has incorrect or missing name";break;case 46:t="Airport is missing";break;case 47:t="Name is incorrect";break;case 48:t="Location is incorrect";break;case 49:t="Address of location is incorrect";break;case 50:t="Expected result not returned";break;case 51:t="Imagery is out of date";break;case 52:t="Imagery is cloudy or blurry";break;case 53:t="Imagery and roads do not match";break;case 54:t="Something else";break;case 0:default:t="No subproblem selected"}return t}function u(n){var t="";switch(n){case 1:t="Address";break;case 2:t="Business";break;case 3:t="Populated Place";break;default:case 0:t="Other"}return t}function f(n){var t="Other";return n===1?t="Inaccurate Directions":n===3?t="A better route that is not shown":n===4?t="Incorrect times for transit services":n===5?t="Incorrect location of a transit stop":n>=10&&(t="Inaccurate location origin/destination"),t}function e(n){var t="driving";return n===2?t="transit":n>=3&&(t="walking"),t}function o(n){return n==="arrival"?"arrival":"departure"}function s(n){switch(n){case 1:return"Footer";case 2:return"TaskMenu";case 3:return"TaskLink";case 4:return"TransientLens";case 5:return"SlideOutMenu";case 6:return"TaskBarMenu";case 7:return"BetaFeedbackButton";case 8:return"Flyover";case 9:return"Landmarks3D";case 10:return"StreetsideBetaFeedbackButton";case 11:return"Map3D";case 12:return"UrlAzureMapsWebSdk";case 13:return"UrlAzureMapsPortal";case 14:return"UrlAzureMapsMSDoc";default:return""}}n.GetStargateProblemValue=t;n.GetStargateIssueEntityType=i;n.GetStargateSubProblemValue=r;n.GetStargateNoFoundPlaceType=u;n.GetDirectionsIssue=f;n.GetDirectionsMode=e;n.GetDirectionsTimeType=o;n.feedbackEntryPointToString=s}(fi||(fi={}));var br=function(i){function r(n,r,u,f){var e=i.call(this,n,r)||this,o=e._privates;return o.defineProperty("showMessagePanel"),o.defineProperty("reminderMessage"),e._map=f,e.resources=t,e.feedbackTask=u,e.isSubmitted=!1,e}return v(r,i),r.prototype.onTaskStateChanged=function(n){if(n.animationState===1&&this.setFocusToDefaultElement(),n.activationState===1&&n.prominence===1){if(this.feedbackType===2&&!this._marker)return;this.feedbackType===1||this.isSubmitted||this.showMarker(!0)}else n.activationState===2&&this.feedbackType!==1&&this._marker&&this.showMarker(!1)},r.prototype.setFocusToDefaultElement=function(){var n=this;a.setTimeout(function(){if(!n.isDisposed){var t=n.getDefaultFocusElement();t&&t.length>0&&t[0].focus();n.onClearError(null)}},20)},r.prototype.getDefaultFocusElement=function(){try{if(this.getControl&&this.getControl()){var n=this.getControl().select(".popOutButton.dropdownBtn");return n.length===0&&(n=this.getControl().select("a,textarea")),n}return null}catch(t){return null}},r.prototype._createMarker=function(n){var u;if(!this._marker){var f=e._nextId().toString(),s='<div class="bm_feedbackDragOverlay"><div class="feedbackDragPin" id="${id}"><\/div><\/div>'.replace("${id}",f),h='<div class="feedbackDragPinMessage">${fdbkPinToolTip}<\/div>'.replace("${fdbkPinToolTip}",t.FdbkPinToolTip),i=this._map.getAzureMap(),c=n||this._markerPosition||i.getCamera().center,o={position:c,hideContainer:!0,keepOpenOnMouseleave:!0,visible:!1},r=this._marker=new lr(i,gt({htmlContent:s,draggable:!0},o));this._marker=r;u=new lr(i,gt({htmlContent:h,pixelOffset:[20,30]},o));this._dragTip=u;this.disposables.push(u);this.disposables.push(r);this._attachEvents(r,f)}this._closeTipWithTimer()},r.prototype._attachEvents=function(t,i){var r=this,u=t.getImpl(),f=function(){r._closeTipWithTimer()},e=function(n){var t=n.target;r._marker.setOptions({position:t.getOptions().position});r._closeTipWithTimer()};n("#".concat(i)).add_event("mouseover",f);u._addEventListener("drag",function(n){r._ondragContinue(n)},!1);u._addEventListener("dragend",function(n){e(n)},!1)},r.prototype._closeTipWithTimer=function(){var n=this;this.showTip(!0,this._marker.getOptions().position);this._hideTipTimer=a.setTimeout(function(){n.showTip(!1)},w.feedbackPinTipExpiry)},r.prototype.onClosePanel=function(n){n&&(n.preventDefault(),n.stopPropagation());this.feedbackTask.onCloseClick.invoke()},r.prototype.onClearError=function(){this.setShowMessagePanel(!1)},r.prototype._ondragContinue=function(n){var t=n.target;window.clearTimeout(this._hideTipTimer);this._markerMoved=!0;this._dragTip.setOptions({visible:!1})},r.prototype._getMarkerLocation=function(){var n,t;return this._marker?n=this._marker.getOptions().position:this._markerPosition?n=this._markerPosition:(t=this._map.getAzureMap(),n=this._markerPosition=t.getCamera().center),n},r.prototype.hasInput=function(){return!1},r.prototype.showTip=function(n,t){if(this._dragTip){window.clearTimeout(this._hideTipTimer);var i={visible:n};t&&(i.position=t);this._dragTip.setOptions(i)}},r.prototype.showMarker=function(n,t){var r=typeof n=="boolean"?n:!0,i,u;(this._marker||r)&&(i=this._getMarkerLocation(),t&&(i=t),this._marker?(this._marker.setOptions({visible:r,position:i}),this.showTip(r,i),r&&(u=this._map.getBounds(),ai.BoundingBox.containsPosition(u,i)||this._map.setView({center:i}))):r&&(this._createMarker(i),this._marker.setOptions({visible:r}),this.showTip(r,i)))},r.prototype._focusInThankYouPanel=function(){window.clearTimeout(this._timeoutHdl);this._timeoutHdl=a.setTimeout(function(){var t=n(".textButton.thankYouPanel");t&&t.length&&t[0].focus()},this._timeout)},r.prototype._baseFeedbackData=function(){var i=this._map,t=i.getView(),n=t.bounds,r=t.center,u=t.zoom;return{MapStyle:i.getStyle(),MapViewBoundingBox:{NELatLon:{Latitude:nr.getNorth(n),Longitude:nr.getEast(n)},SWLatLon:{Latitude:nr.getSouth(n),Longitude:nr.getWest(n)}},MapViewCenter:{Latitude:r[1],Longitude:r[0]},Zoom:u}},r.prototype._showMessagePanel=function(n,t){this.setShowMessagePanel(n);this.setReminderMessage(n?t:"")},r.prototype.dispose=function(){window.clearTimeout(this._hideTipTimer);i.prototype.dispose.call(this)},r.prototype._createGeoLocation=function(){var n=this._getMarkerLocation();return{Latitude:n[1],Longitude:n[0]}},r}(ri),fo=function(i){function f(n,r,u,f){var o=i.call(this,n,le,r,f)||this,s;return o.feedbackType=6,u&&(o.reportType=u.reportType?u.reportType:0,o._query=u.query?u.query:"",u.pushPinLocation&&(o._markerPosition=u.pushPinLocation),u.scenarioKey&&(o._scenarioKey=u.scenarioKey),u.userFacts&&(o.userFacts=u.userFacts),u.rapEntryPoint&&(o._rapEntryPoint=u.rapEntryPoint)),s=o._privates,s.defineProperty("showFeedbackForm"),s.defineProperty("showBackToEditButton"),s.defineProperty("showSuggestions"),s.defineProperty("showThankYouPanel"),s.defineProperty("showDragPushPinErrorMessage"),s.defineProperty("showAllFields"),s.defineProperty("businessCity"),s.defineProperty("businessState"),o.setShowBackToEditButton(!0),o.setShowFeedbackForm(!0),o.setShowSuggestions(!1),o.setShowThankYouPanel(!1),o.setShowAllFields(!1),o._isPushpinManuallyUpdated=!1,o._isAddressGeocoded=!1,o.getControl().select(".businessOwnerLink").set_html(e._formatString(t.FdbkBingPlacesText,o._getBingPlacesLink(t.FdbkBingPlacesLink))),o._reverseGeocodePushpin(function(n,t){o._isValidField(o.businessAddress)||o._isValidField(o.getBusinessCity())||o._isValidField(o.getBusinessState())||o._isValidField(o.businessPostalCode)||(o.setBusinessCity(n),o.setBusinessState(t),o._initialBusinessCity=n,o._initialBusinessState=t)}),o._initMapCenter=o._map.getAzureMap().getCamera().center,o}return v(f,i),f.prototype.dispose=function(){i.prototype.dispose.call(this)},f.prototype.onReturnToSearchResultClick=function(n){n.preventDefault();r.invokeHandler("data-task",{action:"remove",id:this.feedbackTask.id})},f.prototype.onMeFeedbackSubmitClick=function(n){var t=this,r,i;(n.preventDefault(),n.stopPropagation(),y.log("FB","AS",{FT:"AS",SR:"SC"}),r=this._validateNoResultFeedbackForm(),r)&&(i=function(){var n=t.numberOfSuggFetched>0;t.isSnrRequestCompleted&&n?(t.setShowFeedbackForm(!1),t.showMarker(!1),t.setShowSuggestions(!0),y.log("FB","AS",{FT:"AS",SR:"SS",DATA:t.numberOfSuggFetched})):(t.processSubmitBeforeSendingData(),y.log("FB","AS",{FT:"AS",SR:"SD"}))},this.isSnrRequestCompleted?i(n):(a.setTimeout(function(){i(n)},1e3),y.log("FB","AS",{FT:"AS",SR:"WS"})))},f.prototype.onMeFeedbackBackToEditClick=function(n){n.preventDefault();n.stopPropagation();this.getShowBackToEditButton()&&(this.setShowSuggestions(!1),this.setShowFeedbackForm(!0),this.showMarker(!0),this._closeChildLocalDetailsCard(),y.log("FB","AS",{FT:"AS",SR:"BE"}))},f.prototype._closeChildLocalDetailsCard=function(){var f=document.querySelector("[data-subtaskid='"+this.feedbackTask.id+"']"),t,n,i,r,u;f&&(t=f.getAttribute("data-taskid"),t)&&((n=document.querySelectorAll("[data-taskid='"+t+"']"),!n||n.length<2)||(i=n[1],r=i.getAttribute("data-subtaskid"),r&&r.indexOf("LocalDetailsTask")===0&&(u=i.querySelector(".cardFace .bm_cardCloseButton"),u&&u.click(),this._map&&this._map.getAzureMap().setCamera({center:this._initMapCenter}))))},f.prototype.onMeFeedbackSubmitAnywayClick=function(n){n.preventDefault();n.stopPropagation();this._closeChildLocalDetailsCard();this.processSubmitBeforeSendingData();y.log("FB","AS",{FT:"AS",SR:"SA"})},f.prototype.processSubmitBeforeSendingData=function(){var n=this;this._isAddressGeocoded?this._sendSerfData():this._geocodeAddressAndMovePushpin(function(t){n._isAddressGeocoded=t;n._sendSerfData()})},f.prototype.boolToDragPinMessageClass=function(n){var t="mefeedbackCardMovePinReminderDiv";return n&&(t+=" requiredInputMissing"),t},f.prototype.onBlurFBRequiredInputFieldName=function(){if(this._validateField(this.businessName,".inputFieldBlock.name","RN"),w&&w.enableAutoSuggestOnMe&&this._isValidField(this.businessName)&&this._isValidField(this.getBusinessCity())&&this.lastBusinessName!==this.businessName){var n=this._isValidField(this.businessAddress)?this.businessAddress:"";n+=this.getBusinessCity();this.GetAutoSuggestions(this.businessName,n)}this.lastBusinessName=this.businessName},f.prototype.onBlurFBRequiredInputFieldAddress=function(n){var t=this;this._isAddressGeocoded=!1;n.target&&n.target.classList&&n.target.classList.contains("mefbBusinessCity")&&this._validateField(this.getBusinessCity(),".inputFieldBlock.city","RC");this._geocodeAddressAndMovePushpin(function(n){t._isAddressGeocoded=n});w&&w.enableAutoSuggestOnMe&&n.target&&n.target.classList&&n.target.classList.contains("fbBusinessAddress")&&this.lastBusinessAddress!==this.businessAddress&&this._isValidField(this.businessName)&&this._isValidField(this.businessAddress)&&this.GetAutoSuggestions(this.businessName,this.businessAddress);this.lastBusinessAddress=this.businessAddress},f.prototype._validateField=function(n,t,i){var u=this._isValidField(n),r=this.feedbackTask.panelRoot.select(t);return r!==null&&r!==undefined&&(u===!1?r.add_class("requiredInputMissing"):r.remove_class("requiredInputMissing")),u===!1&&y.log("FB","V",{FT:"ME",SR:i,RE:this._rapEntryPoint?this._rapEntryPoint:""}),u},f.prototype._validateAddress=function(){var n=this._validateField(this.businessAddress,".inputFieldBlock.address","RA"),t=this._markerMoved||this._isPushpinManuallyUpdated,i=this._isValidField(this.businessPhone);return n?!0:t||i},f.prototype._isAddressValidForGeocode=function(){return this._isValidField(this.businessAddress)&&this._isValidField(this.getBusinessCity())},f.prototype._isValidField=function(n){return n!==undefined&&n!==null&&n.length!==0},f.prototype.onPushPinUpdate=function(){this.setShowDragPushPinErrorMessage(!1);this._isPushpinManuallyUpdated=!0},f.prototype._geocodeAddressAndMovePushpin=function(n){var t=this;if(this.feedbackTask.geoCoder&&this._isPushpinManuallyUpdated===!1&&this._isAddressValidForGeocode()){var r=this.businessAddress+", "+this.getBusinessCity()+", "+this.getBusinessState()+", "+this.businessPostalCode,i=this._map,u=function(r){if(r.success&&r.results&&r.results.length>0&&r.results[0].confidence==="High"&&t._isPushpinManuallyUpdated===!1)if(t._isAutoGeocodeEnabled(r.results[0].address.countryRegionIso2)){var u=r.results[0].point,f=new ai.Position(u.coordinates[1],u.coordinates[0]);t.showMarker(!0,f);i.setView({center:f,zoom:15});t.setShowDragPushPinErrorMessage(!1);n(!0)}else n(!1);else n(!1)};this.feedbackTask.geoCoder.geocode(r,u,i.getView().bounds,1,!0,!0)}else n(!1)},f.prototype._isAutoGeocodeEnabled=function(n){var t=!1,i;return w&&w.autoGeocodeMissingBusinessAddressMarkets&&(i=new RegExp(n,"i"),w.autoGeocodeMissingBusinessAddressMarkets.search(i)>=0&&(t=!0)),t},f.prototype._sendSerfData=function(){var t=ot.noResultType[2],i=ot.formField[3],r=ot.scenarioField[4],u=ot.issueType[47],f=this._baseFeedbackData(),n=gt(gt({},f),{FORM:i,Query:this._query,FeedbackType:"DSAT",EntryPoint:fi.feedbackEntryPointToString(this.feedbackTask.getEntryPoint()),Scenario:r,Issue:u,UserComment:this.commentsSearchResultNotFound,Comments:this.commentsSearchResultNotFound,SuggestedEntity:{GeoLocation:this._createGeoLocation(),SuggestedEntityType:t},IsPushpinMoved:this._markerMoved,IsPushpinManuallyUpdated:this._isPushpinManuallyUpdated,ScenarioKey:this._scenarioKey});if(n.InitialBusinessCity=this._initialBusinessCity,n.InitialBusinessState=this._initialBusinessState,n.InitialPinLocation={Latitude:this._markerPosition[1],Longitude:this._markerPosition[0]},n.IssueEntityType=ot.issueEntityType[28],n.SuggestedEntity.Address={AddressLine:this.businessAddress,City:this.getBusinessCity(),PostalCode:this.businessPostalCode,Subdivision:this.getBusinessState()},n.SuggestedEntity.Name=this.businessName,n.SuggestedEntity.PrimaryPhone=this.businessPhone,n.SuggestedEntity.PrimaryWebsite=this.businessWebsite,this.userFacts&&this.userFacts.Id&&(n.Id=this.userFacts.Id),this.userFacts&&this.userFacts.isTestingLocation==="true"&&(n.isTestingLocation=!0),n.ServerSideAPIEnabled=!0,this._rapEntryPoint){switch(this._rapEntryPoint){case 4:n.rapentrypoint="LocalListingMissingEntityLink";break;case 1:n.rapentrypoint="NoResultsCardMissingEntityLink";break;case 2:n.rapentrypoint="NoResultsCardRAPLink";break;case 3:n.rapentrypoint="RAPMenu";break;case 5:n.rapentrypoint="SuggestAnEditMissingEntityLink"}n.rappartner="MapsV8"}this._reverseGeocodePushpin(function(t,i,r){n.SuggestedEntity.Address.CountryCode=r});this.feedbackTask.sendLocalFeedback(n,"NEW",2);this.isSubmitted=!0;y.log("FB","S",{FT:"ME",SR:"SM",RE:this._rapEntryPoint?this._rapEntryPoint:""});this.setShowFeedbackForm(!1);this.setShowSuggestions(!1);this.setShowThankYouPanel(!0);this.showMarker(!1)},f.prototype._validateNoResultFeedbackForm=function(){var n=!0,t="",i=this._validateField(this.businessName,".inputFieldBlock.name","RN"),r=this._validateField(this.getBusinessCity(),".inputFieldBlock.city","RC"),u=this._validateAddress();return i||(t+="RN",n=!1),u||(t+="RA",n=!1),r||(t+="RC",n=!1),n||y.log("FB","S",{FT:"ME",SR:t,RE:this._rapEntryPoint?this._rapEntryPoint:""}),n},f.prototype._reverseGeocodePushpin=function(n){if(this.feedbackTask.reverseGeocoder){var t=this._getMarkerLocation(),i=new ii(t[1],t[0]);this.feedbackTask.reverseGeocoder.reverseGeocode(i.getPosition(),function(t){if(t&&t.success&&t.addressList&&t.addressList.length>0){var i=t.addressList[0].countryRegionIso2?t.addressList[0].countryRegionIso2:"",r=t.addressList[0].adminDistrict?t.addressList[0].adminDistrict:"",u=t.addressList[0].locality?t.addressList[0].locality:"";n(u,r,i)}else n("","","")},[],!0,0)}else n("","","")},f.prototype.findAncestor=function(n,t){while((n=n.parentElement)&&n.className.indexOf(t)<0)if(n.tagName.indexOf("html")>-1)break;return n},f.prototype.processItemClickEvent=function(t,i){var f=this,e=this.findAncestor(t.target,"me-listings-item"),o=e.getAttribute("data-entity"),s=JSON.parse(o),r,u;(i=s.entity.id,this.autoSuggCurrentSelectedEntity!==i)&&(r=this.feedbackTask.panelRoot.select("a[data-entity]"),r.for_each(function(t){var s=t.getAttribute("data-entity"),r=JSON.parse(s),o,e;r&&r.entity&&r.entity.id&&(o=n(t),e=r.entity.id,e&&(e===i?(o.add_class("hover"),u=i):e===f.autoSuggCurrentSelectedEntity&&o.remove_class("hover")))}),this.autoSuggCurrentSelectedEntity=u)},f.prototype.GetAutoSuggestions=function(t,i){function f(n,t){var i="sw_ste";return n>t&&(i=n>t+.5?"sw_st":"sw.sth"),i}var r=this,e=t+" in "+i,o,s;this.isSnrRequestCompleted=!1;this.numberOfSuggFetched=0;this.autoSuggListElements=[];this.feedbackTask.panelRoot.select(".me-b_vList").set_style({visibility:"hidden"});y.log("FB","AS",{FT:"AS",SR:"IN",QUERY:e});o=Date.now();s={clickHandler:function(n,t){return r.processItemClickEvent(n,t)}};var c=function(t){var p=Date.now(),b=p-o,c,a,h,v,l;if(y.log("FB","AS",{FT:"AS",SR:"RT",DATA:b}),r.feedbackTask.panelRoot.select(".me-b_vList").clear(),t!==null&&t.value!==null&&t.value.length>0){var u=t.value,k=r.feedbackTask.id,i="";for(c=0,a=u;c<a.length;c++)h=a[c],i+=(h===null||h===void 0?void 0:h.bingId)?h.bingId+"|":"";for(i=i[i.length-1]==="|"?i.substring(i.length-1):i,y.log("FB","AS",{FT:"AS",SR:"ASL_F",ID:i,RS:u.length}),u=u.slice(0,3),v=function(t){for(var c,g,e,y,rt,i=u[t],l=i.geo?i.geo.latitude:null,a=i.geo?i.geo.longitude:null,h=i.bingId,v=i.name,p=i.address.text,ut=i.menuUrl,nt=i.telephone,ft=i.url,et=i.image?i.image.contentUrl.substring(w.imageUrlPrefix.length)+"&w=76&h=108&c=7&rs=1&qlt=80&cdv=1":"",o=i.aggregateRating?i.aggregateRating.ratingValue/2:null,tt=i.aggregateRating?i.aggregateRating.reviewCount:null,b=null,ot=i.review||[],d=0,it=ot;d<it.length;d++)if(c=it[d],c.provider&&c.provider.length>0&&c.provider[0].name){b=c.provider[0].name;break}g=sj_ce("li","","");e=sj_ce("a","","me-listings-item");e.setAttribute("href","#");var st={geometryType:1,geometry:{x:l,y:a,bounds:[l,a,l,a]},entity:{title:v,id:"ypid: "+h,address:p,menuUrl:ut,phone:nt,website:ft},routablePoint:{latitude:l,longitude:a}},ht={state:{entryPoint:"LocalListing",id:"ypid:"+h,flippingCard:!0,taskTitle:v},type:"LocalDetailsTask",activateOptions:{parentId:k}},ct={logData:{feature:"AS",action:"ASL_C",data:{ID:"ypid:"+h,Q:v,PO:t+1}}};e.setAttribute("data-entity",JSON.stringify(st));e.setAttribute("data-task",JSON.stringify(ht));e.setAttribute("data-instrumentation",JSON.stringify(ct));y='<div><div class="me-b_imagePair me-tall_m"><div class="inner"><div class="cico" style="width:76px; height:108px;" ><img height="108" width="76" src="'+et+'" /><\/div><\/div><div class="me-b_vPanel" ><div><div class="me-b_factrow" >'+v+'<\/div><\/div><div><div class="me-b_factrow"><span title="'+p+'" class="b_address" >'+p+"<\/span><\/div> <\/div>";o&&tt&&b&&(y+='<div><div class="me-b_factrow"><span class="csrc sc_rc1" role= "img" aria-label="Star Rating: '+o+' out of 5." ><span class='+f(o,0)+"><\/span><span class="+f(o,1)+"><\/span><span class="+f(o,2)+"><\/span><span class="+f(o,3)+"><\/span><span class="+f(o,4)+"><\/span><\/span>"+b+" ("+tt+")<\/div><\/div>");y+='<div><div class="me-b_factrow" >'+nt+"<\/div><\/div><\/div><\/div><\/div>";e.innerHTML=y;g.appendChild(e);rt=n(e);r.autoSuggListElements.push(h);rt.add_event("click",function(n){return s.clickHandler(n,h)});r.feedbackTask.panelRoot.select(".me-b_vList").append(g);r.feedbackTask.panelRoot.select(".me-b_vList").set_style({visibility:"visible"});r.numberOfSuggFetched++},l=0;l<u.length;l++)v(l);y.log("FB","AS",{FT:"AS",SR:"CM"})}else y.log("FB","AS",{FT:"AS",SR:"NR",QUERY:e});r.isSnrRequestCompleted=!0},l=function(n){y.log("FB","AS",{FT:"AS",SR:"ERR",DATA:n});this.isSnrRequestCompleted=!0},h=u.dynamicProperties.market.toLowerCase(),a=w.snrSearchUrlPrefix+"?appid="+w.snrSearchAppId+"&q="+e+"&count="+w.snrSearchCount+"&mkt="+h+"&setlang="+h;wt.downloadJson(a,null,c,l,null,null,1,null,null)},f.prototype.onTaskStateChanged=function(t){var u,r;i.prototype.onTaskStateChanged.call(this,t);t.activationState===1&&b._getIsSlideCardEnabled()&&(u=this.feedbackTask.panelRoot&&this.feedbackTask.panelRoot.length?this.feedbackTask.panelRoot[0]:null,u&&(r=n("."+f._hoverClassName,u),r&&r.length>0&&(r.remove_class(f._hoverClassName),this.setShowBackToEditButton(!0))));t.activationState===1&&t.prominence===1&&this.feedbackType!==1&&!this.isSubmitted&&this.getShowSuggestions()&&this.showMarker(!1)},f.prototype._getBingPlacesLink=function(n){return'<a class="bingPlacesLink" href="'+w.bingPlacesLink+'" target="_blank" aria-label="'+w.bingPlacesLink+'" role="button">'+n+"<\/a>"},f._hoverClassName="hover",f}(br),eo=function(i){function f(n,t,r,f,e,o){var s=i.call(this,n,ae,t,o)||this,h;return s.feedbackType=r,s.isMobile=u.isMobile,s._timeout=250,s.feedbackQueryables=f,s._query="",s._definePrivates(s._privates),s.feedbackFormField=ot.formField,s.feedbackScenarioField=ot.scenarioField,s.feedbackIssueEntityType=ot.issueEntityType,s.feedbackIssueType=ot.issueType,s.feedbackNotFoundType=ot.noResultType,e&&(r===5?(s._dragEndHandler=function(n){s._dragEnd(n)},s._dragStartHandler=function(n){s._dragStart(n)},s._dragHandler=function(n){s._dragging(n)},s.reportType=e.reportType?e.reportType:0,e.pushPinLocation&&(s._markerPosition=e.pushPinLocation),s._directionTaskState=e.taskState,e.query?s._query=e.query:s._directionTaskState&&s._directionTaskState.originalQuery&&(s._query=s._directionTaskState.originalQuery),e.directionStepsList&&(s._stepsList=e.directionStepsList),e.directionRouteIndex&&(s._directionRouteIndex=e.directionRouteIndex),s.feedbackDirectionsIssueType=ot.directionsIssue):r===3||r===7?(s.reportType=e.reportType?e.reportType:0,s._query=e.query?e.query:"",e.pushPinLocation&&(s._markerPosition=e.pushPinLocation),e.taskStateId&&(s._taskStateId=e.taskStateId),e.scenarioKey&&(s._scenarioKey=e.scenarioKey),e.dataFacts&&(s.dataFacts=e.dataFacts),e.userFacts&&(s.userFacts=e.userFacts),e.rapEntryPoint&&(s._rapEntryPoint=e.rapEntryPoint)):e.reportType&&(e.reportType===10||e.reportType===11)&&(s.reportType=e.reportType)),r===5&&(typeof s._stepsList=="undefined"||s._stepsList.length===0)&&(s.feedbackType=r=2),s._prePopulateAreaDropdown(r,s._query),s._showOrHideElements(),s.setFeedbackType(r),s.setReminderMessage(""),s.showMarker(!1),s.steps=new oi,s.showOrHideReturnNavButtons(s._isSlideCard(r)),s.dataFacts&&s.dataFacts.parentId&&(h=s.dataFacts.parentId,h&&h.indexOf("Detail")>-1&&s.showOrHideReturnNavButtons(!0)),s._initMapCenter=s._map.getAzureMap().getCamera().center,s}return v(f,i),f.prototype._definePrivates=function(n){n.defineProperty("showFeedbackHeader");n.defineProperty("hideBackButton");n.defineProperty("showGeneralFeedbackPanel");n.defineProperty("showProblemOnMapPanel");n.defineProperty("showThankYouPanel");n.defineProperty("showProblemTypes");n.defineProperty("showSubProblems");n.defineProperty("showLookingforDiv");n.defineProperty("showAddressInput");n.defineProperty("showPostcodeInput");n.defineProperty("showCommentsDiv");n.defineProperty("showAddressInput");n.defineProperty("showAddMissingEntityLink");n.defineProperty("showMovePushpinMessage");n.defineProperty("showRequirePinMoveSign");n.defineProperty("showDirectionsFeedback");n.defineProperty("showStepsDiv");n.defineProperty("showRequiredArea");n.defineProperty("showRequireMessage");n.defineProperty("showSendButton");n.defineProperty("showPostRequire");n.defineProperty("showRequireComments");n.defineProperty("isFBBusinessNameFieldValid");n.defineProperty("isFBBusinessCityFieldValid");n.defineProperty("reminderMessage");n.defineProperty("buttonClassName");n.defineProperty("backButtonText");n.defineProperty("problemArea",this._onProblemAreaChanged);n.defineProperty("problemType",this._onProblemTypeChanged);n.defineProperty("subProblemType",this._onSubProblemTypeChanged);n.defineProperty("directionsIssueType",this._onDirectionsIssueTypeChanged);n.defineProperty("addressGhostText",null,null,{defaultValue:t.FdbkStreetGhost});n.defineProperty("userAddress",null,null,{defaultValue:""});n.defineProperty("userPostcode",null,null,{defaultValue:""});n.defineProperty("feedbackType")},f.prototype.dispose=function(){this.showOrHideReturnNavButtons(!1);i.prototype.dispose.call(this)},f.prototype.onReturnToSearchResultClick=function(n){this.showOrHideReturnNavButtons(!1);n.preventDefault();r.invokeHandler("data-task",{action:"remove",id:this.feedbackTask.id})},f.prototype.onAddStepClick=function(n){n.preventDefault();this.addStep()},f.prototype.onProblemSendClick=function(n){var r,h,c,t,f,o,i,l;n.preventDefault();var u=this.feedbackType,s=y.getFeedbackTypeLogValue(2),a=n.target;if(!a.classList.contains("inactive")){if(u&&(s=y.getFeedbackTypeLogValue(u)),r=this.getProblemArea().value,u===3){if(h=!1,r===3&&(h=this.getNotFoundType()===0),!this._validateNoResultFeedbackForm(h,this.commentsFeedback,!0))return}else if(u===7){if(!this._validateNoResultFeedbackForm(!1,this.commentsFeedback,!0))return}else if(u===5){if(!this._validateDirectionsInputs(this.getDirectionsIssueType().value))return}else if(c=this._checkAndCreateError(u),c){y.log("FB","S",{FT:s,SR:"RI"});return}t=this._baseFeedbackData();this.getProblemType().value===34&&(t.MapStyle="streetside");t.FORM=this.feedbackFormField[r];t.FeedbackType="DSAT";t.EntryPoint=fi.feedbackEntryPointToString(this.feedbackTask.getEntryPoint());t.Query=t.query=this._query;t.Scenario=this.feedbackScenarioField[r];this.feedbackQueryables&&this.feedbackQueryables.keywords.length>2?(f=this.feedbackQueryables.keywords[2],f&&(t.IssueEntity={GeoLocation:{latitude:f[1],longitude:f[0]}})):this.getShowMovePushpinMessage()&&(t.IssueEntity={GeoLocation:{latitude:this._initMapCenter[1],longitude:this._initMapCenter[0]}});r===5?(o=this.getDirectionsIssueType().value,o>10&&(o=10),t.Issue=this.feedbackDirectionsIssueType[o],this._insertDirectionsJSON(t)):(r===3||r===4?this._insertSearchJSON(t):(t.IsPushpinMoved=this._markerMoved,this._markerMoved&&(t.SuggestedEntity={GeoLocation:this._createGeoLocation(this._markerPosition)})),i=null,ot.hasProblemFoundType(r)&&(i=this.getProblemType().value,t.IssueEntityType=this.feedbackIssueEntityType[i]),i&&ot.hasSubProblem(i)&&(t.Issue=this.feedbackIssueType[this.getSubProblemType().value]));t.UserComment=e._decodeHTML(this.commentsFeedback);this.feedbackQueryables&&(i=this.getProblemType().value,i===11||i===12?t.keywords=gi([],this.feedbackQueryables.keywords,!0):i===34&&(l=this.feedbackQueryables.keywords.splice(0,2),t.keywords=gi([],l,!0)));this.feedbackTask.sendSurfFeedback(t,"","");rt.defaultScenario(2);this.feedbackQueryables=null;this._showOrHideElements();this.setShowThankYouPanel(!0);this._focusInThankYouPanel();this.isSubmitted=!0;y.log("FB","S",{FT:s,SR:"SM",RP:this._rapEntryPoint?this._rapEntryPoint:""})}},f.prototype.showOrHideReturnNavButtons=function(t){var r,u,f,i,e;if(this.setHideBackButton(t),r=n(".returnArrowDiv",this.getControl()[0]),u=this.getFeedbackType(),u===7||u===3||u===5)for(f=n(".stickyFiltersRoot"),i=0;i<f.length;i++)e=n(f[i]),f[i].classList.contains("slideout")&&(t?(r.remove_class("hide"),e.add_class("hide")):(r.add_class("hide"),e.remove_class("hide"))),u===7&&(f[i].classList.contains("slideout")||(t?(r.remove_class("hide"),e.add_class("hide")):(r.add_class("hide"),e.remove_class("hide"))))},f.prototype.onTaskStateChanged=function(n){this.feedbackType!==5||this.getDirectionsIssueType().value>=10||this.getDirectionsIssueType().value===7?i.prototype.onTaskStateChanged.call(this,n):(this.showMarker(!1),n.animationState===1&&this.setFocusToDefaultElement())},f.prototype.setFocusToDefaultElement=function(){var n=this;a.setTimeout(function(){var t=n.getDefaultFocusElement();t&&t.length>0&&(t[0].focus(),t[0].focus());n.onClearError(null)},20)},f.prototype.onBlurFBRequiredInputField=function(){this._validateNoResultFeedbackForm(this.getNotFoundType()===0,this.commentsFeedback,!1)},f.prototype.addStep=function(){var n=this,t=new ho(this._stepsList,this);this.steps.insert(t);t.stepChanged.addOne(function(){n.setButtonClassName(n._disableSendButton(!1))})},f.prototype.onFeedbackDoneClick=function(t){if(t.preventDefault(),this.getHideBackButton()||this.feedbackType!==2)this.onReturnToSearchResultClick(t);else r.invokeHandler("data-task",{action:"removeStackForTask",id:this.feedbackTask.id}),u.isMobile&&n("#feedbackWrapper").add_class("collapsed")},f.prototype._isSlideCard=function(n){return n===5||n===4||n===3||n===7?!0:!1},f.prototype._prePopulateAreaDropdown=function(n,i){var u,f,r;this.problemAreas=rt.buildScenarioDropDown(n,this.reportType,i);u=[];this.problemTypes=new oi(u);f=[];this.subProblemTypes=new oi(f);r=this.feedbackQueryables;r&&r.keywords&&r.keywords.length>0?(n=2,this.setProblemArea({text:t.FdbkAreaMap,value:1})):this.setProblemArea(rt.defaultScenario(this.feedbackType,this._query))},f.prototype._onProblemAreaChanged=function(n,i){var r,f,e,u;i!==null&&(r=i.value,this.setBackButtonText(t.L_Fdbk_ReturnToSearchResult),this.setProblemType({text:t.L_Fdbk_SelectSubProblem,value:0}),this.setButtonClassName(this._disableSendButton(!0)),r===5?(this.feedbackType=5,f=this._directionTaskState&&this._directionTaskState.waypoints,e=this._directionTaskState&&this._directionTaskState.mode===2,this.directionsIssueTypes=rt.buildDirectionsIssues(f,e),this.setDirectionsIssueType(rt.defaultDirectionsIssue()),this._showOrHideElements(r),this.setBackButtonText(t.ReturnToDirections)):r===2||r===6?(this.feedbackType=r===2?2:3,this.problemTypes.clear(),this._showOrHideElements(r)):r===3?(this.feedbackType=3,this.problemTypes.clear(),this.problemTypes.insertAll(rt.buildProblemType(i.value,this.reportType)),this._showOrHideElements(r),this.setProblemType(rt.setDefaultProblemType())):r===1?(this.feedbackType=2,this.problemTypes.clear(),u=this.feedbackQueryables,this.problemTypes.insertAll(rt.buildProblemType(i.value,this.reportType,u)),this._showOrHideElements(r),u&&u.keywords&&u.keywords.length&&(u.keywords.indexOf("flyOver")>-1?this.setProblemType(rt.setDefaultProblemType(11)):u.keywords.indexOf("3dlandmarks")>-1?this.setProblemType(rt.setDefaultProblemType(12)):(w===null||w===void 0?void 0:w.enableStreetsideFdbk)&&u.keywords.indexOf("Streetside")>-1&&this.setProblemType(rt.setDefaultProblemType(34)))):(this.feedbackType=2,this.problemTypes.clear(),this.problemTypes.insertAll(rt.buildProblemType(i.value,this.reportType)),this._showOrHideElements(r),this.setProblemType(rt.setDefaultProblemType())))},f.prototype._onProblemTypeChanged=function(n,i){if(i!==null){this.getSubProblemType&&this.subProblemTypes.clear();this.setSubProblemType({text:t.L_Fdbk_SelectSubProblem,value:0});var r=i.value,u=this.feedbackQueryables;r===35||r===30||r===19||r===28||r===22||r===26||r===25||r===27||r===24||r===20||r===21||r===2||r===29||r===23||r===14||r===17||r===3?this._showOrHideElements(null,i.value):r===11?u&&u.keywords&&u.keywords.length&&u.keywords.indexOf("flyOver")>-1&&(this._showOrHideElements(this.getProblemArea().value,r),this.setProblemType({text:t.FdbkProblemFlyover,value:11})):r===12?(u&&u.keywords?u.keywords.length===0&&(u.keywords=["3dlandmarks"]):this.feedbackQueryables={keywords:["3dlandmarks"]},this._showOrHideElements(this.getProblemArea().value,r),this.setProblemType({text:t.FdbkLandmarks,value:12})):r===34?(u&&u.keywords?u.keywords.length===0&&(u.keywords=["streetside"]):this.feedbackQueryables={keywords:["streetside"]},this.setProblemType({text:t.StreetsideMapStyle,value:34}),this.subProblemTypes.insertAll(rt.buildSubProblemDropDownItems(i.value)),this._showOrHideElements(this.getProblemArea().value,r)):(this.subProblemTypes.clear(),this.subProblemTypes.insertAll(rt.buildSubProblemDropDownItems(i.value)),this._showOrHideElements(this.getProblemArea().value,i.value))}},f.prototype._onSubProblemTypeChanged=function(n,t){var i=t.value;this._showOrHideElements(this.getProblemArea().value,this.getProblemType().value,null,i)},f.prototype._onDirectionsIssueTypeChanged=function(n,t){var u,i,f,e;if(t)if(this._showOrHideElements(null,null,t.value),t.value>=10){var o=this._directionTaskState.waypoints,s=o[this.getDirectionsIssueType().value-10],r=s.point;this._markerPosition=ai.Position.fromLatLng(r);this.showMarker(!0,this._markerPosition);u=[];w.enablePoiManager&&this.feedbackTask.poiManager&&(i=this.feedbackTask.poiManager,this.showMarker(!1),f=new ci("","",this.feedbackTask.displayState),f&&(this._primitive=new co(new ii(r.latitude,r.longitude),f),this.disposables.push(this._primitive),u.push(this._primitive)),i.setPrimitives(u),i.primDragEnd.remove(this._dragEndHandler),i.primDragCancel.remove(this._dragEndHandler),i.primDragging.remove(this._dragHandler),i.primDragStart.remove(this._dragStartHandler),i.primDragStart.add(this._dragStartHandler),i.primDragEnd.add(this._dragEndHandler),i.primDragCancel.add(this._dragEndHandler),i.primDragging.add(this._dragHandler),this.showTip(!0,this._markerPosition));this.setShowRequirePinMoveSign(!0)}else t.value===7?(e=this._map.getView().center,this._markerPosition=e,this.showMarker(!0,this._markerPosition),this.setShowRequirePinMoveSign(!0)):t.value===2?(this.showMarker(!0),this.setShowRequirePinMoveSign(!1)):(this.setShowRequirePinMoveSign(!1),this.showMarker(!1))},f.prototype._dragStart=function(){this.showTip(!1)},f.prototype._dragEnd=function(n){var t=n.location;this._markerPosition=new ai.Position(t.longitude,t.latitude);this._primitive.setLocation(t);this.feedbackTask.poiManager.refreshMap(!1,!0);this._markerMoved=!0},f.prototype._dragging=function(n){var t=n.location;this._primitive.setLocation(t);this.feedbackTask.poiManager.refreshMap(!1,!0);this._markerMoved=!0},f.prototype.getNotFoundType=function(){var t=this.getProblemType(),n=t&&t.value;return n===28?2:n===30?1:n===29?3:n===35?4:0},f.prototype._insertDirectionsJSON=function(n){var r=null,u=null,f=null,h=1,c=1,l="departure",e,o,s,t,i;if(this._directionTaskState&&(this._directionTaskState.waypoints&&(f=this._directionTaskState.waypoints,r=this._directionTaskState.waypoints[0],u=this._directionTaskState.waypoints[this._directionTaskState.waypoints.length-1]),this._directionTaskState.options&&(this._directionTaskState.options.unit!==1&&(h=0),l=this._directionTaskState.options.timeType),c=this._directionTaskState.mode),r&&(n.From=this._getWayPointString(r),n.GeocodedFrom=this._getWayPointString(r),r.point&&(n.GeocodedFromLatLong={Latitude:r.point.latitude,Longitude:r.point.longitude})),u&&(n.To=this._getWayPointString(u),n.GeocodedTo=this._getWayPointString(u),u.point&&(n.GeocodedToLatLong={Latitude:u.point.latitude,Longitude:u.point.longitude})),this.getDirectionsIssueType().value===1){for(e={},t=0;t<this.steps.length;t++)o=t+1,e["Step"+o]={StepIndex:o,ProblemDetails:this.steps[t].getCommentsDirectionsStep(),StepDescription:this.steps[t].getDirectionsIssueStep().value};for(n.InaccurateSteps=e,n.DirectionsRouteRequest={AvoidOption:!1,DistanceUnitOption:h,MaxSolutionsOptions:3,OptimizeOption:"Time",RouteIndex:this._directionRouteIndex,RouteModeOption:rt.GetDirectionsMode(c),TimeTypeOption:rt.GetDirectionsTimeType(l)},s={},t=0;t<f.length;t++)i=f[t],i&&(s["WayPoint"+t]={Address:this._getWayPointString(i),IsViaPoint:!1,Latitude:i.point.latitude,Longitude:i.point.longitude});n.DirectionsRouteRequest.WayPoints=s}else this.getDirectionsIssueType().value>=10?(f&&(i=f[this.getDirectionsIssueType().value-10],i.point&&(n.IssueEntity={GeoLocation:{Latitude:i.point.latitude,Longitude:i.point.longitude},Identifier:{Identifier:"Unknown"},Name:i.name})),n.SuggestedEntity={GeoLocation:{Latitude:this._markerPosition[1],Longitude:this._markerPosition[0]}}):this.getDirectionsIssueType().value===7&&(n.SuggestedEntity={GeoLocation:{Latitude:this._markerPosition[1],Longitude:this._markerPosition[0]}});return n},f.prototype._insertSearchJSON=function(n){var r=this.getProblemArea().value===3,u=this._validateNoResultFeedbackForm(this.getProblemType().value===0,this.commentsFeedback,!0),i,t;return u?(i=this.getNotFoundType(),t="",r?i===1&&(t=this.feedbackNotFoundType[this.getNotFoundType()]):(this.reportType===2||this.reportType===3)&&(t=this.feedbackNotFoundType[this.getNotFoundType()]),n.SuggestedEntity={GeoLocation:{Latitude:this._markerPosition[1],Longitude:this._markerPosition[0]},SuggestedEntityType:t},n.IsPushpinMoved=this._markerMoved,n.ScenarioKey=this._scenarioKey,this.reportType===2||this.reportType===3?n.IssueEntity={GeoLocation:{Latitude:this._initMapCenter[1],Longitude:this._initMapCenter[0]},Name:this.feedbackTask.getTitle()}:(this.reportType===5||this.reportType===1||this.reportType===8)&&(n.IssueEntity={GeoLocation:{Latitude:this._initMapCenter[1],Longitude:this._initMapCenter[0]},Name:this.feedbackTask.getTitle(),Identifier:{Identifier:this._taskStateId}}),r&&i===2&&(n.SuggestedEntity.Address={AddressLine:this.businessAddress,City:this.businessCity,PostalCode:this.businessPostalCode,Subdivision:this.businessState},n.SuggestedEntity.Name=this.businessName,n.SuggestedEntity.PrimaryPhone=this.businessPhone,n.SuggestedEntity.PrimaryWebsite=this.businessWebsite),n.ServerSideAPIEnabled=!0,this._rapEntryPoint&&(n.rapentrypoint=this._rapEntryPoint,n.rappartner="MapsV8"),n):undefined},f.prototype._checkAndCreateError=function(n){var r=!1,f=this.getProblemArea().value,i=ot.hasProblemFoundType(f)?this.getProblemType().value:null,u=ot.hasSubProblem(i)?this.getSubProblemType().value:null,e;return f===0?(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ProblemArea_Reminder)):f===1&&(i===4||i===5)?u===null||u===0?(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ProblemType_Reminder)):u===4||u===3?this.getUserAddress().length===0&&(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ReportAProblemOnMap_Reminder)):u===2||u===1?this.getUserPostcode().length===0&&(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ReportAProblemOnMap_Reminder)):this.isEmptyFeedbackComment()&&this.getShowRequireComments()&&(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ReportAProblemOnMap_Reminder)):f===1?((i===null||i===0)&&(r=!0,this._showMessagePanel(!0,t.FdbkProblemError)),i!==null&&(i===19||i===11||i===12||i===34||i===2||i===14||i===3?this.isEmptyFeedbackComment()&&this.getShowRequireComments()&&(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ReportAProblemOnMap_Reminder)):u===0?(r=!0,this._showMessagePanel(!0,t.FdbkSubProblemError)):this.isEmptyFeedbackComment()&&this.getShowRequireComments()&&(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ReportAProblemOnMap_Reminder)))):f===7?((i===null||i===0)&&(r=!0,this._showMessagePanel(!0,t.FdbkProblemError)),i!==null&&i===18?u===0?(r=!0,this._showMessagePanel(!0,t.FdbkSubProblemError)):this.isEmptyFeedbackComment()&&this.getShowRequireComments()&&(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ReportAProblemOnMap_Reminder)):this.isEmptyFeedbackComment()&&this.getShowRequireComments()&&(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ReportAProblemOnMap_Reminder))):this.isEmptyFeedbackComment()&&this.getShowRequireComments()&&(r=!0,this._showMessagePanel(!0,t.L_Fdbk_ReportAProblemOnMap_Reminder)),r&&(e=y.getFeedbackTypeLogValue(2),n&&(e=y.getFeedbackTypeLogValue(n)),y.log("FB","S",{FT:e,SR:"RI"})),r},f.prototype._validateDirectionsInputs=function(n){var i=!0,r=t.L_Fdbk_GeneralFeedback_Reminder;return n===0?(r=t.L_Fdbk_ProblemType_Reminder,i=!1):n>=10||n===7?this.getShowRequirePinMoveSign()&&!this._markerMoved&&(i=!1,r=t.FdbkAddressErrorWithPin):n===1&&this.steps.length===0?i=!1:(n===2||n===6||n===4)&&this.isEmptyFeedbackComment()&&(i=!1,r=t.L_Fdbk_ReportAProblemOnMap_Reminder),i||(this._showMessagePanel(!0,r),y.log("FB","S",{FT:y.getFeedbackTypeLogValue(5),SR:"RI"})),i},f.prototype._validateNoResultFeedbackForm=function(n,i,r){var u=!0,e,f="",o=this.getProblemArea()&&this.getProblemArea().value,s=this.getProblemType()&&this.getProblemType().value,c=this.getNotFoundType(),h=this.getShowMovePushpinMessage();return n?(f=t.L_Fdbk_ReportAProblemOnMap_Reminder,e="RI",u=!1):o&&o!==3?o!==4||s&&s!==25?o===6&&this.getShowRequireComments()&&this.isEmptyFeedbackComment()&&(f=t.L_Fdbk_ReportAProblemOnMap_Reminder,u=!1):s?h&&!this._markerMoved&&this.getShowRequirePinMoveSign()&&(f=t.FdbkAddressErrorWithPin,e="RP",u=!1):(f=t.L_Fdbk_ProblemType_Reminder,u=!1,e="RP"):s===28?(this.businessName===null||this.businessName.length===0?(f=t.L_Fdbk_BusinessNotFound_RequiredFields_Missing_ErrorMessage,e="RI",u=!1,this.setIsFBBusinessNameFieldValid(!1)):this.setIsFBBusinessNameFieldValid(!0),this.businessCity===null||this.businessCity.length===0?(f=t.L_Fdbk_BusinessNotFound_RequiredFields_Missing_ErrorMessage,e="RI",u=!1,this.setIsFBBusinessCityFieldValid(!1)):this.setIsFBBusinessCityFieldValid(!0)):this.isEmptyFeedbackComment()?(f=t.L_Fdbk_ReportAProblemOnMap_Reminder,u=!1):this.reportType===3&&h&&!this._markerMoved&&this.getShowRequirePinMoveSign()&&(f=t.FdbkAddressErrorWithPin,u=!1),u?this._showMessagePanel(!1):(this._showMessagePanel(!0,f),y.log("FB",r?"S":"V",{FT:y.getFeedbackTypeLogValue(this.feedbackType),SR:e,RE:this._rapEntryPoint?this._rapEntryPoint:""})),u},f.prototype.isEmptyFeedbackComment=function(){return!this.commentsFeedback||this.isNullOrWhitespace(this.commentsFeedback)},f.prototype.isNullOrWhitespace=function(n){return typeof n=="undefined"||n===null?!0:n.replace(/\s/g,"").length<1},f.prototype._disableSendButton=function(n){return n?"textButton inactive":"textButton"},f.prototype._getWayPointString=function(n){return n.name&&n.address?n.name+","+n.address:n.name?n.name:n.address},f.prototype._showOrHideElements=function(n,i,r,u){if(this.setShowMovePushpinMessage(!1),this.setShowRequirePinMoveSign(!1),this.setShowProblemTypes(!1),this.setShowSubProblems(!1),this.setShowThankYouPanel(!1),this.setShowStepsDiv(!1),this.setShowPostcodeInput(!1),this.setShowLookingforDiv(!1),this.setShowAddressInput(!1),this.setShowCommentsDiv(!1),this.setShowDirectionsFeedback(!1),this.setShowAddMissingEntityLink(!1),this.setShowMessagePanel(!1),this.setShowPostRequire(!1),this.setShowRequireComments(!1),this.setShowRequiredArea(!0),this.setShowRequireMessage(!0),this.setShowSendButton(!0),this.showMarker(!1),n||(n=this.getProblemArea().value),n)switch(n){case 5:this.setShowDirectionsFeedback(!0);break;case 2:this.setShowMovePushpinMessage(!0);this.showMarker(!0);this.setShowCommentsDiv(!0);break;case 6:this.setShowMovePushpinMessage(!0);this.showMarker(!0);this.setShowCommentsDiv(!0);this.setShowRequireComments(!0);break;case 3:case 1:case 4:case 7:this.setShowProblemTypes(!0)}if(n!==1||i||(i=this.getProblemType().value),i){this.setShowProblemTypes(!0);switch(i){case 19:case 22:case 24:case 20:case 23:case 21:case 35:case 14:case 17:case 3:this.setShowCommentsDiv(!0);this.setShowRequireComments(!0);break;case 2:case 30:case 29:this.setShowMovePushpinMessage(!0);this.setShowRequirePinMoveSign(!1);this.showMarker(!0);this.setShowCommentsDiv(!0);this.setShowRequireComments(!0);break;case 25:case 32:case 33:this.setShowMovePushpinMessage(!0);this.setShowRequirePinMoveSign(!0);this.showMarker(!0);this.setShowCommentsDiv(!0);break;case 26:case 27:this.setShowCommentsDiv(!0);this.setShowRequireComments(!0);break;case 28:this.setShowLookingforDiv(!0);this.setShowMovePushpinMessage(!0);this.setShowRequirePinMoveSign(!1);this.showMarker(!0);this.setIsFBBusinessNameFieldValid(!1);this.setIsFBBusinessCityFieldValid(!1);break;case 4:case 5:case 10:case 7:case 8:case 9:case 6:case 13:case 18:case 16:case 1:case 15:case 34:this.setShowSubProblems(!0);break;case 11:this.setShowCommentsDiv(!0);this.setShowRequireComments(!0);break;case 12:this.setShowCommentsDiv(!0);break;case 31:this.setAddressGhostText(t.FdbkStreetGhost);this.setShowAddressInput(!0);this.setShowPostcodeInput(!0);this.setShowMovePushpinMessage(!0);this.showMarker(!0);this.setShowCommentsDiv(!0)}}if(r){this.setShowDirectionsFeedback(!0);r>10&&(r=10);switch(r){case 1:this.setShowStepsDiv(!0);this.setShowMovePushpinMessage(!1);this.steps.length===0&&this.addStep();break;case 10:this.setShowMovePushpinMessage(!0);this.setShowRequirePinMoveSign(!0);this.setShowCommentsDiv(!0);break;case 6:case 4:case 2:this.setShowRequireComments(!0);this.setShowCommentsDiv(!0);break;case 7:this.setShowMovePushpinMessage(!0);this.setShowRequirePinMoveSign(!0);this.showMarker(!0);this.setShowCommentsDiv(!0);break;default:this.setShowCommentsDiv(!0)}}u&&(u===4?(this.setAddressGhostText(t.FdbkStreetGhost),this.setShowAddressInput(!0),this.setShowPostcodeInput(!0),this.setShowMovePushpinMessage(!0),this.showMarker(!0),this.setShowCommentsDiv(!0)):u===2||u===1?(this.setShowPostcodeInput(!0),this.setShowPostRequire(!0),this.setShowCommentsDiv(!0)):u===58?this._showMessagePanel(!0,t.ReportAProblemInstruction):this.getProblemArea().value===1&&this.getProblemType().value!==34?(this.setShowMovePushpinMessage(!0),this.showMarker(!0),this.setShowRequireComments(!0),this.setShowCommentsDiv(!0)):this.getProblemArea().value===1&&this.getProblemType().value===34?(this.setShowMovePushpinMessage(!1),this.showMarker(!1),this.setShowRequireComments(!0),this.setShowCommentsDiv(!0)):this.getProblemType().value===18?(this.setShowRequireComments(!0),this.setShowCommentsDiv(!0)):this.setShowCommentsDiv(!0));this.setButtonClassName(this._disableSendButton(!this.getShowCommentsDiv()&&!this.getShowAddressInput()&&!this.getShowPostcodeInput()&&!this.getShowLookingforDiv()))},f}(br),y;(function(n){function t(n,t,i,u){r.invokeHandler("data-instrumentation",{logData:{feature:n,action:t,data:i},flush:u})}function i(n){var t="G";return n===2?t="B":n===3?t="S":n===4?t="L":n===6?t="ME":n===7&&(t="RE"),t}function u(n){var t="PW";return n===1?t="F":n===3?t="TL":n===2?t="TM":n===6&&(t="TB"),t}n.log=t;n.getFeedbackTypeLogValue=i;n.getEntryPointLogValue=u})(y||(y={}));var oo=function(n){function i(t,i,r,f,e,o,h){var c=n.call(this,i)||this;return c.poiManager=h,c._mapsFeedback=r,c.type="FeedbackTask",c.displayState={prominence:1,colorIndex:5,groupName:"Feedback"},c._geoLocationProvider=f,c.geoCoder=e,c.reverseGeocoder=o,c._controlTemplateFactory=t,c._initFeedbackFocus=new s,c.onCloseClick=new s,c._searchImpressionGuids=[],c._traceIds=[],!u.isMobile&&r&&(r.generateReproUrl(),r.logEntryTime()),c.onCloseClick.add(function(){return c._onCloseClick()}),c}return v(i,n),i.prototype.activate=function(i,r){var l=this,f=2,e,o=this._map,s=this._controlTemplateFactory,u=null,h,c;r&&(this._taskState=r,f=r.feedbackTaskType,u=r.options);this.setTitle(t.L_Fdbk_Link);r&&r.title&&r.title.length>0&&u&&(!u.query||u.query.length===0)&&(u.query=r.title);f===9&&this._hideMapDetailLayers();f===1?(h=new lo(s,this,f,o),h.setShowFeedbackHeader(r&&u&&u.showFeedbackHeader),e=h,this._initFeedbackFocus.add(function(){e.setFocusToDefaultElement()})):f===6?e=new fo(s,this,u,o):(e=new eo(s,this,f,r.queryables,u,o),this._initFeedbackFocus.add(function(){l._currentViewModel.setFocusToDefaultElement()}));this._currentViewModel=e;n.prototype.activate.call(this,i,r);c=e.getControl();c&&this.addControl(c);this._initFeedbackFocus.invoke();y.log("FB","A",{EP:y.getEntryPointLogValue(r.entryPoint),FT:y.getFeedbackTypeLogValue(f)});this.setClarityTag("activated");this.setPercentLoaded(1)},i.prototype.deactivate=function(){n.prototype.deactivate.call(this);this._currentViewModel.dispose();var t="SM";this._currentViewModel.isSubmitted||(t=this._currentViewModel.hasInput(this._currentViewModel.feedbackType)?"T":"F");y.log("FB","D",{FT:y.getFeedbackTypeLogValue(this._currentViewModel.feedbackType),FI:t,RE:this._taskState&&this._taskState.options&&this._taskState.options.rapEntryPoint?this._taskState.options.rapEntryPoint:""})},i.prototype.processCallback=function(n){var r,i,t,e,u,f;if(n.outData)for(r=n.outData,i=0;i<r.length;i++)t=r[i].data,t&&(e=r[i].processorId===this._taskState.activeTaskId,t.ImpressionGuid&&(u=t.ImpressionGuid,e&&(u=t.ImpressionGuid+"|Active"),this._searchImpressionGuids.indexOf(u)===-1&&this._searchImpressionGuids.push(u)),t.TraceId&&(f=t.TraceId,e&&(f=t.TraceId+"|Active"),this._traceIds.indexOf(f)===-1&&this._traceIds.push(f)))},i.prototype.serialize=function(){return this._taskState},i.prototype.setDisplayState=function(t){var i,r;n.prototype.setDisplayState.call(this,t);this._currentViewModel&&this._currentViewModel.onTaskStateChanged(t);(t.activationState===1&&t.prominence===1||t.animationState===1)&&(i={trackingDataRequested:!0},this._callProcess(i,"LocalListingTask"),this._callProcess(i,"LocalDetailsTask"),r={action:1},this._callProcess(r,"DirectionsTask"))},i.prototype.getMapsFeedback=function(){return this._mapsFeedback},i.prototype._callProcess=function(n,t){var i={requestorType:"FeedbackTask",requestorId:this.id,type:t,requestState:n,useActiveTasks:!0};r.invokeHandler("data-process",i)},i.prototype.getCardIconInfo=function(){return{iconClass:"fdbTsk"}},i.prototype.isSharable=function(){return!1},i.prototype.hasDefaultFocusElement=function(){return!0},i.prototype.sendLocalFeedback=function(n,t,i){i===void 0&&(i=1);this._mapsFeedback&&this._mapsFeedback.sendLocalFeedback(n,t,i);this.setClarityTag("submit_local")},i.prototype.sendSurfFeedback=function(n,t,i){n.SearchImpressionGuid=this._searchImpressionGuids.join(" & ");n.TraceID=this._traceIds.join(" & ");this._mapsFeedback&&this._mapsFeedback.sendSurfFeedback(n,t,i,{});this.setClarityTag("submit")},i.prototype.getEntryPoint=function(){return this._taskState.entryPoint},i.prototype.setClarityTag=function(n){var t=_w;t.clarity&&t.clarity("set","MapsFeedback",n)},i.prototype._onCloseClick=function(){var n=this._mapsFeedback.getActiveTask();r.invokeHandler("data-task",{id:n.id,action:"removeTaskAndReseatChild"});this.deactivate()},i.prototype._hideMapDetailLayers=function(){var t,n=document.querySelector("#navbarLabelToggleInput");(n===null||n===void 0?void 0:n.checked)&&(n.click(),(t=document.querySelector("#bingStyleControl"))===null||t===void 0?void 0:t.classList.remove("user-interacted"))},i}(fu),au=function(i){function f(r,u,f,e,o){var s=i.call(this)||this;s.resources=t;s._mapsFeedback=r;s._map=u;s._taskbar=o;var c=u.getAzureMap(),a=u.viewChangeWatcher,h=s._map.getStyle()==="streetside",l=function(){var n=u.getStyle();s.showHideFeedback(n,f);s.hideMenu(!0)};return s.disposables.push(vt.add(c,"movestart",l),vt.add(c,"stylechanged",l)),s._initFeedbackPopoutMenu(),o&&s.disposables.push(o.feedbackInitialize.add(function(n){s.startFeedbackTask(n,6,s._getFeedbackClickEnabled())}),o.dismissFeedbackMenu.add(function(){s.hideMenu()}),o.focusFeedbackMenu.add(function(){s._onEnter()})),s.setTemplate(new it(he,{onFeedbackClick:function(t){t.preventDefault();s.menuOpen=!0;h=s._map.getStyle()==="streetside";var i=h?10:7;s.startFeedbackTask(n(t.target),i,s._getFeedbackClickEnabled(),t)},onMouseOver:function(t){t.preventDefault();s.menuOpen=!0;var i=s._getFeedbackClickEnabled();n(".bm_feedbackBetaButton").add_class("hover");i||h||s.startFeedbackTask(n(t.target),7,i)},onMouseOut:function(){var t=s._getFeedbackClickEnabled();s.hideMenu(t);n(".bm_feedbackBetaButton").remove_class("hover")},onMouseMove:function(n){n.preventDefault();n.stopPropagation()},onKeydown:function(t){var i=t;i.keyCode&&i.keyCode===13&&(t.preventDefault(),t.stopImmediatePropagation(),s.menuOpen=!0,s.startFeedbackTask(n(t.target),7,s._getFeedbackClickEnabled()))},displayControl:function(){return""}})),s.showBetaButton(s._map.getStyle()),s.menuOpen=!1,s}return v(f,i),f.prototype.showHideFeedback=function(t,i){var r,f;(i&&i.length!==0||(i=n("#sb_feedback")),i&&i.length!==0)&&(r=n("#fbpgbt"),u.isMapsVertical&&r.length>0&&r.get_style("display")!=="none"&&r.set_style({display:"none"}),f=t!=="streetside",w.showBetaButton&&n(this.getRootElement()).set_style({display:f?"":"none"}),i.set_style({display:f?"inline":"none"}))},f.prototype.showBetaButton=function(t){var i=!!e._isSmallMapShownOnSerp(),r=t!=="streetside",u=!w.showBetaButton||i||!r;n(this.getRootElement()).set_style({display:u?"none":"flex"})},f.prototype.closeStreetside=function(){this._map.tryDeactivateStreetside()},f.prototype.startFeedbackTask=function(i,r,u,f){var a=this._map.getStyle()==="streetside",k=r===7||r===10,o,c,v,l,s,p;if(a&&!k)window.open(n(".streetsideReportAProblemText").get_attr("href"),"_blank");else{var e=this._mapsFeedback.getActiveTask(),h=e&&e.id,d=h&&h.length>0;d&&h.indexOf("Feedback")>-1?a&&this.closeStreetside():u?(this.menuOpen=!1,this._feedbackButtonClickHandler(f,e,r)):(a&&this.closeStreetside(),o=[],c=w.teolinOptOutLink,c&&c.length>0&&o.push(this._createOptOutLink(c)),e&&e.isReportable()&&(v=e.getReportOptions(),l=e.getReportType&&e.getReportType(),l===4?o.push(this._getListData(4,r,e.getTitle(),h,e.id,e.getLocalReportOptions())):l===8?o.push(this._getListData(7,r,e.getTitle(),h,e.id,v)):o.push(this._getListData(l===7?5:3,r,e.getTitle(),h,e.id,v))),o.push(this._getListData(2,r,t.L_Fdbk_ReportAProblem,h)),s=this._menuListDropdownViewModel,s?(s.setDropdown(o),s.setButtonElement(i),this._popOutButtonViewModel.setDropdown(s)):(s=this._menuListDropdownViewModel=new dt(i),s.setDropdown(o),this._popOutButtonViewModel=new ki(s),p=this._popOutButtonViewModel.buildPopOut(),this._popout.append(p)),this._showMenu(o,i,r,e),b._setFocusOnFirstMenuItem(this._popout),y.log("FB","O",{EP:y.getEntryPointLogValue(r)}))}},f.prototype._feedbackButtonClickHandler=function(n,i,u){var c=this,o,f;n&&(n.stopImmediatePropagation(),n.preventDefault());var s=u===10?8:2,l=this._map.getStyle()==="streetside",e=this._getTaskOptions(s),h=i&&i.id;i&&i.isReportable()&&(o=i.getReportOptions(),f=i.getReportType(),e=f===6||f===2||f===1||f===5||f===3?this._getListData(3,u,i.getTitle(),h,i.id,o).options:f===8?this._getListData(7,u,i.getTitle(),h,i.id,o).options:f===7?this._getListData(5,u,i.getTitle(),h,i.id,o).options:f===10||f===11?this._getTaskOptions(s,o):this._getTaskOptions(s));s===8?this._map.getStreetsideControl().then(function(n){var i=n.getBubbleId(),u=n.getCamera().center,f=t.StreetsideFeedbackTitle.replace("{0}",t.StreetsideMapStyle).replace("{1}",t.L_Fdbk_Link),o={state:{title:f,activeTaskId:"",feedbackTaskType:8,entryPoint:10,queryables:{keywords:["Streetside","BubbleId: "+i.toString(),u]}}};e=Object.assign(e,o);c.closeStreetside();r.invokeHandler("data-task",e)}).catch(function(){c.closeStreetside();r.invokeHandler("data-task",e)}):(l&&this.closeStreetside(),r.invokeHandler("data-task",e))},f.prototype._showMenu=function(t,i,r){var l=this,s=this._popout,d=s[0],g=t.length===3,v=e._isRtl(),f=i[0].getBoundingClientRect(),ft=document.getElementById("b_mapOverlay"),nt=(ft||document.body).getBoundingClientRect(),y,h,tt,rt,ut,b,a,ht,k;if(r===1)y=parseInt(n(".b_footer").get_style("height").replace("px","")),u.isMapsAnswer||(y+=10),s.set_style({left:v?f.left:f.right,right:"",top:"",bottom:g?y+48+"px":y+23+"px"});else if(r===6)s.set_style({left:f.right+"px",right:"",top:f.top+"px"});else if(r===7){var ct=ft?25:0,lt=g?25:0;s.set_style({right:v?"":nt.right-f.right-1,left:v?f.left-1:"",top:"",bottom:nt.height-f.top+f.height+lt+4+ct+"px"})}else s.set_style({right:nt.right-(f.left+f.right)/2+"px",left:"",top:"",bottom:g?"147px":"122px"});if(h=this._popOutButtonViewModel,h.setDropdownClass("feedbackPopOutTop"),h.setIsDisplayed(!0),tt=n(".feedbackPopOutTop",d),r===6){var it=n(window).get_scroll_pos().x,at=window.innerHeight/window.document.documentElement.offsetHeight*100<80,et=!(it===0||at),vt=window.innerWidth,c=tt.get_style("width");c=Number(c.replace("px",""));h.setIsDisplayed(!1);rt=void 0;rt=v?et||f.left-c<0?f.right+it:f.left-c:et||vt<f.right+c?f.left+it:f.right+c;s.set_style({left:rt+"px"});this.disposables.push(h.popOutHidden.addOne(function(){l._taskbar.dismissMenu.invoke()}));h.setIsDisplayed(!0)}if(ut=n(".bm_dropdownEntry",d),w.preventCloseTCF||(ut.add_event("blur",function(){l.hideMenu()}),tt.add_event("mouseout",function(n){l._onMouseOut(n)}),n(".popOutInner",d).add_event("pointerout",function(n){l._onMouseOut(n)})),ut.add_event("keydown",function(n){l._onKeyDown(n)}),w.shouldIgnoreSAE){var ot=n(".saeLink"),p=ot?ot.parent():null,o=null,st=n(".taskCard.focus");for(b=0;b<st.length;b++)if((a=st[b],!a.classList.contains("hidden")&&!a.classList.contains("overflow"))&&(ht=a.querySelector(".bm_l2NavLeft"),ht&&(k=n(".b_feedbackComponent a.b_suggestedit",a),k&&k.length>0))){o=k;break}o||(o=n(".b_feedbackComponent a"));o=o.length===0?n("#epf_infb"):n(o[0]);p.length>0&&o.length>0&&(p.remove_event("click",function(){}),p.remove_attr("data-dropdown"),p.add_event("click",function(n){n.stopImmediatePropagation();o.fireEvent("click")}))}},f.prototype.hideMenu=function(n){var t=this;n===void 0&&(n=!1);window.clearTimeout(f._mouseOverDelayHandle);f._mouseOverDelayHandle=a.setTimeout(function(){var f,i;if(!t.menuOpen){if(f=!1,!n){var r=t._popout[0]&&t._popout.select(".bm_dropdownEntry"),e=t._popout[0],u=e&&e.getElementsByClassName("feedbackPopOutTop")[0];if(u&&(u.querySelector(":hover")||u.querySelector(":active")||u.querySelector(":focus")))for(i=0;i<r.length;i++)if(r[i].parentElement.querySelector(":hover")||r[i].parentElement.querySelector(":active")||r[i].parentElement.querySelector(":focus")||r[i].querySelector(":focus")||r[i].querySelector(":hover")||r[i].querySelector(":active")){f=!0;break}}f||t._popOutButtonViewModel&&t._popOutButtonViewModel.setIsDisplayed(!1)}},f._mouseTimeout)},f.prototype._createOptOutLink=function(n){var i=t.FdbkTeolinOptOutLabel;return i?{name:i,handler:function(){window.open(n,"__self")}}:undefined},f.prototype._onMouseOut=function(){var t=this;window.clearTimeout(f._mouseOverDelayHandle);f._mouseOverDelayHandle=a.setTimeout(function(){for(var r=t._popout[0]&&t._popout.select(".bm_dropdownEntry"),i=0;i<r.length;i++)n(r[i]).remove_event("blur",function(){t.hideMenu()}),r[i].blur();t.hideMenu()},f._mouseTimeout-50)},f.prototype._onEnter=function(){var n=this._popout.select(".bm_dropdownEntry");n.length>0&&n[0].focus()},f.prototype._onKeyDown=function(t){var i=t,r=i.keyCode||i.which,u,f;r===9&&i.shiftKey||r===37?i.srcElement===this._popout.select(".bm_dropdownEntry")[0]&&(this._taskbar.hoverFeedbackButton.invoke(),this.hideMenu()):r===40?(u=t.target.nextElementSibling,u&&n(u)[0].focus()):r===38&&(f=t.target.previousElementSibling,f&&n(f)[0].focus())},f.prototype._getListData=function(n,i,r,u,f,o){var s=r,h=undefined;return n===4?(s=t.L_Menu_SuggestAnEdit_Link_Text+" - "+r,r=s,h="saeLink"):(n===3||n===5)&&(s=e._formatString(t.L_Fdbk_ActiveCard,r)),{name:s,cssClass:h,options:{type:"FeedbackTask",activateOptions:{parentId:f},state:{entryPoint:i,feedbackTaskType:n,activeTaskId:u,title:r,options:o}}}},f.prototype._getTaskOptions=function(n,i,r){var u=i?i:null,f=n?n:2;return{type:"FeedbackTask",state:{entryPoint:this._entryPoint,feedbackTaskType:f,title:r?r:t.L_Fdbk_ReportAProblemOnSearchResult,options:u}}},f.prototype._initFeedbackPopoutMenu=function(){var i=n(".feedbackPopOut"),t;i.length>0||(t=this._popout=b._createElement("div"),t.set_attr("class","feedbackPopOut"),this._map.getRootElement().getParent().append(t))},f.prototype._getFeedbackClickEnabled=function(){var n=this._mapsFeedback.getActiveTask();return n&&n.getReportType?n.getReportType()!==4:!0},f._mouseTimeout=100,f}(kt),so=function(){function t(t,i,r,f,e,o,h){var c=this;this._canvasScreenshotDebugLog="";this._taskBar=i;this._taskManager=r;this._permalink=f;this._map=t;this._menuClickOpen=!1;this.resetFeedback=new s;this._betaFeedbackLinksViewModel=new au(this,t,e,h,this._taskBar);this._ssBetaFeedbackLinksViewModel=new au(this,t);this.resetFeedback.add(function(){a.setTimeout(function(){c._betaFeedbackLinksViewModel.showHideFeedback(c._map.getStyle())},500)});o&&u.isMapsVertical&&o.set_style({display:"none"});u.isMobile||(e&&e.length!==0?this._setFooterEvents(e):a.setTimeout(function(){e=n("#sb_feedback");e&&e.length>0&&c._setFooterEvents(e)},500));typeof Feedback!="undefined"&&Feedback.Bootstrap.InitializeFeedback({structured:!0},"mapsOptOut",!1,!0,!1)}return t.prototype.getControl=function(){return w.showBetaButton?this._betaFeedbackLinksViewModel:undefined},t.prototype.getFeedbackControl=function(n){if(w.showBetaButton){if(n===1)return this._betaFeedbackLinksViewModel;if(n===2)return this._ssBetaFeedbackLinksViewModel}return null},t.prototype.getActiveTask=function(){var n=this._taskManager.getFocusedStack();return n&&n.getForegroundTask()},t.prototype.sendSurfFeedback=function(n,t,i,r){var e,f=u.dynamicProperties,s,o;n.impressionGuid=_G.IG;n.reproUrl=this._reproUrl;n.SchemaVersion="2.0";n.ClientType="MapWebsite";n.ClientMarket=f.market.toLowerCase();u.isMobile||(s=this._screenShotHtml?this._screenShotHtml:Feedback.PackageLoad.GetHTML(),n.html=this._cleanupHTML(s));n.width=_w.innerWidth;n.height=_w.innerHeight;n.language=f.uiLanguage?f.uiLanguage.split("-")[0]:"";n.region=f.userRegion;n.partner="BingLegacy";n.vertical="maps";n.Query||(n.Query=this._getQueryData());n.query=n.Query;n.text=n.UserComment;n.keywords=gi(gi([],(e=n.keywords)!==null&&e!==void 0?e:[],!0),["V9"],!1);o=window._pageTimings;n.metadata={MapsVersion:"V9",isMapsVertical:u.isMapsVertical,reproUrl:this._reproUrl,isMobile:u.isMobile,referrer:document.referrer,timeOnMap:this._timeSpentBeforeFeedback,canvasScreenshotDebugLog:this._canvasScreenshotDebugLog.split(";"),deviceInfo:eu,jsErrors:Microsoft.Maps.errorLogs,perfTiming:o?o:{}};this._postToSurf(n,t,i,r);this._canvasScreenshotDebugLog="";this._screenShotHtml=""},t.prototype.sendLocalFeedback=function(n,t,i){var r;i===void 0&&(i=1);n.Referrer=this._reproUrl;n.RapDebugId=this.GUID();r={};n.Identifier=t;n.FeedbackType="DSAT";n.ClientType="MapsV8";n.ClientVersion="1.0";n.reproURL=this._reproUrl;n.SchemaVersion="2.0";n.ClientMarket=u.dynamicProperties.market.toLowerCase();n.Source="Local";n.Query||(n.Query=n.query=this._getQueryData());n.Issue="Business Suggestion";n.impressionGuid=_G.IG;n.partner="LocalBusinessFeedback";this._postToLocalFeedback(w.surfApiEndpointV2,n,r)},t.prototype._getQueryData=function(){var o=this._taskBar.getSearchTerm(),t,i,u,r,n,f,e;if(o)return o;if(this._taskManager&&(t=this._taskManager.getStacks(),t))for(i=0;i<t.length;i++)if(u=t[i].displayState,u.prominence===2||u.activationState===2)for(r=t[i].getAllTasks(),n=0;n<r.length;n++)if(f=r[n].displayState,(f.prominence===2||f.activationState===2)&&(e=r[n].getTitle(),e&&su&&e!==su.LocalGuideCategory))return r[n].getTitle();return"NULL"},t.prototype._setFooterEvents=function(n){var t=this,i=this._betaFeedbackLinksViewModel,r;n&&(r=function(){return u.isMapsVertical||u.dynamicProperties.isMapsOverlay},n.add_event("click",function(u){var o,f;r()&&(u.stopImmediatePropagation(),u.preventDefault(),o=e._isCommuteDashboardPage(),o?(u.stopImmediatePropagation(),u.preventDefault(),t.clickFeedbackButtonInCLPDashboard()):(f=t._getFeedbackClickEnabled(),i.menuOpen=t._menuClickOpen=!f,i.startFeedbackTask(n,1,f)))},!0),n.add_event("keydown",function(u){if(r()){if(u.which!==13&&u.which!==32)return;u.stopImmediatePropagation();u.preventDefault();var f=t._getFeedbackClickEnabled();i.menuOpen=t._menuClickOpen=!f;i.startFeedbackTask(n,1,f)}},!0),n.add_event("mouseover",function(u){if(r()){u.stopImmediatePropagation();u.preventDefault();i.menuOpen=!0;var f=t._getFeedbackClickEnabled();t._menuClickOpen=!f;f||i.startFeedbackTask(n,1,f)}},!0),n.add_event("mouseout",function(n){r()&&(n.stopImmediatePropagation(),n.preventDefault(),t._menuClickOpen||(i.menuOpen=!1),i.hideMenu())},!0),u.testHooksEnabled&&n.set_attr("data-tag","Feedback.Handler.Attached"))},t.prototype._postToLocalFeedback=function(n,t,i){var r={},u;r["Content-Type"]="application/json";u={queryParameters:i,headers:r};wt.doPost(n,JSON.stringify(t),u)},t.prototype.GUID=function(){for(var n=[],t=0;t<=8;t++)n.push(((1+Math.random())*65536|0).toString(16).substring(1).toLowerCase());return n.join("")},t.prototype._postToSurf=function(n,t,i,r){wt.doPost(w.surfApiEndpointV2,JSON.stringify(n),r)},t.prototype._canvasToBase64=function(n,t){var i=this;return new Promise(function(r){var f=function(n){var t=new FileReader;return t.readAsDataURL(n),new Promise(function(n){t.onloadend=function(){n(t.result)};t.onerror=function(){i._canvasScreenshotDebugLog+="FileReader raised error during Blob to base64 conversion;";n("")}})},u=i._map.getAzureMap();u._getMap().triggerRepaint();u.events.addOnce("render",function(){var u=document.getElementsByClassName("maplibregl-canvas");u.length===1?u[0].toBlob(function(n){n?f(n).then(function(n){return r(n)}):(i._canvasScreenshotDebugLog+="Canvas.Toblob() returned empty/null blob;",r(""))},n,t):(i._canvasScreenshotDebugLog+="Number of CanvasElement: ".concat(u.length,". Should be just 1;"),r(""))})})},t.prototype.takeScreenShot=function(){var n=this;return this._canvasScreenshotDebugLog="",new Promise(function(t){u.isMobile&&(n._canvasScreenshotDebugLog+="Mobile device;",t(""));n._canvasToBase64("image/webp",.1).then(function(i){var r=Feedback.PackageLoad.GetHTML();if(i){var o='class="maplibregl-canvas ',s="<canvas ".concat(o),f="><\/canvas>",e=r.indexOf(s),u=r.indexOf(f,e);e>-1&&u>-1?(r=r.replace(s,'<img src="'.concat(i,'" ').concat(o)),u=r.indexOf(f,e),r=r.slice(0,u)+r.slice(u).replace(f,">"),n._canvasScreenshotDebugLog+="Successfully replaced canvas with img. If missing in screenshot look in html."):n._canvasScreenshotDebugLog+="Replacement tag were missing in outerHTML;"}else n._canvasScreenshotDebugLog+="Missing base64 image;";t(r)})})},t.prototype.setScreenShot=function(n){this._screenShotHtml="";n?this._screenShotHtml=n:(this._canvasScreenshotDebugLog+="Canvas screenshot not requested;",u.isMobile||(this._screenShotHtml=Feedback.PackageLoad.GetHTML()))},t.prototype.logEntryTime=function(){u.isMapsVertical&&(this._timeSpentBeforeFeedback=performance.now())},t.prototype.generateReproUrl=function(){var n=this;this._permalink.getGeneralPermalink(this._map,function(t){n._reproUrl=t.permalink},function(){return n._reproUrl=""},"Feedback")},t.prototype._getFeedbackClickEnabled=function(){var n=this.getActiveTask();return n&&n.getReportType?n.getReportType()!==4:!0},t.prototype.clickFeedbackButtonInCLPDashboard=function(){var n=document.getElementById("clpFeedback-button");n&&n.click()},t.prototype._cleanupHTML=function(n){var t,i;return n&&(t=location.hostname,t==="localhost"&&(i="www.bing.com",n=n.replaceAll("//".concat(t,"/"),"//".concat(i,"/")),t=i),n=n.replaceAll("url(/","url(https://".concat(t,"/")).replaceAll("url(&quot;/","url(&quot;https://".concat(t,"/")).replaceAll('href="/','href="https://'.concat(t,"/")).replaceAll('src="/','src="https://'.concat(t,"/")).replaceAll("https://".concat(t,"//"),"https://")),n},t}(),rt;(function(n){function i(n,i,r){var e,u,f;r||(r="");e=[];switch(n){case 3:u=t.L_Fdbk_Option_DidNotFind;u=u.replace("{0}",r);f=t.L_Fdbk_Option_IssueWithSearchResult;f=f.replace("{0}",r);e=i===6?[{text:t.FdbkSelectArea,value:0},{text:u,value:3},{text:t.FdbkAreaMap,value:1},{text:t.FdbkNotMyLocale,value:2},{text:t.L_Fdbk_Other,value:7}]:[{text:t.FdbkSelectArea,value:0},{text:u,value:3},{text:f,value:4},{text:t.FdbkAreaMap,value:1},{text:t.FdbkNotMyLocale,value:2},{text:t.L_Fdbk_Other,value:7}];break;case 5:e=[{text:t.FdbkSelectArea,value:0},{text:t.FdbkAreaDirections,value:5},{text:t.FdbkAreaMap,value:1},{text:t.FdbkNotMyLocale,value:2},{text:t.L_Fdbk_Other,value:7}];break;case 7:u=t.L_Fdbk_Option_DidNotFind;u=u.replace("{0}",r);f=t.FdbkAreaRealEstate;f=f.replace("{0}",r);e=[{text:t.FdbkSelectArea,value:0},{text:u,value:3},{text:f,value:6},{text:t.FdbkAreaMap,value:1},{text:t.FdbkNotMyLocale,value:2},{text:t.L_Fdbk_Other,value:7}];break;default:e=[{text:t.FdbkSelectArea,value:0},{text:t.FdbkAreaMap,value:1},{text:t.FdbkNotMyLocale,value:2},{text:t.L_Fdbk_Other,value:7}]}return e}function r(n,i){var u,r;return i||(i=""),u={text:t.FdbkSelectArea,value:0},n===5?u={text:t.FdbkAreaDirections,value:5}:n===3||n===6?(r=t.L_Fdbk_Option_DidNotFind,r=r.replace("{0}",i),u={text:r,value:3}):n===7?(r=t.FdbkAreaRealEstate,r=r.replace("{0}",i),u={text:r,value:6}):n===8&&(u={text:t.FdbkAreaMap,value:1}),u}function u(n,i,r){var u=[];switch(n){case 1:u=[{text:t.L_Fdbk_SelectProblem,value:0},{text:t.FdbkPostcodeLabel,value:5},{text:t.L_Fdbk_ProblemAdministrativeDistricts,value:10},{text:t.FdbkProblemSatelliteBE,value:6},{text:t.L_Fdbk_ProblemAirport,value:7},{text:t.L_Fdbk_ProblemBridge,value:8},{text:t.L_Fdbk_ProblemCity,value:9},{text:t.TerrainProblemType,value:13},{text:t.FdbkProblemMapDisplay,value:2},{text:t.L_Fdbk_ProblemNeighborhood,value:16},{text:t.L_Fdbk_ProblemRoad,value:1},{text:t.FdbkProblemRoadView,value:14},{text:t.L_Fdbk_ProblemWater,value:15},{text:t.FdbkProblemZoom,value:3},];r&&r.keywords&&r.keywords.length&&(r.keywords.indexOf("flyOver")>-1?u.push({text:t.FdbkProblemFlyover,value:11}):r.keywords.indexOf("3dlandmarks")>-1?u.push({text:t.FdbkLandmarks,value:12}):(w===null||w===void 0?void 0:w.enableStreetsideFdbk)&&r.keywords.indexOf("Streetside")>-1&&u.push({text:t.StreetsideMapStyle,value:34}));break;case 3:u=[{text:t.L_Fdbk_SelectProblem,value:0},{text:t.FdbkProblemLookAddress,value:30},{text:t.FdbkProblemLookBusiness,value:28},{text:t.FdbkProblemLookPlace,value:29},];break;case 4:u=i===2||i===3?[{text:t.L_Fdbk_SelectProblem,value:0},{text:t.L_Fdbk_locationIncorrect,value:25},{text:t.L_Fdbk_AddressMissing,value:31},{text:t.L_Fdbk_AddressLocationIncorrect,value:32},{text:t.L_Fdbk_AddressSideIncorrect,value:33},{text:t.L_Fdbk_AddressZipIncorrect,value:27},{text:t.L_Fdbk_Other,value:35},]:[{text:t.L_Fdbk_SelectProblem,value:0},{text:t.L_Fdbk_locationIncorrect,value:25},{text:t.L_Fdbk_nameIncorrect,value:26},{text:t.L_Fdbk_AddressZipIncorrect,value:27},{text:t.L_Fdbk_Other,value:35},];break;case 7:default:u=i===10?[{text:t.L_Fdbk_SelectProblem,value:0},{text:t.FdbkProblemTraffic,value:17},{text:t.FdbkProblemAccessibility,value:19},{text:t.FdbkProblemLocalGuide,value:20},{text:t.FdbkProblemMeasure,value:21},]:i===11?[{text:t.L_Fdbk_SelectProblem,value:0},{text:t.FdbkProblemTraffic,value:17},{text:t.FdbkProblemMyPlaces,value:18},{text:t.FdbkProblemAccessibility,value:19},{text:t.FdbkProblemMeasure,value:21},]:[{text:t.L_Fdbk_SelectProblem,value:0},{text:t.FdbkProblemTraffic,value:17},{text:t.FdbkProblemAccessibility,value:19},{text:t.FdbkProblemMeasure,value:21},]}return u}function f(n){if(n){if(n===11)return{text:t.FdbkProblemFlyover,value:11};if(n===12)return{text:t.FdbkLandmarks,value:12};if(n===34)return{text:t.StreetsideMapStyle,value:34}}return{text:t.FdbkSelectArea,value:0}}function o(n,i){var u=[],r,f;if(i){for(u.push({text:t.L_Fdbk_SelectProblem,value:0}),r=0;r<n.length;r++)f=n[r].name?n[r].name:n[r].address,f&&u.push({text:e._formatString(t.L_Fdbk_LocationInDirectionsIncorrect,f),value:10+r});u.push({text:t.L_Fdbk_IncorrectTimesTransit,value:4});u.push({text:t.FdbkDirectionIncorrect,value:3});u.push({text:t.FdbkDirectionRoadClose,value:7})}else{for(u.push({text:t.L_Fdbk_SelectProblem,value:0}),r=0;r<n.length;r++)f=n[r].name?n[r].name:n[r].address,f&&u.push({text:e._formatString(t.L_Fdbk_LocationInDirectionsIncorrect,f),value:10+r});u.push({text:t.FdbkDirectionIncorrect,value:1});u.push({text:t.FdbkDirectionRoadClose,value:7});u.push({text:t.FdbkRouteTime,value:6})}return u}function s(){return{text:t.L_Fdbk_SelectProblem,value:0}}function h(n){var i=[];switch(n){case 1:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_RoadNameIncorrect,value:34},{text:t.L_Fdbk_RoadRemove,value:35},{text:t.L_Fdbk_RoadLocationIncorrect,value:36},{text:t.L_Fdbk_RoadMissing,value:37},{text:t.L_Fdbk_RoadClosed,value:38},{text:t.L_Fdbk_RoadTypeIncorrect,value:39},{text:t.L_Fdbk_RoadOneWay,value:40},{text:t.L_Fdbk_RoadTwoWay,value:41},{text:t.L_Fdbk_RoadOneWayOpposite,value:42},{text:t.L_Fdbk_Other,value:59});break;case 4:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_AddressMissing,value:4},{text:t.L_Fdbk_AddressLocationIncorrect,value:3},{text:t.L_Fdbk_AddressSideIncorrect,value:5},{text:t.L_Fdbk_AddressZipIncorrect,value:1},{text:t.L_Fdbk_AddressZipMissing,value:2},{text:t.L_Fdbk_Other,value:59});break;case 5:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_AddressZipIncorrect,value:1},{text:t.L_Fdbk_AddressZipMissing,value:2},{text:t.L_Fdbk_Other,value:59});break;case 9:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_CityNameIncorrect,value:18},{text:t.L_Fdbk_CityLocationIncorrect,value:19},{text:t.L_Fdbk_CityMissing,value:17},{text:t.L_Fdbk_CityNeighborhood,value:20},{text:t.L_Fdbk_Other,value:59});break;case 16:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_NeighborhoodNameIncorrect,value:32},{text:t.L_Fdbk_NeighborhoodLocationIncorrect,value:31},{text:t.L_Fdbk_NeighborhoodMissing,value:30},{text:t.L_Fdbk_NeighborhoodCity,value:33},{text:t.L_Fdbk_Other,value:59});break;case 10:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.FdbkSubProbPolitic,value:21},{text:t.FdbkSubProbBoundaryIncorrect,value:55},{text:t.FdbkSubProbBoundaryVisible,value:22},{text:t.L_Fdbk_AdminDistrictsEntityMissing,value:24},{text:t.L_Fdbk_AdminDistrictsWrongEntity,value:23},{text:t.L_Fdbk_AdminDistrictsCountryName,value:25},{text:t.L_Fdbk_AdminDistrictsStateName,value:25},{text:t.L_Fdbk_AdminDistrictsCountyName,value:25},{text:t.L_Fdbk_Other,value:59});break;case 13:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_LandFeatureNameIncorrect,value:29},{text:t.L_Fdbk_LandTypeIncorrect,value:28},{text:t.L_Fdbk_LandFeatureMissing,value:26},{text:t.L_Fdbk_LandLocationIncorrect,value:27},{text:t.L_Fdbk_Other,value:59});break;case 15:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_WaterMissing,value:45},{text:t.L_Fdbk_WaterLocationIncorrect,value:44},{text:t.L_Fdbk_WaterNameIncorrect,value:43},{text:t.L_Fdbk_WaterTypeIncorrect,value:46},{text:t.L_Fdbk_Other,value:59});break;case 8:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_BridgeClosed,value:12},{text:t.L_Fdbk_BridgeNameIncorrect,value:14},{text:t.L_Fdbk_BridgeMissing,value:15},{text:t.L_Fdbk_BridgeRemoved,value:16},{text:t.L_Fdbk_BridgeLocationIncorrect,value:13},{text:t.L_Fdbk_Other,value:59});break;case 7:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_AirportIncorrect,value:9},{text:t.L_Fdbk_AirportMissing,value:10},{text:t.L_Fdbk_AirportWrongLocation,value:11},{text:t.L_Fdbk_Other,value:59});break;case 6:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_ImageryOutOfDate,value:8},{text:t.L_Fdbk_ImageryBlurry,value:6},{text:t.L_Fdbk_ImageryRoadMismatch,value:7},{text:t.L_Fdbk_Other,value:59});break;case 18:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.FdbkSubProbCollections,value:52},{text:t.FdbkSubProbFavorites,value:51},{text:t.FdbkSubProbHomeWork,value:50},{text:t.FdbkSubProbItineraries,value:53});break;case 34:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_ImageryOutOfDate,value:8},{text:t.L_Fdbk_ImageryBlurry,value:6},{text:t.ImageryTooDark,value:56},{text:t.ImageryOverexposed,value:57},{text:t.ReportAProblem,value:58});break;default:i.push({text:t.L_Fdbk_SelectSubProblem,value:0},{text:t.L_Fdbk_Other,value:59})}return i}function c(n){var t="driving";return n===2?t="transit":n>=3&&(t="walking"),t}function l(n){return n==="arrival"?"arrival":"departure"}n.buildScenarioDropDown=i;n.defaultScenario=r;n.buildProblemType=u;n.setDefaultProblemType=f;n.buildDirectionsIssues=o;n.defaultDirectionsIssue=s;n.buildSubProblemDropDownItems=h;n.GetDirectionsMode=c;n.GetDirectionsTimeType=l})(rt||(rt={})),function(n){function o(n){var t=!1;switch(n){case 4:case 1:case 3:case 7:t=!0}return t}function s(n){var t=!1;switch(n){case 30:case 10:case 7:case 8:case 9:case 6:case 13:case 18:case 16:case 1:case 15:case 5:case 4:case 34:t=!0}return t}var u,f,i,t,r,e;n.formField=(u={},u[5]="Problem with Directions",u[4]="Problem with Search",u[3]="Problem with Search",u[6]="Problem with Real Estate",u[1]="Problem on Map",u[2]="Problem on Map",u[7]="Problem on Map",u[0]="Problem on Map",u);n.scenarioField=(f={},f[5]="Directions",f[4]="Search issue found",f[3]="No Search Results Found",f[6]="Real estate issue",f[1]="Map",f[2]="User Location incorrect",f[7]="Something Else",f[0]="No problem selected",f);n.issueEntityType=(i={},i[1]="Road",i[30]="Address",i[10]="Admininistrative district",i[7]="Airport",i[8]="Bridge",i[28]="Issue with Business",i[9]="City",i[13]="Landform",i[16]="Neighborhood",i[15]="Waterbody",i[19]="Accessibility and Performance",i[11]="Flyover",i[12]="3d Landmarks",i[34]="Streetside",i[22]="My Contributions",i[6]="Imagery",i[25]="Did not find Location",i[26]="Did not find business",i[27]="Did not find post code",i[24]="UX Language is incorrect",i[20]="Issue with Local Guide",i[4]="Address on the map is incorrect",i[5]="Postal code on the map is incorrect",i[2]="Map displaying incorrectly (e.g. overlapping, all white, etc.)",i[21]="Measure function is faulty",i[18]="My Places issue",i[29]="Search issue with a Place",i[23]="Issue with Print or Share",i[14]="Road view or Dark Road view",i[17]="Issue with Traffic",i[3]="Issue with Map Zoom",i[35]="Something else",i[0]="No problem selected",i);n.issueType=(t={},t[21]="A political entity is missing or incorrect (country/region, state/province, county etc.)",t[23]="Political entity is wrong type",t[25]="Incorrect or missing name for (country/region, state/province, county etc.)",t[22]="The boundary between countries, states, or provinces is hard to see",t[55]="The boundary between countries, states, or provinces is wrong or missing",t[24]="A political entity is missing",t[4]="Address is missing from road",t[3]="Address is in wrong location",t[5]="Address is on the wrong side of the road",t[11]="Airport in wrong location",t[9]="Airport has incorrect or missing name",t[10]="Airport is missing",t[12]="Bridge is closed",t[14]="Bridge name is incorrect or missing",t[15]="Bridge is missing",t[16]="Bridge needs to be removed",t[13]="Bridge is in wrong location",t[18]="City name is incorrect",t[19]="City location is incorrect",t[17]="City is missing",t[20]="City should be neighborhood",t[8]="Imagery is out of date",t[6]="Imagery is cloudy or blurry",t[7]="Imagery and roads do not match",t[57]="Imagery is over exposed",t[56]="Imagery is too dark",t[29]="Name of land feature is incorrect",t[28]="Land feature is wrong type (forest should be a desert etc.)",t[26]="Land feature is missing",t[27]="Land feature is the wrong location",t[49]="Did not find address",t[47]="Did not find business",t[48]="Did not find place",t[52]="Did not find collection",t[51]="Did not find favorite",t[50]="Problem with Home or Work",t[53]="Problem with saved itinerary",t[32]="Neighborhood name is incorrect",t[31]="Neighborhood location is incorrect",t[30]="Neighborhood is missing",t[33]="Neighborhood should be city",t[1]="Postal code has incorrect zip code",t[2]="Postal code is missing",t[34]="Road name is incorrect or missing",t[35]="Road needs to be removed",t[36]="Road location is incorrect",t[37]="Road is missing",t[38]="Road is closed",t[39]="Road type is incorrect (highway or street)",t[40]="Road should be one way",t[41]="Road should be two ways",t[42]="Road is one way in the wrong direction",t[45]="Water body is missing",t[44]="Water body is in an incorrect location",t[43]="Water body has incorrect name",t[46]="Incorrect type of water body (ocean should be sea etc.)",t[59]="Something else",t[0]="No subproblem selected",t);n.directionsIssue=(r={},r[1]="Inaccurate Directions or could be better",r[3]="A better transit route that is not shown",r[4]="Incorrect times for transit services",r[5]="Incorrect location of a transit stop",r[6]="Incorrect time for driving route",r[7]="Route has a closed road that was not indicated",r[10]="Inaccurate location origin/destination",r[2]="Something else",r[0]="No issue selected",r);n.noResultType=(e={},e[1]="Address",e[3]="Place",e[2]="Business",e[4]="Other",e[0]="",e);n.hasProblemFoundType=o;n.hasSubProblem=s}(ot||(ot={}));var ho=function(n){function i(i,r){var u=n.call(this)||this,e,f,o,h;for(u.stepChanged=new s,u.resources=t,u._panelViewModel=r,e=u._privates,e.defineProperty("directionsIssueStep",function(){return u._directionStepsChanged()}),e.defineProperty("commentsDirectionsStep"),u.directionsSteps=[{text:t.L_Fdbk_SelectSubProblem,value:""}],f=0,o=i;f<o.length;f++)h=o[f],u.directionsSteps.push({text:h,value:h});return u.setDirectionsIssueStep({text:t.L_Fdbk_SelectSubProblem,value:""}),u}return v(i,n),i.prototype._directionStepsChanged=function(){var n=this.getDirectionsIssueStep().value;n.length>0&&this.stepChanged.invoke()},i}(bt),co=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r.bucket="353",r}return v(t,n),t.prototype.isDragEnabled=function(){return!0},t.prototype.isTapEnabled=function(){return!1},t.prototype.isMoveInertiaEnabled=function(){return!1},t.prototype.isHoverEnabled=function(){return!0},t.prototype.getLocation=function(){return n.prototype.getLocation.call(this)},t.prototype.setLocation=function(t){n.prototype.setLocation.call(this,t)},t}(pi),lo=function(i){function f(n,r,f,e){var o=i.call(this,n,ce,r,e)||this,s,h;return o.feedbackType=f,o.newFeedbackInputHeader=t.L_Fdbk_GeneralCardInputHeader,o.newFeedbackTextWatermark=t.L_Fdbk_GeneralCardTextWatermark,o.isMobile=u.isMobile,o.emailDisplay=w.emailEnabled?"":"none",o.emailLabel=t.L_Fdbk_Email,o.privacyPolicyLinkDisplay=w.emailEnabled?"":"none",o.privacyPolicyLink=w.privacyPolicyLink,o.overallRating=-1,o._timeout=250,o.lastVdpid="",o.isPositionClicked=!1,s=o._privates,s.defineProperty("showFeedbackHeader"),s.defineProperty("showGeneralFeedbackPanel"),s.defineProperty("showProblemOnMapPanel"),s.defineProperty("showThankYouPanel"),s.defineProperty("showVectorFeedbackPrompt"),s.defineProperty("showPushpinMessage"),s.defineProperty("showEntityName"),s.defineProperty("problemType",o._onProblemTypeChanged),s.defineProperty("subProblemType",o._onSubProblemTypeChanged),s.defineProperty("unHappySelected",null,null,{defaultValue:!1}),s.defineProperty("happySelected",null,null,{defaultValue:!1}),s.defineProperty("showAddressInput",null,null,{defaultValue:!1}),s.defineProperty("showPostcodeInput",null,null,{defaultValue:!1}),s.defineProperty("addressGhostText",null,null,{defaultValue:t.FdbkStreetGhost}),s.defineProperty("userAddress",null,null,{defaultValue:""}),s.defineProperty("userPostcode",null,null,{defaultValue:""}),s.defineProperty("entityName",null,null,{defaultValue:""}),o._prePopulateProblemDropdowns(),o.setShowFeedbackHeader(!1),o.setShowGeneralFeedbackPanel(f!==2),o.setShowProblemOnMapPanel(f===2),o.setShowThankYouPanel(!1),o.setShowMessagePanel(!1),o.setShowVectorFeedbackPrompt(!1),o.setShowPushpinMessage(!0),o.setReminderMessage(""),w.vectorFeedbackEnabled&&(o.setShowVectorFeedbackPrompt(!0),o.setShowPushpinMessage(!1),h=o._map.getAzureMap().getCanvasContainer(),h.style.cursor="pointer",vt.add(o._map.getAzureMap(),"click",function(n){o._handleVectorClick(n)}),o._map.onTransformRequest.add(o._modifyUrl)),o}return v(f,i),f.prototype.dispose=function(){if(w.vectorFeedbackEnabled){var n=this._map.getAzureMap().getCanvasContainer();n.style.cursor="grab";this._map.onTransformRequest.remove(this._modifyUrl)}window.clearTimeout(this._timeoutHdl);this._disposeSelection();i.prototype.dispose.call(this)},f.prototype._modifyUrl=function(n){n.resourceType==="Tile"&&(n.url+="&features=mvtNoIdFilter")},f.prototype._usePoi=function(n){var t=n,i=!1;return t.properties.type?t.properties.type==="plain"&&t.geometry.type==="MultiPolygon"||t.properties.type==="land_area"?i=!0:t.geometry.type==="Point"?i=!0:t.geometry.type==="MultiLineString"&&t.properties.type!=="river"&&(i=!0):i=!0,i},f.prototype._showSelection=function(n,t){if(this._map)if(this._usePoi(n))this.showMarker(!0,t.position);else{this.showMarker(!1);var i=this._map.getAzureMap()._getMap();i.addSource(f.vectorSourceId,{type:"geojson",data:{type:"Feature",geometry:{type:n.geometry.type,coordinates:n.geometry.coordinates}}});i.addLayer({id:f.vectorLayerId,type:"fill",source:f.vectorSourceId,layout:{},paint:{"fill-color":"#0080ff","fill-opacity":.5}})}},f.prototype._getVectorInfo=function(n){var f,t={},o,i,s,u,r,e;return((f=n.shapes)===null||f===void 0?void 0:f.length)>0&&(o=n.shapes[0],i=o,i&&(s=i.sourceLayer,t=i.properties||{},u=i._vectorFileFeature,u&&(r=u._keys,e=u._values,r&&(r.indexOf("name")===-1||"name"in t||(t.name=e[r.indexOf("name")]),r.indexOf("id")===-1||"id"in t||(t.id=e[r.indexOf("id")]))),t.type=s,this._disposeSelection(),this._showSelection(i,n))),t},f.prototype._disposeSelection=function(){if(this._map){var n=this._map.getAzureMap()._getMap();n.getSource(f.vectorSourceId)&&(n.removeLayer(f.vectorLayerId),n.removeSource(f.vectorSourceId))}},f.prototype._handleVectorClick=function(n){var t=this._getVectorInfo(n),i=t===null||t===void 0?void 0:t.name,r;typeof i=="string"?this.setEntityName(i):this.setEntityName(null);this.lastPosition=n.position;Object.keys(t).length!==0?(this.lastVdpid=t.id?t.id.toString():"",this._changeProblemType(t.type),this.isPositionClicked=!0):this.lastVdpid="";this._map&&(r=this._map.getAzureMap().getCanvasContainer(),r.style.cursor="pointer");this.setShowVectorFeedbackPrompt(!1);this.setShowProblemOnMapPanel(!0)},f.prototype.onOverallHappyButtonClick=function(n){this._onOverallButtonClick(n,1)},f.prototype.onOverallUnhappyButtonClick=function(n){this._onOverallButtonClick(n,0)},f.prototype._onOverallButtonClick=function(n,t){n.preventDefault();var i=t?this._getOverallHappyButton():this._getOverallUnhappyButton(),r=t?this._getOverallUnhappyButton():this._getOverallHappyButton();this.overallRating===t?(i.remove_class("overallSelected"),this._setHappyButtonsState(-1),this.overallRating=-1):(i.add_class("overallSelected"),r.remove_class("overallSelected"),this._setHappyButtonsState(t),this.overallRating=t)},f.prototype._setHappyButtonsState=function(n){n===-1?(this.setHappySelected(!1),this.setUnHappySelected(!1)):n===0?(this.getUnHappySelected()||this.setUnHappySelected(!0),this.setHappySelected(!1)):n===1&&(this.getHappySelected()||this.setHappySelected(!0),this.setUnHappySelected(!1))},f.prototype.onGeneralFeedbackSendClick=function(n){var i,r,u;if(n.preventDefault(),this.overallRating===-1&&this.commentsGeneral.length===0){this._showMessagePanel(!0,t.L_Fdbk_GeneralFeedback_Reminder);y.log("FB","S",{FT:"G",SR:"RI"});return}i="Suggestion";this.overallRating===1?i="SAT":this.overallRating===0&&(i="DSAT");r=this._baseFeedbackData();u=gt(gt({},r),{FORM:"General",FeedbackType:i,EntryPoint:fi.feedbackEntryPointToString(this.feedbackTask.getEntryPoint()),Scenario:"General",UserComment:this.commentsGeneral,Issue:this._createKeywords("Feedback"),alias:this.email,send_mail:!0});this.feedbackTask.sendSurfFeedback(u,"","");this.setShowGeneralFeedbackPanel(!1);this.setShowMessagePanel(!1);this.setShowThankYouPanel(!0);this._focusInThankYouPanel();this.isSubmitted=!0;y.log("FB","S",{FT:"G",SR:"SM"})},f.prototype.onProblemOnMapSendClick=function(n){n.preventDefault();var u=this.getProblemType().value,i=this.getSubProblemType().value,f=t.FdbkAddressErrorWithPin,r=!1;if(u!==0&&this.commentsBaseMap.length!==0&&(this._markerMoved||w.vectorFeedbackEnabled)?u===2?i===0?(this._showMessagePanel(!0,f),r=!0):(i===10||i===11)&&this.getUserAddress().length===0&&(this._showMessagePanel(!0,f),r=!0):u===1&&i===1&&this.getUserAddress().length===0&&(this._showMessagePanel(!0,f),r=!0):(this._showMessagePanel(!0,f),r=!0),r){y.log("FB","S",{FT:"B",SR:"RI"});return}var e=this.getShowPostcodeInput(),o=this._baseFeedbackData(),s=gt(gt({},o),{FORM:"Problem on Map",FeedbackType:"DSAT",EntryPoint:fi.feedbackEntryPointToString(this.feedbackTask.getEntryPoint()),Scenario:"Map",IssueEntity:{GeoLocation:this._createGeoLocation(this.lastPosition),ReverseGeocodeAddress:{AddressLine:""}},IssueEntityType:fi.GetStargateIssueEntityType(u),Issue:fi.GetStargateSubProblemValue(i),UserProvidedAddress:e?this.getUserAddress():null,UserProvidedPostcode:this.getUserPostcode(),UserProvidedStreetname:e?null:this.getUserAddress(),UserComment:this.commentsBaseMap,IsPushpinMoved:this._markerMoved});this.feedbackTask.sendSurfFeedback(s,"Maps.Basemap","Basemap");this.isSubmitted=!0;y.log("FB","S",{FT:"B",SR:"SM"});this.setShowProblemOnMapPanel(!1);this.setShowMessagePanel(!1);this.setShowThankYouPanel(!0);this._map.onTransformRequest.remove(this._modifyUrl);this._focusInThankYouPanel();this.showMarker(!1)},f.prototype.onClearError=function(n){i.prototype.onClearError.call(this,n)},f.prototype.onFeedbackDoneClick=function(t){t.preventDefault();window.clearTimeout(this._timeoutHdl);r.invokeHandler("data-task",{action:"removeStackForTask",id:this.feedbackTask.id});u.isMobile&&n("#feedbackWrapper").add_class("collapsed")},f.prototype.onReportAProblemOnMapClick=function(n){this._switchPanel(n,2);this.showMarker()},f.prototype.onSendGeneralFeedbackClick=function(n){this._switchPanel(n,1);this.showMarker(!1)},f.prototype._switchPanel=function(n,i){n.preventDefault();this._showMessagePanel(!1);this.feedbackType=i;i===2?(this.setShowGeneralFeedbackPanel(!1),this.setShowProblemOnMapPanel(!0),this.feedbackTask.setTitle(t.L_Fdbk_ReportAProblem)):(this.setShowProblemOnMapPanel(!1),this.setShowGeneralFeedbackPanel(!0),this.feedbackTask.setTitle(t.L_Fdbk_GeneralFeedback));this.setFocusToDefaultElement();y.log("FB","C",{FT:y.getFeedbackTypeLogValue(i)})},f.prototype._createKeywords=function(n){return n+";"+(this.overallRating!==-1?"OVERALL-"+this.overallRating.toString()+";":"")},f.prototype.getDefaultFocusElement=function(){var n,t;return this.feedbackType===2&&(n=this._getElementObj(".feedbackCardInputDiv.problemSelect"),n&&n.length&&(t=n.select(".selectControl"),t&&t.length))?t.select(".popOutButton.dropdownBtn"):this._getOverallHappyButton()},f.prototype.getFeedbackTitle=function(n){return n?t.L_Fdbk_SendGeneralFeedback:t.L_Fdbk_ReportAProblem},f.prototype._getOverallHappyButton=function(){return this._getElementObj(".happyButton")},f.prototype._getOverallUnhappyButton=function(){return this._getElementObj(".unhappyButton")},f.prototype._getElementObj=function(n){return this.getControl().select(n)},f.prototype.hasInput=function(n){var t=this.getProblemType(),i=this.getSubProblemType();return n===2?t&&t.value!==0||i&&i.value!==0||this.commentsBaseMap.length!==0:this.overallRating!==-1||this.commentsGeneral.length!==0},f.prototype._changeProblemType=function(n){var i,r;if(n){r=n.toString();switch(r){case"road":i={text:t.L_Fdbk_ProblemRoad,value:1};break;case"address":i={text:t.L_Fdbk_ProblemAddress,value:2};break;case"populated_place":i={text:t.L_Fdbk_ProblemCity,value:3};break;case"neighborhood":i={text:t.L_Fdbk_ProblemNeighborhood,value:4};break;case"indigenous_peoples_reserve":case"admin_division1":i={text:t.L_Fdbk_ProblemAdministrativeDistricts,value:5};break;case"land":case"park":case"plain":case"land_area":i={text:t.TerrainProblemType,value:6};break;case"river":case"ocean":case"bay":case"lake":i={text:t.L_Fdbk_ProblemWater,value:7};break;case"bridge":i={text:t.L_Fdbk_ProblemBridge,value:8};break;case"airport":i={text:t.L_Fdbk_ProblemAirport,value:9};break;case"imagery":i={text:t.L_Fdbk_ProblemImagery,value:12};break;default:i={text:t.L_Fdbk_Other,value:13}}}else i={text:t.L_Fdbk_Other,value:13};this.setProblemType(i)},f.prototype._prePopulateProblemDropdowns=function(){this.problemTypes=[{text:t.L_Fdbk_SelectProblem,value:0},{text:t.L_Fdbk_ProblemRoad,value:1},{text:t.L_Fdbk_ProblemAddress,value:2},{text:t.L_Fdbk_ProblemCity,value:3},{text:t.L_Fdbk_ProblemNeighborhood,value:4},{text:t.L_Fdbk_ProblemAdministrativeDistricts,value:5},{text:t.TerrainProblemType,value:6},{text:t.L_Fdbk_ProblemWater,value:7},{text:t.L_Fdbk_ProblemBridge,value:8},{text:t.L_Fdbk_ProblemAirport,value:9},{text:t.L_Fdbk_ProblemImagery,value:12},{text:t.L_Fdbk_Other,value:13}];this.subProblemTypes=new oi([]);this.setProblemType({text:t.L_Fdbk_SelectProblem,value:0});this.setSubProblemType({text:t.L_Fdbk_SelectSubProblem,value:0})},f.prototype._onProblemTypeChanged=function(n,i){if(i){this.subProblemTypes.clear();var r=[];this.setSubProblemType({text:t.L_Fdbk_SelectSubProblem,value:0});switch(i.value){case 1:r.push({text:t.L_Fdbk_RoadNameIncorrect,value:1},{text:t.L_Fdbk_RoadRemove,value:2},{text:t.L_Fdbk_RoadLocationIncorrect,value:3},{text:t.L_Fdbk_RoadMissing,value:4},{text:t.L_Fdbk_RoadClosed,value:5},{text:t.L_Fdbk_RoadTypeIncorrect,value:6},{text:t.L_Fdbk_RoadOneWay,value:7},{text:t.L_Fdbk_RoadTwoWay,value:8},{text:t.L_Fdbk_RoadOneWayOpposite,value:9},{text:t.L_Fdbk_Other,value:54});break;case 2:r.push({text:t.L_Fdbk_AddressMissing,value:10},{text:t.L_Fdbk_AddressLocationIncorrect,value:11},{text:t.L_Fdbk_AddressSideIncorrect,value:12},{text:t.L_Fdbk_AddressZipIncorrect,value:13},{text:t.L_Fdbk_AddressZipMissing,value:14},{text:t.L_Fdbk_Other,value:54});break;case 3:r.push({text:t.L_Fdbk_CityNameIncorrect,value:15},{text:t.L_Fdbk_CityLocationIncorrect,value:16},{text:t.L_Fdbk_CityMissing,value:17},{text:t.L_Fdbk_CityNeighborhood,value:18},{text:t.L_Fdbk_Other,value:54});break;case 4:r.push({text:t.L_Fdbk_NeighborhoodNameIncorrect,value:19},{text:t.L_Fdbk_NeighborhoodLocationIncorrect,value:20},{text:t.L_Fdbk_NeighborhoodMissing,value:21},{text:t.L_Fdbk_NeighborhoodCity,value:22},{text:t.L_Fdbk_Other,value:54});break;case 5:r.push({text:t.L_Fdbk_AdminDistrictsCountryBoundary,value:23},{text:t.L_Fdbk_AdminDistrictsStateBoundary,value:24},{text:t.L_Fdbk_AdminDistrictsCountyBoundary,value:25},{text:t.L_Fdbk_AdminDistrictsEntityMissing,value:26},{text:t.L_Fdbk_AdminDistrictsWrongEntity,value:27},{text:t.L_Fdbk_AdminDistrictsCountryName,value:28},{text:t.L_Fdbk_AdminDistrictsStateName,value:29},{text:t.L_Fdbk_AdminDistrictsCountyName,value:30},{text:t.L_Fdbk_Other,value:54});break;case 6:r.push({text:t.L_Fdbk_LandFeatureNameIncorrect,value:31},{text:t.L_Fdbk_LandTypeIncorrect,value:32},{text:t.L_Fdbk_LandFeatureMissing,value:33},{text:t.L_Fdbk_LandLocationIncorrect,value:34},{text:t.L_Fdbk_Other,value:54});break;case 7:r.push({text:t.L_Fdbk_WaterMissing,value:35},{text:t.L_Fdbk_WaterLocationIncorrect,value:36},{text:t.L_Fdbk_WaterNameIncorrect,value:37},{text:t.L_Fdbk_WaterTypeIncorrect,value:38},{text:t.L_Fdbk_Other,value:54});break;case 8:r.push({text:t.L_Fdbk_BridgeClosed,value:39},{text:t.L_Fdbk_BridgeNameIncorrect,value:40},{text:t.L_Fdbk_BridgeMissing,value:41},{text:t.L_Fdbk_BridgeRemoved,value:42},{text:t.L_Fdbk_BridgeLocationIncorrect,value:43},{text:t.L_Fdbk_Other,value:54});break;case 9:r.push({text:t.L_Fdbk_AirportIncorrect,value:45},{text:t.L_Fdbk_AirportMissing,value:46},{text:t.L_Fdbk_AirportWrongLocation,value:44},{text:t.L_Fdbk_Other,value:54});break;case 12:r.push({text:t.L_Fdbk_ImageryOutOfDate,value:51},{text:t.L_Fdbk_ImageryBlurry,value:51},{text:t.L_Fdbk_ImageryRoadMismatch,value:53},{text:t.L_Fdbk_Other,value:54});break;case 13:r.push({text:t.L_Fdbk_Other,value:54});break;default:r.push({text:t.L_Fdbk_SelectSubProblem,value:0})}this.subProblemTypes.insertAll(r)}},f.prototype._onSubProblemTypeChanged=function(n,i){var u=i.value===1,r=i.value===10,f=i.value===11;this.setAddressGhostText(r?t.FdbkNumberAndStreetGhost:t.FdbkStreetGhost);this.setShowAddressInput(r||f||u);this.setShowPostcodeInput(r)},f.vectorSourceId="vector",f.vectorLayerId="fill of "+f.vectorSourceId,f}(br),ao=function(){function n(n,t,i,r,u){this.value=n;this.label=t;this.augmentation=i||"";this.isSelected=r||!1;this.isEnabled=typeof u=="undefined"?!0:u}return n}(),vo=function(){function n(n,t,i,r,u,f){this.id=n;this.cssClass=t;this.displayName=i;this.filterType=r;this.options=[];this.selectionRenderer=f;this.instId=u;this.instrumentationData=this._createInstrumentationData(this.instId)}return n.prototype.getSelectedOptions=function(){for(var t=[],n=0;n<this.options.length;n++)this.options[n].isSelected&&t.push(this.options[n]);return t},n.prototype.hasSelectedOptions=function(){for(var n=0;n<this.options.length;n++)if(this.options[n].isSelected)return!0;return!1},n.prototype.isEnabled=function(){if(this.options.length===0)return!1;for(var n=0;n<this.options.length;n++)if(this.options[n].isEnabled)return!0;return!1},n.prototype.addAllOptions=function(n){var t=this;return n.forEach(function(n){t.addOption(n)}),this},n.prototype.addOption=function(n){return this.options.push(n),n.item=this,this},n.prototype.removeOptionAt=function(n){if(n<0||n>=this.options.length)throw new Error("Index ["+n+"] of option to remove is out of bound, must be in (0, "+this.options.length+"] range!");return this.options.splice(n,1)[0]},n.prototype.getOptionByValue=function(n){for(var t=0;t<this.options.length;t++)if(n===this.options[t].value)return this.options[t];return null},n.prototype.equals=function(n){if(!n)return!1;if(n===this)return!0;if(this.id!==n.id||this.options.length!==n.options.length)return!1;for(var t=0;t<this.options.length;t++)if(this.options[t].value!==n.options[t].value||this.options[t].label!==n.options[t].label)return!1;return!0},n.prototype.applySelection=function(n){var i,t,r;if(this.id!==n.id)throw new Error("Filter items id missmatch "+this.id+"/"+n.id+"! Selection could not be applied!");for(i=0;i<this.options.length;i++)t=this.options[i],r=n.getOptionByValue(t.value),r&&(t.isSelected=r.isSelected,t.isEnabled=t.isEnabled||t.isSelected)},n.prototype.displaySelection=function(){return this.selectionRenderer?this.selectionRenderer(this):this.getSelectedOptions().map(function(n){return n.label}).join(", ")},n.prototype.unselectAllOptions=function(){for(var n=0;n<this.options.length;n++)this.options[n].isSelected=!1},n.prototype.prune=function(){for(var t,n=this.options.length-1;n>=0;n--)t=this.options[n],t.isEnabled||this.removeOptionAt(n)},n.prototype.clear=function(){this.options=[]},n.prototype.hasOptions=function(){return this.options&&this.options.length>0},n.prototype._createInstrumentationData=function(n){var t={logData:{feature:"FSB",action:"C",data:{FT:n}}};return JSON.stringify(t)},n}(),yo=function(){function n(n){var t=this;this._items=[];n.forEach(function(n){t.addItem(n)})}return n.prototype.getItems=function(){return this._items.slice()},n.prototype.getItemsNumber=function(){return this._items.length},n.prototype.getItemAt=function(n){return this._checkRange(n),this._items[n]},n.prototype.addItem=function(n){this._items.push(n)},n.prototype.addItemAt=function(n,t){if(t<0||t>this._items.length)throw new Error("Index ["+t+"] is out of bound, must be in [0, "+this._items.length+"] range!");this._items.splice(t,0,n)},n.prototype.removeItemAt=function(n){return this._checkRange(n),this._items.splice(n,1)[0]},n.prototype._checkRange=function(n){if(n<0||n>=this._items.length)throw new Error("Index ["+n+"] is out of bound, must be in [0, "+this._items.length+") range!");},n.prototype.removeItem=function(n){var t=this.indexOf(n);return t>=0?(this.removeItemAt(t),!0):!1},n.prototype.clear=function(){this._items=[]},n.prototype.indexOf=function(n){for(var t=0;t<this._items.length;t++)if(n.id===this._items[t].id)return t;return-1},n.prototype.hasSelectedOptions=function(){for(var n=0;n<this._items.length;n++)if(this._items[n].hasSelectedOptions())return!0;return!1},n.prototype.getItemById=function(n){for(var t=0;t<this._items.length;t++)if(n===this._items[t].id)return this._items[t];return null},n.prototype.getSelectedItems=function(){return this._items.filter(function(n){return n.hasSelectedOptions()})},n.prototype.applyHistograms=function(n){var t=this;n&&(this.clear(),n._items.forEach(function(n){t.addItem(n)}))},n}(),vu=function(n){function t(i,r,u){var f=n.call(this,r,gf)||this;return t._initializeFilterItemTemplates(),f._eventHandlers=[],f._filtersBar=i,f.filterOptionClicked=new s,f._createFiltersViewModels(),f._expansionState=u||{isExpanded:!1},f._processExpansionState(),f}return v(t,n),t.prototype.unselectItem=function(n){for(var i,t=0;t<this._filtersViewModels.length;t++)if(i=this._filtersViewModels[t],n.id===i.filterItem.id){i.filterItem.unselectAllOptions();i.refresh();break}},t.prototype.dispose=function(){this._eventHandlers.forEach(function(n){n.item.remove_event(n.eventName,n.handler)});this._eventHandlers=[]},t._initializeFilterItemTemplates=function(){t._filterItemTemplates[2]=df;t._filterItemTemplates[1]=ue;t._filterItemTemplates[0]=yr},t._resolveFilterItemTemplate=function(n){var i=t._filterItemTemplates[n.filterType];return i?i:yr},t.prototype._processExpansionState=function(){var n=this,t=this._getExpandButton(),i;if(!this._isExpandable()){this._expansionState.isExpanded=!1;t&&t.length===1&&t.removeFromParent();return}this._synchronizeExpansionStateWithView();i=function(t){t.preventDefault();n._expansionState.isExpanded=!n._expansionState.isExpanded;n._synchronizeExpansionStateWithView();n._logExpandButtonClick(n._expansionState.isExpanded)};t.add_event("click",i);this._addEventsToEventList(t,"click",i)},t.prototype._getExpandButton=function(){var n="a[class="+t._expandButtonCssClass+"]";return this.getControl().select(n)},t.prototype._synchronizeExpansionStateWithView=function(){var n=this._getExpandButton(),i=this.getControl();this._expansionState.isExpanded?(i.add_class(t._filtersBarExpandedCssClass),n.set_text(f.L_FiltersBar_Less_Text)):(i.remove_class(t._filtersBarExpandedCssClass),n.set_text(f.L_FiltersBar_More_Text))},t.prototype._isExpandable=function(){return this._filtersViewModels.length>=t._expandButtonThreshold},t.prototype._logExpandButtonClick=function(n){var t={logData:{feature:"FSB",action:"EX",data:{ED:n}}};r.invokeHandler("data-instrumentation",t)},t.prototype._createFiltersViewModels=function(){var r=this,n;for(this._filtersViewModels=[],this._filtersBar.getItems().forEach(function(n){if(n.options.length>0){var i=new is(n,t._resolveFilterItemTemplate(n));i.filterOptionClicked.add(function(n){r.filterOptionClicked.invoke(n)});r._filtersViewModels.push(i)}}),n=0;n<this._filtersViewModels.length;n++){var i=this._filtersViewModels[n],u=i.filterItem,f=this.getControl().select("a."+u.cssClass),e=this.getControl().select("div."+u.cssClass);i.setViewModelData(e,f);this._addFilterButtonClickHandler(f,i)}},t.prototype._addFilterButtonClickHandler=function(n,t){var i=function(n){return t.filterButtonButtonClicked(n)};n.add_event("click",i);this._addEventsToEventList(n,"click",i)},t.prototype._addEventsToEventList=function(n,t,i){this._eventHandlers.push({item:n,eventName:t,handler:i})},t._filterItemTemplates={},t._expandButtonCssClass="expandFiltersButton",t._expandButtonThreshold=4,t._filtersBarExpandedCssClass="Expanded",t}(ri),yu=function(t){function i(n,i){var r=t.call(this,i,ne)||this,u=r._privates;return u.defineProperty("selectedItems",function(n,t){r.setIsVisible(t.length>0)}),u.defineProperty("isVisible"),r.setSelectedItems(n.getSelectedItems()),r.filterItemDiscardedFromSelection=new s,r}return v(i,t),i.prototype.onDiscardFilterItemSelection=function(t){t.stopPropagation();t.preventDefault();var i=n(t.target).get_attr("class"),u=this._getItemById(i),r=this.getSelectedItems().slice();r.splice(this._getItemIndex(i),1);this.setSelectedItems(r);this.filterItemDiscardedFromSelection.invoke(u)},i.prototype.itemToString=function(n){if(n){var t=this._getItemById(n);return t.displaySelection()}return""},i.prototype._getItemById=function(n){var t=this._getItemIndex(n);return t===-1?null:this.getSelectedItems()[t]},i.prototype._getItemIndex=function(n){for(var i,t=0;t<this.getSelectedItems().length;t++)if(i=this.getSelectedItems()[t],n===i.id)return t;return-1},i}(ri),po=function(){function n(n){this._controlTemplateFactory=n;this._filtersBarViewModelExpansionState={isExpanded:!1};this.filterOptionClicked=new s;this.filtersBarRecreated=new s;this.filterItemDiscardedFromSelection=new s}return n.prototype.update=function(n,t){var i=this;this.dispose();this._control=t;t.getParent().remove_class("withFilters");t.clear();n&&n.getItemsNumber()>0&&(this._filtersBarViewModel=new vu(n,this._controlTemplateFactory,this._filtersBarViewModelExpansionState),this._filtersBarViewModel.filterOptionClicked.add(function(t){i._filtersStatusBarViewModel.setSelectedItems(n.getSelectedItems());i.filterOptionClicked.invoke(t)}),t.append(this._filtersBarViewModel.getControl()),this._filtersStatusBarViewModel=new yu(n,this._controlTemplateFactory),this._filtersStatusBarViewModel.filterItemDiscardedFromSelection.add(function(n){i._filtersBarViewModel.unselectItem(n);i.filterItemDiscardedFromSelection.invoke(n)}),t.append(this._filtersStatusBarViewModel.getControl()),t.getParent().add_class("withFilters"),this.filtersBarRecreated.invoke())},n.prototype.disableInteraction=function(){if(this._control){var n=b._createElement("div").add_class("bm_filtersBarModuleOverlay").set_html("&nbsp;");this._control.append(n);a.setTimeout(function(){n.append(b._createElement("div").add_class("spinner"))},400)}},n.prototype.enableInteraction=function(){this._control&&this._control.select(".bm_filtersBarModuleOverlay").removeFromParent()},n.prototype.dispose=function(){this._filtersBarViewModel&&this._filtersBarViewModel.dispose();this._filtersStatusBarViewModel&&this._filtersStatusBarViewModel.dispose()},n}(),wo=function(){function n(n){var t=function(){var n={title:o.FlyoverFeedbackTitle,activeTaskId:"",feedbackTaskType:2,entryPoint:8,queryables:{keywords:["flyOver"]}};r.invokeHandler("data-task",{type:"FeedbackTask",state:n})};this.disposables=[n.onFeedbackBtnClick.add(t)];this.control=n.getControl()}return n.prototype.getControl=function(){return this.control},n.prototype.dispose=function(){this.isDisposed||(e._clearDisposables(this.disposables),this.isDisposed=!0)},n}(),bo=function(t){function i(){var n=t.call(this)||this,i;return n._templateString='<div class="{TemplateBinding Class}" data-tag="canvasIcon"><\/div>',i=n._privates,i.defineProperty("class",null,null,{defaultValue:""}),i.defineProperty("vectorTemplate",function(t,i){n._onVectorTemplateChanged(t,i)}),n.setTemplate(new it(n._templateString,null)),n}return v(i,t),i.prototype._onVectorTemplateChanged=function(t,i){var r=n(this.getRootElement());r.clear();i&&r.append(i.renderIcon())},i}(kt);it.registerControl("CanvasControl",bo);pu=function(){function n(n){var t=function(){var n={title:o.Landmarks3DFeedbackTitle,activeTaskId:"",feedbackTaskType:2,entryPoint:9,queryables:{keywords:["3dlandmarks"]}};r.invokeHandler("data-task",{type:"FeedbackTask",state:n})};this.disposables=[n.onFeedbackBtnClick.add(t)]}return n.prototype.dispose=function(){this.isDisposed||(e._clearDisposables(this.disposables),this.isDisposed=!0)},n}();wu=function(){function n(n){var t=function(){var n={title:o.Map3DFeedbackTitle,activeTaskId:"",feedbackTaskType:2,entryPoint:11,queryables:{keywords:["3d"]}};r.invokeHandler("data-task",{type:"FeedbackTask",state:n})};this.disposables=[n.onFeedbackBtnClick.add(t)]}return n.prototype.dispose=function(){this.isDisposed||(e._clearDisposables(this.disposables),this.isDisposed=!0)},n}(),function(t){function a(){h.removeAllStacks(!1)}function v(n){if(n.length!==0){var t=-1;n.for_each(function(n){n.classList.contains("sldShown")?t=Number(n.getAttribute("data-slideid")):Number(n.getAttribute("data-slideid"))-t>1?n.classList.contains("inactive")||n.classList.add("inactive"):n.classList.contains("inactive")&&n.classList.remove("inactive")})}}function y(n){var r=i.select(".slideImage.btSINext"),f,t,e,u;r.length>0&&(n=n===null||n===undefined?Number(r.get_attr("data-slideid")):n,f=n+1,t=_w.btULCinfo,t&&(t.currentSlide=n,e=i.select(".btsImg"+f),u=i.select(".btULCTeaser"),r.set_attr("data-slideId",f.toString()),f===t.totalSlide?(u.length>0&&u.set_text(r.get_attr("data-title")),t.summaryPageUrl=r.get_attr("data-Url"),t.slideCompleted=!0):e.length>0&&u.length>0&&u.set_text(e.get_attr("title"))))}function p(n){var r=i.select(".bt_title"),t;r.set_text(n.getAttribute("data-title"));t=i.select(".bt_desc");t.set_text(n.getAttribute("data-description"))}function w(){var n="_SS";sj_cook.set(n,"BTQID","-",!1,"/");sj_cook.set(n,"BTSID","-",!1,"/");sj_cook.set(n,"BTSlClk","-",!1,"/");sj_cook.set(n,"BTOID","-",!1,"/");sj_cook.set(n,"BTMC","-",!1,"/");sj_cook.set(n,"BTULCTtl","-",!1,"/")}function b(n){var t=document.getElementById("maps_sb");t&&(t.value=n)}function k(){var t=n(".overlayPanel",i[0]),r;t&&t.length>0&&(t.set_style({"margin-top":"0","background-color":"#fafafa"}),u=t.get_style("height"),i.set_style({height:u}),r=n(".btOverlay",i[0]),r&&r.length>0&&r.set_style({bottom:"auto",height:u}))}function d(n){var t=n.currentTarget,u,f,e;t.classList.contains("sldShown")||t.classList.contains("inactive")||(t.classList.add("sldShown"),o=Number(t.getAttribute("data-slideid")),a(),v(i.select(".ulcSlides .slideImage")),y(),p(t),w(),u=JSON.parse(t.getAttribute("data-task")),f=u&&u.state,r.invokeHandler("data-task",u),e=f.query||f.taskTitle||f.title,b(e),k())}function g(){var n=document.getElementById("maps_sb");n&&(n.placeholder=f.SearchGhostText,n.focus())}function nt(){var n=i.select(".nextULC .slideImage.btSINext");n&&n.length>0&&n.add_event("click",function(t){var e=_w.btULCinfo,s=n.get_attr("data-slideid"),h=Number(s),u,f;h===e.totalSlide?(t.preventDefault(),t.stopImmediatePropagation(),o=0,u=JSON.parse(n.get_attr("data-task")),u&&(a(),e.summaryPageUrl="",n.set_attr("data-url",""),r.invokeHandler("data-task",u),b(""),g()),i.select("#rqCloseBtn").fireEvent("click")):(f=i.select(".btsImg"+n.get_attr("data-slideid")),f&&f.fireEvent("click"))})}function tt(){var n=i.select("#rqCloseBtn");n&&n.length>0&&n.add_event("click",function(){e&&e.unregister("MktTourHelper")})}function it(){var r,t;i.select(".ulcSlides").set_style({width:"calc(100% - 280px)"});r=n("#b_footer")[0];r&&(t=r.querySelector("ul"),t&&t.parentNode.insertBefore(i[0],t));k()}function rt(){var t,r,i,f;if(u&&(t=n(".ent_ovlc"),t&&t.length>0))for(r=0;r<t.length;r++)i=n(".ovl",t[r]),i&&i.length>0&&(i.set_style({bottom:u}),f=n("ovlbg",i[0]),f&&f.length>0&&f.set_style({bottom:u}))}function ut(r,u){var y=this,a,f;l||(l=!0,h=u,c=r,i=n("#b_TriviaOverlay"),o=0,t.serializableObjectChanged=new s,a=c.getContainer(),a.instanceAsync("BrowserHistoryManager",function(n){if(e=n,e)try{e.register("MktTourHelper",y)}catch(t){}},null,!0),f=i.select(".ulcSlides .slideImage"),f&&f.length>0&&(f.for_each(function(n){var i=n.getAttribute("data-task"),t;i&&(t=n.getAttribute("data-serpquery"),t||n.addEventListener("click",function(n){return d(n)}))}),nt(),tt()),sj_cook.set("_SS","BTQID","-",!1,"/"),f&&v(f),it(),sj_evt.bind("ovlShow",rt))}function ft(t){if(t!==null&&t.activeSlideId!=="undefined"&&t.activeSlideId>-1){var r=t.activeSlideId,u=i.select(".ulcSlides .slideImage");u.length>0&&(u.for_each(function(t){var i=Number(t.getAttribute("data-slideId"));i<=r?n(t).add_class("sldShown"):(n(t).remove_class("sldShown"),i>r+1&&n(t).add_class("inactive"))}),y(r),r>0&&w(),p(u[r]));o=r}}function et(){return{activeSlideId:o}}function ot(n){ft(n)}var i,h,c,e,o,u,l;t.initialize=ut;t.serialize=et;t.deserialize=ot}(kr||(kr={}));var ko=function(t){function i(n,i,r,u){var e=this,o,h,c,l;return e=t.call(this,u,te)||this,e._privates.defineProperty("trafficOn",function(n,t){return e._onTrafficOnChanged(n,t)},null,{defaultValue:!1}),e._privates.defineProperty("zoomBtnsOn",function(n,t){return e._onZoomBtnsOnChanged(n,t)},null,{defaultValue:!1}),e._map=i,e._container=n,e._mapShell=r,e.resources=f,e.onSettingsClosed=new s,e.onFeedbackClicked=new s,e.onExploreNearYouClicked=new s,e.onZoomBtnsClicked=new s,((l=(c=(h=(o=Microsoft===null||Microsoft===void 0?void 0:Microsoft.Maps)===null||o===void 0?void 0:o.GlobalConfig)===null||h===void 0?void 0:h.features)===null||c===void 0?void 0:c.mobileMapShell)===null||l===void 0?void 0:l.enableZoomBtns)&&e._enableZoomBtnsFeature(),e._highlightMapStyleButton(),e._closeSettingsOnClickOutsideSettingsPage(),e}return v(i,t),i.prototype.onRoadMapStyleClick=function(){this._map.setStyle({style:"road"});this._highlightMapStyleButton()},i.prototype.onAerialMapStyleClick=function(){this._map.setStyle({style:"hybrid"});this._highlightMapStyleButton()},i.prototype.onDoneClick=function(){this._closeSettings()},i.prototype.onTrafficClick=function(){this.setTrafficOn(!this.getTrafficOn())},i.prototype.onZoomBtnsClick=function(){this.setZoomBtnsOn(!this.getZoomBtnsOn())},i.prototype.onFeedbackClick=function(){var t=this,i=this._container;i&&i.instanceAsync("FeedbackTask",function(i){i.activate(t._mapShell,{title:"Feedback",feedbackTaskType:1,options:{showFeedbackHeader:!0}});var r=n("#feedbackContainer");r.clear();r.append(i.getContent(null));n("#feedbackWrapper").remove_class("collapsed");t.onFeedbackClicked.invoke()});this._closeSettings()},i.prototype.onExploreNearYouClick=function(){this.onExploreNearYouClicked.invoke();this._closeSettings()},i.prototype.hideStyleSetting=function(){var n=this.getControl(),t=n.select(".contentRoot.mapSetting");t.set_style({display:"none"})},i.prototype.hideMapSettingsForSupportHidden=function(){var n=this.getControl(),t=n.select(".mobileSettingContainer.pageSetting.supportHidden");t.set_style({display:"none"})},i.prototype._highlightMapStyleButton=function(){var n="selected",t=this.getControl(),r=t.select(".roadStyle"),f=t.select(".darkStyle"),u=t.select(".aerialStyle"),i;r.remove_class(n);f.remove_class(n);u.remove_class(n);i=this._map.getStyle();i.style==="road"?r.add_class(n):i.style==="hybrid"&&u.add_class(n)},i.prototype._closeSettingsOnClickOutsideSettingsPage=function(){var i=this,r=this.getControl().select("#settingsWrapper"),t;r.add_event("click",function(n){n.stopPropagation();n.preventDefault()});t=n("#screenOverlay");t.add_event("click",function(n){i._closeSettings();n.stopPropagation();n.preventDefault()})},i.prototype._closeSettings=function(){this.onSettingsClosed.invoke()},i.prototype._logTrafficLayerCreated=function(){var n;(n=h.logger)===null||n===void 0?void 0:n.logObject({feature:"MC",action:"MapLayerAdded",data:{ID:"TrafficLayer"}})},i.prototype._onTrafficOnChanged=function(n,t){var i=this,f=t,u=function(){i._trafficFlowManager&&(f?(i._trafficFlowManager.showFlow(),i._logTrafficLayerCreated()):i._trafficFlowManager.hideFlow())},r;this._trafficFlowManager?u():(r=this._container,r&&r.instanceAsync("TrafficLayerV2",function(){Microsoft&&Microsoft.Maps&&Microsoft.Maps.TrafficControl&&Microsoft.Maps.TrafficControl.TrafficFlowManager&&(i._trafficFlowManager=new h.TrafficControl.TrafficFlowManager(i._map),u())}))},i.prototype._onZoomBtnsOnChanged=function(n,t){this.onZoomBtnsClicked.invoke(t)},i.prototype._enableZoomBtnsFeature=function(){var n=this.getControl(),t=n.select("#zoomBtnsToggle");t.remove_class("hidden")},i}(ri),gc=function(n){function t(t){var i=n.call(this)||this,r=i._privates;return r.defineProperty("name"),r.defineProperty("checked",function(n,t){i._onChanged(n,t)},null,{defaultValue:!1}),r.defineProperty("icon"),i.setName(t),i.onCheckedChanged=new s,i}return v(t,n),t.prototype.onItemClick=function(n){this.setChecked(!this.getChecked());n.preventDefault()},t.prototype._onChanged=function(n,t){t?this.onCheckedChanged.invoke(!0):n&&this.onCheckedChanged.invoke(!1)},t}(bt),go=function(n){function t(){var t=n.call(this)||this,i=t._privates;return i.defineProperty("itemList"),i.defineProperty("displayDropdown",null,null,{defaultValue:!1}),i.defineProperty("buttonName"),i.defineProperty("buttonIcon"),i.defineProperty("dropdownTitle"),t.setTemplate(new it(wf,{boolToDisplay:function(n){return t._boolToDisplay(n)},onDropdownButtonClick:function(n){t._onDropdownButtonClick(n)},itemCheckedClass:function(n){return t._itemCheckedClass(n)},dropdownOpenClass:function(n){return t._dropdownOpenClass(n)},mouseoverDropdown:function(n){t._mouseoverDropdownHandler(n)},mouseexitDropdown:function(n){t._mouseexitDropdownHandler(n)}})),t}return v(t,n),t.prototype._boolToDisplay=function(n){return n?"":"none"},t.prototype._onDropdownButtonClick=function(n){this.setDisplayDropdown(!0);n&&n.preventDefault&&n.preventDefault()},t.prototype._itemCheckedClass=function(n){return"multiselectCheckbox"+(n?" checked":"")},t.prototype._dropdownOpenClass=function(n){return"dropdownButton"+(n?" open":"")},t.prototype._mouseoverDropdownHandler=function(n){var t=this;window.clearTimeout(this._mouseoverDelay);this._mouseoverDelay=a.setTimeout(function(){t.setDisplayDropdown(!0)},50);this._tempButtonIcon||(this._tempButtonIcon=this.getButtonIcon());this.setButtonIcon(this._tempButtonIcon+" hover");n&&n.preventDefault&&n.preventDefault()},t.prototype._mouseexitDropdownHandler=function(n){var t=this;window.clearTimeout(this._mouseoverDelay);this._mouseoverDelay=a.setTimeout(function(){t.setDisplayDropdown(!1)},200);this.setButtonIcon(this._tempButtonIcon);n&&n.preventDefault&&n.preventDefault()},t}(kt);it.registerControl("MultiselectDropdown",go);var ns=function(n){function t(t,i,r,u){var f=n.call(this)||this,e;return f.title=t,f.linkTitle=i,f.linkData=r,f._buttonElement=u,e=f._privates,e.defineProperty("showLink",null,null,{defaultValue:!0}),e.defineProperty("showChangeLink"),e.defineProperty("nickName"),e.defineProperty("showAnnotate"),e.defineProperty("parentClass"),f.setShowAnnotate(!1),f}return v(t,n),t.prototype.getButtonElement=function(){return this._buttonElement},t.prototype.setButtonElement=function(n){this._buttonElement=n},t.prototype.onLinkClick=function(n){this.linkData&&r.invokeHandler("data-task",this.linkData);n&&n.preventDefault&&n.preventDefault()},t.prototype.onEditLinkClick=function(n){n&&n.preventDefault&&n.preventDefault()},t.prototype.onCloseLinkClick=function(n){n&&n.preventDefault&&n.preventDefault()},t.prototype.onSaveLinkClick=function(n){return n&&n.preventDefault&&n.preventDefault(),!0},t.prototype.onChangeLinkClick=function(n){return n&&n.preventDefault&&n.preventDefault(),!0},t.prototype.onKeyPress=function(){},t.prototype.boolToDisplay=function(n){return n?"inline":"none"},t.prototype.boolToNotDisplay=function(n){return n?"none":"block"},t}(bt),bu=function(t){function i(n,i,r,u,f,e,o){var h=t.call(this,n,i,r,u)||this;return h._container=f,h.setShowLink(!0),h.processOptions=e,h.entityId=o,h.showFooter=e&&e.requestState&&e.requestState.entityId?"":"none",h.popOutChangeLinkClicked=new s,h}return v(i,t),i.prototype.onLinkClick=function(n){var i,u,f;if(this.linkData)t.prototype.onLinkClick.call(this,n);else if(this.processOptions){if(this._container&&l.enableSingleMyPlacesCard&&(i=this._container.instance("CollectionsTask"),i&&i.id&&i.stackId)){u=this.processOptions.requestState;u.action=2;this.processOptions.taskId=i.id;f={action:"focus",id:i.id,type:"CollectionsTask",state:u};r.invokeHandler("data-task",f);return}r.invokeHandler("data-process",this.processOptions)}else this.activateOptions&&(this.isTempCollectionMessage||l.enableOneClickSave)&&r.invokeHandler("data-task",this.activateOptions);n&&n.preventDefault&&n.preventDefault()},i.prototype.onSaveLinkClick=function(n){var i,u,f,e;return t.prototype.onSaveLinkClick.call(this,n),i=this.getNickName().trim(),i?(this.processOptions&&this.processOptions.requestState?(u=this.processOptions.requestState,u.action=20,u.entityId=this.entityId,u.data={title:i},this.processOptions.useActiveTasks=!1,r.invokeHandler("data-process",this.processOptions)):(f=this.activateOptions&&this.activateOptions.state&&this.activateOptions.state.collectionId,e={type:"CollectionsTask",requestorType:this.requestorType,requestorId:this.requestorId,requestState:{action:20,entityId:this.entityId,collectionId:f,data:{title:i}}},r.invokeHandler("data-process",e)),this.saveNicknameClicked=!0,!0):(this.focusMessageOrTextBox(),!1)},i.prototype.onChangeLinkClick=function(n){return t.prototype.onChangeLinkClick.call(this,n),this.popOutChangeLinkClicked.invoke(n),!0},i.prototype.onKeyPress=function(n){if(n.keyCode===13)this.onSaveLinkClick(null)},i.prototype.focusMessageOrTextBox=function(){this.getShowAnnotate()?a.setTimeout(function(){var t=n(".nameEditBox"),i,r,f,u;if(t&&t.length)for(i=null,r=0;r<t.length;r++)if(t[r].focus(),i=document.activeElement,i&&i.classList.contains("nameEditBox"))break;f=document.activeElement;f.classList.contains("nameEditBox")||(u=n(".messageContainer"),u.length>0&&u[0].focus())},500):a.setTimeout(function(){var t=n(".messageContainer");t.length>0&&t[0].focus()},100)},i}(ns),dt=function(){function n(n){this._buttonElement=n;this.setDropdown([])}return n.prototype.getButtonElement=function(){return this._buttonElement},n.prototype.setButtonElement=function(n){this._buttonElement=n},n.prototype.setDropdown=function(n){this.dropdownList=n||[]},n.prototype.onEntryClicked=function(n){if(n>=0&&n<this.dropdownList.length){var t=this.dropdownList[n];t.options?r.invokeHandler("data-task",t.options):t.handler&&t.handler.call(this,null,n);t.instData&&r.invokeHandler("data-instrumentation",this.dropdownList[n].instData)}},n.prototype.onEntryMouseover=function(n){if(n>=0&&n<this.dropdownList.length){var t=this.dropdownList[n];t.mouseoverhandler&&(t.mouseoverhandler.call(this,null,n),t.instData&&r.invokeHandler("data-instrumentation",this.dropdownList[n].instData))}},n.prototype.onEntryMouseout=function(n){if(n>=0&&n<this.dropdownList.length){var t=this.dropdownList[n];t.mouseouthandler&&t.mouseouthandler.call(this,null,n)}},n}(),ku=function(t){function i(n,i,r,u,f,e){var o=t.call(this,i)||this;return o._map=n,o.entityDescription=e,o.entityNickName=u,o.entityOriginalName=f,o.isMoveToMenu=r,o._showItineraries=ct.isEditable,o.newCollectionCreated=new s,o.contextMenuFinished=new s,o}return v(i,t),i.prototype.setDropdownData=function(n,t,i,r,u,f,e,o,s){var h=this,c;this._entityId=i.id;c=new ui;this._showItineraries&&c.getIsSignedIn()?tr&&tr.instanceAsync("ItineraryDataManager",function(c){h._dataManager=c;h._dataManager.retrieveAllItinerariesMetaData(function(c,l){c&&l===0&&(h.dropdownList=h._populateDropDownListData(n,t,i,r,u,f,e,c,s));o&&o()})}):(this.dropdownList=this._populateDropDownListData(n,t,i,r,u,f,e),o&&o())},i.prototype.onEntryClicked=function(n){var u,i,t,f,e;n<0||n>=this.dropdownList.length||(u=this.dropdownList[n],i=u.options,i&&(t=i.requestState,t?(l.enableOneClickSave&&(t.removeEntityFromItinerary?(f={type:"ItineraryDetailsTask",taskId:t.removeEntityFromItineraryDetailsTaskId,requestState:{action:8,itineraryItem:{Id:t.entityId||t.itineraryItem.Id}}},r.invokeHandler("data-process",f)):t.removeEntityAndPerformAction&&t.removeEntityFromCollectionId&&i.type==="ItineraryDetailsTask"&&(e={type:"CollectionsTask",requestState:{action:22,removeEntityFromCollectionId:t.removeEntityFromCollectionId,entityId:t.entityId}},r.invokeHandler("data-process",e))),r.invokeHandler("data-process",i)):(r.invokeHandler("data-task",i),this.newCollectionCreated.invoke())),u.handler&&u.handler(null,n))},i.prototype._populateDropDownListData=function(n,t,i,r,u,e,o,s){var ht=this,v=[],p,y,nt,vt,ot,it,rt,st,b,tt;if(!n||!i||!r||!u&&!e)return v;var a=i,w=i instanceof cr?a:null,ct=a.categoryId||w&&w.getSelectedCategoryForIcon(),yt=a.addressFields,pt=a.interests,wt=a.stayDuration,d=a.getImageUrl(),c=ft.getMyPlacesTaskOptions(a.getTitle(),r,this.entityDescription,a.getAddress(),d&&d.length>0?d:null,ct,this._entityId,yt,a.metadataString,a.mainSegmentType),h=t&&t.requestState;if(l.enableOneClickSave&&(!this.isMoveToMenu&&(h===null||h===void 0?void 0:h.removeEntityAndPerformAction)?(c.state.removeEntityAndPerformAction=h.removeEntityAndPerformAction,c.state.removeEntityFromCollectionId=h.removeEntityFromCollectionId,h.entityId&&(c.state.entityId=h.entityId)):!this.isMoveToMenu&&(h===null||h===void 0?void 0:h.removeEntityFromItinerary)&&(c.state.removeEntityFromItinerary=h.removeEntityFromItinerary,c.state.removeEntityFromItineraryDetailsTaskId=h.removeEntityFromItineraryDetailsTaskId,c.state.removeEntityFromCollectionId=t.requestState.removeEntityFromCollectionId,h.entityId&&(c.state.entityId=h.entityId))),c.activateOptions={parentId:u},this.entityNickName&&this.entityOriginalName?(c.state.data.nickName=this.entityNickName,c.state.data.title=this.entityOriginalName):a.getNickname&&a.getNickname()&&(c.state.data.nickName=a.getNickname()),p=o.logData.data,c.state.entryPoint=p&&(p.EP&&p.EP==="LocalDetails"||p.ID)?3:2,y=p&&p.EP,this.isMoveToMenu&&(c.state.isMove=!0),(!l.enableOneClickSave||(h===null||h===void 0?void 0:h.removeEntityFromCollectionId)||(h===null||h===void 0?void 0:h.removeEntityFromItinerary)||this.isMoveToMenu)&&this._pushFavoritesAction(v,this.isMoveToMenu?f.L_MoveToFavorites:f.L_AddFavorite,10,c,e,y,"newFavorite icon"),v.push({name:"",separator:!0}),this._showItineraries){var ut=!1,g=w&&w.getSegmentTypes(),lt=w&&w.getPrimaryCategoryName(),at=function(){ht.contextMenuFinished.invoke()},et=c.state,k=ft.getItineraryItem(et.data.nickName||et.data.title,r,i.id,d,ct,pt,wt);if(lt?k.CategoryName=lt:(g===null||g===void 0?void 0:g.length)>0&&(k.CategoryName=g[0]),k.OriginalName=et.data.title,y==="ContextMenu"||l.enableOneClickSave||this._pushMostRecentlyUsedListEntries(v,k,at,c,e,u,y)&&(ut=!0),s&&s.length)for(ut=!0,nt=0,vt=s.length;nt<vt;nt++)ot=s[nt],l.enableOneClickSave&&(h===null||h===void 0?void 0:h.removeEntityFromCollectionId)&&(h===null||h===void 0?void 0:h.removeEntityFromCollectionId)===ot.collectionId||(tt=this._createSaveToItineraryAction(k,c,at,ot,e,u,y),v.push(tt));ut&&v.push({name:"",separator:!0})}for(v.push({name:f.L_CreateNewCollection,handler:function(){ht._createNewCollectionControl(c.state)},iconClass:"newCollection icon"}),it=window.$MicrosoftMaps8&&window.$MicrosoftMaps8.CloudGraphDataManager,rt=0,st=n.collections;rt<st.length;rt++)b=st[rt],l.useJsonApiForFavorites&&it&&it.Utilities&&it.Utilities.isDefaultCollectionId(b.id)||l.enableOneClickSave&&t.requestState.removeEntityFromCollectionId&&t.requestState.removeEntityFromCollectionId===b.id||(tt=this._createSaveToCollectionAction(b.name,b.id,c,e,u,y),b.name&&v.push(tt));return v.push({name:"",separator:!0}),this._pushFavoritesAction(v,this.isMoveToMenu?f.L_MoveToHome:f.L_SetAsHome,8,c,e,y,"setHome icon"),this._pushFavoritesAction(v,this.isMoveToMenu?f.L_MoveToWork:f.L_SetAsWork,9,c,e,y,"setWork icon"),v},i.prototype._pushFavoritesAction=function(n,t,i,r,u,f,e){var o={type:r.type,requestorId:r.activateOptions.parentId,requestorType:u,requestState:{action:i,data:r.state.data,removeEntityAndPerformAction:r.state.removeEntityAndPerformAction,removeEntityFromCollectionId:r.state.removeEntityFromCollectionId,removeEntityFromItinerary:r.state.removeEntityFromItinerary,removeEntityFromItineraryDetailsTaskId:r.state.removeEntityFromItineraryDetailsTaskId,entityId:r.state.entityId},requestorState:{entryPoint:f}};n.push({name:t,options:o,iconClass:e})},i.prototype._pushSaveToTempAction=function(n,t,i,r,u){var e={requestorId:t.activateOptions.parentId,requestorType:i,type:"CollectionsTask",requestState:{action:18,data:t.state.data},requestorState:{entryPoint:r}};n.push({name:f.L_TemporaryCollectionTitle,options:e,iconClass:u?"newCollection icon":"icon"})},i.prototype._createSaveToCollectionAction=function(n,t,i,r,u,f){var e={type:i.type,requestorId:u,requestorType:r,requestState:{action:1,data:i.state.data,collectionId:t,removeEntityAndPerformAction:i.state.removeEntityAndPerformAction,removeEntityFromCollectionId:i.state.removeEntityFromCollectionId,removeEntityFromItinerary:i.state.removeEntityFromItinerary,removeEntityFromItineraryDetailsTaskId:i.state.removeEntityFromItineraryDetailsTaskId,entityId:i.state.entityId},requestorState:{title:n,entryPoint:f}};return{name:n,options:e,iconClass:"icon"}},i.prototype._createSaveToItineraryAction=function(n,t,i,r,u,f,e){var o=this._getActiveItineraryTaskId(r),s={type:"ItineraryDetailsTask",requestorId:f,requestorType:u,taskId:o,requestState:{action:l.enableOneClickSave&&o?1:5,itineraryItem:n,itineraryCollectionId:r.collectionId,removeEntityAndPerformAction:t.state.removeEntityAndPerformAction,removeEntityFromCollectionId:t.state.removeEntityFromCollectionId,removeEntityFromItinerary:t.state.removeEntityFromItinerary,removeEntityFromItineraryDetailsTaskId:t.state.removeEntityFromItineraryDetailsTaskId,title:r.getName()},requestorState:l.enableOneClickSave?{title:n.Name,entryPoint:e}:null};return{name:r.getName(),options:s,handler:i,iconClass:"icon"}},i.prototype._createSaveToOpenItineraryAction=function(n,t,i,r){var u={type:"ItineraryDetailsTask",requestState:{action:1,itineraryItem:n},taskId:r};return{name:i,options:u,handler:t,iconClass:"icon"}},i.prototype._pushMostRecentlyUsedListEntries=function(n,t,i,r,u,f,e){var p=h.CloudGraphDataManager.MostRecentlyUsedList&&h.CloudGraphDataManager.MostRecentlyUsedList.instance,a=window.$MicrosoftMaps8&&window.$MicrosoftMaps8.CloudGraphDataManager,v,c,o,s,w,y;if(p.getLength()>0){for(n.splice(0,0,{name:"",separator:!0}),v=p.getList(),c=v.length-1;c>=0;c--)o=v[c],s=void 0,o.IsItinerary?o.IsOpenTask?s=this._createSaveToOpenItineraryAction(t,i,o.TaskTitle,o.TaskId):(w=o.Itinerary,s=this._createSaveToItineraryAction(t,r,i,w,u,f,e)):l.useJsonApiForFavorites&&a&&a.Utilities&&a.Utilities.isDefaultCollectionId(o.Collection.id)||(y=o.Collection,s=this._createSaveToCollectionAction(y.name,y.id,r,u,f,e)),c===0&&s&&(s.iconClass="recentlyUsed icon"),s&&n.splice(0,0,s);return!0}return!1},i.prototype._createNewCollectionControl=function(t){var i=this,r;this.newCollectionCreated.invoke();r=this._map.getContainer();r.instanceAsync("NewCollectionControl",function(r){var e=n("#transientLens"),o,s,f,u;e.length>0?(u=e.getParent(),f=i._map.getRootElement().getParent(),u.getParent().has_class("bm_listMenu")&&(u=u.getParent(),f=u.getParent()),o=u.get_style("left"),s=u.get_style("top")):f=i.popOutRoot;r.setLeftPosition(o);r.setTopPosition(s);r.setEntityData(t);i.contextMenuFinished.invoke();i.contextMenuFinished.invoke();r.finished.add(function(){i._removeNewCollectionControl()});i._newCollectionControl=r.getControl();f&&f.append(i._newCollectionControl)})},i.prototype._removeNewCollectionControl=function(){this._newCollectionControl&&this._newCollectionControl.removeFromParent();this._newCollectionControl=null},i.prototype._getActiveItineraryTaskId=function(n){var r,u,i,t;if(!l.enableOneClickSave)return null;if(r=h.CloudGraphDataManager.MostRecentlyUsedList&&h.CloudGraphDataManager.MostRecentlyUsedList.instance,r.getLength()>0)for(u=r.getList(),i=u.length-1;i>=0;i--)if(t=u[i],t.IsItinerary&&t.ItineraryCollectionId&&t.ItineraryCollectionId===n.collectionId)return t.TaskId;return null},i}(dt),ts=function(n){function t(t,i,r,u,f,e){var o=n.call(this,u)||this;return o._addToRouteMode=e,o.setDropdownData(t,i,r,f),o}return v(t,n),t.prototype.setDropdownData=function(t,i,r,u){var f=this;b.checkDirectionsControl(function(){n.prototype.setDropdown.call(f,f._populateDropDownListData(t,i,r,u))})},t.prototype._populateDropDownListData=function(n,t,i,r){var o=[],l,a,v,y,u,p,it,d,w,b,g,s,h,c,e,rt,ut,k,et,nt,tt,ot,st;if(!n||!t||!i)return o;if(y=t.getDescription()||t.getTitle(),u=t,u&&u.id&&u.id.indexOf("event")>-1&&(it=li.eventPreArrivalTime,p=u&&u.getDateTime&&u.getDateTime()?u.getDateTime()+u.getUtcOffset()*6e4-it*6e4:null),d=ft.getDirectionTaskOptions(y,i,r.logData.data.EP,t.getTitle(),t.id,null,p),r){for(l={logData:{feature:r.logData.feature,action:r.logData.action,data:{}}},a={logData:{feature:r.logData.feature,action:r.logData.action,data:{}}},v={logData:{feature:r.logData.feature,action:r.logData.action,data:{}}},w=r.logData.data,b=0,g=Object.keys(w);b<g.length;b++)s=g[b],l.logData.data[s]=w[s],a.logData.data[s]=w[s],v.logData.data[s]=w[s];l.logData.data.DT="DirectionsTo";a.logData.data.DT="DirectionsFrom";v.logData.data.DT="AddWaypoint"}for(h=null,c=0;c<n.length;c++)e=n[c].data,e.activationState!==1||this._addToRouteMode?(e.routeTitle&&e.mode!==2||e.isIncomplete)&&(k="",this._addToRouteMode||(k=f.L_Directions_AddToRoute+"\n"),k+=e.routeTitle,e.isIncomplete&&(d.state.waypoints[0].waypointType=4),et={action:"focus",state:d.state,id:n[c].processorId},o.push({name:k,options:et,instData:v})):(h=n[c].processorId,e.routeTitle&&e.mode!==2&&(rt=ft.getDirectionTaskOptions(y,i,r.logData.data.EP,t.getTitle(),t.id,3,p),ut={action:"focus",state:rt.state,id:h},o.splice(0,0,{name:f.L_Add_To_Current_Route,options:ut,instData:v})));return this._addToRouteMode||(nt=ft.getDirectionTaskOptions(y,i,r.logData.data.EP,t.getTitle(),t.id,2,p),tt=ft.getDirectionTaskOptions(y,i,r.logData.data.EP,t.getTitle(),t.id,1,p),h?(ot={action:"focus",state:tt.state,id:h},o.splice(0,0,{name:f.L_Directions_From,options:ot,instData:a}),st={action:"focus",state:nt.state,id:h},o.splice(0,0,{name:f.L_Directions_To,options:st,instData:l})):(o.splice(0,0,{name:f.L_Directions_From,options:tt,instData:a}),o.splice(0,0,{name:f.L_Directions_To,options:nt,instData:l}))),o},t}(dt),ki=function(t){function i(n,i,r,u,f){var e=t.call(this)||this,h=e._privates,c,l;return h.defineProperty("popOutTemplate",function(n,t){return e._onTemplateChange(n,t)}),h.defineProperty("popOutContent"),h.defineProperty("isDisplayed",function(n,t){return e._onDisplayChange(n,t)},null,{defaultValue:!1}),h.defineProperty("buttonClass"),e.setButtonClass("hidePopupButton"),h.defineProperty("popOut"),h.defineProperty("ariaLabel"),h.defineProperty("dropdownClass"),h.defineProperty("parentClass"),e.setParentClass(f?f:""),e.resources=o,e.dropdownList=new oi,e.setDropdownClass("popOutTop"),n&&e.setDropdown(n),i&&e.setPopOut(i),c=r?r:yr,l=u?u:re,e._dropdownListTemplate=new it(c,{onEntryClicked:function(t){e._dropdownListViewModel.onEntryClicked(t);n.dropdownList&&n.dropdownList[t]&&n.dropdownList[t].subMenu||e.setIsDisplayed(!1)},onEntryMouseover:function(t){e._dropdownListViewModel.onEntryMouseover(t);n.dropdownList&&n.dropdownList[t]&&n.dropdownList[t].subMenu||e.setIsDisplayed(!0)},onEntryMouseout:function(n){e._dropdownListViewModel.onEntryMouseout(n)}}),e._popoutMessageTemplate=new it(l,{onPopOutLinkClick:function(n){return e.onPopOutLinkClicked(n)},onPopOutEditLinkClick:function(n){return e.onPopOutEditLinkClick(n)},onPopOutCloseLinkClick:function(n){return e.onPopOutCloseLinkClick(n)},onPopOutSaveLinkClick:function(n){return e.onPopOutSaveLinkClick(n)},onPopOutKeyPressed:function(n){return i.onKeyPress(n)},onTextBoxClick:function(n){return e.onTextBoxClick(n)},onPopOutClick:function(n){return e.onPopOutClick(n)},onPopOutChangeLinkClick:function(n){return i.onChangeLinkClick(n)},boolToDisplay:function(n){return i.boolToDisplay(n)},boolToNotDisplay:function(n){return i.boolToNotDisplay(n)}}),e.popOutHidden=new s,e.setPopOutTemplate(e._dropdownListTemplate),e.setPopOutContent(e),e._windowKeyupEventHandler=function(n){var i,r=n,t;if(r.keyCode===9){if(t=document.activeElement,(i=t===null||t===void 0?void 0:t.classList)===null||i===void 0?void 0:i.contains("bm_dropdownEntry"))return;e._hideControls()}else r.keyCode===37?e._hideControls():r.keyCode===39&&e._hideControls()},e._windowBlurEventHandler=function(){a.setTimeout(function(n){e.onPopoutMessageBlur(n)},50)},e}return v(i,t),i.prototype.dispose=function(){t.prototype.dispose.call(this);this.dropdownList.clear()},i.prototype.isPopOutInListMode=function(){return this.getPopOutTemplate()===this._dropdownListTemplate},i.prototype.setDropdown=function(t,i){var u=this._dropdownListViewModel&&this._dropdownListViewModel.getButtonElement(),r;u&&u.remove_class("selected");this._dropdownListViewModel=t;r=this._dropdownListViewModel.getButtonElement();r&&r.add_class("selected");this.dropdownList.clear();this.dropdownList.insertAll(this._dropdownListViewModel.dropdownList);this.setPopOutTemplate(i?i:this._dropdownListTemplate);n(window).add_event("keyup",this._windowKeyupEventHandler)},i.prototype.setTemplateToPopOutMessage=function(){var i=this,t;this.setPopOutTemplate(this._popoutMessageTemplate);t=this.getPopOut();t&&t instanceof bu?(t.focusMessageOrTextBox(),a.setTimeout(function(){var t=n(".messageContainer");t.length>0&&t.add_event("blur",i._windowBlurEventHandler)},501)):a.setTimeout(function(){var t=n(".messageContainer");t.length>0&&t[0].focus()},100)},i.prototype.onPopOutLinkClicked=function(n){this.getPopOut().onLinkClick(n);this.setIsDisplayed(!1)},i.prototype.onPopOutEditLinkClick=function(n){this.getPopOut().onEditLinkClick(n);this.setIsDisplayed(!1)},i.prototype.onPopOutCloseLinkClick=function(n){this.getPopOut().onCloseLinkClick(n);this.setIsDisplayed(!1)},i.prototype.onPopOutSaveLinkClick=function(n){var t=this.getPopOut().onSaveLinkClick(n);this.setIsDisplayed(!t)},i.prototype.onTextBoxClick=function(n){n&&n.preventDefault&&n.preventDefault()},i.prototype.onPopOutClick=function(n){n&&n.preventDefault&&n.preventDefault()},i.prototype.onPopoutMessageBlur=function(t){var r,i;t&&t.target&&t.target.classList&&t.target.classList.contains("messageContainer")&&(this.setIsDisplayed(!1),r=this.getParentClass(),r&&(i=n("."+r),i&&i.get_attr("aria-expanded")!==undefined&&i.set_attr("aria-expanded","true")),t.preventDefault(),t.stopImmediatePropagation())},i.prototype.buildPopOut=function(){var r=new it(ie),t=r.applyDataTemplate(this),i=t;return t&&t.getRootElement&&(i=t.getRootElement()),n(i)},i.prototype._onTemplateChange=function(n,t){var i=this._dropdownListViewModel&&this._dropdownListViewModel.getButtonElement(),r=this.getPopOut()&&this.getPopOut().getButtonElement();n===this._dropdownListTemplate?i&&i.remove_class("selected"):n===this._popoutMessageTemplate?r&&r.remove_class("selected"):(i&&i.remove_class("selected"),r&&r.remove_class("selected"));t===this._dropdownListTemplate?i&&i.add_class("selected"):t===this._popoutMessageTemplate&&r&&r.add_class("selected")},i.prototype._onDisplayChange=function(t,i){var r=this._dropdownListViewModel&&this._dropdownListViewModel.getButtonElement(),u=this.getPopOut()&&this.getPopOut().getButtonElement(),f,s=this.getPopOutTemplate(),e,o;s===this._dropdownListTemplate?(u&&u.remove_class("selected"),r&&(f=r,i?(r.add_class("selected"),e=r.select(".feedbackMenuLink"),e&&e.length>0&&r.set_attr("aria-expanded","true")):(r.remove_class("selected"),r.get_attr("aria-expanded")&&r.set_attr("aria-expanded","false")))):s===this._popoutMessageTemplate&&(r&&r.remove_class("selected"),u&&(f=u,i?u.add_class("selected"):u.remove_class("selected")));t&&!i?(this.popOutHidden.invoke(),f&&f.length>0&&f[0].focus(),r&&r.remove_class("selected"),u&&u.remove_class("selected"),n(window).remove_event("keyup",this._windowKeyupEventHandler)):!t&&i&&(o=this.getPopOut(),o&&o.setNickName(""))},i.prototype._hideControls=function(){this.setIsDisplayed(!1);var n=this._dropdownListViewModel&&this._dropdownListViewModel.getButtonElement();n&&n.length>0&&n[0].focus()},i}(bt),is=function(){function t(n,t){this._events=[];this.filterItem=n;this._filterItemTemplateName=t;this.filterOptionClicked=new s;this._viewModelInitialized=!1;this.hideParent=new s}return t.prototype.setViewModelData=function(n,t){this._popOutRootElement=n;this._filterButton=t},t.prototype.filterButtonButtonClicked=function(n){if(n.preventDefault(),this.filterItem.isEnabled()){var t=this._popOutButtonViewModel&&this._popOutButtonViewModel.getIsDisplayed();t||this._showPopOut()}},t.prototype._updatePopOutListDropdownViewModel=function(n){this._popOutButtonViewModel.setDropdown(n)},t.prototype.dispose=function(){this._popOutButtonViewModel&&this._popOutButtonViewModel.dispose()},t.prototype.refresh=function(){this._viewModelInitialized&&this._dropdownViewModel.setDropdown(this._createDropdownListData())},t.prototype._displayPopOut=function(){var n=this;a.setTimeout(function(){n._popOutButtonViewModel.setIsDisplayed(!0)},0)},t.prototype._showPopOut=function(){if(this._initializeViewModels(),this._dropdownViewModel.dropdownList.length>0){var i=e._isFeatureEnabled("mobileMyPlaces")?n("#filterChoiceBar"):this._popOutRootElement.select("div."+t.popOutCssClass);this._updatePopOutListDropdownViewModel(this._dropdownViewModel);i.append(this._popOutElement);this._displayPopOut()}else this.hideParent.invoke()},t.prototype._initializeViewModels=function(){var n=this;this._viewModelInitialized?this._dropdownViewModel.setButtonElement(this._filterButton):(this._dropdownViewModel=new os(this._createDropdownListData(),this._filterButton,this.filterItem.filterType===2),this._popOutButtonViewModel=new ki(this._dropdownViewModel,this._PopOutMessageViewModel,this._filterItemTemplateName,null),this._events.push(this._popOutButtonViewModel.popOutHidden.add(function(){var t;((t=n._dropdownViewModel)===null||t===void 0?void 0:t.dropdownList.length)>1?n.hideParent.invoke():n._popOutButtonViewModel.isPopOutInListMode()||n.hideParent.invoke()})),this._popOutElement=this._popOutButtonViewModel.buildPopOut(),this._viewModelInitialized=!0)},t.prototype._createDropdownListData=function(){for(var n,t=this,r=[],i=0;i<this.filterItem.options.length;i++)n=this.filterItem.options[i],r.push({value:n.value,name:n.label,isSelected:n.isSelected,cssClass:"variant",handler:function(n,i){t._applyViewModelSelection();t.filterOptionClicked.invoke(t.filterItem.options[i])}});return r},t.prototype._applyViewModelSelection=function(){for(var n=0;n<this._dropdownViewModel.dropdownList.length;n++)this.filterItem.options[n].isSelected=this._dropdownViewModel.dropdownList[n].isSelected},t.popOutCssClass="routesPopOut",t}(),rs=function(n){function t(t,i,r,u,f){var e=n.call(this,u)||this;return e.setDropdownData(t,i,r,f),e}return v(t,n),t.prototype.setDropdownData=function(t,i,r,u){n.prototype.setDropdown.call(this,this._populateDropDownListData(t,i,r,u))},t.prototype.onEntryClicked=function(n){if(!(n<0)&&!(n>=this.dropdownList.length)){var t=this.dropdownList[n].options;t.requestState?r.invokeHandler("data-process",t):r.invokeHandler("data-task",t)}},t.prototype._populateDropDownListData=function(n,t,i){var e=[],r,h,o;if(!n||!n.length||!t||!i)return e;var c=t,s=n[0].data.days,l=n[0].processorId;for(r=0;r<=s;r++)(h=ft.getItineraryDayOptions(c,l,r),o=f.L_MoveToDay.replace("{0}",(r+1).toString()),r===s&&(o=f.L_MoveToNewDay,u.isInPrivateMode))||e.push({name:o,options:h});return e},t}(dt),du=function(n){function t(t,i,r,u){var f=n.call(this,r)||this;return f._address=u,f.setDropdownData(t,i),f.contextMenuFinished=new s,f}return v(t,n),t.prototype.setDropdownData=function(t,i){n.prototype.setDropdown.call(this,this._populateDropDownListData(t,i))},t.prototype.setAddress=function(n){this._address=n},t.prototype.buildCategoryIcons=function(n,t,i){var u,f,r;if(this._categories&&this._categories.length!==0&&t&&t.length!==0)for(u=t.select(".nearbyCatIcon"),f=this._categories.length,r=0;r<f;r++)this._drawIcon(n,this._categories[r],u[r],i)},t.prototype.onEntryClicked=function(n){if(n>=0&&n<this.dropdownList.length){var t=this.dropdownList[n];t.options&&t.options.type==="NearbyTransitTask"?r.invokeHandler("data-task",t.options):r.invokeHandler("data-process",t.options);r.invokeHandler("data-instrumentation",t.instData);this.contextMenuFinished.invoke()}},t.prototype._populateDropDownListData=function(n,i){var f=[],o,s,e,h,a,r;if(!n||n.length===0||!i)return f;for(this._categories=n,o="nearbyItem",s="nearbyCatIcon",e=0,h=n;e<h.length;e++){var c=h[e],u=c.Name,l={logData:{feature:"NBC",action:"C",data:{query:u,lat:i.latitude,lon:i.longitude}}};c.Id===t.nearbyTransitCategoryId?(a={location:i,title:this._address,entryPoint:2},f.push({name:u,options:{state:a,type:"NearbyTransitTask"},cssClass:o,instData:l,iconClass:s})):(r={},r.entryPoint="ContextMenu",r.query=u,r.point=[i.latitude,i.longitude],r.nearbyPivotEntity={location:i,title:u},f.push({name:u,options:{requestState:r,type:"LocalSearchTask"},cssClass:o,instData:l,iconClass:s}))}return f},t.prototype._drawIcon=function(n,i,r){var f=i.Id,u=null;eu.contrastMode!=="none"&&(u=t._suggestionHighContrastIconColor);n.getIconTemplate(function(n){var t=n&&n.icon;t&&r.appendChild(t.renderIcon())},n.getBucketForCategory(f,!0),!1,u,24,24)},t._suggestionRoadIconColor="rgb(64,64,64)",t._suggestionAerialIconColor="rgba(255, 255, 255, 0.8)",t._suggestionHighContrastIconColor="rgb(255, 255, 0)",t.nearbyTransitCategoryId="250",t}(dt),us=function(t){function i(){var n=t.call(this)||this,u;n.resources=o;u=n._privates;u.defineProperty("linkTitle",null,function(t,i){return n._convertSaveMessage(t,i)});u.defineProperty("showLink",null,null,{defaultValue:!0});u.defineProperty("showChangeLink",function(t,i){n._onShowChangeLinkChanged(t,i)});n._baseTemplate='<div class="saveLink spaceBeforeLink" data-tag="saveLink" style:display="{TemplateBinding ShowLink Converter=displaySeeItLink}">{0}<\/div>';var h=f.L_SeeIt,l=f.L_SeeItWithChange,a="seeItLink"+(h.indexOf("<link>")!==0?" spaceBeforeLink":""),c=i._linkStart.replace("{0}",a),e=h.replace("<link>",c).replace("<\/link>",i._linkEnd),r=l.replace("<link>",c).replace("<\/link>",i._linkEnd);return r=r.replace("<changelink>",i._changeLinkStart).replace("{1}",f.L_Change).replace("<\/changelink>",i._linkEnd),e=e.replace("{0}",'<TextBlock Text="{TemplateBinding LinkTitle}" />'),r=r.replace("{0}",'<TextBlock Text="{TemplateBinding LinkTitle}" />'),n._templateString=n._baseTemplate.replace("{0}",e),n._templateStringWithChange=n._baseTemplate.replace("{0}",r),n._resetTemplate(n._templateString),n.popupLinkClicked=new s,n.popupChangeLinkClicked=new s,n}return v(i,t),i.prototype._resetTemplate=function(n){var t=this;this.setTemplate(new it(n,{onPopOutLinkClick:function(n){return t._popupLinkClicked(n)},onPopOutChangeLinkClick:function(n){return t._popupChangeLinkClicked(n)},displaySeeItLink:function(n){return t.displaySeeItLink(n)}}))},i.prototype._onShowChangeLinkChanged=function(n,t){t?this._resetTemplate(this._templateStringWithChange):this._resetTemplate(this._templateString)},i.prototype._popupLinkClicked=function(t){(t&&t.preventDefault&&t.preventDefault(),t.type!=="pointerup"||n(".mapContainer .MicrosoftMap").has(t.target))&&this.popupLinkClicked.invoke(t)},i.prototype._popupChangeLinkClicked=function(t){(t&&t.preventDefault&&t.preventDefault(),t.type!=="pointerup"||n(".mapContainer .MicrosoftMap").has(t.target))&&this.popupChangeLinkClicked.invoke(t)},i.prototype.displaySeeItLink=function(n){return n?"":"none"},i.prototype._convertSaveMessage=function(n){return n&&n.length>0||(n=f.L_Favorite_Text),n},i._linkStart='<a href="#" class="{0}" data-tag="seeItLink" event:click="onPopOutLinkClick" event:touchend="onPopOutLinkClick" role="link" aria-label="{TemplateBinding LinkTitle}">',i._changeLinkStart='<a href="#" class="seeItLink spaceBeforeLink" data-tag="changeContainerLink" event:click="onPopOutChangeLinkClick" event:touchend="onPopOutChangeLinkClick" role="link" aria-label="{TemplateBinding LinkTitle}">',i._linkEnd="<\/a>",i._linkText="",i}(kt);it.registerControl("PopUpMessageControl",us);var fs=function(n){function t(t,i,r,u,f,e,o,s){var h=n.call(this,t,o)||this;return h.setDropdownData(null,null,r,u,f,e,s,null,i),h}return v(t,n),t.prototype.setDropdownData=function(t,i,r,u,f,e,o,s,h){n.prototype.setDropdown.call(this,this._populateSaveListData(h,r,u,f,e,o))},t.prototype.onEntryClicked=function(n){if(!(n<0)&&!(n>=this.dropdownList.length)){var t=this.dropdownList[n].options;t.requestState?r.invokeHandler("data-process",t):r.invokeHandler("data-task",t)}},t.prototype._populateSaveListData=function(n,t,i,r,u,f){var y=this,h=[],s;if(!t||!i||!f)return h;var e=t,a=e.getImageUrl&&e.getImageUrl()||null,v=ft.getItineraryAddItemOptions(e.getTitle(),i,t.id,a,r,e.categoryId,e.interests,e.stayDuration),o=f.logData.data,c=o&&o.EP,p=function(){y.contextMenuFinished.invoke()};return c==="ContextMenu"||l.enableOneClickSave||this._pushMostRecentlyUsedListEntries(h,v.requestState.itineraryItem,p,v,u,r,c),s=ft.getMyPlacesTaskOptions(e.getTitle(),i,null,e.getAddress()),s.activateOptions={parentId:r},s.state.data.id=t.id,s.state.entryPoint=o&&(o.EP&&o.EP==="LocalDetails"||o.ID)?3:2,s.state.data.photoUrl=a,this._pushSaveToTempAction(h,s,u,c,!0),h},t}(ku),es=function(n){function t(t,i,r){var u=n.call(this,i)||this;return u.setDropdownData(t,null,r),u}return v(t,n),t.prototype.setDropdownData=function(t,i,r){var a=this,s,v,f,e,u,h,o,c,l;if(i){for(s=[],v=function(n,t){if(t<a.dropdownList.length){var i=a.dropdownList[t].value;i&&window.open(i)}},e=0;e<i.length;e++){if(u=i[e],r){for(f={logData:{feature:r.logData.feature,action:r.logData.action,data:{}}},h=r.logData.data,o=0,c=Object.keys(h);o<c.length;o++)l=c[o],f.logData.data[l]=h[l];f.logData.data.Source=u.DisplayName}s.push({name:u.DisplayName,value:u.Url,handler:v,iconClass:u.DisplayName+" icon",instData:f})}n.prototype.setDropdown.call(this,s)}},t}(dt),os=function(n){function t(t,i,r){var u=n.call(this,i)||this;return u.setDropdown(t),u._isMultipleSelection=r||!1,u._updateItemsCssClasses(),u}return v(t,n),t.prototype.onEntryClicked=function(t){if(t>=0&&t<this.dropdownList.length){var i=this.dropdownList[t];if(i.isSelected&&!this._isMultipleSelection)return;i.isSelected||this._isMultipleSelection||this._unselectAllItems();i.isSelected=!i.isSelected;this._updateItemsCssClasses();n.prototype.onEntryClicked.call(this,t)}},t.prototype._unselectAllItems=function(){for(var n=0;n<this.dropdownList.length;n++)this.dropdownList[n].isSelected=!1},t.prototype._updateItemsCssClasses=function(){for(var i=0;i<this.dropdownList.length;i++){var n=this.dropdownList[i],r=t._selectedCssClass,u=n.cssClass&&n.cssClass.search(r)!==-1;n.isSelected&&!u?n.cssClass&&n.cssClass.length>0?n.cssClass+=" "+r:n.cssClass=r:!n.isSelected&&u&&(n.cssClass=n.cssClass.replace(r,""),n.cssClass=n.cssClass.replace("  "," ").trim())}},t._selectedCssClass="selected",t}(dt),ss=function(n){function t(t,i){var r=n.call(this,i)||this;return r.setDropdown(t),r.taskBarListDropDownTemplate=ee,r.feedbackClickEnable=!1,r}return v(t,n),t.prototype.boolTodisplay=function(n){return n?"inline-block":"none"},t.prototype.onEntryClicked=function(t){if(t>=0&&t<this.dropdownList.length){var i=this.dropdownList[t];i.cssClass!=="feedbackMenuLink"||this.feedbackClickEnable?n.prototype.onEntryClicked.call(this,t):i.mouseoverhandler.call(this,null,t)}},t.prototype.onEntryMouseover=function(n){var r=this,i;n>=0&&n<this.dropdownList.length&&(i=this.dropdownList[n],i.cssClass==="feedbackMenuLink"&&(window.clearTimeout(t._mouseOverDelayHandle),t._mouseOverDelayHandle=a.setTimeout(function(){i.mouseoverhandler.call(r,null,n)},t._mouseTimeout)))},t.prototype.onEntryMouseout=function(n){if(n>=0&&n<this.dropdownList.length){var i=this.dropdownList[n];i.mouseouthandler&&(window.clearTimeout(t._mouseOverDelayHandle),i.mouseouthandler.call(this,null,n))}},t._mouseTimeout=250,t}(dt),et;(function(n){function i(n,i,u){r.invokeHandler("data-instrumentation",{logData:{feature:t,action:n,data:i},flush:u})}var t="PRT";n.Submit="S";n.Activate="A";n.Deactivate="D";n.TaskBar="T";n.Filter="FLTR";n.TaskCardHeader="H";n.TaskType="TYP";n.MapOnly="MO";n.TextOnly="TO";n.MapAndText="MAT";n.log=i})(et||(et={}));var hs=function(t){function i(i){var r=this,u={};return r=t.call(this,ye,"PrintContainer",u,o)||this,r._map=i,r._window=n(window),r.resources=o,r._printDisplayOption=0,r.onPrintDialogClose=new s,r.onPrintDialogOpen=new s,r.generateContextMapUrl(),u.onPrintClick=function(n){return r._onPrintClick(n)},u.onCloseClick=function(n){return r._onCloseClick(n)},u.onMapTextClick=function(t){t.preventDefault();t.stopImmediatePropagation();r._toggleMapAndText(!0,!0,n(".printMapAndText",r.getRootElement()))},u.onMapOnlyClick=function(t){t.preventDefault();t.stopImmediatePropagation();r._toggleMapAndText(!0,!1,n(".printMapOnly",r.getRootElement()))},u.onTextOnlyClick=function(t){t.preventDefault();t.stopImmediatePropagation();r._toggleMapAndText(!1,!0,n(".printTextOnly",r.getRootElement()))},r.notesMaxCharSize=ei.notesMaxChars,r._privates.defineProperty("printContentList"),r.setPrintContentList(new oi),r}return v(i,t),i.prototype.loadPrintMap=function(){var h=this,f,e,r,u;t.prototype.OpenDialog.call(this);f=n(this.getRootElement());e=f.getParent().select(".defaultPrintMessage");e.swap_class("showPrintErrorMessage","hidePrintErrorMessage");f.select(".PrintContainer").set_attr("data-tag","PrintContainer");r=this._getPrintTasksAvailable();r&&(n(".PrintContainer .baseMapPrint").removeFromParent(),this._addPrintPreviewContent());this._setupDialog(r);this._mapHolder=n(".PrintContainer .printMap");var o=this._map.getAzureMap(),i=o.getCamera(),s=o.getStyle().style;i.style=s==="roaddark"?"road":s;i.preserveDrawingBuffer=!0;u=vi.create(this._mapHolder[0],i);u.setCamera({bearing:i.bearing,pitch:i.pitch,type:"jump"});u.events.addOnce("ready",function(){h._finishPrintMapSetup(u,r)})},i.prototype._setupDialog=function(t){var u=this,i=n(this.getRootElement()),r=t?"taskMap":"baseMap";i.select(".printMap").add_class(r);i.select(".printArea").add_class(r);this.setDialogSize(new ru(window.innerWidth,window.innerHeight));this._windowSizeHandler=function(){return u.onWindowResize()};this._window.add_event("resize",this._windowSizeHandler);i.select(".printContent")[0].scrollTop=0;n(".mapAndTextPrint").set_style({display:t?"inline":"none"})},i.prototype.addPrintContent=function(n){n&&this.getPrintContentList().insert(n)},i.prototype.setDialogSize=function(t){if(t.height&&t.width){var r=n(this.getRootElement());r.select(".printContent").set_style({height:(t.height>i.BaseMapHeaderFooterPadding?t.height-i.BaseMapHeaderFooterPadding:0)+"px"})}},i.prototype.onWindowResize=function(){this.setDialogSize(new ru(window.innerWidth,window.innerHeight))},i.prototype._toggleMapAndText=function(t,i,r){var u=n(this.getRootElement()),o,f,e;u.select(".isMap").swap_class(t?"hideMap":"showMap",t?"showMap":"hideMap");u.select(".isText").swap_class(i?"hideText":"showText",i?"showText":"hideText");o=t&&!i;u.select(".taskMapPrint").swap_class(o?"taskMapPrintPageBreak":"taskMapPrintNoPageBreak",o?"taskMapPrintNoPageBreak":"taskMapPrintPageBreak");u.select(".mapTextOptions").remove_class("selected");r.add_class("selected");f=0;e=et.MapAndText;t?i||(f=1,e=et.MapOnly):(f=2,e=et.TextOnly);this._printDisplayOption=f;et.log(et.Filter,{CLK:e})},i.prototype._disableMap=function(){this._printMiniMap.setUserInteraction({interactive:!1});this._azureMapControls&&this._printMiniMap.controls.remove(this._azureMapControls)},i.prototype._enableMap=function(){var n=this._printMiniMap;n.setUserInteraction({interactive:!0});this._azureMapControls||(this._azureMapControls=e.constructCommonControls(!1,!1));n.controls.add(this._azureMapControls,{position:atlas.ControlPosition.TopRight})},i.prototype._finishPrintMapSetup=function(t,i){var h,v,y,c,f,r,o,w,s,a,b,u;for(this._printMiniMap=t,sr.init(this._printMiniMap),this.disposables.push(t),this._disableMap(),this.getRootElement().addEventListener("mousewheel",function(n){n.stopPropagation()}),this._addEditButton(),this._updateLandmarkClickBehavior(),h=this.getPrintContentList(),r=0;r<h.length;r++)v=h[r],i||(y=n(".taskPrintContent",this.getRootElement()),this._addContentToDom(v,y,r));for(c=this._map.getAzureMap(),f=c.layers.getLayers(),t.setTraffic(c.getTraffic()),r=f.length-1;r>=0;r--){var p=f[r],e=p.metadata,l=null;e&&e.noPrint||(e&&"beforeId"in e?l=e.beforeId:r<f.length-1&&(l=f[r+1].getId()),vi.copyMapLayer(this._map,t,p,l))}if(this.onPrintDialogOpen.invoke(),this._printMapReady=!0,this._isPrinted=!1,i){if(o=n(".printMapAndText"),o&&o.length>0)o[0].focus();else for(w=[".waypointNotes",".searchNotes"],s=0,a=w;s<a.length;s++)if(b=a[s],u=n(b),u.length>0){u[0].focus();break}}else u=n("#baseMapNotes"),u&&u.length>0&&u[0].focus()},i.prototype.generateContextMapUrl=function(){var i=ei.printImgOverviewMapUrlFormat,t=this._map.getView().center,n=Math.floor(e.convertZoom(this._map.getView().zoom,0));n=n>4?n-2:ei.minZoomLevel;this.overviewContextMap=i.replace("{credentials}",u.dynamicProperties.sessionKey).replace("{zoom}",n.toString()).replace("{lat}",t[1].toString()).replace("{lon}",t[0].toString()).replace("{cmnPltParam}",u.platformCommonParam)},i.prototype._addEditButton=function(){var e=this,f=n(this.getRootElement()),u=f.select(".printArea"),i,t,r;u&&(i=b._createElement("div"),i.add_class("bm_mapEditButton"),i.set_attr("data-tag","mapEditButton"),t=b._createElement("a"),t.add_class("textButton"),t.set_attr("href","#"),t.set_attr("role","button"),t.set_attr("data-tag","editButton"),t[0].innerHTML=this.resources.L_EditMap_Text,i.append(t),r=f.select(".printMap"),r&&r.length>0?u[0].insertBefore(i[0],r[0]):u.append(i),t.add_event("click",function(n){n.preventDefault();n.stopPropagation();n.cancelBubble=!0;e._toggleEditMap(n)}))},i.prototype._toggleEditMap=function(n){var t=n.target,i=t.innerHTML===this.resources.L_EditMap_Text;i?(t.innerHTML=this.resources.L_EditMapDone_Text,this._enableMap()):(t.innerHTML=this.resources.L_EditMap_Text,this._disableMap())},i.prototype._addPrintPreviewContent=function(){for(var i=this.getPrintContentList(),r=n(".taskPrintContent",this.getRootElement()),t=0;t<i.length;t++)this._addContentToDom(i[t],r,t);n(".svg",this.getRootElement()).inlineDataSvgs().remove_class("svg")},i.prototype._addContentToDom=function(n,t,i){var u=n&&n.getHtmlContent(),f=n&&n.getCssScope(),r;u&&(r=b._createElement("div"),r.add_class(i===0?"bm_firstTaskContent":"bm_taskContent"),r.set_attr("data-tag","taskContent-"+i),f&&r.add_class(f),r[0].innerHTML=u,t.append(r))},i.prototype._getPrintTasksAvailable=function(){for(var t=this.getPrintContentList(),n=0;n<t.length;n++)if(t[n].getHtmlContent()!==null)return!0;return!1},i.prototype._updateLandmarkClickBehavior=function(){},i.prototype._onPrintClick=function(n){var t=this;(n.preventDefault(),this._printMapReady)&&(this.prepareForPrint(),window.addEventListener("afterprint",function(){var n=et.MapAndText;t._printDisplayOption===2?n=et.TextOnly:t._printDisplayOption===1&&(n=et.MapOnly);et.log(et.Submit,{NUM_TASKS:t.getPrintContentList().length,FLTR:n});ei.dialogOpenAfterPrint?t._isPrinted=!0:(t.revertPrintSetup(),t._closeDialog())},{once:!0}),window.print())},i.prototype._onCloseClick=function(n){if(n.preventDefault(),et.log(et.Deactivate),this._isPrinted&&ei.dialogOpenAfterPrint&&(this._isPrinted=!1,this.revertPrintSetup()),ei.dialogOpenAfterPrint){var t=document.getElementsByName("viewport")[0];t&&t.setAttribute("content","user-scalable=no, width=device-width, maximum-scale=1.0")}this._closeDialog()},i.prototype._closeDialog=function(){var t=n(this.getRootElement()),i=t.getParent().select(".defaultPrintMessage");i.swap_class("hidePrintErrorMessage","showPrintErrorMessage");t&&(t.select(".printMap").clear(),t.select(".taskPrintContent").clear());this.onPrintDialogClose.invoke();this.CloseDialog();this.dispose()},i.prototype.prepareForPrint=function(){var t=n(this.getRootElement()),i=t.select(".screenNotes textarea")[0],r=t.select(".printedNotes")[0];i&&r&&(r.innerHTML=n.Internals.HTMLEncode(i.value).replace(/\n/g,"<BR>"));this._printDisplayOption===2&&t.select(".isMap").removeFromParent();n("#bingLogo").inlineDataSvgs().remove_attr("height").remove_attr("width").set_attr("viewBox","50 0 92 92")},i.prototype.revertPrintSetup=function(){var i=n(this.getRootElement()),t=i.select(".printedNotes")[0];t&&(t.innerHTML="")},i.prototype.dispose=function(){this._windowSizeHandler&&(this._window.remove_event("resize",this._windowSizeHandler),this._windowSizeHandler=null);t.prototype.dispose.call(this)},i.BaseMapHeaderFooterPadding=136,i}(lu),dr=function(){function t(i,r){this._map=i;this._taskManager=r;t.onPrintDialogClose=new s;t.onPrintDialogOpen=new s;n(window).add_event("keydown",function(n){n.keyCode===27&&t.onPrintDialogClose.invoke()})}return t.prototype.showPrintDialog=function(n){var u,r,i;n&&(u=window.matchMedia("(orientation: portrait)"),ei.dialogOpenAfterPrint&&u&&(r=document.getElementsByName("viewport")[0],r&&r.setAttribute("content","user-scalable=no, maximum-scale=1.0")),i=new hs(this._map),i.onPrintDialogClose.addOne(function(){return t.onPrintDialogClose.invoke()}),i.onPrintDialogOpen.addOne(function(){return t.onPrintDialogOpen.invoke()}),this._createPrintContent(i,n),i.loadPrintMap(),et.log(et.Activate,{EP:n.source===1?et.TaskBar:et.TaskCardHeader,TYP:n.taskType?n.taskType:"",CD:n.data}))},t.prototype._createPrintContent=function(n,t){var i;if(t.source===2&&t.taskId)i=this._taskManager.getTaskById(t.taskId),i&&i.hasPrintContent()&&n.addPrintContent(i.getPrintContent());else{var u=null,f=this._taskManager.getFocusedStack(),r=f&&f.getForegroundTask();r&&r.hasPrintContent()&&(u=r.getPrintContent(),n.addPrintContent(u))}},t}(),cs=function(t){function i(n,i,r,u,f){var e=t.call(this,n.getAzureMap(),i)||this;return e._taskId=u,i.visible=!0,e.setOptions(i),e.infoboxEnter.add(function(){clearTimeout(e._infoboxCloseDelayHandle)}),e._contentProcessor=new af(n,r,u,f),e._disposables=[e._contentProcessor],e}return v(i,t),i.prototype.setOptions=function(i){var r=this,f=n("#transientLens"),u,e;f.length>0&&f.get_style("visibility")==="visible"||(u=uu.InfoboxContentCreator,i&&i.visible&&i.entity?(e=function(){var n=i.entity,f=st.getDisplayName(i.entity),e,o,c;f&&(f=f.replace("<","").replace(">",""));e=i.entity.getAddress&&i.entity.getAddress();e&&(e=e.replace("<","").replace(">",""));var l=u.createSimpleContent(f||e),s=n.getLocation().getPosition(),v=r.getOptions().pixelOffset,y=i.pixelOffset||v||[20,-45],h=lr.getAdjustedAnchor(r._map,{pixelOffset:y,position:s}),p=h.anchor,w=h.pixelOffset;t.prototype.setOptions.call(r,{anchor:p,visible:!0,pixelOffset:w,htmlContent:l,position:s,animationDuration:250});o=n.getSelectedCategoryForIcon&&n.getSelectedCategoryForIcon();o||n.getPrimaryCategoryPath&&(o=n.getPrimaryCategoryPath());c=b._isAttractionCategory(o);u.createEntityContent(n.id,f,c).then(function(i){var f,e,u;r.isDisposed||(f=r.getOptions(),e=f.position,f.visible&&ai.Position.areEqual(e,s)&&(u=r._contentProcessor.preProcessContent(i,n,r),u&&u.length>0&&(t.prototype.setOptions.call(r,{delayTime:0,htmlContent:u,animationDuration:0}),r._postProcessDelayhandle=a.setTimeout(function(){!r.isDisposed&&r.getOptions().visible&&(r._contentProcessor.postProcessContent(n,r),r._logOpen(n))}))))})},this._infoboxDelayHandle=a.setTimeout(e,250)):(clearTimeout(this._infoboxCloseDelayHandle),this._infoboxCloseDelayHandle=a.setTimeout(function(){t.prototype.setOptions.call(r,{visible:!1,animationDuration:250})},150),clearTimeout(this._infoboxDelayHandle),u.abortContentRequests()))},i.prototype.dispose=function(){t.prototype.dispose.call(this);clearTimeout(this._infoboxDelayHandle);clearTimeout(this._infoboxCloseDelayHandle);clearTimeout(this._postProcessDelayhandle)},i.prototype._logOpen=function(n){var i=st.isLandmarkEntity(n)?u.dynamicProperties.mapsIG:this._getOwnerIG(),t=this._getlogData(n,"EX");t.impressionGuid=i;r.invokeHandler("data-instrumentation",t)},i.prototype._getOwnerIG=function(){for(var u,f,t=n(".taskCard.focus"),r=0;r<t.length;r++)if(u=t[r].getAttribute("data-subtaskid"),this._taskId&&u&&u.indexOf(this._taskId)>-1&&(f=t.select("div[data-ig]"),f.length>0))return f.get_attr("data-ig");return i._tabID},i.prototype._getlogData=function(n,t){var i="",r,u;this._taskId&&(r=this._taskId.indexOf("$"),i=r>-1?this._taskId.substring(0,r):this._taskId);i=i||"Landmark";var f="",e="",o="";return n&&(f=st.getYpid(n),e=st.getDisplayName(n),o=this._getSearchCategoryFromEntity(n)),u={logData:{feature:"INF",action:t,data:{SRC:i,TYP:o,LBL:e,ID:f}}},t==="C"&&(u.logData.data.Q=st.getDisplayName(n)),u},i.prototype._getSearchCategoryFromEntity=function(n){var i,r,u,f,t;return st.isLandmarkEntity(n)?"Landmark":(t=n,t)?((i=t.getPrimaryCategoryName)===null||i===void 0?void 0:i.call(t))||((r=t.getSearchCategory)===null||r===void 0?void 0:r.call(t))||((u=t.getSelectedCategoryForIcon)===null||u===void 0?void 0:u.call(t))||((f=t.getPrimaryCategoryPath)===null||f===void 0?void 0:f.call(t))||"":""},i._tabID=e._hasBingHeaders()&&_G.IG,i}(uu.RichMapsInfobox),ls=function(t){function i(){var i=t.call(this)||this,r=i._privates.defineProperty,u;return r("sharingLinkAvailable",null,null,{defaultValue:!1,isPrivate:!0}),r("permalinkString",null,null,{defaultValue:o.L_Link_Generating_Text,isPrivate:!0}),r("isShortPermalinkDisplayed",null,null,{defaultValue:!1,isPrivate:!0}),r("errorMessage",null,null,{defaultValue:"",isPrivate:!0}),r("enableSharingVisibility",null,null,{defaultValue:ut.isShorteningEnabled?"visible":"hidden",isPrivate:!0}),r("hasAtLeastOneSharableStack",null,null,{defaultValue:!1,isPrivate:!0}),r("enableSocialSharing",null,null,{defaultValue:ut.isEnableSocialSharing,isPrivate:!0}),r("taskList"),r("titleText",null,null,{defaultValue:o.L_Permalink_Prompt}),i.setTaskList([]),i.controlUpdated=new s,u={availableToLinkClass:function(n){return n?"":"nonClickable"},availableToShareButtonClass:function(n){return n?"shareButton":"shareButton nonClickable"},availableToButtonClass:function(n){return n?"textButton":" textButton nonClickable"},displayStateToLinkText:function(n){return n?o.L_LengthenButton_Text:o.L_ShortenButton_Text},errorMessageToVisibility:function(n){return n&&n.length>0?"visible":"hidden"},errorMessageToNotDisplay:function(n){return n&&n.length>0?"none":""},boolToDisplay:function(n){return n?"":"none"},boolToNotDisplay:function(n){return n?"none":""},boolToVisibility:function(n){return n?"visible":"hidden"},onDlgKeydown:function(n){var t=n,r=t.keyCode||t.which;r===27&&i._rootElement.select("*[data-tag='Share.CloseButton']")[0].click()},resources:o},i.setTemplate(new it(pe,u)),i._keydownEventHandler=function(n){return i._onKeydownEvent(n)},n(".".concat("taskLayoutContainer")).add_event("keydown",i._keydownEventHandler),i.rendered.addOne(function(t){var u=t||i,r;i._rootElement=n(u.getRootElement());r=document.execCommand&&typeof document.execCommand("copy")=="boolean";r||i._rootElement.select("a[data-tag='Share.Copy']").set_style({visibility:"hidden"})}),i.dataContext=i,i._lvlParam="",i._cpParam="",i._setTwitterUrl(""),i._setFacebookUrl(""),i}return v(i,t),i.prototype.toggleLinkLength=function(n){this._isDisposed||(n.preventDefault(),this.getIsShortPermalinkDisplayed()?this._updateLongPermalink():this._updateShortPermalink())},i.prototype.titleTextSelection=function(n){return n&&n.length>0?o.ShareHeaderTitle:o.L_Permalink_Prompt},i.prototype.copyToClipboard=function(n){this._isDisposed||(n.preventDefault(),this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select(),document.execCommand("copy"))},i.prototype.urlBoxClick=function(n){n.preventDefault();this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select()},i.prototype.openEmail=function(n){var r=this,e,s,f,p,h,c,l,a;if(!this._isDisposed){n.preventDefault();e=o.L_Link_EmailTitleManyCards_Text;s=this._getOneCardShared();s&&(e="Bing Maps: "+s.getTitle());var t="{0}\n",v=this._taskManager.getStacks(),u,i,y=0;for(f=0,p=v.length;f<p;f++)u=v[f],u&&u.getIsSelected()&&(i=u.getForegroundTask())&&(t+="{bullet}{0}\n".replace("{0}",i.getTitle()),(i.type==="LocalDetailsTask"||i.type==="PolygonEntityDetailsTask")&&(h=i.getOriginalName(),h&&(t+="{bullet}{0}\n".replace("{0}",h)),c=i.getNotes(),c&&(t+="{bullet}{0}\n".replace("{0}",c))),y++);t=t.replace(/{bullet}/g,y>1?" - ":"");t+="\n "+o.L_Link_EmailFooter_Text;l="mailto:?subject={0}&body={1}".replace("{0}",encodeURIComponent(e));a=function(){r._permalink.getCurrentLink(r._map,function(n){r._openEmail(n,l,t)},function(){window.console.log("Could not update permalink on the server, hence not showing email popup for stale content.")})};this.getIsShortPermalinkDisplayed()?this._permalink.shorten(function(n){r._openEmail(n,l,t)},a):a()}},i.prototype.openFacebook=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getFacebookUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,1))}},i.prototype.openTwitter=function(n){if(!this._isDisposed){n.preventDefault();var i=this._getPopUpOptions(),t=this._getTwitterUrl();t&&(window.open(t,"",i),this._logSocialMedia(t,2))}},i.prototype.setInitialData=function(n){var t=this;n.container&&(this._container=n.container,this._container&&!this._taskManager&&this._container.instanceAsyncAll([{name:"TaskManager"}],function(n){t._taskManager=n.TaskManager}))},i.prototype.onSelectionChanged=function(n,t){if(!this._isDisposed&&this._selectedPermalinkParts&&this._selectedPermalinkParts[n]){if(this._selectedPermalinkParts[n].isEnabled=t,this._updateTaskListData(),ut.isShorteningEnabled){var i=this._permalink.isShorteningAvailable();this._privates.setEnableSharingVisibility(i?"visible":"hidden");this._privates.setEnableSocialSharing(ut.isEnableSocialSharing)}this._updateLongPermalink()}},i.prototype.refresh=function(n){var t=this;if(!this._container)throw new Error("SharePanel cannot work without access to container");this._setState(1);this._permalink&&this._taskManager?this._recomputePanelDataAndUX(n):this._container.instanceAsyncAll([{name:"Permalink"},{name:"TaskManager"},{name:"MapShell"},{name:"ShareDataHandler"}],function(i){t._permalink=i.Permalink;t._taskManager=i.TaskManager;t._map=i.MapShell;t._currentSharingOptions=i.ShareDataHandler.currentSharingOptions;i.ShareDataHandler.currentSharingOptions=null;var r=function(){return t._recomputePanelDataAndUX(n)},u=function(){t._resetSharePanelUX(n);t._setState(3)};t._permalink.getGeneralPermalink(t._map,r,u,t._currentSharingOptions.entryPoint)})},i.prototype._addTaskListData=function(){var t,r,f,i,s,e,n;if(this._taskManager&&(t=this._taskManager.getStacks(),t&&t.length>0)){for(r=[],f=-1,i=0,s=t.length;i<s;i++)if(e=t[i],n=e.getForegroundTask(),n&&n.isSharable()&&(n.type!=="CollectionsTask"||n.isPublicCollection&&n.isPublicCollection())){f++;var h=e.getIsSelected(),c=h?o.ClickToUnselect:o.ClickToSelect,u=new gu(n.getTitle(),h,c);u.stackId=t[i].id;u.setIcon(n.getCardIconInfo());u.taskId=t[i].getFirstTask().id;u.setIndex(f);r.push(u)}r.length>0&&(this.setTaskList(r),this._buildTaskList(r))}},i.prototype._buildTaskList=function(t){var l=this,u,a,s,i,r,f,e,w,y,p,o;if(t.length>0&&(u=n(".taskListContainer"),u.length>0)){if(u[0].childNodes.length>0)for(a=u[0].childNodes,s=a.length-1;s>=0;s--)u[0].removeChild(a[s]);for(i=0;i<t.length;i++){var v=t[i],h=v.getIsSelected(),c=b._createElement("li");c.add_class("taskCheckListItem"+i);c.set_attr("data-index",v.getIndex().toString());r=b._createElement("div");r.add_class("taskItem");r.add_class(h?"selected":"unselected");f=b._createElement("div");e=v.getIcon();e.iconElements?(f.append(e.iconElements[0]),f.add_class("catIcon")):(w="titleIcon",f.add_class(e.iconClass?e.iconClass:"srcTsk"),f.add_class(w));y=this._taskManager.getStackById(t[i].stackId);y&&this._setIconBackgroundColor(y,r,n(".taskList"));p=b._createElement("label");p.add_class("taskItemLabel").set_text(t[i].getName());o=b._createElement("input");o.add_class("taskItemCheckbox").add_class(h?"checked":"").set_attr("type","checkbox").set_attr("role","checkbox").set_attr("aria-label",t[i].getTaskAriaLabel()).set_attr("aria-checked",h?"true":"false");o[0].defaultChecked=h;o.add_event("change",function(t){var u,h,v,f,c,e,o;if(t&&l._taskManager){t.preventDefault();t.stopPropagation();var a="taskCheckListItem",i=n(t.target),r=i.get_ancestor(2),s=r.length>0&&r[0].className;if(s&&s.indexOf(a)>-1){if(u=Number(r.get_attr("data-index")),isNaN(u)&&(h=s.slice(a.length,s.length),u=h.indexOf(" ")>0?Number(h.split(" ")[0]):Number(h),isNaN(u)))return;v=l.getTaskList();f=v[u];f.setIsSelected(!f.getIsSelected());c=l._taskManager.getStackById(f.stackId);c&&(e=f.getIsSelected(),c.setIsSelected(e),o=n(r[0].childElementCount>0?n(r[0].children[0]):r),e&&o.has_class("unselected")?(n.Browser.is_ie&&n.Browser.ie_version<12?i[0].setAttribute("checked","checked"):i[0].checked=!0,o.remove_class("unselected").add_class("selected")):!e&&o.has_class("selected")&&(o.add_class("unselected").remove_class("selected"),n.Browser.is_ie&&n.Browser.ie_version<12?i[0].removeAttribute("checked"):i[0].checked=!1),i.set_attr("aria-checked",e?"true":"false"))}}});r[0].appendChild(f[0]);r[0].appendChild(p[0]);r[0].appendChild(o[0]);c[0].appendChild(r[0]);u[0].appendChild(c[0])}}},i.prototype._updateTaskListData=function(){var n=this;this.setTaskList([]);this._addTaskListData();a.setTimeout(function(){n.controlUpdated.invoke({state:n._currentState,control:n})},100)},i.prototype._setIconBackgroundColor=function(t,i,r){var f=this,u=t.getForegroundTask();u&&u.getIconColorAndClassName&&u.getIconColorAndClassName(function(e,o){var s=f._getCardClass(t),h;e&&o&&o!==s&&(h=u.getCardIconInfo(),s&&n(".taskItem",f.getRootElement()).remove_class(s),s=o,i.add_class(f._appendCssForBackground(o,e,h&&h.iconClass?h.iconClass:"srcTsk",r)))})},i.prototype._getCardClass=function(t){var u=n(".PanelWrapper"),i=u&&u.select("[data-taskId='"+t.id+"']")[0].className,r;return t&&t.displayState&&(r="ac"+t.displayState.colorIndex,i.indexOf(r)===-1&&(i+=" "+r)),i},i.prototype._appendCssForBackground=function(n,t,i,r){if(n&&t){var u=this._createCssForBackground(n,t,i);return r.length>0?r[0].appendChild(u):this.getRootElement().append(u),n}return undefined},i.prototype._createCssForBackground=function(n,t,i){var r=document.createElement("style"),u,f;return r.type="text/css",u=".MicrosoftMap .bm_sharePanel .taskItem.",f="".concat(u).concat(n," .catIcon,\n                    ").concat(u).concat(n," .").concat(i,".titleIcon\n                    {background-color:").concat(t,"}"),r.innerHTML=f,r},i.prototype._setTwitterUrl=function(n){this._twitterUrl=n},i.prototype._getTwitterUrl=function(){return this._twitterUrl},i.prototype._setFacebookUrl=function(n){this._facebookUrl=n},i.prototype._getFacebookUrl=function(){return this._facebookUrl},i.prototype._onKeydownEvent=function(t){var i=t,f=i.keyCode||i.which,r,u;f===9&&(r=this.getFirstTabbableChild(n(".".concat("taskLayoutContainer"))[0]),u=this.getErrorMessage()?this._rootElement.select(".urlBox")[0]:this._rootElement.select("#copyButton")[0],i.target!==u||i.shiftKey?i.target===r&&i.shiftKey&&(u.focus(),i.preventDefault()):(r.focus(),i.preventDefault()))},i.prototype._trimEmailBodyIfNecessary=function(n,t,i){var r=t.replace("{0}",i),u=n.length+encodeURIComponent(r).length-3,f;return u>=yt.maxIeUrlLength&&(f=u+o.L_Link_EmailFooter_Text.length+10-yt.maxIeUrlLength,r=r.substr(0,r.length-f)+(" ...\n\n "+o.L_Link_EmailFooter_Text)),r},i.prototype._getOneCardShared=function(){for(var n,r=this._taskManager.getStacks(),t=null,i=0,u=r.length;i<u;i++)if(n=r[i],n&&n.getIsSelected()){if(t)return null;t=n.getForegroundTask()}return t},i.prototype._recomputePanelDataAndUX=function(n){var t=this,i;this._setState(1);i=function(){t._resetSharePanelUX(n);ut.isShorteningEnabled?t._updateShortPermalink():t._updateLongPermalink();var i=t._rootElement.select("*[data-tag='Share.UrlBox']")[0];i.focus();i.select()};n?i():this._recomputeDataModel(i)},i.prototype.dispose=function(){t.prototype.dispose.call(this);n(".".concat("taskLayoutContainer")).remove_event("keydown",this._keydownEventHandler);this._selectedPermalinkParts=null;this._taskManager=null;this._permalink=null;this._isDisposed=!0},i.prototype._recomputeDataModel=function(n){var t=this,l,f,s,e,u,o,a,r,h,c;if(this._selectedPermalinkParts=this._permalink.getPermalinkParts(),this._currentSharingOptions&&this._currentSharingOptions.taskIds&&this._currentSharingOptions.taskIds.length>0)for(l=Object.keys(this._selectedPermalinkParts),f=0,s=l;f<s.length;f++)e=s[f],this._currentSharingOptions.taskIds.indexOf(e)<0&&e!==yt.osidQueryParamName&&(this._selectedPermalinkParts[e].isEnabled=!1);for(u=this._taskManager.getStacks(),o=0,a=u.length;o<a;o++)r=u[o].getForegroundTask(),!r||r.isSharable()&&(r.type!=="CollectionsTask"||r.isPublicCollection())||(h=this._selectedPermalinkParts[r.id],h&&(h.isEnabled=!1));c=function(n,r){var f=function(f){var o,e,s;if(f&&f.length>=yt.maxAllowedSharingLinkLength){o=t._findFarthestTaskId();t._selectedPermalinkParts[o].isEnabled=!1;c(!0,r);return}for(e=0,s=u.length;e<s;e++){var h=u[e],a=h.getForegroundTask().id,l=t._selectedPermalinkParts[a];h.setIsSelected(l&&l.isEnabled)}n===!0&&i.logError(f,3);r&&r()},e=function(){t._setState(3)};t._permalink.getCurrentLink(t._map,f,e)};c(!1,n)},i.prototype._findFarthestTaskId=function(){for(var n=this._taskManager.getStacks(),o=this._taskManager.getFocusedStack(),e=0,u,t=0;t<n.length;t++)if(n[t]===o){e=t;break}for(var i=n.length-1,r=0,f=n[i].getForegroundTask().id;i>=e&&!this._selectedPermalinkParts[f]||!this._selectedPermalinkParts[f].isEnabled;)i--,f=n[i].getForegroundTask().id;for(u=n[r].getForegroundTask().id;r<=e&&!this._selectedPermalinkParts[u]||!this._selectedPermalinkParts[u].isEnabled;)r++,u=n[r].getForegroundTask().id;return t-r>i-t?u:f},i.prototype._resetSharePanelUX=function(t){var u=this._privates.setHasAtLeastOneSharableStack,o,f,r,s,e,i;if(u(!1),this._rootElement.select(".svg").inlineDataSvgs().remove_class("svg"),o=this._map.getStyle(),this._setLightOrDark(o),!t)for(f=this._taskManager.getStacks(),r=0,s=f.length;r<s;r++)if(e=f[r],i=void 0,e&&(i=e.getForegroundTask())&&i.isSharable())if(i.type!=="CollectionsTask"||i.isPublicCollection&&i.isPublicCollection()){u(!0);break}else u(!1);this._updateTaskListData();this._showOrHideScroll();this.setTitleText(this.titleTextSelection(this.getTaskList()));n(".".concat("taskLayoutContainer")).select(".".concat("cardTitleText")).set_attr("tabindex","-1")},i._getStackIndex=function(n,t,i){for(var u,r=0,f=t.length;r<f;r++)if(u=t[r],u&&(n!==null&&n===u.id||i!==null&&u.getForegroundTask().id===i))return r;return-1},i.prototype._updateLongPermalink=function(){var n=this;if(this._setState(1),this._selectedPermalinkParts===null){this.refresh();return}var t=this._privates,r=function(r){r.length>=yt.maxAllowedSharingLinkLength?(n._setState(2),i.logError(r,2)):(u.testHooksEnabled?t.setPermalinkString("Test result"):(t.setPermalinkString(r),n._setTempParamValues(r),n._createSocialMediaLink(r)),t.setIsShortPermalinkDisplayed(!1),n._setState(0))},f=function(){u.testHooksEnabled?t.setPermalinkString("Test result"):(n._setState(3),i.logError("",4))};this._permalink.getCurrentLink(this._map,r,f)},i.prototype._updateShortPermalink=function(){var n=this;this._currentState!==2&&(this._setState(1),this._permalink.shorten(function(t,i){n._privates.setEnableSharingVisibility("visible");n._privates.setIsShortPermalinkDisplayed(!0);n._privates.setPermalinkString(t);n._createSocialMediaLink(t);i&&n._setTempParamValues(i);n._setState(0)},function(){n._privates.setEnableSharingVisibility("hidden");n._updateLongPermalink();i.logError("",1)}))},i.prototype._setState=function(n){this._currentState=n;var t=this._privates;switch(n){case 0:t.setErrorMessage("");t.setSharingLinkAvailable(!0);t.setEnableSocialSharing(ut.isEnableSocialSharing);this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select();break;case 1:t.setErrorMessage("");t.setSharingLinkAvailable(!1);t.setPermalinkString(o.L_Link_Generating_Text);break;case 2:t.setSharingLinkAvailable(!1);t.setIsShortPermalinkDisplayed(!1);t.setPermalinkString("");t.setErrorMessage(o.L_Link_TooManyItemsSelected_Text);t.setEnableSocialSharing(!1);break;default:t.setErrorMessage(o.L_Link_GenerationFailed_Text);t.setIsShortPermalinkDisplayed(!1);t.setSharingLinkAvailable(!1);t.setPermalinkString("");t.setEnableSocialSharing(!1);this._rootElement.select("input[data-tag='Share.UrlBox']")[0].select()}this.controlUpdated.invoke({state:n,control:this})},i.prototype._logEmail=function(n){var t={PL:n};yt.instLog("EC",t)},i.prototype._logEmbed=function(n){var t={PL:n};yt.instLog("EMC",t)},i.prototype._logSocialMedia=function(n,t){var i={PL:n},r=t===1?"FB":"TW";yt.instLog(r,i)},i.logError=function(n,t){var i={PL:n,ERR:t};yt.instLog("SEW",i)},i.prototype._setLightOrDark=function(n){var r=n==="birdseye"||n==="streetside"||n==="hybrid"||n==="aerial"||n==="canvas_dark",t=this._rootElement.select(".header"),i="dark";r?t.add_class(i):t.remove_class(i)},i.prototype._setTempParamValues=function(n){var t=/lvl=([^&]*)/ig.exec(n),i=/cp=([^&]*)/ig.exec(n);t&&t.length&&(this._lvlParam=t[0]);i&&i.length&&(this._cpParam=i[0])},i.prototype._createSocialMediaLink=function(n){var t,i;n?(t=ut.twitterShareUrl.replace("{text}","").replace("{related}",encodeURIComponent("BingMaps,Bing")),this._setTwitterUrl(t.replace("{url}",encodeURIComponent(n))),i=ut.facebookShareUrl.replace("{facebookpage}",encodeURIComponent(ut.facebookRedirectUrl)),this._setFacebookUrl(i.replace("{url}",encodeURIComponent(n)))):this._privates.setEnableSocialSharing(!1)},i.prototype._getPopUpOptions=function(){var n=(screen.availWidth-i._popupWidth)/2,t=(screen.availHeight-i._popupHeight)/2;return"width="+i._popupWidth+",height="+i._popupHeight+",screenX="+n+",screenY="+t+",left="+n+",top="+t+",status,scrollbars,resizable"},i.prototype._openEmail=function(n,t,i){i=this._trimEmailBodyIfNecessary(t,i,n);this._logEmail(n);window.location.href=t.replace("{1}",encodeURIComponent(i))},i.prototype._showOrHideScroll=function(){var i=n("#b_footer"),u;if(i.length>0){var f=i[0].getBoundingClientRect().top,r=n(".linkBox",this.getRootElement()),t=n(".panelWrapper");if(r.length>0&&t.length>0){if(u=r[0].getBoundingClientRect().bottom,u>=f){t.set_style({"overflow-y":"auto"});return}t.set_style({"overflow-y":""})}}},i._popupWidth=550,i._popupHeight=420,i}(kt);it.registerControl("SharePanel",ls);gu=function(n){function t(t,i,r){var u=n.call(this)||this,f=u._privates;return f.defineProperty("name"),f.defineProperty("isSelected"),f.defineProperty("taskAriaLabel"),f.defineProperty("index"),f.defineProperty("icon"),u.setName(t),u.setIsSelected(i),u.setTaskAriaLabel(r),u}return v(t,n),t}(bt);nf=function(n){function t(){var t=n.call(this)||this;return t.signInStateHandler=new ui,t.resources=f,t._privates.defineProperty("signInMessage",null,function(n,i){return t._convertSignInMessage(n,i)}),t._baseTemplate='<div class="signInControlTop" style:display="{TemplateBinding signInStateHandler.IsSignedIn Converter=displaySignInPopUpControl}"><div class="signInMessage">{0}<\/div>{1}<\/div>',t._templateString=t._baseTemplate.replace("{0}","").replace("{1}",""),t._resetTemplate(t._templateString),t.signInClicked=new s,t.signedIn=new s,t.signInStateHandler.notifySignedIn.add(function(n){n&&t.signedIn&&t.signedIn.invoke()}),t}return v(t,n),t.prototype.displaySignInPopUpControl=function(){return this.signInStateHandler.tryUpdateIsSignedIn(),this.signInStateHandler.getIsSignedIn()?"none":"block"},t.prototype._resetTemplate=function(n){var t=this;this.setTemplate(new it(n,{onSignInLinkClick:function(n){return t._onSignInLinkClick(n)},displaySignInPopUpControl:function(n){return t.displaySignInPopUpControl(n)}}))},t.prototype._onSignInLinkClick=function(n){r.invokeHandler("data-instrumentation",{logData:{feature:"CX",action:"SI",data:{SGNIN:"SigningIn"}},isMapsAction:!0});n.preventDefault();this.signInStateHandler.signIn();this.signInClicked.invoke(n);n&&n.preventDefault&&n.preventDefault()},t.prototype._convertSignInMessage=function(n){var i="",r="",u;if(n)switch(n.indexOf("<link>")){case-1:i=n;u=t._cardifiedSignInButton;r=u.replace("{0}",this.resources.L_SignInLink_Text);break;case 0:i=n.replace("<link>",t._linkStart).replace("<\/link>",t._linkEnd);break;default:i=n.replace("<link>",t._linkStartSpaceBefore).replace("<\/link>",t._linkEnd)}else i=t._linkStart.concat(this.resources.L_SignInLink_Text,t._linkEnd);return this._templateString=this._baseTemplate.replace("{0}",i).replace("{1}",r),this._resetTemplate(this._templateString),n},t._linkStart='<a href="#" class="signInLink" event:click="onSignInLinkClick" event:touchend="onSignInLinkClick" data-tag="signInLink">',t._linkStartSpaceBefore='<a href="#" class="signInLink spaceBeforeLink" event:click="onSignInLinkClick" event:touchend="onSignInLinkClick" data-tag="signInLink">',t._linkEnd="<\/a>",t._cardifiedSignInButton='<a href="#" class="signInButton secondaryButton" event:click="onSignInLinkClick" event:touchend="onSignInLinkClick" data-tag="signInLink">{0}<\/a>',t}(kt);it.registerControl("SignInPopUpControl",nf);var as=function(t){function i(n,i,r,u,f){var e=t.call(this,f,u)||this;return e._slideOutMenu=n,e._container=i,e._map=r,e._initializeMenuItems(),e}return v(i,t),i.prototype.showMenu=function(){this._initMapTypeSelector();this.getControl().add_class("opened")},i.prototype.hideMenu=function(){this.getControl().remove_class("opened")},i.prototype.clickBackgroundHandler=function(){this.hideMenu()},i.prototype._clickHandler=function(){this.hideMenu()},i.prototype._initializeMenuItems=function(){this.menuItems=[];this._createAndAddDirectionsMenu();this._createAndAddTrafficMenu();this._createAndAddMapTypeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddSeeAllCardsMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddBingHomeMenu();this.menuItems.push(this._createMenuSeparater());this._createAndAddFeedbackExitPreivewMenu()},i.prototype._createMenuSeparater=function(){var n=new tf;return n.type="menuSeparater",n},i.prototype._createMenuItem=function(n,t,i,r){var f=this,u;return i===void 0&&(i=undefined),r===void 0&&(r=!1),u=new tf,u.type="menuItem",u.name=n,u.cssClass=t,u.clickHandler=function(n){n.preventDefault();i&&i();r||f._clickHandler()},u},i.prototype._createAndAddMenuItem=function(n,t,i,r){i===void 0&&(i=undefined);r===void 0&&(r=!1);var u=this._createMenuItem(n,t,i,r);return this.menuItems.push(u),u},i.prototype._createAndAddDirectionsMenu=function(){this._createAndAddMenuItem(o.L_TaskBar_Label_Directions,"directionsMenu",function(){r.invokeHandler("data-task",{type:"DirectionsTask",state:{entryPoint:8}})})},i.prototype._createAndAddTrafficMenu=function(){},i.prototype._createAndAddMapTypeMenu=function(){var n=this;this._createAndAddMenuItem(o.L_SlideOutMenu_MapType,"mapMenu",null,!0);this._createAndAddMenuItem(o.L_SlideOutMenu_MapType_Road,"mapTypeItem",function(){n._changeMapType("r")});this._createAndAddMenuItem(o.L_SlideOutMenu_MapType_Aerial,"mapTypeItem",function(){n._changeMapType("a")});this._createAndAddMenuItem(o.L_SlideOutMenu_MapType_Birdseye,"mapTypeItem",function(){n._changeMapType("be2")})},i.prototype._createAndAddSeeAllCardsMenu=function(){this._createAndAddMenuItem(o.L_SlideOutMenu_SeeAllCards,"allCardsMenu",function(){r.invokeHandler("data-layout",{action:"updateLayout",state:{layoutType:"listView"}})})},i.prototype._createAndAddBingHomeMenu=function(){this._createAndAddMenuItem(o.L_SlideOutMenu_BingHome,"homeMenu",function(){window.location.href="/"})},i.prototype._createAndAddFeedbackExitPreivewMenu=function(){var t=this,i=this._createAndAddMenuItem(o.L_SlideOutMenu_Feedback,"feedbackMenu",function(){var n={type:"FeedbackTask",state:{entryPoint:5,feedbackTaskType:2,activeTaskId:null,title:o.L_SlideOutMenu_Feedback}};r.invokeHandler("data-task",n)}),n;i.htmlId="sli_feedback";n=this._createAndAddMenuItem(o.L_SlideOutMenu_ExitPreview,"exitMenu",function(){t._slideOutMenu.exitPreview.invoke()});n.htmlId="sli_exit"},i.prototype._changeMapType=function(){},i.prototype._initMapTypeSelector=function(){},i.prototype._selectMapType=function(t){var i=n(".mapTypeItem");i.length===3&&(i.remove_class("selected"),n(i[t]).add_class("selected"))},i}(ri),nl=function(){function n(n,t,i){this._viewModel=new as(this,n,t,bf,i);this.exitPreview=new s;var u=this._viewModel.getControl(),r=t.getRootElement();r.getParent().insertBefore(u,r);typeof Feedback!="undefined"&&(Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_feedback",!1,!0,!1),Feedback.Bootstrap.InitializeFeedback({structured:!0},"sli_exit",!1,!0,!1))}return n.prototype.showMenu=function(){this._viewModel.showMenu()},n}(),tf=function(){function n(){}return n}(),vs=function(t){function i(n,i){var r=t.call(this)||this,u;return r.id=i,u=r._privates,u.defineProperty("title"),u.defineProperty("imageClass"),u.defineProperty("canvas"),u.defineProperty("closeTitle"),u.defineProperty("capsuleTitle"),u.defineProperty("backgroundColor"),r.setTitle(n),r.setCanvas(null),r.setCloseTitle(o.L_RemoveFromMap),r.setCapsuleTitle(o.L_EditYourSearch),r}return v(i,t),i.prototype.insertIcon=function(){var r=this.getCanvas(),i,t;r&&(i=n(document.getElementById(this.id)),i&&i.length>0&&(t=n(".bm_cardImage",i[0]),t&&t.length>0&&(t.clear(),t.append(r))))},i}(bt),tl=function(){function t(n){this._rootElement=n;this.animationCompleted=new s}return t.prototype.startAnimation=function(n,t,i,r){var u=this;a.setTimeout(function(){u._startAnimationInternal(n,t,i,r)},1)},t.prototype._startAnimationInternal=function(t,i,r,u){if(this._capsulesList=n(".bm_cardItem",this._rootElement[0]),this._overflowCounter=n(".bm_overflowCounter",this._rootElement[0]),this._capsulesList.length>0&&this._overflowCounter.length>0){var o=t?t.length:0,f=i?i.length:0,e=f+u;this._onCardChanged(t,i,e)}this.animationCompleted.invoke()},t.prototype._onCardChanged=function(t,i,r){var u="animatedOpen",f="animatedOpen",s=t&&t[0],h=i&&i[0],e,o;s===h&&(u="normalOpen");e=t&&t[1];o=i&&i[1];e===o&&(f="normalOpen");r===1&&this._capsulesList.length>=1?n(this._capsulesList[0]).add_class(u):r===2&&this._capsulesList.length>=2?(n(this._capsulesList[0]).add_class(u),n(this._capsulesList[1]).add_class(f)):r>2&&this._capsulesList.length>=2&&(n(this._capsulesList[0]).add_class(u),n(this._capsulesList[1]).add_class(f),this._overflowCounter.has_class("animatedOpen")||this._overflowCounter.has_class("normalOpen")||this._overflowCounter.add_class("animatedOpen"))},t}(),ys=function(){function t(n){this._rootElement=n;this.animationCompleted=new s}return t.prototype.startAnimation=function(n,t){var i=this;a.setTimeout(function(){i._startAnimationInternal(n,t)},1)},t.prototype._startAnimationInternal=function(t,i){this._capsulesList=n(".bm_cardItem",this._rootElement[0]);this._overflowCounter=n(".bm_overflowCounter",this._rootElement[0]);this._onCardChanged(t,i);this.animationCompleted.invoke()},t.prototype._onCardChanged=function(t,i){t&&t.length>0&&this._capsulesList.length>=1&&n(this._capsulesList[0]).add_class("animatedOpen");i>0&&(this._overflowCounter.has_class("animatedOpen")||this._overflowCounter.has_class("normalOpen")||this._overflowCounter.add_class("animatedOpen"))},t}(),rf=function(){function t(t,i,r,u){var f=this,e,o,s;this._capsuleClicked=!1;this._taskBarViewModel=t;this._searchBoxViewModel=u;this._taskManager=i;this._map=r;this._nonXSRCategories=["search","address","place","directions","traffic","myplaces","feedback","transit","measure","itinerary"];this._cardsList=new yi(50);e=r.getAzureMap();e&&(o=function(){f._showOrHidePopout(!1)},vt.add(e,"moveend",o),vt.add(e,"mousedown",o));this._taskManager.newStackListCreated.add(function(){f._onNewStacksAddedFromBrowserHistory(f._taskManager.getStacks())});this._taskManager.stackAdded.add(function(n){f._onStackAdded(n.stack,n.task)});this._taskManager.stackRemoved.add(function(n){var r=n&&n.stack,e,o,i,u,t;if(r)if(f._stackIdToBeRemovedDueToSearchFromSearchBox||n.disableFindingFocusedStack){for(f._stackIdToBeRemovedDueToSearchFromSearchBox=null,i=f._cardsList.convertToArray(),f._cardsList=new yi(50),u=i.length,t=u-1;t>=0;t--)i[t].id!==r.id&&f._cardsList.addItem(i[t].id,i[t]);n.disableFindingFocusedStack&&f._updateOverflowListOnTaskBar()}else{if(e=f._entrypointForCloseFromCapsule?"closeFromCapsule":"closeFromCard",f._entrypointForCloseFromCapsule)for(o=1,i=f._cardsList.convertToArray(),t=0,u=i.length;t<u;t++)if(i[t].id===r.id){t>o&&(e="closeFromOverflow");break}f._updateCardsList(r.id,null,1,e);f._entrypointForCloseFromCapsule=!1}});this._taskManager.secondaryTaskAdded.add(function(n){var t=n&&n.stack,i;t&&(i=f._cardsList.convertToArray(),i&&i.length>0&&i[0].id!==t.id&&(t.setDisplayState({isHidden:!1}),f._updateCardsList(t.id,f._getCardItem(t.id),2)))});this._taskManager.stackFocused.add(function(n){var r=n&&n.stack,t,i,u;r&&(t=f._getCardItem(r.id),i=f._cardsList.convertToArray(),i&&i.length>0&&t&&i.indexOf(t)!==0&&(u=f._taskManager.getStackById(i[0].id),u&&u.setDisplayState({isHidden:!0}),r&&r.setDisplayState({isHidden:!1}),f._updateCardsList(t.id,t,2)))});window.addEventListener("click",function(t){var i=n(t.target),r=f._taskBarViewModel.getOverflowCapsuleListCount();i.has_class("bm_overflowCardClose")&&r>0||f._showOrHidePopout(!1)});s=this._taskBarViewModel.getControl();this._cardsAnimationSearchInsideManager=new ys(s);n(window).add_event("keyup",function(n){f._onEscapeEvent(n)})}return t.prototype._onEscapeEvent=function(t){var i,u,r;this._searchTermInsertedIntoSearchBoxFromCapsule&&(i=t,i&&i.keyCode&&i.keyCode===27&&(u=this._taskBarViewModel.getControl(),r=n("#maps_sb",u[0]),this._taskBarViewModel.setOverflowExpanded(!1),r&&r[0].blur()))},t.prototype._onNewStacksAddedFromBrowserHistory=function(n){var r=this,t,o,i,s;if(n&&n.length>0){this._previousSearchTooltipShown=!0;this._reactivateTooltipShown=!0;var u=[],f=0,e=function(t){var e,i,f;if(t===n.length){for(r._cardsList=new yi(50),i=0;i<u.length;i++)u[i].dispose();for(e=void 0,i=0;i<n.length;i++)f=n[i],f&&f.displayState&&!f.displayState.isHidden?e=i:r._onStackAdded(f,f.getFirstTask());typeof e!="undefined"&&r._onStackAdded(n[e],n[e].getFirstTask())}};for(t=0;t<n.length;t++)o=n[t],i=o.getFirstTask(),i?i.getPercentLoaded()===1?e(++f):(s=i.changed.add(function(n){n&&n.name==="percentLoaded"&&n.newValue===1&&e(++f)}),u.push(s)):e(++f)}else this._cardsList=new yi(50),this._updateOverflowListOnTaskBar()},t.prototype._onStackAdded=function(i,r){var u=this,f=function(){var f,e,o;u._taskManager.getStackById(i.id)&&(u._stackIdToBeRemovedDueToSearchFromSearchBox&&u._taskManager.removeTaskStack(u._stackIdToBeRemovedDueToSearchFromSearchBox),f=u._getCardItem(i.id),f||(e=void 0,u._searchTermFromSearchBox?e=u._searchTermFromSearchBox:(o=r._taskState,e=(o===null||o===void 0?void 0:o.originalQuery)||r.getTitle()),u._searchTermFromSearchBox=null,f=new vs(e,i.id),u._selectorReady().then(function(n){var i=t._getCategory(n,r);u._setImageClass(i,f);r.getIconColorAndClassName(function(n){n&&f.setBackgroundColor(n)});u._setCardIcon(n,i,f)}),f.cardCloseHandler=function(n){n.preventDefault();n.stopImmediatePropagation();u._entrypointForCloseFromCapsule=!0;u._taskManager.removeTaskStack(i.id)},f.cardCloseKeyDownHandler=function(t){var i,r,s,e,o;t.preventDefault();t.stopImmediatePropagation();i=t;i.keyCode===9?i.shiftKey?(o=n(".bm_overflowCardText",t.target.parentElement),o.length>0&&(o.set_attr("tabindex","0"),o[0].focus())):(r=u._cardsList.convertToArray(),s=r.indexOf(f),s>=r.length-1&&(u._showOrHidePopout(!0),s===r.length-1&&(e=n(".bm_clearAllLink"),e.length>0&&(e.set_attr("tabindex","0"),e[0].focus())))):i.keyCode===13&&f.cardCloseHandler(t)},f.overflowTitleClickHandler=function(n){var t,i,r;n.preventDefault();t=u._taskManager.getStackById(f.id);i=u._taskManager.getFocusedStack();t!==i&&(i&&i.setDisplayState({isHidden:!0}),t&&(t.displayState.cardTitleHoveringState===1&&t.setDisplayState({cardTitleHoveringState:2}),t.setDisplayState({isHidden:!1}),u._taskManager.toggleStack(t)),r=u._cardsList.convertToArray().indexOf(f),u._log({T:"CI.SearchCardReactivated",feature:"SearchPrototype",action:"CI.SearchCardReactivated",data:{entryPoint:"overflow"}}));u._updateCardsList(f.id,f,2)},f.overflowTitleTouchHandler=function(n){f.overflowTitleClickHandler(n);u._showOrHidePopout(!1)},f.overflowTitleKeyDownHandler=function(t){var r=t,o=u._cardsList.convertToArray().indexOf(f),s,e,h,i,c;r.keyCode===13?(f.overflowTitleClickHandler(t),u._showOrHidePopout(!1)):r.keyCode===40?o!==u._cardsList.getCount()-1&&(t.preventDefault(),t.stopImmediatePropagation(),e=n(document.getElementById(f.id)),s=e.get_sibling(1),s.length>0&&(i=n(".bm_overflowCardText",s[0]),i.length>0&&i[0].focus())):r.keyCode===38?o!==1&&(t.preventDefault(),t.stopImmediatePropagation(),e=n(document.getElementById(f.id)),h=e.get_sibling(-1),h.length>0&&(i=n(".bm_overflowCardText",h[0]),i.length>0&&i[0].focus())):r.keyCode===9&&r.shiftKey&&o===1&&(t.preventDefault(),t.stopImmediatePropagation(),u._showOrHidePopout(!1),c=n(".bm_overflowCountContainer"),c.length>0&&c[0].focus())},f.overflowTitleMouseoverHandler=function(n){var t=u._taskManager.getStackById(f.id);t&&t.setDisplayState({cardTitleHoveringState:1});u._log({T:"CI.CapsuleTitleHover",feature:"SearchPrototype",action:"CI.CapsuleTitleHover",data:null});n.preventDefault()},f.overflowTitleMouseoutHandler=function(t){var i,r,e;try{i=n(document.getElementById(f.id));i.length>0&&(r=n(".bm_overflowCardText",i[0]),r.length>0&&r[0].blur());e=u._taskManager.getStackById(f.id);e&&e.setDisplayState({cardTitleHoveringState:2})}finally{t.preventDefault()}},u._updateCardsList(f.id,f,0)))},e;i&&r&&(e=this._getCardItem(i.id),e||(i.changed.add(function(n){var t,i;n&&n.name==="foregroundTask"&&(t=n.newValue,t&&(i=u._getCardItem(t.stackId),i&&(i.setTitle(t.getTitle()),i.setCloseTitle(o.L_RemoveFromMap),u._updateQueryTerm())))}),r.changed.add(function(n){var t,i;n&&(n.name==="percentLoaded"&&n.newValue===1?f():n.name==="title"?(t=u._getCardItem(r.stackId),t&&(t.setTitle(n.newValue),t.setCloseTitle(o.L_RemoveFromMap),u._updateQueryTerm())):(n.name==="catid"||n.name==="catId")&&(i=u._getCardItem(r.stackId),i&&r.getIconColorAndClassName(function(n){n&&i.setBackgroundColor(n)})))}),r.getPercentLoaded()===1&&f()))},t.prototype._getCardItem=function(n){for(var i=this._cardsList.convertToArray(),t=0,r=i.length;t<r;t++)if(i[t].id===n)return i[t];return null},t.prototype._updateCardsList=function(n,t,i,r){var u,o,e,s,f;if(i===0)this._cardsList.addItem(n,t);else if(i===2)this._changeMapModeOnCardSelection(),this._cardsList.getItem(n);else if(i===1)for(this._log({T:"CI.SearchCardDeleted",feature:"SearchPrototype",action:"CI.SearchCardDeleted",data:{entryPoint:r}}),u=this._cardsList.convertToArray(),u&&u[0]&&u[0].id===n&&(o=u[1],o&&(e=this._taskManager.getStackById(o.id),e&&(e.setDisplayState({isHidden:!1}),this._taskManager.toggleStack(e)))),this._cardsList=new yi(50),s=u.length,f=s-1;f>=0;f--)u[f].id!==n&&this._cardsList.addItem(u[f].id,u[f]);this._updateOverflowListOnTaskBar()},t.prototype._changeMapModeOnCardSelection=function(){},t.prototype._updateOverflowListOnTaskBar=function(){for(var r,s=this,o=1,t=new oi,u=this._cardsList.convertToArray(),f=0,i=o,e=u.length;i<e;i++)f>=0&&t.insert(u[i]),f++;for(f===0&&this._showOrHidePreviousSearchTip(!1),r=this._taskBarViewModel,r.setOverflowCapsuleList(t),r.getOverflowCapsuleListCount()===0&&t.length>0&&this._log({T:"CI.SearchOverflowCounter",feature:"SearchPrototype",action:"CI.SearchOverflowCounterShown",data:null}),r.getOverflowCapsuleListCount()===1&&t.length===0&&this._showOrHidePopout(!1),r.setOverflowCapsuleListCount(t.length),t.length>7?(n(".bm_popoutTop1").add_class("scroll"),n(".bm_overflowPopout").add_class("scroll")):(n(".bm_popoutTop1").remove_class("scroll"),n(".bm_overflowPopout").remove_class("scroll")),this._updateQueryTerm(),i=o,e=u.length;i<e;i++)u[i].insertIcon();this._cardsAnimationSearchInsideManager.animationCompleted.addOne(function(){t.length>0&&s._showOrHidePreviousSearchTipOnOverflowShown(!0);ti.isSafari&&setTimeout(function(){r.resizeOnOverlayOpened()},100)});this._cardsAnimationSearchInsideManager.startAnimation(t,t.length);r.resizeOnOverlayOpened()},t.prototype._updateQueryTerm=function(){var n,i,r,t;p.updateSearchTerm&&(n=this._cardsList.convertToArray(),i=n&&n.length>0?n[0].getTitle():"",p.updateSearchTermWithTaskTitle&&n&&n.length>0&&(r=this._taskManager.getStackById(n[0].id),r&&(t=r.getFirstTask(),t&&t._taskState&&(t._taskState.originalQuery||t._taskState.taskTitle)&&(i=t._taskState.originalQuery||t._taskState.taskTitle))),this._taskBarViewModel.setSearchTerm(i))},t.prototype._showOrHidePopout=function(t){var o=this._map.getRootElement(),r=o&&o.getParent(),s=r&&r.length>0&&r[0],u,i;if(s&&(u=n(".bm_overflowPopout",s).get_style("display"),(t&&u==="none"||!t&&u==="block")&&(i=this._taskBarViewModel.getControl(),this._overflowPopoutShown=t,i.length>0))){this._log({T:"CI.SearchOverflowPopout",feature:"SearchPrototype",action:"CI.SearchOverflowPopout",data:{isShown:t}});var f=n(".bm_overflowPopout",i[0]),e=n(".bm_overflowBox",i[0]),h=n(".bm_outsideBeak",i[0]);f.length>0&&e.length>0&&(f.set_style({display:t?"block":"none"}),h.length>0&&h.set_style({display:t?"block":"none"}),t&&(this._showOrHidePreviousSearchTip(!1),e.add_class("active"),a.setTimeout(function(){var t=n(".bm_overflowCardText",f[0]);t.length>0&&(t[0].focus(),t.getParent().fireEvent("hover"))},20)),t||(e.remove_class("active"),this._taskBarViewModel.setOverflowExpanded(!1)))}},t.prototype._showOrHideReactivateTip=function(t){var i=this;this._reactivateTooltipShown||(this._log({T:"CI.SearchReactivateTip",feature:"SearchPrototype",action:"CI.SearchReactivateTip",data:{isShown:t}}),t?n("#ReactivateSearchTip").add_class("opened"):n("#ReactivateSearchTip").remove_class("opened"),t&&a.setTimeout(function(){i._showOrHideReactivateTip(!1);i._reactivateTooltipShown=!0},4e3))},t.prototype._showOrHidePreviousSearchTipOnOverflowShown=function(n){var t=this;this._previousSearchTooltipShown||(this._log({T:"CI.PreviousSearchTip",feature:"SearchPrototype",action:"CI.PreviousSearchTip",data:{isShown:n}}),this._showOrHidePreviousSearchTip(n),n&&a.setTimeout(function(){t._showOrHidePreviousSearchTipOnOverflowShown(!1);t._previousSearchTooltipShown=!0},4e3))},t.prototype._showOrHidePreviousSearchTip=function(t){t?n("#PreviousSearchTip").add_class("opened"):n("#PreviousSearchTip").remove_class("opened")},t.prototype._log=function(n){var t=Microsoft.Maps.logger;t&&t.logObject(n)},t.prototype.onSearchInvokedFromTaskbar=function(n){if(this._newSearchInitiatedFromTaskbar=!0,this._searchTermFromSearchBox=n,this._searchTermInsertedIntoSearchBoxFromCapsule){var t=this._cardsList.convertToArray();t&&t.length>0&&(this._stackIdToBeRemovedDueToSearchFromSearchBox=t[0].id)}},t.prototype.overflowClick=function(n){window.clearTimeout(t._popoutHideHandler);this._overflowPopoutShown?this._showOrHidePopout(!1):this._showOrHidePopout(!0);n&&(n.preventDefault&&n.preventDefault(),n.stopImmediatePropagation())},t.prototype.overflowKeyDown=function(n){var t=n;t.keyCode===13&&this.overflowClick(n)},t.prototype.overflowMouseOver=function(n){this._overflowPopoutShown||this._showOrHidePreviousSearchTip(!0);n&&n.preventDefault()},t.prototype.overflowMouseOut=function(n){this._showOrHidePreviousSearchTip(!1);n&&n.preventDefault()},t.prototype.popoutMouseoverHandler=function(n){window.clearTimeout(t._popoutHideHandler);n&&n.preventDefault&&n.preventDefault()},t.prototype.clearAllClickHandler=function(n){var r,t,i,u,f;if(n&&n.preventDefault&&n.preventDefault(),r=this._taskBarViewModel,t=r.getOverflowCapsuleList(),t)for(i=0,u=t.length;i<u;i++)f=t[i],this._taskManager.removeTaskStack(f.id)},t.prototype.clearAllKeyDownHandler=function(t){var i,r;if(t&&t.preventDefault&&t.preventDefault(),i=t,i)if(i.keyCode===13)this.clearAllClickHandler(t);else if(i.keyCode===9)if(i.shiftKey){this._showOrHidePopout(!0);var f=this._cardsList.convertToArray(),e=n(".bm_overflowItem")[f.length-1],u=n(".bm_overflowCardClose",e);u.set_attr("tabindex","0");u[0].focus()}else this._showOrHidePopout(!1),r=this._taskBarViewModel,r&&r.setSearchBoxFocus()},t.prototype.sbCloseTaskHandler=function(n){var f,e,t,u,i,o,s;if((n.preventDefault(),n.stopImmediatePropagation(),!this._searchBoxViewModel.getCloseDisable())&&(f=this._cardsList.convertToArray()[0],e=f&&this._taskManager.getStackById(f.id),e))for(t=e.getAllTasks(),u=0;u<t.length;u++)if(i=t[u],!i.displayState||i.displayState.stackOrder===1||i.displayState.prominence===1&&t.length===1){o=i.id;s={logData:{feature:"SB",action:"C",data:{BN:n.target.classList,TID:o}}};r.invokeHandler("data-instrumentation",s);(this._taskManager.getStacks().length>1||t.length>1)&&this._searchBoxViewModel.setCloseDisable(!0);this._taskManager.removeTaskAndReseatChild(o);break}},t.prototype.popoutMouseoutHandler=function(n){var i=this;t._popoutHideHandler=a.setTimeout(function(){i._showOrHidePopout(!1)},500);n&&n.preventDefault&&n.preventDefault()},t.prototype._setImageClass=function(n,t){var i,r;n&&(i="",n.indexOf("search")>-1?i="maps_searchsvg":n.indexOf("myplaces")>-1?i="maps_myplacessvg":n.indexOf("place")>-1||n.indexOf("address")>-1?i="maps_addresssvg":n.indexOf("directions")>-1?i="maps_carsvg":n.indexOf("traffic")>-1?i="maps_trafficsvg":n.indexOf("feedback")>-1?i="maps_feedbacksvg":n.indexOf("transit")>-1?i="maps_transitsvg":n.indexOf("itinerary")>-1?i="maps_itinerarysvg":n.indexOf("measure")>-1?i="maps_measuresvg":n.length>0&&(i=n),r="bm_cardImage",i.length>0&&(r+=" "+i),t.setImageClass(r))},t.prototype._setCardIcon=function(t,i,r){i&&this._nonXSRCategories.indexOf(i)===-1&&!r.getCanvas()&&t.getIconTemplate(function(t){var u=t&&t.icon,i;u&&(i=u.renderIcon(),i&&(r.setCanvas(n(i)),r.insertIcon()))},t.getBucketForCategory(i,!0),!1,"#FFF",20,20)},t.prototype._selectorReady=function(){return this._baseMapTemplateSelector||(this._baseMapTemplateSelector=this._map.getTemplateSelector()),this._baseMapTemplateSelector.selectorReady()},t._getCategory=function(n,i){if(i){var r=i.type;return r==="DirectionsTask"||r==="DirectionsFlipTask"?"directions":r==="TrafficTask"||r==="TrafficFlipTask"?"traffic":r==="CollectionsTask"?"myplaces":r==="FeedbackTask"?"feedback":r==="TransitLineTask"||r==="TransitStopTask"||r==="NearbyTransitTask"?"transit":r==="ItineraryListingsTask"||r==="ItineraryDetailsTask"?"itinerary":r==="VenueMapTask"?"90892":r==="MeasureMapTask"?"measure":r==="MyContributionsTask"?"myContributions":r==="MyContributionsV2Task"?"myContributionsV2":r==="MyContributionsV3Task"?"myContributionsV3":r==="MyContributionsAndRewardsTask"?"myContributionsAndRewards":t._getSearchCategory(n,i)}return"search"},t._getSearchCategory=function(n,t){var h=["Place","City","Events"],r,u,f,e,s,i,o;if(t){if(r=t.viewModel,r){if(r.categoryFound)return t.viewModel.getCardCategoryId();if(u=r&&r.getEntities(),u&&u.length>-1&&(f=u[0],f)){if(e=f.getPrimaryCategoryPath(),e)return(s=n.extractCategoryId(e,!1),!s)?e in h?"place":"search":s;if(i=f.getSegmentTypes(),i&&i.length>0)return(o=i[0],h.indexOf(o)>-1)?"place":o.indexOf("Local")>-1?i.length>1?i[1]:"place":o}}return"place"}return undefined},t}(),gr=function(n){function t(){var i=n.call(this)||this,t=i._privates;return t.defineProperty("isActive"),t.defineProperty("dataTag"),t.defineProperty("showLabel"),t.defineProperty("popoutClass"),t.defineProperty("ariaExpanded"),t.defineProperty("ariaControls"),t.defineProperty("ariaHasPopout"),i.url="#",i.isNew=!1,i.banner="",i}return v(t,n),t.prototype.setCssClass=function(n){this.cssClass=n},t.prototype.getCssClass=function(){return this.cssClass},t}(bt),il=function(t){function i(i,r,f,e,h,c){var l=t.call(this,e,f)||this,a=l._privates,v;return a.defineProperty("searchTerm"),a.defineProperty("capsuleList"),a.defineProperty("overflowCapsuleList"),a.defineProperty("overflowCapsuleListCount"),a.defineProperty("searchboxContainerClassName"),a.defineProperty("stackExists"),a.defineProperty("closeDisable"),a.defineProperty("displayInPrivate"),a.defineProperty("closeTitle"),a.defineProperty("displayClearSearch"),l.resources=o,l._map=r,l._taskManager=h,v=h.getFocusedStack(),l._currentStack=v&&v.id,l._cardsController=new rf(c,h,l._map,l),l.searchInstData=l.stringify(l._getInstData()),l._stacks=h.getStacks(),l._taskManager=h,l.setCloseDisable(!1),l._isFlipped=!1,l._isFlipMode=!1,l.setDisplayInPrivate(u.isInPrivateMode?"":"none"),l.setCloseTitle(l.resources.ShareClose),l.setAsExpanded(!1),l.clearSearchEvent=new s,l.disposables.push(h.stackRemoved.add(function(n){var i,t;if(h.getStacks().length===0)l.setSearchTerm(""),l._searchBox&&l._searchBox.focus(),l.setStackExists(!1),l._setTaskType(null);else for(i=h.getStacks(),t=0;t<i.length;t++)v=i[t],v.displayState&&v.displayState.activationState===1&&l._setTaskType(v.getForegroundTask());n.stack.id===l._currentStack&&l._determineWidthOverride(h);h.getStacks().length===0&&l._setSearchControlsWidth(l._searchBox,p.searchBoxWidth)})),l.disposables.push(h.stackFocused.add(function(n){n&&n.stack&&(l._currentStack=n.stack.id,l._isFlipMode&&l._flipSetSearchTerm(),l._setTaskType(n.stack.getForegroundTask()))})),l.disposables.push(h.stackAdded.add(function(n){l._isFlipped=!1;l._determineWidthOverride(h);n&&n.stack&&(l._currentStack=n.stack.id);var t=l._getTaskFromArgs(n);l.setStackExists(t&&t!==undefined);l._setTaskType(t);l.disposables.push(n.stack.flipAnimationCompleted.add(function(){return l._flipSetSearchTerm()}))})),l.disposables.push(h.stacksReset.add(function(){var n=h.getFocusedStack();l._currentStack=n.id;l._determineWidthOverride(h);l.setStackExists(h.getStacks().length>0);l._setTaskType(n&&n.getForegroundTask())})),l.disposables.push(h.secondaryTaskAdded.add(function(n){var t=l._getTaskFromArgs(n);t&&t.id&&(t.id.toLowerCase().indexOf("itinerarydetails")>-1||!b._getIsSlideCardEnabled()&&t.id.toLowerCase().indexOf("transitline")>-1)&&l._flipSetSearchTerm()})),sj_evt.bind("CardResize",function(){for(var r,u,e,c,o,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];if(r=l.getControl(),r&&r.length>0&&t&&t.length>1){var s=t[1],w=t.length>2&&t[2],a=ti.showLoadingSkeleton&&b.percievedLoadSkeletonShown;if(s){if(u=!0,!b._getIsSlideCardEnabled()){u=!1;var v=l._taskManager.getFocusedStack(),h=v&&v.getForegroundTask(),f=h&&h.displayState,y=f&&f.prominence,p=f&&f.activationState;y&&y===1&&p&&p===1&&(e=h,c=e&&e.getCurrentWidth&&e.getCurrentWidth(),u=c&&c===s)}(!a&&u||a&&w)&&(o=n(".inputbox",r[0]),o&&o.length>0&&l._setSearchControlsWidth(o[0],s))}}}),l.setSearchboxContainerClassName("bm_searchBoxNavLeft bm_l2Search"),l}return v(i,t),i.prototype.setDisabledClass=function(n){return n?"disabled":""},i.prototype.onSearchInvokedFromTaskbar=function(n){if(this._cardsController!==null)this._cardsController.onSearchInvokedFromTaskbar(n)},i.prototype.overflowCapsuleListToDisplay=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?"":"none"},i.prototype.overflowCapsuleListToCount=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?n.length.toLocaleString():"none"},i.prototype.overflowClick=function(n){this._cardsController.overflowClick(n)},i.prototype.overflowKeyDown=function(n){var t=n;t.keyCode===13&&this._cardsController.overflowClick(n)},i.prototype.overflowMouseOver=function(n){this._cardsController.overflowMouseOver(n)},i.prototype.overflowMouseOut=function(n){this._cardsController.overflowMouseOut(n)},i.prototype.mouseEnterSearchBox=function(){},i.prototype.mouseLeaveSearchBox=function(){},i.prototype.clearSearchText=function(n){this.setSearchTerm("");this._searchBox&&(this._searchBox.value="");this.setSearchBoxFocus();this.setDisplayClearSearch(!1);this.clearSearchEvent.invoke();n.preventDefault();n.stopImmediatePropagation()},i.prototype.showClearTextTip=function(){var n,t,i;this.getAsExpanded()||(n=this._showTip(this.resources.ClearText),t=this.getControl().select(".clearSearchText"),t.append(n),i=n.get_absolute_pos(),n.set_style({top:52,left:18-i.width/2}))},i.prototype.showClearSearchTip=function(){},i.prototype.hideTip=function(){this._tooltip&&this._tooltip.removeTip()},i.prototype.stringify=function(n){return JSON.stringify(n)},i.prototype.clearAllClickHandler=function(n){this._cardsController.clearAllClickHandler(n)},i.prototype.sbCloseHandler=function(t){var r,f=this._taskManager.getStackById(this._currentStack),u,e;f&&(r=f.getForegroundTask());r&&r.id.toLowerCase().indexOf("collection")>-1&&(u=n(".collectionsCard.refresh"),u.length>0&&(e=u.select(".placesMessage"),e.get_style("display")==="none"&&(this._isFlipped=!0)));this._isFlipped?(i.flipClickReturnToList(r),this._isFlipped=!1):this._cardsController.sbCloseTaskHandler(t);t.preventDefault();t.stopPropagation()},i.prototype.setSearchBoxFocus=function(){if(this._searchBox)if(this._searchBox.focus(),hi.enableDirectionsSearch=!0,typeof this._searchBox.selectionStart=="number")this._searchBox.selectionStart=this._searchBox.selectionEnd=this._searchBox.value.length;else if(typeof this._searchBox.createTextRange!="undefined"){var n=this._searchBox.createTextRange();n.collapse(!1);n.select()}},i.prototype.setSearchBox=function(t){var i=this;this._searchBox=t;n(this._searchBox).add_event("keydown",function(n){i._onSearchBoxEnter(n)})},i.prototype._setTaskType=function(t){var i=n(".MicrosoftMap .bm_searchBoxNavLeft"),u=i&&i.length>0&&i[0].firstElementChild,r;u&&(r=n(u),t&&t.type==="DirectionsTask"?r.add_class("DirectionsTask"):r.remove_class("DirectionsTask"))},i.prototype._determineWidthOverride=function(t){var i=n(".MicrosoftMap .bm_searchBoxNavLeft ul li.inputbox"),r=t.getStacks();r.length>0?i.has_class("inlineCard")||i.add_class("inlineCard"):i.remove_class("inlineCard")},i.prototype._onSearchBoxEnter=function(t){var u=t,e=u.keyCode||u.which,f,i;e===13&&(f=this._getInstData(),r.invokeHandler("data-instrumentation",f),i=n(".searchButton")[0],i.setAttribute("tabindex","-1"),i.focus(),i.removeAttribute("tabindex"))},i.prototype._adjustSearchBoxWidth=function(){var e=this.getControl()[0],i=n(".inputbox",e)[0],r=n("#taskbarPrimer"),u=r.length>0&&r[0],t,f;u&&u.clientWidth>0&&(t=this._getCardContainerWidth(),t?this._setSearchControlsWidth(i,t,!0):(f=n(".bm_tcfPrimer .inputbox")[0],this._setSearchControlsWidth(i,f.getBoundingClientRect().width,!0)))},i.prototype._getCardContainerWidth=function(){var n=0,t=document.getElementsByClassName("overlay-container"),i;return t&&t.length>0&&(i=t[0].getAttribute("data-mapcardwidth"),n=i&&parseInt(i),n=isNaN(n)?0:n),n},i.prototype._setSearchControlsWidth=function(t,r,u){var o,s,f,e;t&&this._currentWidth!==r&&(this._currentWidth=r,o=0,s=u?0:i.searchBoxBorderWidth*2,t.setAttribute("style","width: "+(r===-1?"":r-o-s+"px")),f=n(".as_container_search",t),f&&f.get_style("visibility")==="visible"&&this._searchBox.value.length>-1&&f.set_style({width:r+"px"}),e=n("#taskbarPrimer"),e&&e.length>0&&r!==-1&&e.select(".inputbox").set_style({width:r+"px"}))},i.prototype._getTaskFromArgs=function(n){var t=n.task;return!t&&n.stack&&(t=n.stack.getForegroundTask()),t},i.prototype._getInstData=function(){return{logData:{feature:"SB",action:"C",data:{FN:"SR"}}}},i.prototype._flipSetSearchTerm=function(){var t=this._taskManager.getStackById(this._currentStack),n;t?(n=t.getForegroundTask(),p.updateSearchTermWithTaskTitle&&this.setSearchTerm(n.getTitle()),this._isFlipMode=!0,this._isFlipped=n.displayState.stackOrder>1):this._isFlipMode=!1},i.prototype._showTip=function(t){this._tooltip&&this._tooltip.removeTip();var i=new fr(this._map,"",[t],!0,!1,!0,!1,null,null,"searchBoxTip");return i.setShowClose(!1),i.setShowBeak(!0),this._tooltip=i,n(i.getRootElement())},i.flipClickReturnToList=function(t){var i=n(".bm_navLeftBack"),u,r,f,e;if(t&&t.id.toLowerCase().indexOf("collection")>-1&&(i=n(".collectionBack")),i.length===0&&(i=n(".backButtonContainer"),i.length===0&&(i=n("[data-tag=detailsCardBackBtnContainer]")),(i.length===0||i.get_style("display")==="none")&&(i=null)),t&&i&&i.length>0)for(u=0;u<i.length;u++)if(r=n(i[u]).select(".backArrowButton"),r.length===0&&n(i[u]).has_class("collectionBack")&&(r=n(i[u])),f=r.length>0?r.get_attr("data-task"):null,f){if(e=JSON.parse(f),e&&e.id===t.id){r.fireEvent("click");break}}else if(t.id.toLowerCase().indexOf("collection")>-1){r.fireEvent("click");break}},i.CardContentLeftPadding=16,i.searchBoxBorderWidth=2,i}(ri),ps=new Map([[0,nt.CommuteRewardsLogActionName.DismissClick],[1,nt.CommuteRewardsLogActionName.ImplicitDismiss],[2,nt.CommuteRewardsLogActionName.FlyoutEarnClick],[3,nt.CommuteRewardsLogActionName.FlyoutClick],[4,nt.CommuteRewardsLogActionName.FlyoutImpression]]),ir="trffeatures",rr="clpdash",hi=function(t){function i(r,f,h,c,v){var y=this,b,w,k,g,d,nt,tt;return y=t.call(this,c,h)||this,y._commuteFlyoutDismissCount=0,y._commuteFlyoutNotNowActionCount=0,y._impressionIncrementedFlyoutDismiss=!1,y._actionButtonsFullWidth=0,y._idControlsAndHamburgerButtonsFullWidth=0,w=y._privates,w.defineProperty("searchTermInternal"),w.defineProperty("className"),w.defineProperty("asExpanded"),w.defineProperty("selectedSuggestionId"),w.defineProperty("overflowCapsuleList"),w.defineProperty("overflowCapsuleListCount"),w.defineProperty("searchboxPlaceHolderText"),w.defineProperty("overflowExpanded"),w.defineProperty("showCommuteFlyout"),w.defineProperty("commuteRewardsFlyoutTitle"),w.defineProperty("upsellImageClass"),w.defineProperty("commutePointValue"),y.setCommutePointValue(""+l.commuteRewardsPointValue),p.fullScreen=u.isMapsAnswer?!1:p.fullScreen,y._localGuideEnabled=er===null||er===void 0?void 0:er.isEnabled,y._minimumActionButtonsWidth=p.minimumActionButtonsWidth,y._maxIdControlsWidth=p.maxIdControlsWidth,y._minIdControlsWidth=p.minIdControlWidth,y._searchBoxWidth=p.searchBoxWidth,y._navButtonWidth=p.navButtonWidth,y._minSearchBoxWidth=p.minSearchBoxWidth,y._maxActionButtonsWidth=p.maximumActionButtonsWidth,y._searchBoxLeftBuffer=p.taskbarLeftBuffer,y._rightTaskbarBuffer=p.taskbarRightBuffer,y._fullSearchControlsWidth=y._searchBoxWidth,y._previousWindowWidth=window.innerWidth,y.setClassName("taskBar"),y.setSearchboxPlaceHolderText(p.setSearchBoxPlaceholderText?o.L_TaskBar_Placeholder_SearchBox:""),y.setSearchTerm(""),y._taskManager=v,y.taskBarItems=[],y.taskBarExtraItems=[],i._taskItems=[],y._map=f,y.createTaskItems(),i._taskBarContainer||(i._taskBarContainer=(b=f.shellContainerElement)===null||b===void 0?void 0:b.querySelector("#taskBarContainer")),y._controlTemplateFactory=c,i._staticMap=f,y._signInState=new ui,y.setUpAlwaysOnPoi(),y._container=r,y.setAsExpanded(!1),y.displayInPrivate=u.isInPrivateMode?"":"none",y.disposables.push(y._taskManager.stackFocused.add(function(){i.enableDirectionsSearch=!1}),y.launchFeedbackMenu=new s,y.hideFeedbackMenu=new s,y.focusFeedback=new s,y.exitFullScreen=new s,y.clearAutosuggest=new s,y.closeOverlay=new s),y.exitFullScreen.add(function(){return y._exitFullScreenHandler()}),y.launchFeedbackMenu.add(function(){y._hasMenuToHide=!0}),y.focusFeedback.add(function(){y._hasMenuToHide=!0}),sj_evt&&sj_evt.bind("identityHeaderShown",function(){a.setTimeout(function(){y._setHiddenElementFocusHandler();y._onResizeHandler();y._mapTabAccessibility()},500)}),y._menuList=[],y._touchByPassMouseout=!1,k=y._map.getAzureMap(),(y._trafficItem||e._isFeatureEnabled("traffic"))&&(g=function(){y._container.instanceAsync("TrafficLayerV2",function(n){y._trafficLayer=n;n&&(y._setTrafficButtonSelected(n.getIsShowing()),y.disposables.push(y._trafficLayer.changed.add(function(n){n.name==="isShowing"&&y._setTrafficButtonSelected(n.newValue)})))})},k.mapFirstIdle.then(g)),(u.trafficStyleMenu||u.trafficStyleMenu2)&&(d=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];y._isTrafficButtonSelected=!0;sj_evt.unbind("OnLoadTrafficLayerStatus",d)},sj_evt.bind("OnLoadTrafficLayerStatus",d)),(y._mapsPlusItem||e._isFeatureEnabled("mapsPlus"))&&(nt=function(){y._container.instanceAsync("MapsPlusLayer",function(n){y._mapsPlusLayer=n})},k.mapFirstIdle.then(nt)),y.resources=o,y.searchInstData=y.createInstrumentationData("Search"),f&&(y._userActionHandlers=vt.handleUserActions(f.getAzureMap(),function(){return y.mapInteractedEvent()}),y.disposables.push(v.stackRemoved.add(function(){v.getStacks().length===0&&(y.setSearchTerm(""),y._searchBox&&y._searchBox.focus())}))),u.isMapsAnswer&&sj_evt&&sj_evt.bind("LargeMapHidden",function(){y._clearHeaderLastElementKeyDownHandler()}),p.showTaskBarLabels&&(n(window).add_event("resize",function(){y._onResizeHandler()}),n(window).add_event("orientationchange",function(){y._onResizeHandler()}),p.fullScreen&&n(window).add_event("fullscreenChange,webkitfullscreenChange,mozfullscreenChange,msfullscreenchange,msfullscreenChange,MSFullscreenChange",function(){y._onResizeHandler()})),tt=(p===null||p===void 0?void 0:p.isEnabled)?"block":"none",y.getControl().set_style({display:tt}),y._cardsController=new rf(y,v,y._map),ti.isTouchDevice&&y.getControl().add_class("bm_touch"),y._activeTask=y.getTask(),e._isSmallMapShownOnSerp()?sj_evt.bind("LargeMapShown",function(){y._setUpCommuteRewardsFlyout()}):a.setTimeout(function(){y._setUpCommuteRewardsFlyout()}),y.disposables.push(y._signInState.notifySignedIn.add(function(n){n&&y._setUpCommuteRewardsFlyout()})),y}return v(i,t),i.prototype.setAutoSuggestExpanded=function(n){this._searchBoxViewModel?this._searchBoxViewModel.setAsExpanded(n):this.setAsExpanded(n);this._showOrHidePanelShading(n);n||this.setSelectedSuggestionId("")},i.prototype._setUpCommuteRewardsFlyout=function(){var n=this,t=new Promise(function(t){l.forceShowCommuteRewardsFlyout?t(!0):l.enableCommuteRewards&&l.enableCommuteRewardsFlyout&&n._shouldPromptCommuteRewardsFlyout()&&n._signInState.getIsSignedIn()&&!u.isInPrivateMode?nt.getPromotionAvailableCommuteResponse().then(function(i){(i===null||i===void 0?void 0:i.isPromotionAvailable)&&nt.isPromotionErrorCodeExpected(i.errorCode)?n._hasBothHomeAndWork().then(function(n){t(!n)}):t(!1)}):t(!1)});t.then(function(t){if(t){var i=n._getCounterFromStorageKey(nt.StorageKeys.FlyoutImpressionCountKey);i++;i>0&&i%2==0&&n._trackFlyoutDismiss(4);u.testHooksEnabled||(localStorage===null||localStorage===void 0?void 0:localStorage.setItem(nt.StorageKeys.FlyoutImpressionCountKey,""+i));n._drawCommuteFlyoutAndLogImpressions(i)}n.setShowCommuteFlyout(t)})},i.prototype._drawCommuteFlyoutAndLogImpressions=function(t){var u,i,r,f,e,s;this.setUpsellImageClass("upsellImage ".concat(l.commuteRewardsEnableHighPoints?"high":""));u=o.CommuteRewards_FlyoutTitle.replace("{0}",""+l.commuteRewardsPointValue);this.setCommuteRewardsFlyoutTitle(u);i=document.querySelector(".taskBar .actions .placesIcon");r=n("#rewardsFlyout");i&&r&&(f=i.getBoundingClientRect(),this._alignUnderTaskBarAction(r,f,1));e=h.logger;s={feature:"COMR",action:"I",data:{visual:nt.CommuteRewardsLogActionName.FlyoutImpression,count:t}};e.logObject(s)},i.prototype._shouldPromptCommuteRewardsFlyout=function(){var n,r,s;if(u.userExpectingCommuteRewards)return!1;var t=!1,f=!1,e=!1,o=localStorage===null||localStorage===void 0?void 0:localStorage.getItem(nt.StorageKeys.FlyoutDismissKey),i=parseInt((n=localStorage===null||localStorage===void 0?void 0:localStorage.getItem(nt.StorageKeys.FlyoutDismissCountKey))!==null&&n!==void 0?n:"");if(o&&!isNaN(i)){this._commuteFlyoutDismissCount=i;var h=new Date,c=Date.parse(o),l=Math.ceil((h.getTime()-c)/864e5);t=i<3&&l>=7}else t=!0;return r=this._getCounterFromStorageKey(nt.StorageKeys.FlyoutNotNowActionKey),this._commuteFlyoutNotNowActionCount=r,f=r<2,s=(localStorage===null||localStorage===void 0?void 0:localStorage.getItem(nt.StorageKeys.ShownIneligibleKey))!==null,e=!s,t&&f&&e},i.prototype._hasBothHomeAndWork=function(){var n=!1,t=this._map&&this._map.getContainer();return new Promise(function(i){t?t.instanceAsync("ItineraryDataManager",function(t){t.syncFavorites(function(r){r===0&&t.home&&t.work&&(n=!0);i(n)})}):i(!0)})},i.prototype._showOrHidePanelShading=function(t){if(p.autoSuggestDimmingEnabled){var r=n(".MicrosoftMap .bm_waitlayer"),i=n(".MicrosoftMap .inner-container"),u=n(".taskLayoutContainer.bm_l2NavLeft"),f=r.length>0?n(r[0]):null,e=i.length>0?n(i[0]):null;if(!f||!e||u.length===0)return;r.set_style({display:""});i.length>0&&this._showOrHideWaitLayer(t,i[0],u)}},i.prototype._showOrHideWaitLayer=function(t,i,r,u){var s=n(i),f=s.select(".bm_waitlayer"),e,o,h;f.length>0&&(t?(s.set_style({position:""}),r.has_class("bm_asDroppedDown")||r.add_class("bm_asDroppedDown"),f.has_class("bm_highlightPane")||f.add_class("bm_highlightPane"),e=f.getParent().length>0&&f.getParent().get_size(),e&&(o=u&&u.leftOffset?e.width-1:e.width+1,h=u?u.leftOffset:0,f.set_style({width:o+"px",left:h+"px"}),u&&(u.leftOffset+=o))):(r.remove_class("bm_asDroppedDown"),f.remove_class("bm_highlightPane"),f.set_style({width:"",left:""})))},i.prototype.setSearchTerm=function(n){this._searchBoxViewModel?this._searchBoxViewModel.setSearchTerm(n):this.setSearchTermInternal(n)},i.prototype.getSearchTerm=function(){return this._searchBoxViewModel?this._searchBoxViewModel.getSearchTerm():this.getSearchTermInternal()},i.prototype.setSearchBox=function(t){var i=this;this._searchBoxViewModel?this._searchBoxViewModel.setSearchBox(t):(this._searchBox=t,n(this._searchBox).add_event("keydown",function(n){i._onSearchBoxEnter(n)}))},i.prototype.invertBoolean=function(n){return!n},i.prototype.onSearchInvokedFromTaskbar=function(n){var t;(t=this._cardsController)===null||t===void 0?void 0:t.onSearchInvokedFromTaskbar(n)},i.prototype.onCommuteRewardsEarnClick=function(n){var t,i,r,u;n.stopPropagation();this._launchCollectionsTask(n);t=n.target.getAttribute("data-action")==="earn";i=t?2:3;this._hideAndTrackDismissFlyout(i);r=h.logger;u={feature:"COMR",action:"C",data:{activity:t?nt.CommuteRewardsLogActionName.FlyoutEarnClick:nt.CommuteRewardsLogActionName.FlyoutClick}};r.logObject(u)},i.prototype.onCommuteRewardsDismissClick=function(n){n.preventDefault();n.stopPropagation();this._hideAndTrackDismissFlyout(0);this._commuteFlyoutNotNowActionCount++;u.testHooksEnabled||(localStorage===null||localStorage===void 0?void 0:localStorage.setItem(nt.StorageKeys.FlyoutNotNowActionKey,""+this._commuteFlyoutNotNowActionCount))},i.prototype.overflowClick=function(n){this.setOverflowExpanded(!0);this._cardsController.overflowClick(n)},i.prototype.overflowKeyDown=function(n){var t=n;t.keyCode===13&&this._cardsController.overflowClick(n)},i.prototype.overflowMouseOver=function(n){this._cardsController.overflowMouseOver(n)},i.prototype.overflowMouseOut=function(n){this._cardsController.overflowMouseOut(n)},i.prototype.dispose=function(){n(window).remove_event("keyup",this._windowEventHandler);n(window).remove_event("keydown",this._firefoxEscapeEventHandler);n(window).remove_event("fullscreenChange,webkitfullscreenChange,mozfullscreenchange,msfullscreenChange,MSFullscreenChange,msfullscreenchange",this._onResizeHandler);this._clearHeaderLastElementKeyDownHandler();e._clearDisposables(this._userActionHandlers);t.prototype.dispose.call(this)},i.prototype.removeTrafficFlow=function(){this._trafficLayer.hide(null,null,this._isTrafficButtonSelected,this._isTrafficPickerSelected);u.trafficStyleMenu?this._trafficStylePickerBox.checked=!1:(this._trafficBox.checked=!1,this._incidentsBox.checked=!1)},i.prototype.setActionsOptions=function(t){for(var f,e,s,u=this.taskBarItems,r=0;r<u.length;r++)t===4095&&(u[r].action===8||u[r].action===256)?u[r].setIsActive(!1):(u[r].setIsActive((t&u[r].action)!=0),i.isFullScreen&&u[r].name===o.L_TaskBar_Label_Fullscreen&&(f=this._getTaskbarFullScreenButton(null),f.add_class("selected"),e=i.getMenuItem(o.L_TaskBar_Label_Fullscreen),s=n(".fullscreenIcon",e),s.add_class("selected")))},i.prototype.setActionsState=function(n,t){for(var r,o,u,e=this.taskBarItems,s=this.getControl(),f=0;f<e.length;f++)r=e[f],(n&r.action)!=0&&(o=r.getDataTag(),u=s.select('*[data-tag="'+o+'"]'),t===1?u.remove_class(i._pressedButtonClass):t===2&&u.add_class(i._pressedButtonClass),r.setCssClass(u.get_attr("class")))},i.prototype.clearAllClickHandler=function(n){this._cardsController.clearAllClickHandler(n)},i.prototype.clearAllKeyDownHandler=function(n){this._cardsController.clearAllKeyDownHandler(n)},i.prototype.setSearchBoxFocus=function(){if(this._searchBoxViewModel)this._searchBoxViewModel.setSearchBoxFocus();else if(this._searchBox)if(this._searchBox.focus(),i.enableDirectionsSearch=!0,typeof this._searchBox.selectionStart=="number")this._searchBox.selectionStart=this._searchBox.selectionEnd=this._searchBox.value.length;else if(typeof this._searchBox.createTextRange!="undefined"){var n=this._searchBox.createTextRange();n.collapse(!1);n.select()}},i.prototype.mapInteractedEvent=function(){i.enableDirectionsSearch=!1;this.hideMenu();var n=this.getShowCommuteFlyout();l.enableCommuteRewards&&n&&this._hideAndTrackDismissFlyout(1)},i.prototype.hideMenu=function(){var t=this;window.clearTimeout(i._mouseOverDelayHandle);i._taskBarPopOutElement&&(i._mouseOverDelayHandle=a.setTimeout(function(){var s,r,e,u,o,f;if((t._hasMenuToHide||((s=t._taskbarPopOutButtonViewModel)===null||s===void 0?void 0:s.getIsDisplayed()))&&(r=n(".bm_dropdownEntry",i._taskBarPopOutElement[0]),r&&r.length>0&&r[0].blur(),e=!1,u=n(".popOutTemplate",i._taskBarPopOutElement[0]),u&&u.length>0)){if(o=":focus,:hover,:active",u[0].querySelector(o))e=!0;else for(f=0;f<r.length;f++)if(r[f].parentElement.querySelector(o)||r[f].querySelector(o)){e=!0;break}e&&u.get_style("display")!=="none"||t.clearMenuElements()}},300))},i.prototype.mouseoverMenuHandler=function(n){var t=this;window.clearTimeout(i._mouseOverDelayHandle);i._mouseOverDelayHandle=a.setTimeout(function(){t._setMoreTaskItemState(!0);t._initializeMenu(n);i._taskBarPopOutElement.set_style({display:"block"});t._hasMenuToHide=!0},50);n&&n.preventDefault&&n.preventDefault()},i.prototype.popoutMouseoverHandler=function(n){this._cardsController.popoutMouseoverHandler(n)},i.prototype.popoutMouseoutHandler=function(n){this._cardsController.popoutMouseoutHandler(n)},i.prototype.onFullScreenClick=function(t){var e=this;this._windowEventHandler||(this._windowEventHandler=function(n){return e._onEscapeEvent(n)},document.addEventListener("mozfullscreenchange",this._windowEventHandler),document.addEventListener("webkitfullscreenchange",this._windowEventHandler),document.addEventListener("msfullscreenChange",this._windowEventHandler),document.addEventListener("MSFullscreenChange",this._windowEventHandler),document.addEventListener("msfullscreenchange",this._windowEventHandler),document.addEventListener("fullscreenchange",this._windowEventHandler),n(window).add_event("keyup",this._windowEventHandler));i.enableDirectionsSearch=!1;var r=this._getTaskbarFullScreenButton(t),u=i.getMenuItem(o.L_TaskBar_Label_Fullscreen),f=n(".fullscreenIcon",u),s=n("#container");r&&(r.has_class("selected")?(n(r).exit_full_screen(),r.remove_class("selected"),r[0].setAttribute("aria-label",o.L_TaskBar_Label_Fullscreen),f.remove_class("selected"),u&&u.setAttribute("aria-label",o.L_TaskBar_Label_Fullscreen),this._updateFullScreenMenuItem(!1),i.isFullScreen=!1):(n(r).set_full_screen(s[0]),r.add_class("selected"),r.set_attr("aria-label",o.Taskbar_Label_ExitFullScreen),f.add_class("selected"),u&&u.setAttribute("aria-label",o.Taskbar_Label_ExitFullScreen),this._updateFullScreenMenuItem(!0),i.isFullScreen=!0,i._logFullScreen(!0)),i._adjustContainerTop());t&&t.preventDefault()},i.prototype._updateFullScreenMenuItem=function(n){for(var t,e,u,i=0,r=0,f=this._menuList;r<f.length;r++){if(t=f[r],t.iconClass.indexOf("fullscreenIcon")>-1){e=t.iconClass.indexOf("selected")>-1;u=n&&!e;u?this._menuList[i].iconClass+=" selected":u||(this._menuList[i].iconClass=t.iconClass.replace(" selected",""));break}i++}},i.getMenuItem=function(t){var e=n(".taskBarPopout",i._staticMap.getRootElement().getParent()[0])[0],f=n(".popOutInner",e)[0],u,r;if(f&&f.childElementCount>0)for(u=f.children,r=0;r<u.length;r++)if(u[r].innerHTML.indexOf(t)>-1)return u[r];return null},i.prototype.clearMenuElements=function(){this.hideFeedbackMenu.invoke();this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.setIsDisplayed(!1);n(".taskBarPopout",this._map.getRootElement().getParent()[0]).set_style({display:"none"});this._setMoreTaskItemState(!1);this._hasMenuToHide=!1},i.prototype._setMoreTaskItemState=function(n){for(var r,t=i._taskItems.length-1;t>0;t--)if(i._taskItems[t].getCssClass().indexOf("moreIcon")>-1){r=i._taskItems[t];break}i._handleSelectedClass(r,n);r.setAriaExpanded(n)},i._handleSelectedClass=function(t,i){if(t)if(i)t.getCssClass().indexOf("selected")===-1&&t.setCssClass(t.getCssClass()+" selected");else while(t.getCssClass().indexOf("selected")>-1)t.setCssClass(t.getCssClass().replace(" selected","")),n(".moreIcon").fireEvent("blur")},i.prototype.mouseoutMenuHandler=function(n){var t=this;this._touchByPassMouseout||(window.clearTimeout(i._mouseOverDelayHandle),i._mouseOverDelayHandle=a.setTimeout(function(){t.hideFeedbackMenu.invoke()},150));this._touchByPassMouseout=!1;n&&n.preventDefault&&n.preventDefault()},i.prototype.hoverFeedbackButton=function(){var t=n(".fullscreenMenuLink",i._taskBarPopOutElement[0]);t&&t.length>0&&t[0].parentElement.parentElement.focus()},i.prototype.overflowCapsuleListToDisplay=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?"":"none"},i.prototype.overflowCapsuleListToCount=function(){var n=this.getOverflowCapsuleList();return n&&n.length>0?n.length.toLocaleString():"none"},i.prototype.boolToHide=function(n){return n?"none":""},i.prototype._onEscapeEvent=function(n){var t=n,r=document.mozFullScreenElement||document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement;(t&&t.key&&(t.key==="Escape"||t.key==="Esc")||t.keyCode&&t.keyCode===27||(n.type==="mozfullscreenchange"||n.type==="webkitfullscreenchange"||n.type==="fullscreenchange"||n.type==="msfullscreenchange"||n.type==="MSFullscreenChange"||n.type==="msfullscreenChange")&&!r)&&(this._exitFullScreenHandler(),i._logFullScreen(!1));this._setMoreTaskItemState(!1);n.preventDefault()},i.prototype.onOverlayCloseButtonClicked=function(n){var t,f={logData:{feature:"TB",action:"C",data:{FN:i._featureNameToAction.Overlay,CN:"Close"}}};f.impressionGuid=u.dynamicProperties.serpIG?u.dynamicProperties.serpIG:u.dynamicProperties.mapsIG;r.invokeHandler("data-instrumentation",f);(t=this.closeOverlay)===null||t===void 0?void 0:t.invoke();n.preventDefault()},i.prototype.onOverlayCloseKeydown=function(t){var r=t,i;if(r.keyCode)if(r.keyCode===13)this.onOverlayCloseButtonClicked(t);else r.keyCode===9&&(t.preventDefault(),t.stopImmediatePropagation(),r.shiftKey?this._focusLastIdControl():(i=n(".azure-maps-control-button.curr-style"),i.length===0&&(i=n(".azure-maps-control-list-button.curr-style")),i.length>0&&i[0].focus()))},i.prototype.getTaskbarItem=function(n){var t=this.taskBarItems.filter(function(t){return t.action===n}),i;return t&&t.length===1?(i=t[0].getCssClass(),this.getControl().select("."+i.replace(" ","."))):null},i.prototype._exitFullScreenHandler=function(){var t=this._getTaskbarFullScreenButton(null),r=i.getMenuItem(o.L_TaskBar_Label_Fullscreen),u=n(".fullscreenIcon",r);t.has_class("selected")&&(n("#container").exit_full_screen(),t.remove_class("selected"),u.remove_class("selected"),this._updateFullScreenMenuItem(!1));i.isFullScreen=!1;i._adjustContainerTop()},i.prototype._setActionButtonsRealignClass=function(n){var f,t,e,i,r,u;if(n=n!==null&&n!==void 0?n:this._getShowTaskBarItemLabel(),t=this.getControl().select(".actions"),t.length>0&&t.get_style("display")!=="none")for(e=t.select(".action"),i=0;i<e.length;i++)r=e[i],u=(f=r===null||r===void 0?void 0:r.firstElementChild)===null||f===void 0?void 0:f.classList,u&&(n?u.add("realign"):u.remove("realign"))},i.prototype._getTaskbarFullScreenButton=function(t){var i=t&&t.target;return i?i.className.indexOf("actionLabel")>-1?n(i.parentElement):i.className.indexOf("action")>-1?n(i.firstChild):n(i):n(".taskBar .fullScreenIcon")},i.prototype._onSearchBoxEnter=function(t){var u=t,e=u.keyCode||u.which,f,i;e===13&&(f=this._getInstData("Search"),r.invokeHandler("data-instrumentation",f),i=n(".searchButton")[0],i.setAttribute("tabindex","-1"),i.focus(),i.removeAttribute("tabindex"))},i.prototype._createTaskItemWithTaskOption=function(n,t,i,r,u){var f=new gr;return f.setCssClass(n),f.taskOption=t,f.action=i,f.setIsActive(!0),f.setDataTag(u?u:""),f.setShowLabel(r),f},i.prototype.createTaskItemWithClickHandler=function(t,i,r,u,f,o){var h=this,s;return o===void 0&&(o=!0),s=new gr,s.setCssClass(t),s.action=r,s.setIsActive(!0),s.setDataTag(f?f:""),s.setShowLabel(u),s.clickHandler=function(n){i(n);n.preventDefault()},s.keydownHandler=function(i){var f=h._map.getStyle(),s=(f==="birdseye"||f==="streetside")&&(p.fullScreen&&t.indexOf("full")>-1||!p.fullScreen&&t.indexOf("share")>-1),c=e._isCommuteDashboardPage()&&t.indexOf("placesIcon")>-1,r,o,u;(s||c)&&(r=i,o=r.keyCode||r.which,o===9&&(u=n("#id_h"),u.length>0&&h._setFocusToId(i,u)))},s.action=r,s},i.prototype.createTaskItemWithMouseHandlers=function(t,r,u,f,e){var s=this,o=new gr;return o.setCssClass(t),o.mouseoverHandler=function(n){window.clearTimeout(i._mouseOverDelayHandle);i._mouseOverDelayHandle=a.setTimeout(function(){r(n)},150);n&&n.preventDefault&&n.preventDefault()},o.mouseoutHandler=function(n){s._touchByPassMouseout||(window.clearTimeout(i._mouseOverDelayHandle),i._mouseOverDelayHandle=a.setTimeout(function(){n.target.tagName==="A"&&(n&&n.preventDefault&&n.preventDefault(),s.hideMenu())},150));s._touchByPassMouseout=!1},o.clickHandler=function(n){(n.type==="touchend"||n.type==="pointerup")&&(s._touchByPassMouseout=!0);n&&n.preventDefault&&n.preventDefault();r(n);n.cancelBubble=!0;n.stopPropagation()},o.keydownHandler=function(t){var u=t,e=u.keyCode||u.which,f;e===40&&o.getCssClass().indexOf("selected")===-1?(window.clearTimeout(i._mouseOverDelayHandle),i._mouseOverDelayHandle=a.setTimeout(function(){r(t)},150),t&&t.preventDefault&&t.preventDefault()):e===9&&!u.shiftKey&&t.target.className.indexOf("more")>-1&&(f=n("#id_h"),f.length>0&&s._setFocusToId(t,f))},o.action=u,o.setIsActive(!0),o.setDataTag(e?e:""),o.setShowLabel(f),o.setPopoutClass("taskBarPopout"),o},i.prototype.createTaskItems=function(){this.addDirectionsItem(!0);this.addTrafficItem(!0);this._localGuideEnabled&&this.addLocalGuideItem(!0);this.addCollectionItem(!0);this.addSharingItem(!0);e._isFeatureEnabled("mapsPlus")&&this.addMapsPlusItem(!0);e._isCommuteDashboardPage()||this.addMoreMenuItem(!0);this.addfullScreenItem(!0)},i.prototype.addCollectionItem=function(n){var t=this,r;e._isFeatureEnabled("collections")&&!u.isInPrivateMode&&(r=this.createTaskItemWithClickHandler("placesIcon realign",function(n){(u.trafficStyleMenu||u.trafficStyleMenu2)&&t._isTrafficButtonSelected&&(t._isTrafficButtonSelected&&!t._isTrafficPickerSelected&&t.removeTrafficFlow(),t._isTrafficButtonSelected=!1);e._isCommuteDashboardPage()?t._updateUrl("/maps/myplaces",ir,rr):(t._launchCollectionsTask(n),t.setShowCommuteFlyout(!1))},2,n,"TaskBar.CollectionsButton",!1),r.altName=r.name=o.L_TaskBar_Label_Favorites,r.url="/maps/myplaces",r.instrumentationData=this.createInstrumentationData("CollectionsTask"),this.taskBarItems.push(r),i._taskItems.push(r))},i.prototype._launchCollectionsTask=function(n){var f,u,t;n.type!=="pointerup"&&(i.enableDirectionsSearch=!1,f={entryPoint:1,action:3},u={type:"CollectionsTask",state:f},l.enableSingleMyPlacesCard&&(t=this._container.instance("CollectionsTask"),t&&t.id&&t.stackId&&(u.state=undefined)),r.invokeHandler("data-task",u),n.preventDefault())},i.prototype.makeHomeWorkRequest=function(){var n={type:"CollectionsTask",requestorType:"TaskBar",requestState:{entryPoint:1,action:21}},t=function(){r.invokeHandler("data-process",n)};this._map.getAzureMapFirstIdle().then(t)},i.prototype.setUpAlwaysOnPoi=function(){var t=this,n;e._isSmallMapShownOnSerp()?(n=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];t.makeHomeWorkRequest();sj_evt.unbind("LargeMapShown",n)},sj_evt.bind("LargeMapShown",n)):this.makeHomeWorkRequest()},i.prototype.addSharingItem=function(n){if((ut===null||ut===void 0?void 0:ut.isEnabled)&&!ut.disableOutboardSharing){var t=this.createTaskItemWithClickHandler("shareIcon realign",function(n){n.type!=="pointerup"&&(i.enableDirectionsSearch=!1,r.invokeHandler("data-share",{entryPoint:"TaskBar"}))},8,n,"TaskBar.ShareButton",!1);t.name=o.L_TaskBar_Label_Share;t.instrumentationData=this.createInstrumentationData("Share");t.setIsActive(!1);t.setAriaExpanded(undefined);this.taskBarItems.push(t);i._taskItems.push(t)}},i.prototype.addMoreMenuItem=function(n){var r=this,t=this.createTaskItemWithMouseHandlers("moreIcon realign",function(n){r.mouseoverMenuHandler(n)},128,n,"Taskbar.MoreButton");t.altName=t.name=o.L_TaskBar_Label_More;t.setAriaExpanded(!1);t.setAriaHasPopout(!0);t.setAriaControls("taskbarPopout");this.taskBarItems.push(t);i._taskItems.push(t)},i.prototype.addfullScreenItem=function(n,t){var u=this,r;p.fullScreen&&(r=this.createTaskItemWithClickHandler("fullScreenIcon",function(n){if(n.type!=="pointerup")u.onFullScreenClick(n)},256,n,"Taskbar.FullscreenButton"),r.altName=r.name=o.L_TaskBar_Label_Fullscreen,r.setIsActive(!1),r.setAriaExpanded(undefined),t?this.taskBarExtraItems.push(r):this.taskBarItems.push(r),i._taskItems.push(r))},i.prototype.addTrafficItem=function(n){var t=this,s,h,c,l,a,r,v;if(e._isFeatureEnabled("traffic")){var y=window.location.pathname==="/maps/traffic",p=(s=e._getUrlParam(window.location,ir))===null||s===void 0?void 0:s.toLowerCase(),w=iu.dashboardConfigs.isEnabled||p.includes(rr),f=e._isCommuteDashboardPage()||w&&!y;(u.trafficStyleMenu||u.trafficStyleMenu2)&&(this._isTrafficPickerSelected=!1,h=function(){var n,i;u.trafficStyleMenu?t._trafficStylePickerBox=t._map.shellContainerElement.querySelector(".".concat("labelToggleInput",'[aria-label="').concat(ar.L_TrafficStyleMenu,'"]')):(t._trafficBox=(n=t._map.shellContainerElement)===null||n===void 0?void 0:n.querySelector(".".concat("labelToggleInput",'[aria-label="').concat(ar.L_TrafficStyleMenu,'"]')),t._incidentsBox=(i=t._map.shellContainerElement)===null||i===void 0?void 0:i.querySelector(".".concat("labelToggleInput",'[aria-label="').concat(ar.L_Incidents,'"]')))},h(),this._trafficStylePickerBox||this._trafficBox||this._incidentsBox||(c=function(){h();sj_evt.unbind("TrafficPickerAdded",c)},sj_evt.bind("TrafficPickerAdded",c)),l=function(){var n=t._trafficLayer.getIsShowing()||t._trafficLayer.getIncidentManager().isShowing();t._isTrafficPickerSelected=n},sj_evt.bind("TrafficPickerSelected",l),a=function(){t._isTrafficButtonSelected=!1;t._isTrafficPickerSelected=!1},sj_evt.bind("ClosedTrafficCard",a));r=void 0;v=function(n){if(n.type!=="pointerup")if(f)e._isCommuteDashboardPage()||t._updateUrl("/maps/commute");else if(i.enableDirectionsSearch=!1,t._map.getStyle()!=="birdseye"){var r=function(n){n&&(t._trafficLayer=n);u.trafficStyleMenu||u.trafficStyleMenu2?(t._isTrafficButtonSelected=!0,t._trafficLayer.show(1,t._isTrafficButtonSelected),u.trafficStyleMenu?t._trafficStylePickerBox.checked=!0:(t._trafficBox.checked=!0,t._incidentsBox.checked=!0)):t._trafficLayer.toggle(1)};t._trafficLayer?r():t._container.instanceAsync("TrafficLayerV2",r)}};this._trafficItem=r=this.createTaskItemWithClickHandler(f?"myRoutesIcon realign":"trafficIcon realign",v,32,n,"TaskBar.TrafficButton",!1);r.altName=r.name=f?o.L_TaskBar_Label_MyRoutes:o.L_TaskBar_Label_Traffic;r.url=f?"/maps/commute":"/maps/traffic";r.setAriaExpanded(undefined);r.instrumentationData=this.createInstrumentationData("Traffic");this.taskBarItems.push(r);i._taskItems.push(r)}},i.prototype.addMapsPlusItem=function(n){var r=this,u=function(n){if(n.type!=="pointerup"){i.enableDirectionsSearch=!1;var t=function(n){n&&(r._mapsPlusLayer=n);r._mapsPlusLayer.toggle()};r._mapsPlusLayer?t():r._container.instanceAsync("MapsPlusLayer",t)}},t=this.createTaskItemWithClickHandler("mapsPlusIcon realign",u,2048,n,"TaskBar.MapsPlus",!1);this._mapsPlusItem=t;t.name=t.altName="M+";t.url="/maps/mapsplus";t.setAriaExpanded(undefined);t.instrumentationData=this.createInstrumentationData("MapsPlus");this.taskBarItems.push(t);i._taskItems.push(t)},i.prototype.addLocalGuideItem=function(n){var f=this,t=this.createTaskItemWithClickHandler("localGuideIcon realign",function(n){if(n.type!=="pointerup")if((u.trafficStyleMenu||u.trafficStyleMenu2)&&(f._isTrafficButtonSelected&&!f._isTrafficPickerSelected&&f.removeTrafficFlow(),f._isTrafficButtonSelected=!1),e._isCommuteDashboardPage())f._updateUrl("/maps/localguide",ir,rr);else{i.enableDirectionsSearch=!1;r.invokeHandler("data-task",{type:"LocalGuideTask",state:{entryPoint:"TaskBar"}})}},1024,n,"TaskBar.LocalGuideButton",!1);t.name=o.L_TaskBar_Label_LocalGuide;t.altName=o.LocalGuide_Title;t.url="/maps/localnearby";t.setAriaExpanded(undefined);t.instrumentationData=this.createInstrumentationData("LocalGuide");this.taskBarItems.push(t);i._taskItems.push(t)},i.prototype.addDirectionsItem=function(n,t){var r=this,i;e._isFeatureEnabled("directions")&&(i=void 0,t?i=this._createTaskItemWithTaskOption("directionsIcon realign",{type:"DirectionsTask",state:t},1,n,"TaskBar.DirectionsButton"):(i=this.createTaskItemWithClickHandler("directionsIcon realign",function(n){if(n.type!=="pointerup"){!e._isCommuteDashboardPage()&&(u.trafficStyleMenu||u.trafficStyleMenu2)&&(r._isTrafficButtonSelected&&!r._isTrafficPickerSelected&&r.removeTrafficFlow(),r._isTrafficButtonSelected=!1);r.onDirectionsClick(n)}},1,n,"TaskBar.DirectionsButton",!1),i.altName=i.name=o.L_TaskBar_Label_Directions,i.url="/maps/directions",i.setAriaExpanded(undefined),i.instrumentationData=this.createInstrumentationData("DirectionsTask")),this.taskBarItems.push(i))},i.prototype.createInstrumentationData=function(n){var t=this._getInstData(n);return JSON.stringify(t)},i.prototype.onDirectionsClick=function(n){var t=this.getTask(),u,f;t&&(t.type==="LocalDetailsTask"||t.type==="PolygonEntityDetailsTask")&&!i.enableDirectionsSearch?(this._logDirectionsSearch(),this._getCardDetailsForDirections(t.type)):i.enableDirectionsSearch&&this._searchBox&&this._searchBox.value&&this._searchBox.value.length>0?(this._logDirectionsSearch(),this._getDetailsForDirections()):e._isCommuteDashboardPage()?this._updateUrl("/maps/directions",ir,rr):(u={entryPoint:1},f={type:"DirectionsTask",state:u},r.invokeHandler("data-task",f));i.enableDirectionsSearch=!1;n.preventDefault()},i.prototype._getCardDetailsForDirections=function(n){var t={requestorType:"TaskBar",type:n,requestState:{searchEntitiesRequested:!0,entryPoint:"TaskBar"},useActiveTasks:!0};r.invokeHandler("data-process",t)},i.prototype._getDetailsForDirections=function(){var n={disableTaskActivate:!0,query:this._searchBox.value,noAds:!0,entryPoint:"TaskBar"},t={requestorType:"TaskBar",type:"LocalDetailsTask",requestState:n,useActiveTasks:!1};r.invokeHandler("data-process",t)},i.prototype._logDirectionsSearch=function(){var n={logData:{feature:"TB",action:"SE",data:{C:"DS"}},impressionGuid:u.dynamicProperties.mapsIG};r.invokeHandler("data-instrumentation",n)},i._logFullScreen=function(n){var t=n?"FSO":"FSE",i={logData:{feature:"TB",action:"C",data:{FN:t}},impressionGuid:u.dynamicProperties.mapsIG};r.invokeHandler("data-instrumentation",i)},i.prototype._getInstData=function(n){return{logData:{feature:"TB",action:"C",data:{FN:i._featureNameToAction[n]}},impressionGuid:u.dynamicProperties.mapsIG}},i.prototype._getMenuInstData=function(n){return{logData:{feature:"TB",action:"C",data:{FN:n}},impressionGuid:u.dynamicProperties.mapsIG}},i.prototype._initializeMenu=function(t){var f=this,o,s,r,u;t&&t.preventDefault();o=n(".taskBarPopout",this._map.getRootElement().getParent()[0]);o&&o.length>0&&(s=n(".feedbackPopOut")[0],s&&this._map.getRootElement().getParent().insertBefore(s,this._map.getRootElement()));this.checkNewTask()&&(this._menuList=[]);this._menuList.length===0&&((ut===null||ut===void 0?void 0:ut.isEnabled)&&!ut.disableOutboardSharing&&this._menuList.push(this._createShareMenuItem()),e._isFeatureEnabled("print")&&this._menuList.push(this._createPrintMenuItem()),e._isFeatureEnabled("feedback")&&this._menuList.push(this._createFeedbackMenuItem()),p.fullScreen&&this._menuList.push(this._createFullscreenMenuItem()),this._menuList.push(this._createEmbedMenuItem()),ti.enableMyContributions&&this._menuList.push(this._createMyContributionsMenuItem()));this._showDropdown(t);r=n(".feedbackMenuLink");u=r.length>0?r.select(".arrow"):null;u&&u.length>0&&(this._isFeedbackNoMenu()?u.add_class("hide"):u.remove_class("hide"));r.set_attr("aria-expanded","false");r.add_event("touchend",function(t){if(f._isFeedbackNoMenu()){f._touchByPassMouseout=!0;return}var i=n(".feedbackMenuLink").parent();f.launchFeedbackMenu.invoke(i);t&&(t.preventDefault(),t.stopPropagation());f._touchByPassMouseout=!0});a.setTimeout(function(){b._setFocusOnFirstMenuItem(i._taskBarPopOutElement)},0)},i.prototype._createShareMenuItem=function(){var n=this;return{name:o.L_TaskBar_Label_Share,handler:function(){r.invokeHandler("data-share",{entryPoint:"TaskBar"});n._setMoreTaskItemState(!1)},mouseouthandler:function(t){n.hideMenu();t&&(t.preventDefault(),t.stopPropagation())},cssClass:"shareMenuLink",iconClass:"shareIcon menuLinkIcon",instData:this._getMenuInstData("SH")}},i.getCurrentActiveTask=function(n){var i="",t;return n&&(t=n.getFocusedStack(),t?t.getForegroundTask()&&(i=t.getForegroundTask().type):i="BaseMap"),i},i.prototype._createMyContributionsMenuItem=function(){var n=this;return{name:o.L_TaskBar_Label_MyContributions,handler:function(){var t={type:ti.enableMyRewards?"MyContributionsAndRewardsTask":"MyContributionsV3Task",state:{}};r.invokeHandler("data-task",t);n._setMoreTaskItemState(!1)},mouseouthandler:function(t){n.hideMenu();t&&(t.preventDefault(),t.stopPropagation())},cssClass:"shareMenuLink",iconClass:"shareIcon menuLinkIcon",instData:this._getMenuInstData("MCB")}},i.prototype._createPrintMenuItem=function(){var n=this,t=this._taskManager;return{name:o.L_TaskBar_Label_Print,handler:function(){var u=i.getCurrentActiveTask(t);r.invokeHandler("data-print",{source:1,fullScreen:i.isFullScreen,taskType:u});n._setMoreTaskItemState(!1);dr.onPrintDialogOpen.addOne(function(){i.isFullScreen&&n.exitFullScreen.invoke()});dr.onPrintDialogClose.addOne(function(){window.clearTimeout(i._mouseOverDelayHandle);i._mouseOverDelayHandle=a.setTimeout(function(){n._setMoreTaskItemState(!1);a.setTimeout(function(){n.hideMenu()},50)},150)})},mouseouthandler:function(t){n.hideMenu();t&&(t.preventDefault(),t.stopPropagation())},cssClass:"printMenuLink",iconClass:"printIcon menuLinkIcon",instData:this._getMenuInstData("PRT")}},i.prototype._isFeedbackNoMenu=function(){var n=this.getTask();return n&&n.getReportType&&n.getReportType()===4?!1:!0},i.prototype._createFeedbackMenuItem=function(){var t=this,f={name:o.L_Menu_Feedback_Text,mouseoverhandler:function(){window.clearTimeout(i._submenuMouseOverDelayHandle);i._submenuMouseOverDelayHandle=a.setTimeout(function(){if(!t._isFeedbackNoMenu()){var i=n(".feedbackMenuLink").parent();t.launchFeedbackMenu.invoke(i)}},150)},mouseouthandler:function(n){t._touchByPassMouseout||(window.clearTimeout(i._submenuMouseOverDelayHandle),i._submenuMouseOverDelayHandle=a.setTimeout(function(){t.hideFeedbackMenu.invoke()},300));t._touchByPassMouseout=!1;n&&(n.preventDefault(),n.stopPropagation())},cssClass:"feedbackMenuLink",iconClass:"feedbackIcon menuLinkIcon",subMenu:!this._isFeedbackNoMenu(),instData:this._getMenuInstData("FB")},e,r,u;return this._isFeedbackNoMenu()?(e=this.getNewFeedbackTaskData(),f.options={type:"FeedbackTask",state:e},r=this.getTask(),r&&r.isReportable&&r.isReportable()&&r.getReportType&&(u=r.getReportType(),u&&u!==9&&u!==10&&u!==11&&(f.options.activateOptions={parentId:r.id}))):f.handler=function(){t._taskbarDropdownViewModel.feedbackClickEnable=!1;var i=n(".feedbackMenuLink").parent();t.launchFeedbackMenu.invoke(i)},f},i.prototype.getNewFeedbackTaskData=function(){var u={title:"",activeTaskId:"",feedbackTaskType:2,entryPoint:6,options:{showFeedbackHeader:!1,noMenu:!0}},n=this.getTask(),r,f;if(n&&n.getReportType&&n.getReportOptions){var e=n&&n.getTitle?n.getTitle():"",o=n&&n.id?n.id:"",i=2,t=n.getReportType?n.getReportType():null;t&&(t===7?i=5:t===2||t===6||t===1||t===5||t===3?i=3:t===8?i=7:t===4&&(i=4));r=n.getReportOptions();f={title:e,activeTaskId:o,feedbackTaskType:i,entryPoint:6,options:r?r:{showFeedbackHeader:!1,noMenu:!0}};u=f}return u},i.prototype._createFullscreenMenuItem=function(){var t=this,u=n(".fullScreenIcon.realign"),r="fullscreenIcon menuLinkIcon";return i.isFullScreen&&(r+=" selected"),{name:o.L_TaskBar_Label_Fullscreen,handler:function(n){t.onFullScreenClick(n);t._setMoreTaskItemState(!1);t.hideMenu()},mouseouthandler:function(n){t.hideMenu();n&&(n.preventDefault(),n.stopPropagation())},cssClass:"fullscreenMenuLink",iconClass:r,instData:this._getMenuInstData("FS")}},i.prototype._createEmbedMenuItem=function(){var n=this,t=this._taskManager;return{name:o.L_TaskBar_Label_Embed,handler:function(t){n._openEmbedPage(t)},mouseouthandler:function(t){n.hideMenu();t&&(t.preventDefault(),t.stopPropagation())},cssClass:"embedMenuLink",iconClass:"embedIcon menuLinkIcon",instData:this._getMenuInstData("EMB")}},i.prototype._openEmbedPage=function(){if(this._map){var n=this._map.getView(),t=e._formatString(ut.embedPageUrl,n.center[1],n.center[0],e.convertZoom(n.zoom,0));window.open(t,"EmbeddedMap");this._logEmbed(t)}},i.prototype._showDropdown=function(t){var o=this,u=i._taskBarPopOutElement,r=t&&t.target,f,e;r.className.indexOf("actionLabel")>-1?r=t.target.parentElement.parentElement:r.className.indexOf("Icon")>-1&&(r=r.parentElement);this._taskbarPopOutButtonViewModel&&this._taskbarPopOutButtonViewModel.getIsDisplayed()===!0?(this._taskbarDropdownViewModel.feedbackClickEnable=this._isFeedbackNoMenu(),this._taskbarPopOutButtonViewModel.setIsDisplayed(!1),this._taskbarDropdownViewModel.setDropdown(this._menuList),this._taskbarDropdownViewModel.setButtonElement(n(r)),this._taskbarPopOutButtonViewModel.setDropdown(this._taskbarDropdownViewModel)):this._taskbarDropdownViewModel?(this._taskbarDropdownViewModel.feedbackClickEnable=this._isFeedbackNoMenu(),this._taskbarDropdownViewModel.setDropdown(this._menuList),this._taskbarDropdownViewModel.setButtonElement(n(r)),this._taskbarPopOutButtonViewModel.setDropdown(this._taskbarDropdownViewModel)):(this._taskbarDropdownViewModel=new ss(this._menuList,n(r)),this._taskbarDropdownViewModel.feedbackClickEnable=this._isFeedbackNoMenu(),this._taskbarPopOutButtonViewModel=new ki(this._taskbarDropdownViewModel,null,this._taskbarDropdownViewModel.taskBarListDropDownTemplate),f=this._taskbarPopOutButtonViewModel.buildPopOut(),u=i._taskBarPopOutElement=n(".taskBarPopout",this._map.getRootElement().getParent()[0]),u.append(f),n(".taskBarPopout").add_event("keydown",function(n){o._onMenuKeyDown(n)}));e=r.getBoundingClientRect();this._alignUnderTaskBarAction(u,e);this._taskbarPopOutButtonViewModel.setIsDisplayed(!0)},i.prototype._showIdControls=function(){var l,v=n("#b_header")[0],f,b,k,c;if(v&&(f=n("#id_h",v),f.length>0)){var t=n(".id_nc",f[0]),a=t&&t.length>0&&!t.has_class("bnc-hide"),r=n("#id_sc"),i="hide",o=((l=n(".taskBar")[0])===null||l===void 0?void 0:l.clientWidth)||window.innerWidth;if(u.isMapsAnswer)c=0,a?c=this._minIdControlsWidth:r.length>0&&(c=20),o<p.taskbarIdShowWidth+c?(t.length>0&&!t.has_class("hide")&&t.add_class("hide"),r.length>0&&!r.has_class("hide")&&r.add_class("hide")):(t.length>0&&t.has_class("hide")&&t.remove_class("hide"),r.length>0&&r.has_class("hide")&&r.remove_class("hide"));else{var y=n("#id_l",f[0]),s=n("#id_rh",f[0]),h=n("#rh_rwm",f[0]),w=e._isCommuteDashboardPage()?iu.dashboardConfigs.minWidth+1:p.taskbarIdShowWidth;o>=w?r.remove_class(i):o<w&&this._localGuideEnabled&&r.add_class(i);b=n(".inputbox")[0].parentElement.clientWidth;k=n(".actions")[0].clientWidth;o<b+k+this._idControlsAndHamburgerButtonsFullWidth?(y.add_class(i),s&&s.add_class(i),h&&h.add_class(i),a&&t.add_class(i)):(y.remove_class(i),s&&s.remove_class(i),h&&h.remove_class(i),a&&t.remove_class(i))}this._removeIDFocusHandler(f);this._setLastIdKeyDownListener(f)}},i.prototype._setFocusToId=function(t,i){for(var r,o=this,f=i[0].children,u=0;u<f.length;u++)if(r=f[u].tagName.toLowerCase()==="a"?n(f[u]):null,r&&r.length>0&&(r.get_style("display")!=="none"||!(!r.has_class("hide")||r.has_class("b_hide")))){t&&t.preventDefault&&t.preventDefault();r.add_event("keydown",function(t){if(t.keyCode===9&&t.shiftKey){var i=void 0;i=e._isCommuteDashboardPage()?n(".placesIcon",o.getControl()[0]):n(".moreIcon",o.getControl()[0]);i.length>0&&(t.preventDefault(),t.stopImmediatePropagation(),i[0].focus())}});r[0].focus();break}},i.prototype._clearHeaderLastElementKeyDownHandler=function(){var i=n("#b_header"),t=n("#id_h",i[0]);t.length>0&&this._removeIDFocusHandler(t)},i.prototype._setLastIdKeyDownListener=function(t){for(var i,f=this,u=t&&t.length>0&&t[0].children,r=u.length-1;r>=0;r--)if(i=u[r].tagName.toLowerCase()==="a"?n(u[r]):null,i&&i.length>0&&i.get_style("display")!=="none"&&(!i.get_attr("keydownListen")||i.get_attr("keydownListen").indexOf("false")>-1)){i[0].addEventListener("keydown",function(n){return f.idButtonKeydownHandler(n)});i.set_attr("keydownListen","true");break}},i.prototype._removeIDFocusHandler=function(t){for(var i,u=t&&t.length>0&&t[0].children,r=u.length-1;r>=0;r--)i=u[r].tagName.toLowerCase()==="a"?n(u[r]):null,i&&i.length>0&&(i[0].removeEventListener("keydown",this.idButtonKeydownHandler),i.set_attr("keydownListen","false"))},i.prototype.idButtonKeydownHandler=function(t){var r,i;t&&t.keyCode&&t.keyCode===9&&!t.shiftKey&&(e._isCommuteDashboardPage()?(r=n(".".concat(e._commuteDashboardTabStartClassName)),r.length>0&&r[0].focus()):(i=n(".maplibregl-canvas-container.maplibregl-interactive .maplibregl-canvas.atlas-map-canvas"),e._isMapsOverlay()&&(i=n(".overlayCloseLink")),i.length>0&&i[0].focus()),t.preventDefault(),t.stopImmediatePropagation())},i.prototype._setTextAlignment=function(){for(var t=this._getShowTaskBarItemLabel(),n=0;n<this.taskBarItems.length;n++)this.taskBarItems[n].setShowLabel(t)},i.prototype._adjustSearchBoxWidth=function(){var r,c=this.getControl()[0],l=e._isSmallMapShownOnSerp()?0:this._map.getAzureMap().getMapSize().width,t,i,s,o;if(l>0)if(t=n(".inputbox",c)[0],i=n("#taskbarPrimer")[0],i&&i.clientWidth>0)s=n(".inputbox",i)[0],this._setSearchControlsWidth(t,s.getBoundingClientRect().width);else if(u.isMapsAnswer&&this.actionBarSize<this._minimumActionButtonsWidth&&(this.actionBarSize=this._maxActionButtonsWidth),t){var a=n("#b_header")[0],v=n("#id_h",a),f=n(".id_nc",v[0]),y=f&&f.length>0&&!f.has_class("bnc-hide"),p=(y?47:0)+((r=n(".overlayCloseBtn")[0])===null||r===void 0?void 0:r.clientWidth)||0,w=this._rightTaskbarBuffer+this._searchBoxLeftBuffer+this._actionButtonsFullWidth+this._idControlsAndHamburgerButtonsFullWidth+p,b=this._fullSearchControlsWidth-this._minSearchBoxWidth,h=window.innerWidth-(this._fullSearchControlsWidth+w);h>0?this._setSearchControlsWidth(t,this._searchBoxWidth):(o=b-Math.abs(h),o<0?this._setSearchControlsWidth(t,this._minSearchBoxWidth):this._areAllTaskbarElementVisibleAndExpanded()&&this._setSearchControlsWidth(t,this._minSearchBoxWidth+o))}},i.prototype._setSearchControlsWidth=function(t,i){var u,f,r;t&&(u=38,f=n("#maps_sb",t)[0],t.setAttribute("style","width: "+i+"px"),r=n(".as_container_search",t),r&&r.get_style("visibility")==="visible"&&this._searchBox.value.length>-1&&r.set_style({width:i+"px"}))},i.prototype.insertPopoutInMap=function(){var n=i._taskBarPopOutElement;n&&n.length!==0||(n=i._taskBarPopOutElement=b._createElement("div"),n.set_attr("class","taskBarPopout"),i._taskBarContainer.appendChild(n[0]))},i.prototype.getSearchBox=function(){return this._searchBoxViewModel&&this._searchBoxViewModel.getControl()},i.prototype.resizeOnOverlayOpened=function(){this._onResizeHandler()},i.prototype._updateActionButtonsAndIdControlsFullWidths=function(){var t,i,u=(t=n(".actions")[0])===null||t===void 0?void 0:t.clientWidth,r,f;u>this._actionButtonsFullWidth?this._actionButtonsFullWidth=u:this._actionButtonsFullWidth===0&&(this._actionButtonsFullWidth=this._navButtonWidth);r=(i=n("#id_h")[0])===null||i===void 0?void 0:i.clientWidth;r>this._idControlsAndHamburgerButtonsFullWidth?(f=20,this._idControlsAndHamburgerButtonsFullWidth=r+f):this._idControlsAndHamburgerButtonsFullWidth===0&&(this._idControlsAndHamburgerButtonsFullWidth=this._maxIdControlsWidth)},i.prototype._onResizeHandler=function(){var u,f,o,s,i,t,h,r;if((((u=n(".actions")[0])===null||u===void 0?void 0:u.clientWidth)>this._actionButtonsFullWidth||((f=n("#id_h")[0])===null||f===void 0?void 0:f.clientWidth)>this._idControlsAndHamburgerButtonsFullWidth)&&this._updateActionButtonsAndIdControlsFullWidths(),this._previousWindowWidth>=window.innerWidth?(this._adjustSearchBoxWidth(),this._showIdControls(),this._setTextAlignment(),this._setActionButtonsRealignClass()):(this._setTextAlignment(),this._setActionButtonsRealignClass(),this._showIdControls(),this._adjustSearchBoxWidth()),this._previousWindowWidth=window.innerWidth,e._isMapsOverlay()||b._isTravelOverlayShownOnSerp()){if(o=document.getElementById("b_header"),s=window.innerWidth,o)if(i=n(".id_button",o),s<=p.taskBarMapTypeTextMinWidth)for(t=0;t<i.length;t++)i[t].style.padding="0";else for(t=0;t<i.length;t++)i[t].removeAttribute("style");h=document.getElementsByTagName("html")[0];r=n(".b_footer.b_slimFoot.bm_oneMap")[0];s<=p.windowMinWidth?(h.style.overflowX="auto",r&&(r.style.zIndex="1001")):(h.style.overflowX="hidden",r&&r.removeAttribute("style"))}},i._adjustContainerTop=function(){var t=n("#container")[0];i.isFullScreen&&(t.style.top="0",t.style.bottom="0")},i.prototype._onMenuKeyDown=function(t){var s=this,o=t,u=o.keyCode||o.which,r,f,e;u===9?this.hideMenu():u===37?this.clearMenuElements():u===13||u===39?(r=t.target,r.className.indexOf("bm_dropdownEntry")>-1&&(r=r.children[0],r&&(r=r.children[0])),r.className.indexOf("feedback")>-1&&this.launchFeedbackMenu.invoke(n(".feedbackMenuLink").parent()),window.clearTimeout(i._mouseOverDelayHandle),i._mouseOverDelayHandle=a.setTimeout(function(){s.focusFeedback.invoke()},300)):u===40?(f=t.target.nextElementSibling,f&&n(f)[0].focus()):u===38&&(e=t.target.previousElementSibling,e?n(e)[0].focus():this.clearMenuElements())},i.prototype._setTrafficButtonSelected=function(t){if(e._isCommuteDashboardPage()||!(u.trafficStyleMenu||u.trafficStyleMenu2)){var i=e._isCommuteDashboardPage()?n(".myRoutesIcon")[0]:n(".trafficIcon")[0];i&&(t&&!i.classList.contains("selected")?(i.classList.add("selected"),i.setAttribute("aria-pressed","true")):!t&&i.classList.contains("selected")&&(i.classList.remove("selected"),i.setAttribute("aria-pressed","false")))}},i.prototype._getShowTaskBarItemLabel=function(){var t,r,u,f;if(this._searchBoxWidth===null)return!1;var e=((t=n(".taskBar")[0])===null||t===void 0?void 0:t.clientWidth)||window.innerWidth,o=(u=(r=n(".inputbox")[0])===null||r===void 0?void 0:r.parentElement)===null||u===void 0?void 0:u.clientWidth,s=((f=n(".overlayCloseBtn")[0])===null||f===void 0?void 0:f.clientWidth)||0;return o?p.showTaskBarLabels&&e>o+this._actionButtonsFullWidth+i._hamburgerButtonWidth+s:p.showTaskBarLabels&&e>p.taskbarButtonsShowTextWidth+s},i.prototype._logEmbed=function(n){var t={PL:n};yt.instLog("EMC",t)},i.prototype._searchBoxFocusHandler=function(){var t;t=e._isCommuteDashboardPage()?n(".sbElement .b_logoArea"):n("#maps_sb_container #maps_sb");t.length>0&&t[0].focus()},i.prototype._setHiddenElementFocusHandler=function(){var r=this,i=n("#b_header"),t;i.length>0&&(t=i.select("a"),t.length>0&&t[0].addEventListener("keydown",function(n){n&&n.keyCode&&n.keyCode===9&&!n.shiftKey&&(n.preventDefault(),n.stopPropagation(),r._searchBoxFocusHandler())}))},i.prototype._mapTabAccessibility=function(){var i=this,t=n(".mapboxgl-canvas-container.mapboxgl-interactive .mapboxgl-canvas.atlas-map-canvas");t.length>0&&t[0].addEventListener("keydown",function(t){if(t&&t.keyCode&&t.keyCode===9&&t.shiftKey)if(t.preventDefault(),t.stopPropagation(),e._isMapsOverlay()){var r=n(".overlayCloseLink");r.length>0&&r[0].focus()}else i._focusLastIdControl()})},i.prototype._focusLastIdControl=function(){var f=n("#b_header")[0],u,r,i,t;if(f&&(u=n("#id_h",f),u.length>0))for(r=u[0].children,i=r.length-1;i>=0;i--)if(t=r[i].tagName.toLowerCase()==="a"?n(r[i]):null,t&&t.length>0&&(t.get_style("display")!=="none"||!(!t.has_class("hide")||t.has_class("b_hide")))){t[0].focus();break}},i.prototype.getTask=function(){if(this._taskManager&&this._taskManager.getFocusedStack){var n=this._taskManager.getFocusedStack();if(n)return n.getForegroundTask()}return null},i.prototype.checkNewTask=function(){var n=this.getTask();return!this._activeTask||n&&(n.id!==this._activeTask.id||n.id.indexOf("Directions")>-1)?!0:!1},i.prototype._alignUnderTaskBarAction=function(t,i,r){r===void 0&&(r=0);var e=i.height+10,f=n(window).get_scroll_pos().x,o=window.innerHeight/window.document.documentElement.offsetHeight*100<80,s=!(f===0||o),u=_G.RTL?i.right-t[0].clientWidth:i.left;r===1&&(u=_G.RTL?u+t[0].clientWidth-i.width:u-t[0].clientWidth+i.width);s&&(u+=f);t.set_style({left:"".concat(u,"px"),right:"",top:"".concat(e,"px")})},i.prototype._hideAndTrackDismissFlyout=function(n){this.setShowCommuteFlyout(!1);this._trackFlyoutDismiss(n)},i.prototype._trackFlyoutDismiss=function(n){this._impressionIncrementedFlyoutDismiss||this._commuteFlyoutDismissCount++;n===4&&(this._impressionIncrementedFlyoutDismiss=!0);u.testHooksEnabled||(localStorage===null||localStorage===void 0?void 0:localStorage.setItem(nt.StorageKeys.FlyoutDismissKey,(new Date).toString()),localStorage===null||localStorage===void 0?void 0:localStorage.setItem(nt.StorageKeys.FlyoutDismissCountKey,""+this._commuteFlyoutDismissCount));var t=ps.get(n),i=h.logger,r={feature:"COMR",action:"CLS",data:{activity:t}};i.logObject(r)},i.prototype._getCounterFromStorageKey=function(n){var t,i=parseInt((t=localStorage===null||localStorage===void 0?void 0:localStorage.getItem(n))!==null&&t!==void 0?t:"");return isNaN(i)?0:i},i.prototype._areAllTaskbarElementVisibleAndExpanded=function(){var t,i=n(".actions .realign").length>0,r;return e._isMapsOverlay()?i:(r=((t=n("#id_l")[0])===null||t===void 0?void 0:t.clientWidth)>0,i&&r)},i.prototype._updateUrl=function(n,t,i){var r=new URL(window.location.origin+n);t&&i&&r.searchParams.set(t,i);window.location.href=r.toString()},i._featureNameToAction=function(){var n={};return n.CollectionsTask="CX",n.DirectionsTask="DD",n.Share="SH",n.Search="SR",n.Traffic="T",n.Fullscreen="FS",n.Embed="EMB",n.Overlay="OV",n.LocalGuide="LG",n}(),i.hiddenStyle={visibility:"hidden"},i.visibleStyle={visibility:"visible"},i._pressedButtonClass="pressed",i._hamburgerButtonWidth=100,i.isFullScreen=!1,i}(ri),ws=function(){function t(t,i,r,f){var o=this,h=i.shellContainerElement,y=this._getTemplate(),e,c,l,a,v;if(y)this._taskManager=f,e=this._viewModel=this._CreateTaskBarViewModel(t,i,y,r,this._taskManager),c=e.getControl(),this._map=i,this.feedbackInitialize=new s,e.launchFeedbackMenu.add(function(n){o.feedbackInitialize.invoke(n)}),this.dismissMenu=new s,this.dismissMenu.add(function(){e.hideMenu()}),this.dismissFeedbackMenu=new s,this.focusFeedbackMenu=new s,e.focusFeedback.add(function(){o.focusFeedbackMenu.invoke()}),e.hideFeedbackMenu.add(function(){o.dismissFeedbackMenu.invoke()}),this.hoverFeedbackButton=new s,this.hoverFeedbackButton.add(function(){e.hoverFeedbackButton()}),this.exitFullScreen=new s,this.exitFullScreen.add(function(){e.exitFullScreen.invoke()}),this.closeOverlay=e.closeOverlay,this._visibilityChangedEvent=new s,this._visibilityChangedEvent.add(function(n){e.setAutoSuggestExpanded(n)}),this._selectionChangedEvent=new s,this._selectionChangedEvent.add(function(n){e.setSelectedSuggestionId(n)}),this._currentSearchBoxQuery=null,this._registerMapTapEvent(),this._autosuggestResultsFromNearby=!1,n("#taskBarContainer",h).append(c),(ti.isOSx||ti.isSafari)&&c.add_class("bm_safari"),l=n("#maps_sb",h),l.length>0&&(this._searchBox=l[0],e.setSearchBox(this._searchBox)),n(".searchIcon",h).add_event("click",function(n){o.handleSearchButtonEvents(n)}),(pt===null||pt===void 0?void 0:pt.isEnabled)&&(this._suggestionItemSelected=new s,this._suggestionItemSelected.add(function(n){o._onSuggestionItemSelected(n)}),this._suggestionItemClicked=new s,this._suggestionItemClicked.add(function(n){o._onSuggestionItemClicked(n)}),this._onAutosuggestKeydown=new s,this._onAutosuggestKeydown.add(function(n){o.onAutosuggestKeydownFunction(n)}),this._clickHandler=new s,this._clickHandler.add(function(){o.handleClick()})),typeof Feedback!="undefined"&&(Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_feedback",!1,!0,!1),Feedback.Bootstrap.InitializeFeedback({structured:!0},"tdd_exit",!1,!0,!1)),e.insertPopoutInMap(),this.fullScreenEnabled=p.fullScreen,pt.enableQueryCompletion&&(a=b.createElementWithClassName("input","bm_completionBox bm_completionBoxHidden"),a.disabled=!0,this._searchBox&&this._searchBox.insertAdjacentElement("afterend",a));else throw new Error("Template is not defined!");this._clearSuggestions=!1;v=n("#b_TriviaOverlay",h);u.isMapsVertical&&v&&v.length>0&&kr.initialize(this._map,this._taskManager)}return t.prototype.initializeAutosuggest=function(){if((pt===null||pt===void 0?void 0:pt.showAutosuggestions)&&!this._searchBoxAutosuggestDataModel){var t=this._map.shellContainerElement,i=t.querySelector("#maps_sb"),r=this._searchBoxAutosuggestDataModel=new pf;this._autosuggestViewModel=new yf(r,!0,"TaskBarSearch",this._visibilityChangedEvent,this._selectionChangedEvent);var u=t.querySelector("#sb_as_container"),n=this._autosuggest=new vf(u,i,"as_container_search",this._autosuggestViewModel,this._map.getAzureMap());n.setAutosuggestKeydownHandler(this._onAutosuggestKeydown);n.setItemSelectionEventHandler(this._suggestionItemSelected);n.setItemClickEventHandler(this._suggestionItemClicked);n.setClickEventHandler(this._clickHandler)}},t.prototype.handleSearchButtonEvents=function(n){hi.enableDirectionsSearch=!1;this._autosuggest&&this._autosuggest.instrumentSearchButtonClickEvent();var t=this._autosuggestViewModel&&this._autosuggestViewModel.getSelectedSuggestion(),i=t?"Autosuggest":"SearchButton";this._performSearch(i,t);n&&n.preventDefault&&n.preventDefault()},t.prototype.handleClick=function(){hi.enableDirectionsSearch=!0;this._autosuggest&&this._autosuggest.refreshAutosuggest();this._clearSuggestions&&(hi.enableDirectionsSearch=!1,this._clearSuggestions=!1,this._searchBox&&this._searchBox.removeAttribute("placeholder"),this._searchBoxAutosuggestDataModel.clearDefaultSuggestions());this._autosuggestResultsFromNearby=!1},t.prototype.onAutosuggestKeydownFunction=function(n){var r=n,o=r.keyCode||r.which,s=this._autosuggestViewModel.getSelectedSuggestion(),u=pt.waitForCompositionEnd&&o===229&&r.code==="Enter",t,i,f,e;u&&s===null||(o===13||u)&&(hi.enableDirectionsSearch=!1,t=void 0,i="SearchBox",this._autosuggestViewModel&&(t=s),pt.enableQueryCompletion&&!t&&(f=this._autosuggestViewModel.getCurrentSuggestion(),f&&(t=f.suggestion)),t&&(i="Autosuggest"),i=this._autosuggestResultsFromNearby?"Nearby":i,t&&u&&(e=t.searchText,this._searchBox.value=e,this.setSearchTerm(e)),this._performSearch(i,t),this._autosuggestResultsFromNearby=!1)},t.prototype.processCallback=function(n){var u=this,t,i;n&&n.inData&&n.processorType&&n.outData&&(n.processorType==="LocalDetailsTask"||n.processorType==="PolygonEntityDetailsTask")&&(t={entryPoint:1},i=n.inData.requestState,b.checkDirectionsControl(function(){var e,f,o,s;i&&(i.searchEntitiesRequested||i.disableTaskActivate)&&n.outData&&n.outData.length>0&&(e=u._getEventTime(n.outData),f=void 0,e&&(f={dateTime:e,timeType:"arrival"}),o=u._getWaypoint(n.outData),o&&(t.waypoints=[o],f&&(t.options=f)));s={type:"DirectionsTask",state:t};r.invokeHandler("data-task",s)}))},t.prototype.getTaskbarItem=function(n){return this._viewModel.getTaskbarItem(n)},t.prototype._getTemplate=function(){return we},t.prototype._getWaypoint=function(n){var u=null,i,r,f,t;if(n.length>1||n[0]&&n[0].processorId){for(i=0;i<n.length;i++)if(n[i]&&n[i].data&&(r=n[i],f=r.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===f&&(t=r.data&&r.data.length>0?r.data[0]:null,t&&!t.isApproximateLocation))){u=new h.DirectionsControl.Waypoint(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,3);break}}else n[0]&&n[0]&&n[0].data.entities&&n[0].data.entities.length>0&&(t=n[0].data.entities[0],t&&!t.isApproximateLocation&&(u=new h.DirectionsControl.Waypoint(t.getAddress(),t.getLocation(),t.getTitle(),!1,null,t.id,null,null,null,2,3)));return u},t.prototype._getEventTime=function(n){var u,f,e,i,r,o,t;if(((f=(u=n===null||n===void 0?void 0:n[0])===null||u===void 0?void 0:u.data)===null||f===void 0?void 0:f.length)===1)for(i=0;i<n.length;i++)n[i]&&n[i].data&&(r=n[i],o=r.processorId,this._taskManager.getFocusedStack()&&this._taskManager.getFocusedStack().getForegroundTask().id===o&&(t=r.data&&r.data.length>0?r.data[0]:null,t&&t.id&&t.id.indexOf("event")>-1&&t.getDateTime&&t.getDateTime()&&(e=t.getDateTime()+t.getUtcOffset()*6e4-li.eventPreArrivalTime*6e4)));return e},t.prototype._onSuggestionItemSelected=function(n){this.getSearchTerm()===n.searchText&&this._searchBox&&(this._searchBox.value=n.searchText);this.setSearchTerm(n.searchText)},t.prototype._onSuggestionItemClicked=function(n){this._performSearch(this._autosuggestResultsFromNearby?"Nearby":"Autosuggest",n);this._autosuggestResultsFromNearby=!1},t.prototype.onAutosuggestBlurHandler=function(){this.getSearchTerm()||(this._currentSearchBoxQuery&&this.setSearchTerm(this._currentSearchBoxQuery),this._searchBox.setAttribute("placeholder",o.SearchGhostText));this._currentSearchBoxQuery=null},t.prototype._performSearch=function(t,i){var h,u,e,c,l,f,s,a;sf.setStartTime("SearchRequest");h=this._searchBox?this._searchBox.value.trim():this._viewModel.getSearchTerm().trim();this._viewModel.onSearchInvokedFromTaskbar(null);if(this._autosuggest&&this._autosuggest.stopAutosuggest(),u={},u.query=h,t!=="Autosuggest"&&(u.originalQuery=h),p.searchFormCode&&t!=="Nearby"&&(u.formCode=p.searchFormCode),u.entryPoint=t,t==="Nearby"&&(e=n("div.overlay-taskpane"),c=null,e&&e.length>0&&(l=e[e.length-1].getAttribute("data-entity"),l&&(f=JSON.parse(l),f&&f.routablePoint&&(c={location:f.routablePoint,title:f.entity&&(f.entity.name||f.entity.title||f.entity.adress)}))),u.nearbyPivotEntity=c,p.nearbyFormCode&&!u.formCode&&(u.formCode=p.nearbyFormCode)),u.asConversationId=this._autosuggest&&this._autosuggest.getConversationId(),i&&(this.setSearchTerm(i.searchText),u.query=i.searchText,u.fullQuery=i.searchText,p.updateSearchTermOfAutosuggestWithTaskTitle&&(u.originalQuery=i.searchText),u.filterUrlParam=i.entityId,u.mapBounds=i.mapBounds,i.type==="Favorite"?(!i.entityId&&i.location&&(u.query=i.location[1]+","+i.location[0],u.fullQuery=u.query),u.taskTitle=i.alternateName||i.name,u.asName=i.name,u.asFormattedAddress=i.formattedAddress):(u.asName=i.formattedLine1,u.asFormattedAddress=i.formattedLine2),s=i.primaryCategoryPath,s&&(b._isRestaurantCategory(s)||b._isHotelsCategory(s))&&(u.noAds=!0)),this._map.tryDeactivateStreetside(),i&&i.title===o.L_SearchNearbyTransit&&(or===null||or===void 0?void 0:or.isEnabled)){a={location:vi.getMapCenter(this._map.getAzureMap()),title:this._nearbyLocationTitle,entryPoint:1};r.invokeHandler("data-task",{state:a,type:"NearbyTransitTask"});return}r.invokeHandler("data-process",{requestState:u,type:"LocalSearchTask"})},t.prototype.setActionsOptions=function(n){this._viewModel.setActionsOptions(n)},t.prototype.setActionsState=function(n,t){this._viewModel.setActionsState(n,t)},t.prototype.setSearchTerm=function(n,t){this._viewModel.setSearchTerm(n);t&&r.invokeHandler("data-process",{type:"LocalSearchTask",requestState:{query:n}})},t.prototype.getSearchTerm=function(){return this._viewModel.getSearchTerm()},t.prototype.setSearchBoxFocus=function(){this._viewModel.setSearchBoxFocus()},t.prototype.getSearchBox=function(){return n(this._searchBox)},t.prototype.setSearchBoxGhostText=function(n){this._searchBox&&(this._currentSearchBoxQuery=this.getSearchTerm(),this.setSearchTerm(""),this._searchBox.setAttribute("placeholder",n),this.setSearchBoxFocus(),this._clearSuggestions=!0)},t.prototype.updateSearchBoxAutosuggestDefault=function(n,t,i){this._autosuggestResultsFromNearby=ti.nearbyButtonEnabled&&!!i;this._searchBoxAutosuggestDataModel.updateDefaultSuggestions(n,t);this._autosuggest&&this._autosuggest.refreshAutosuggest()},t.prototype.setNearbyLocationTitle=function(n){this._nearbyLocationTitle=n},t.prototype._CreateTaskBarViewModel=function(n,t,i,r,f){return new hi(n,t,u.isMobile?ve:this._getTemplate(),r,f)},t.prototype._registerMapTapEvent=function(){var n=this,t=this._map.getAzureMap();vt.add(t,"mousedown",function(){n._searchBox&&n._searchBox.blur()})},t}(),nu;(function(n){function t(n){function r(n,t,i,r,u){return n.actionSucceeded?t:n.favorite?r:u&&n.maxFavorites?u:i}var u=n&&n.inData&&n.inData.requestState&&n.inData.requestState,t=u&&u.action,i,f;if(n&&n.outData&&n.outData.length!==0){if(i=n.outData&&n.outData[0].data,i.notSignedIn)return 2;if(f=i.actionSucceeded,t===8)return r(i,10,9,15,16);if(t===9)return r(i,12,11,15,16);if(t===10)return r(i,8,7,15,16);if(t===18)return r(i,20,7,22,null);if(t===20)return f?25:7;if(t===1)return f&&i.collections?6:i.failureMessage?24:i.collections?17:3;if(i.collections.length===0){if(t===4)return 4;if(t===12)return 13}else{if(t===4)return u.isMove?23:5;if(t===12)return 13}}else return t&&t===12?13:t&&t===18?21:1;return 1}n.processResponse=t})(nu||(nu={}));var bs=function(){function t(n){this._events=[];this._map=n;this._viewModelInitialized=!1;this.hideParent=new s;this.moveToNewCollection=new s}return t.prototype.setEntityData=function(n,t,i){this._entity=n;this._options=t;this._rootElement=i},t.prototype.setAddToRouteMode=function(n,t){this._directionsButton=n;this._addToRouteMode=t},t.prototype.setSaveButton=function(n){this._saveButton=n},t.prototype.getSaveButton=function(){return this._saveButton},t.prototype.processDirectionsData=function(n,t){this._showDirectionsPopOut(n.outData,t,n.inData.requestorState)},t.prototype.processCollectionsData=function(n,t){this._showCollectionsPopOut(n,t,n.inData.requestorState)},t.prototype.processTravelMoveToData=function(n,t){this._showTravelMoveToPopOut(n.outData,t,n.inData.requestorState)},t.prototype.processSaveWithTravelData=function(t,i){this._saveButton=i&&n(i.target);this.openItineraryTaskInfo=t.outData;var r=t.inData.requestorState;l.enableOneClickSave&&r&&r.entryPoint!=="ContextMenu"?this._showItineraryPopout(t):r.isSignedIn?this.collectionMenuButtonClicked(i,r.location,r.instData,r.entryPoint):this._showSaveWithTravelPopOut(t.outData,r)},t.prototype.directionButtonClicked=function(t,i,u,f){t&&t.preventDefault();this._directionsButton=n(t.currentTarget);this._setAriaExpanded(this._directionsButton);var e={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:"DirectionsTask",requestState:{action:0},requestorState:{location:i,instData:u,entryPoint:f},useActiveTasks:!0};r.invokeHandler("data-process",e)},t.prototype.scheduleContactTourButtonClicked=function(t,i,r){t&&t.preventDefault();this._scheduleContactButton=t&&n(t.target);this._showScheduleContactPopOut(i,r)},t.prototype.collectionButtonClicked=function(t,i,r,u){var f,e,o,s;if(t&&t.preventDefault(),t&&(this._saveButton=n(t.target)),l.enableOneClickSave&&this._entity){this._oneClickSave(i,r,u,!1);return}f=this._entity;e={title:st.getDisplayName(f),address:f.getAddress&&f.getAddress(),location:i,id:st.getYpid(f)};this.entityNickName&&this.entityOriginalName&&(e.nickName=this.entityNickName,e.title=this.entityOriginalName);this.entityDescription&&(e.description=this.entityDescription);o=f.getImageUrl&&f.getImageUrl();o&&o.length&&(e.photoUrl=o);s=18;this._trySaveProcessCall(e,s,r,u,!0);this._logData(r)},t.prototype.collectionMenuButtonClicked=function(t,i,u,f,e){var o,s;t&&t.preventDefault();t&&(this._saveButton=n(t.target));l.enableOneClickSave&&this._entity&&!e?this._oneClickSave(i,u,f,!0):(o={action:4},e&&(o.isMove=!0),s={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:"CollectionsTask",requestState:o,requestorState:{location:i,instData:u,entryPoint:f}},r.invokeHandler("data-process",s));this._logData(u)},t.prototype.travelMoveToButtonClicked=function(t,i,u,f){t&&t.preventDefault();this._travelButton=n(t.target);var e={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:"ItineraryDetailsTask",requestState:{action:2},requestorState:{location:i,instData:u,entryPoint:f},taskId:this._options.requestorId};r.invokeHandler("data-process",e)},t.prototype.saveWithTravelButtonClicked=function(t,i,u,f,e){if(t&&t.preventDefault(),this._saveButton=n(t.target),l.enableOneClickSave&&this._entity)this._oneClickSave(i,u,f,e);else{var o={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:"ItineraryDetailsTask",requestState:{action:0},requestorState:{location:i,instData:u,entryPoint:f,isSignedIn:e},useActiveTasks:!0};r.invokeHandler("data-process",o)}e||this._logData(u)},t.prototype.nearbyButtonClicked=function(t,i,r,u,f,e){var a=this,c,l;t&&t.preventDefault();this._nearbyButton=n(t.target);this._initializeViewModels(i);var h=this._rootElement?this._rootElement:n("#transientLens"),s=this._popOutButtonViewModel,o=this._nearbyListDropdownViewModel;o?(o.setAddress(e),o.setButtonElement(this._nearbyButton),o.setDropdownData(r,i)):(o=this._nearbyListDropdownViewModel=new du(r,i,this._nearbyButton,e),this._events.push(o.contextMenuFinished.add(function(){s.setIsDisplayed(!1);o.isDisplayed=!1;a.hideParent.invoke()})));s.setAriaLabel(null);s.setDropdownClass("popOutTop");this._updatePopOutListDropdownViewModel(o);o.isDisplayed=!0;c=this._nearbyButton&&this._nearbyButton.length>0?this._nearbyButton[0].className:"";s.setParentClass(c);this._nearbyButton.add_class("selected");l=h.select("div.nearbyPopOut");l.append(this._popOutElement);o.buildCategoryIcons(u,h,f);this._displayPopOut()},t.prototype.hidePopout=function(){this._popOutButtonViewModel&&this._popOutButtonViewModel.setIsDisplayed(!1)},t.prototype.dispose=function(){this._popOutButtonViewModel&&this._popOutButtonViewModel.dispose()},t.prototype._showDirectionsPopOut=function(t,i,u){var e=u.location,o,s,h;this._initializeViewModels(e);this._directionsListDropdownViewModel.setButtonElement(this._directionsButton);this._directionsListDropdownViewModel.setDropdownData(t,this._entity,e,u.instData);this._directionsListDropdownViewModel.dropdownList.length>1?(o=this._rootElement?this._rootElement:n("#transientLens"),s=o.select("div.directionsPopOut"),this._popOutButtonViewModel.setAriaLabel(f.L_DirectionsPopOutAriaLabel),this._popOutButtonViewModel.setDropdownClass("popOutTop"),h=this._directionsButton&&this._directionsButton.length>0?this._directionsButton[0].className:"",this._popOutButtonViewModel.setParentClass(h),this._updatePopOutListDropdownViewModel(this._directionsListDropdownViewModel),s.append(this._popOutElement),this._displayPopOut()):(this.hideParent.invoke(),r.invokeHandler("data-task",i))},t.prototype._showSaveWithTravelPopOut=function(t,i){var o=i.location,r,e,u,s;this._initializeViewModels(o);r=this._saveWithTravelDropdownViewModel;r?(r.setButtonElement(this._saveButton),r.setDropdownData(null,null,this._entity,o,this._options.requestorId,this._options.requestorType,i.instData,null,t),r.dropdownList.length>0&&(e=this._rootElement?this._rootElement:n("#transientLens"),u=e.select("div.collectionsPopOut"),this._handleCollectionsPopoutLocation(u,e),this._popOutButtonViewModel.setAriaLabel(f.L_TravelPopOutAriaLabel),s=this._saveButton&&this._saveButton.length>0?this._saveButton[0].className:"",this._popOutButtonViewModel.setParentClass(s),this._popOutButtonViewModel.setDropdownClass("popOutTop listDropdown"),this._updatePopOutListDropdownViewModel(r),u.append(this._popOutElement),this._displayPopOut(),this._setPopoutFocus(u))):this.hideParent.invoke()},t.prototype._showScheduleContactPopOut=function(t,i){var f,e,r,o,u,s,h;this._initializeViewModels(null);f=this._scheduleTourDropdownViewModel;f&&(f.setButtonElement(this._scheduleContactButton),f.setDropdownData(null,t,i));f&&f.dropdownList.length>0?(e=this._rootElement?this._rootElement:n("#transientLens"),r=e.select("div.scheduleContactPopOut"),(!r||r.length<1)&&(r=n(document.createElement("div")),r.add_class("bm_popout scheduleContactPopOut")),o="popOutTop listDropdown scheduleContact",u=this._scheduleContactButton&&this._scheduleContactButton.get_ancestor(3),u&&u.has_class("b_sgmbtns")?u.append(r):(this._handleCollectionsPopoutLocation(r,e,"House"),s=u&&u[0]&&u[0].childElementCount||3,o+=s===1?" leftScheduleContact":s===2?" middleScheduleContact":" rightScheduleContact"),this._popOutButtonViewModel.setAriaLabel("scheduleTourLabel"),h=this._scheduleContactButton&&this._scheduleContactButton.length>0?this._scheduleContactButton[0].className:"",this._popOutButtonViewModel.setParentClass(h),this._popOutButtonViewModel.setDropdownClass(o),this._updatePopOutListDropdownViewModel(this._scheduleTourDropdownViewModel),r.append(this._popOutElement),this._displayPopOut(),this._setPopoutFocus(r)):this.hideParent.invoke()},t.prototype._handleCollectionsPopoutLocation=function(n,t,i){var u,r,f,e,o,s;(i===void 0&&(i=""),u=t.select(".b_subModule"),!u||u.length<1)||(r=null,i||(f=this._entity,e=f&&f.getSegmentTypes&&f.getSegmentTypes(),i=e&&e.length&&e[0]||f&&f.getSearchCategory&&f.getSearchCategory()),b._isHouseCategory(i))&&(o=u.select(".b_actionBtns"),s=u.select(".b_mapbtns"),s&&s.length>0&&o&&o.length>0?(n.add_class("houseCollectionsPopout"),o.insertBefore(n,s)):(r=u.select(">.b_mort"),r&&r.length!==0||(r=u.select(">.b_subscomp")),r&&r.length!==0||(r=u.select(">.b_lBottom.b_snippet")),r&&r.length!==0||(r=u.select(">.b_infoCardCustFacts")),r&&r.length!==0||(r=u.select(".infoCardIcons")),r&&r.length!==0||(r=u.select(".b_vList")),r&&r.length>0&&u.insertBefore(n,r)))},t.prototype._showTravelMoveToPopOut=function(t,i,r){var e=r.location,u,o,s,h;this._initializeViewModels(e);u=this._itineraryDaysDropdownViewModel;u&&u.setButtonElement(this._travelButton);u&&u.setDropdownData(t,this._entity,e,r.instData);u&&u.dropdownList.length>0?(o=this._rootElement?this._rootElement:n("#transientLens"),s=o.select("div.travelPopOut"),this._popOutButtonViewModel.setAriaLabel(f.L_TravelPopOutAriaLabel),h=this._travelButton&&this._travelButton.length>0?this._travelButton[0].className:"",this._popOutButtonViewModel.setParentClass(h),this._popOutButtonViewModel.setDropdownClass("popOutTop"),this._updatePopOutListDropdownViewModel(u),s.append(this._popOutElement),this._displayPopOut()):this.hideParent.invoke()},t.prototype._showCollectionsPopOut=function(n,t,i){var s=nu.processResponse(n),r=i.location,u=i.instData,e=i.entryPoint,h=i.isSignedIn,o;switch(s){case 2:this.showSignInMessage(i.location);break;case 1:case 4:case 5:case 23:this._showCollectionsList(n.outData[0].data,n.inData,t,i.location,i.instData,s===23);break;case 3:this._showAddEntityMessage(!1,n.inData.requestState,n.inData.requestorState);break;case 24:this._showAddEntityMessage(!1,n.inData.requestState,n.inData.requestorState,n.outData[0].data);break;case 6:this._showAddEntityMessage(!0,n.inData.requestState,n.inData.requestorState,n.outData[0].data);break;case 7:this._showCollectionsMessage(f.L_AddFavoriteFailed,r,u,e);break;case 15:this._showCollectionsMessage(f.L_AddFavoriteExists_Text,r,u,e);break;case 22:this._showCollectionsMessage(f.L_AddTemporaryExists,r,u,e);break;case 16:this._showCollectionsMessage(f.L_TooManyFavorites,r,u,e);break;case 8:this._showAddFavoriteMessage(n.inData.requestState,n.inData.requestorState,n.outData[0].data);break;case 20:this._showAddTemporaryMessage(n.inData.requestState,n.inData.requestorState,n.outData[0].data);break;case 21:o=n.inData.requestorState;this._trySaveProcessCall(n.inData.requestState.data,18,o.instData,o.entryPoint);break;case 9:this._showCollectionsMessage(f.L_SetHomeFailed,r,u,e);break;case 10:this._showCollectionsMessage(f.L_SetHomeSucceeded,r,u,e);break;case 11:this._showCollectionsMessage(f.L_SetWorkFailed,r,u,e);break;case 12:this._showCollectionsMessage(f.L_SetWorkSucceeded,r,u,e);break;case 13:this._openCollection(n.inData.requestState,n.inData.requestorState,n.outData);break;case 25:this._showCollectionsMessage(f.L_EntityUpdateSucceeded,r,u,e);break;case 17:this._showAddEntityMessage(!0,n.inData.requestState,n.inData.requestorState,n.outData[0].data)}},t.prototype.showSignInMessage=function(t,i){var u;this._initializeViewModels(t);var e=this._rootElement?this._rootElement:n("#transientLens"),o=e.select("div.collectionsPopOut"),r=this._collectionsPopOutMessageViewModel;r.title=i?f.L_SignInRequiredItinerary:f.L_SignInRequired;r.linkTitle=null;r.linkData=null;r.setButtonElement(this._saveButton);this._popOutButtonViewModel.setPopOutTemplate(this._signInControlTemplate);u=this._travelButton&&this._travelButton.length>0?this._travelButton[0].className:"";this._popOutButtonViewModel.setParentClass(u);this._saveButton.add_class("selected");this._popOutButtonViewModel.setPopOut(r);o.append(this._popOutElement);this._displayPopOut()},t.prototype._showAddEntityMessage=function(n,t,i,r){var u={action:l.enableOneClickSave?2:12,collectionId:t.collectionId,data:t.data,entityId:r&&r.entityId||this._getEntityIdFromCollection(r,t.collectionId,t.data.id)},e="",o="",s,h;n?(t.collectionId&&(e=u.entityId?f.L_SavedCollection.replace("{0}",t.data.title):f.L_EntityPreviouslySaved.replace("{0}",t.data.title)),o=i.title,l.enableOneClickSave?h={type:"CollectionsTask",state:u}:s={type:"CollectionsTask",requestorType:this._options.requestorType,requestorId:this._options.requestorId,requestState:u,requestorState:i,useActiveTasks:!0}):e=r?r.failureMessage:f.L_SaveFailed.replace("{0}",i.title).replace("{1}",t.data.title);this._showCollectionsMessage(e,i.location,i.instData,i.entryPoint,o,null,s,h)},t.prototype._showAddTemporaryMessage=function(n,t,i){var r={action:l.enableOneClickSave?17:12,data:n.data,entityId:i&&i.entityId,collectionId:i&&i.collections&&i.collections.length&&i.collections[0].id},u="",s=f.L_AddTemporaryCollectionTitle,e,o;i&&i.entityId&&(u=f.L_AddFavoriteSucceeded.replace("{0}",n.data.title),l.enableOneClickSave?o={type:"CollectionsTask",state:r}:e={type:"CollectionsTask",requestorId:this._options.requestorId,requestorType:this._options.requestorType,requestState:r,requestorState:t,useActiveTasks:!0});this._showCollectionsMessage(u,t.location,t.instData,t.entryPoint,s,null,e,o,!0)},t.prototype._showAddFavoriteMessage=function(n,t,i){var r={action:l.enableOneClickSave?15:12,data:n.data,entityId:i&&i.entityId},u="",e,o;i.entityId&&(u=f.L_AddFavoriteSucceeded.replace("{0}",n.data.title),l.enableOneClickSave?o={type:"CollectionsTask",state:r}:e={type:"CollectionsTask",requestorType:this._options.requestorType,requestorId:this._options.requestorId,requestState:r,requestorState:t,useActiveTasks:!0});this._showCollectionsMessage(u,t.location,t.instData,t.entryPoint,"",null,e,o)},t.prototype._showCollectionsMessage=function(t,i,u,e,o,s,h,c,a){var y=this,p,b,v,d,w,k;this._initializeViewModels(null);p=this._rootElement?this._rootElement:n("#transientLens");b=p.select("div.collectionsPopOut");this._handleCollectionsPopoutLocation(b,p);v=this._collectionsPopOutMessageViewModel;v.setParentClass(p[0].className);v.title=t;v.linkTitle=o||"";v.editButtonTitle=f.L_EditFavorite_Text;v.closeButtonTitle=f.L_Dlg_Close;v.saveButtonTitle=f.L_SaveUpdateButton;v.updateNicknameMessage=f.L_UpdateNicknameMessage;v.linkData=s;v.processOptions=h;v.activateOptions=c;v.isTempCollectionMessage=a;v.setShowLink(!!(s||h||c));v.saveNicknameClicked=!1;u&&r.invokeHandler("data-instrumentation",u);h&&h.requestState?(w=h.requestState,v.entityId=w.entityId,d=w.data&&w.data.nickName):c&&(v.requestorId=this._options.requestorId,v.requestorType=this._options.requestorType,v.entityId=c.state.entityId);v.showFooter=v.entityId&&v.entityId.length>0?"":"none";v.setButtonElement(this._saveButton);l.enableOneClickSave?(k=new ui,k.getIsSignedIn()&&(this._collectionTaskState=(h===null||h===void 0?void 0:h.requestState)||(c===null||c===void 0?void 0:c.state),this._linkTaskOptions=s,this._collectionPopoutChangeRegistered||(this._collectionPopoutChangeRegistered=!0,this._collectionsPopOutMessageViewModel.popOutChangeLinkClicked.add(function(){var n,t,f;if(y._collectionTaskState)t={action:4,removeEntityAndPerformAction:!0,removeEntityFromCollectionId:y._collectionTaskState.collectionId,entityId:y._collectionTaskState.entityId};else if(((n=y._itineraryTaskState)===null||n===void 0?void 0:n.itineraryItem)&&y._linkTaskOptions)t={action:4,removeEntityFromItinerary:!0,removeEntityFromItineraryDetailsTaskId:y._linkTaskOptions.id,removeEntityFromCollectionId:y._itineraryTaskState.itineraryCollectionId,entityId:y._itineraryTaskState.itineraryItem.Id};else return;f={requestorType:y._options.requestorType,requestorId:y._options.requestorId,type:"CollectionsTask",requestState:t,requestorState:{location:i,instData:u,entryPoint:e}};r.invokeHandler("data-process",f)}))),(!e||e!=="ContextMenu"&&e!=="Infobox")&&(h||c||s)&&k.getIsSignedIn()?this._collectionsPopOutMessageViewModel.setShowChangeLink(!0):this._collectionsPopOutMessageViewModel.setShowChangeLink(!1)):this._collectionsPopOutMessageViewModel.setShowChangeLink(!1);this._popOutButtonViewModel.setTemplateToPopOutMessage();this._popOutButtonViewModel.setPopOut(null);this._popOutButtonViewModel.setPopOut(v);b.append(this._popOutElement);this._displayPopOut()},t.prototype._showCollectionsList=function(t,i,u,e,o,s){var h=this,c;this._initializeViewModels(e);c=function(){var i,t,e;h._collectionsListDropdownViewModel.dropdownList.length>1?(i=h._rootElement?h._rootElement:n("#transientLens"),t=i.select("div.collectionsPopOut"),h._popOutButtonViewModel.setAriaLabel(f.L_CollectionsPopOutAriaLabel),e=h._travelButton&&h._travelButton.length>0?h._travelButton[0].className:"",h._popOutButtonViewModel.setParentClass(e),h._popOutButtonViewModel.setDropdownClass("popOutTop listDropdown"),h._updatePopOutListDropdownViewModel(h._collectionsListDropdownViewModel),t.append(h._popOutElement),h._displayPopOut(),h._setPopoutFocus(t)):r.invokeHandler("data-task",u)};this._updateCollectionsListViewModel(t,i,e,o,c,s)},t.prototype._openCollection=function(n,t,i){var f=window.$MicrosoftMaps8&&window.$MicrosoftMaps8.CloudGraphDataManager,e=i&&i.length&&i[0].data,o=e&&e.taskId,u=n.collectionId?2:15,s,h;l.enableOneClickSave&&(u=f&&f.Utilities&&f.Utilities.isDefaultCollectionId(n.collectionId)?15:2);this._collectionsPopOutMessageViewModel.isTempCollectionMessage&&(u=17);s=n.collectionId?{action:u,collectionId:n.collectionId,entryPoint:2}:{action:u,entityId:n.entityId,entryPoint:2};h={action:o?"focus":"activate",id:o,type:"CollectionsTask",state:s};r.invokeHandler("data-task",h)},t.prototype._updatePopOutListDropdownViewModel=function(n){this._popOutButtonViewModel.setDropdown(n)},t.prototype._displayPopOut=function(){var n=this;a.setTimeout(function(){var t,i;n._popOutButtonViewModel.setIsDisplayed(!0);t=n._popOutElement;t.select&&(i=t.select(".bm_dropdownEntry"),i&&i.length>0&&i[0].focus(),t.select(".popOutTop").set_attr("aria-hidden","false"))},0)},t.prototype._initializeViewModels=function(n){var t=this,r,u,e,i;this._viewModelInitialized||(this._directionsListDropdownViewModel=new ts(null,this._entity,n,this._directionsButton,null,this._addToRouteMode),this._scheduleTourDropdownViewModel=new es(null,this._scheduleContactButton,null),r=this.hideParent,this._entity&&(this._saveWithTravelDropdownViewModel=new fs(this._map,null,this._entity,n,this._options.requestorId,this._options.requestorType,this._saveButton,null),u=this._collectionsListDropdownViewModel=new ku(this._map,this._saveButton,!1,this.entityNickName,this.entityOriginalName,this.entityDescription),u.setDropdownData(null,null,this._entity,n,this._options.requestorId,this._options.requestorType,null,function(){},this.openItineraryTaskInfo),this._events.push(u.newCollectionCreated.add(function(){r.invoke();u.isMoveToMenu&&t.moveToNewCollection.invoke()})),this._events.push(u.contextMenuFinished.add(function(){r.invoke()})),this.isItineraryContextMenu&&(this._itineraryDaysDropdownViewModel=new rs(null,this._entity,n,this._travelButton,null))),e=this._collectionsPopOutMessageViewModel=new bu(f.L_SignInRequired,null,null,this._saveButton,this._map.getContainer()),i=this._popOutButtonViewModel=new ki(this._directionsListDropdownViewModel,e),this._signInControlTemplate=new it(fe,{onPopOutLinkClick:function(n){return i.onPopOutLinkClicked(n)},onSignedIn:function(){return t._saveButton.fireEvent("click")}}),this._events.push(i.popOutHidden.add(function(){var n;((n=t._directionsListDropdownViewModel)===null||n===void 0?void 0:n.dropdownList.length)>1?r.invoke():i.isPopOutInListMode()||i.getPopOutTemplate()===t._signInControlTemplate||e.isTempCollectionMessage&&e.saveNicknameClicked?i.isPopOutInListMode()&&t._nearbyListDropdownViewModel&&t._nearbyListDropdownViewModel.isDisplayed&&r.invoke():r.invoke();t._popOutElement.select&&t._popOutElement.select(".popOutTop").set_attr("aria-hidden","true")})),this._popOutElement=i.buildPopOut(),this._viewModelInitialized=!0)},t.prototype._updateCollectionsListViewModel=function(n,t,i,r,u,f){var e=this._collectionsListDropdownViewModel;typeof f=="boolean"&&(e.isMoveToMenu=f);this.entityNickName&&(e.entityNickName=this.entityNickName);this.entityOriginalName&&(e.entityOriginalName=this.entityOriginalName);this.entityDescription&&(e.entityDescription=this.entityDescription);e.setButtonElement(this._saveButton);e.popOutRoot=this._popOutElement;e.setDropdownData(n,t,this._entity,i,this._options.requestorId,this._options.requestorType,r,u,this.openItineraryTaskInfo)},t.prototype._logData=function(n){r.invokeHandler("data-instrumentation",n)},t.prototype._trySaveProcessCall=function(n,t,i,u,f){var e={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:"CollectionsTask",requestState:{action:t,data:n},requestorState:{location:location,instData:i,entryPoint:u}};f&&(e.useActiveTasks=!0);r.invokeHandler("data-process",e)},t.prototype._setPopoutFocus=function(n){a.setTimeout(function(){b._setFocusOnFirstMenuItem(n)},100)},t.prototype._setAriaExpanded=function(n){n&&n.length>0&&n.get_attr("aria-expanded")!==undefined&&n.get_attr("aria-expanded")!==""&&n.set_attr("aria-expanded","true")},t.prototype._oneClickSave=function(n,t,i,u){var o,s,f,e;this._initializeViewModels(n);this._entity instanceof cr||this._entity instanceof ci?(o=this._entity.id,s=this._entity.getImageUrl()):(o=st.getYpid(this._entity),s=this._entity.imageUrl);f=ft.getMyPlacesTaskOptions(st.getDisplayName(this._entity),n,this.entityDescription,this._entity.getAddress&&this._entity.getAddress(),s,this._entity.getSelectedCategoryForIcon&&this._entity.getSelectedCategoryForIcon(),o,this._entity.addressFields,this._entity.metadataString,this._entity.mainSegmentType);f.activateOptions={parentId:this._options.requestorId};this.entityNickName&&this.entityOriginalName&&(f.state.data.nickName=this.entityNickName,f.state.data.title=this.entityOriginalName);e=this._getMostRecentlyUsedOption(n,t,i,f,u);e||(e={type:f.type,requestorId:this._options.requestorId,requestorType:this._options.requestorType,requestState:{action:u?10:18,data:f.state.data},requestorState:{location:n,instData:t,entryPoint:i,isSignedIn:u},processCallback:this._options.processCallback});r.invokeHandler("data-process",e)},t.prototype._getMostRecentlyUsedOption=function(n,t,i,r,u){var f=window.$MicrosoftMaps8&&window.$MicrosoftMaps8.CloudGraphDataManager,h=f.MostRecentlyUsedList&&f.MostRecentlyUsedList.instance,s,o,e;if(h.getLength()>0)for(s=h.getList(),o=0;o<s.length;o++){if(e=s[o],e.IsItinerary)return this._getRecentItineraryProcessOptions(n,t,i,e,u);if(!l.useJsonApiForFavorites||!f||!f.Utilities||!f.Utilities.isKeyPlacesCollectionId(e.Collection.id))return this._getCollectionProcessOptions(n,t,i,u,e,r)}return null},t.prototype._getRecentItineraryProcessOptions=function(n,t,i,r,u){var f,e,o=ft.getItineraryItemFromSearchEntity(this._entity,n);return{type:"ItineraryDetailsTask",requestorId:this._options.requestorId,requestorType:this._options.requestorType,taskId:r.TaskId,requestState:{action:r.TaskId?1:5,itineraryItem:o,itineraryCollectionId:(f=r.Itinerary)===null||f===void 0?void 0:f.collectionId,title:r.TaskTitle?r.TaskTitle:(e=r.Itinerary)===null||e===void 0?void 0:e.getName()},requestorState:{location:n,instData:t,entryPoint:i,isSignedIn:u},processCallback:this._options.processCallback}},t.prototype._getCollectionProcessOptions=function(n,t,i,r,u,f){var e=u.Collection,o=window.$MicrosoftMaps8&&window.$MicrosoftMaps8.CloudGraphDataManager,s;return s=r?o&&o.Utilities&&o.Utilities.isDefaultCollectionId(e.id)?10:1:18,{type:"CollectionsTask",requestorId:this._options.requestorId,requestorType:this._options.requestorType,requestState:{action:s,data:f.state.data,collectionId:e.id},requestorState:{title:e.name,location:n,instData:t,entryPoint:i,isSignedIn:r},processCallback:this._options.processCallback}},t.prototype._showItineraryPopout=function(n){var r={action:7},o=f.L_SavedCollection.replace("{0}",this._entity.getTitle()),s=n.inData.requestState.title,i=n.outData&&n.outData.length>0?n.outData[0].processorId:null,u=n.outData&&n.outData.length>0&&n.outData[0].data?n.outData[0].data.collectionId:null,e,t;i||(r.itineraryCollectionId=u);e={type:"ItineraryDetailsTask",action:i?"focus":"activate",id:i,state:r};t=n.inData.requestorState;this._itineraryTaskState=n.inData.requestState;this._itineraryTaskState.itineraryCollectionId=u;this._showCollectionsMessage(o,t.location,t.instData,t.entryPoint,s,e)},t.prototype._getEntityIdFromCollection=function(n,t,i){var o,s,u,f,e,r;if(!l.enableOneClickSave||!n||!n.collections||n.collections.length===0||!t||!i)return null;for(u=0;u<n.collections.length;u++)if(f=n.collections[u],f.id===t)for(e=0;e<f.primitives.length;e++)if(r=f.primitives[e],((o=r===null||r===void 0?void 0:r.entity)===null||o===void 0?void 0:o.id)===i||((s=r===null||r===void 0?void 0:r.entity)===null||s===void 0?void 0:s.businesslistingid)===i)return r.entity.id;return null},t}(),ci=function(n){function t(t,i,r,u,f,e){var o=n.call(this,t,i,null,null,f)||this;return o._taskDisplayState=r,o._menuUrl=u,o.isRecommendationEntity=!1,o.categoryId=e,o}return v(t,n),t.prototype.getDirectionTaskOptions=function(){throw new Error("getDirectionTaskOptions");},t.prototype.getTaskDisplayState=function(){return this._taskDisplayState},t.prototype.getMenuUrl=function(){return this._menuUrl},t.prototype.setSegmentTypes=function(n){this._segmentTypes=n},t.prototype.getSegmentTypes=function(){return this._segmentTypes},t.prototype.getPrimaryCategoryName=function(){return this._primaryCategoryName},t.prototype.setPrimaryCategoryName=function(n){this._primaryCategoryName=n},t}(ou),lt=function(t){function o(r,f,o,h){var c=this,v,y,a,p;return c=t.call(this)||this,c._events=[],c.actionList=[],c._adjustLabel=function(n,t,i){for(var r,u,o,l,s,f,h,v=new ff(-2,-1),y={textOptions:{offset:v,anchor:"top-right"}},e=0,c=n.layers;e<c.length;e++)r=c[e],sr.PrimitiveManager.isTextLayer(r.getId())?r.setOptions(y):sr.PrimitiveManager.isIconLayer(r.getId())&&r.setOptions({visible:!1});for(u=0,o=Object.keys(i);u<o.length;u++)for(l=o[u],s=i[l],f=0,h=Object.keys(s);f<h.length;f++){var p=h[f],w=s[p],a=w.iconAndLabel.textOptions;"variableAnchor"in a&&(a.variableAnchor=null)}},c._shell=r,c._isRtl=e._isRtl(),c._reverseGeocoder=f,c._disposables=[],y={templateText:oe,staticResources:{clickHandler:function(n){n&&n.stopPropagation()},boolToDisplay:function(n){return n?"":"none"}}},c._controlTemplate=o(y),c.signInStateHandler=new ui,c._buttonGroupViewModel=h,c._hideTransientLensClickHandler=function(n){return c._onClick(n)},n(window).add_event("click,touchend",c._hideTransientLensClickHandler),c._hideTransientLensKeyDownHandler=function(n){return c._onKeyDown(n)},n(window).add_event("keydown",c._hideTransientLensKeyDownHandler),a=c.actionList,a.push(i.DirectionsTo,i.DirectionsFrom,i.AddToRoute,i.Search),tr&&(p=function(){tr.instanceAsync("MostRecentlyUsedList",function(n){c._mostRecentlyUsedList=n})},c._shell.getAzureMapFirstIdle().then(p)),(at===null||at===void 0?void 0:at.isEnabled)&&a.push(i.Streetside),e._isFeatureEnabled("birdseye")&&a.push(i.Birdseye),!(l===null||l===void 0?void 0:l.isEnabled)||u.isInPrivateMode||u.disableReverseGeocode||a.push(i.SaveWithTempCollection),a.push(i.Remove,i.Zoom),(l===null||l===void 0?void 0:l.isEnabled)&&a.push(i.Measure),((v=li.contextMenuNearbyCategories)===null||v===void 0?void 0:v.length)>0&&a.push(i.Nearby),a.push(i.Coordinates),c.invalidateLayer=new s,c.moveToNewCollection=new s,c._events.push(c._buttonGroupViewModel.hideParent.add(function(){return c.hide()}),c._buttonGroupViewModel.moveToNewCollection.add(function(){return c.moveToNewCollection.invoke()}),vt.add(r.getAzureMap(),"movestart",function(){return c.hide()})),c._ignoreHideEventOnce=!1,c._isDirectionsPopOutVisible=!1,c._isCollectionsPopOutVisible=!1,c._isTravelPopOutVisible=!1,c._isNearbyPopOutVisible=!1,c._populateNearbyCategories(),c._topAdjustment=0,c._secondaryMenuOpen=!1,c}return v(o,t),o.prototype.getPrimitive=function(){return this._primitive},o.prototype.getButtonGroupViewModel=function(){return this._buttonGroupViewModel},o.prototype.setOptions=function(n){this._options=n},o.prototype.processDirectionsData=function(n){var u,r,t,i;if(this._primitive){if(this._directionsProcessed=!0,this._directionsListCount=0,u=null,n.outData&&n.outData.length>0){for(r=0,t=0;t<n.outData.length;t++)i=n.outData[t].data,i&&!i.longDistanceIntent&&(i.routeTitle&&i.mode!==2&&(u||(u=n.outData[t].processorId),r++),i.activationState===1&&(this._activeDirectionTaskId=n.outData[t].processorId));r>0&&(this._directionsProcessData=n,this._directionsListCount=r,r===1&&(this._addToRouteDirectionTaskId=u))}this.updateTransientLens(n.inData)}},o.prototype.processTravelData=function(n){this._travelProcessed=!0;this._travelProcessData=n;this.updateTransientLens(n.inData)},o.prototype.updateTransientLens=function(n){var t=this,r=n.requestorState.location;this._directionsProcessed&&(!ct||!ct.isEditable||this._travelProcessed)&&(this._directionsProcessed=!1,this._travelProcessed=!1,this._populateActions(r),(at===null||at===void 0?void 0:at.isEnabled)&&(at===null||at===void 0?void 0:at.showStreetside)&&this._shell.getStreetsideControl().then(function(n){t._streetsideControl=n;n.isStreetsideAvailable({center:r.getPosition()}).then(function(n){t._isStreetsideAvailable(n)})}),this.actionList&&this.actionList.indexOf(i.Birdseye)>=0&&this._shell.getBirdseyeControl().then(function(n){t._birdseyeControl=n;n.isActive||n.isBirdseyeAvailable(r.getPosition()).then(function(n){t._isBirdseyeAvailable(n)})}),this.showOverlay(),this._updateOverlayPosition(n.requestorState.args,n.requestorState.preventInvalidate),this._updateEntityData())},o.prototype.showOverlay=function(){var n={overlayTemplate:this._controlTemplate,overlayEvent:0};wi.hideOverlay(this._shell,this._sourcePrimitive);wi.showOverlay(this._shell,n,this._primitive)},o.prototype.processCollectionsData=function(n){var t=null,i=n&&n.inData&&n.inData.requestState&&n.inData.requestState;this._primitive&&this._primitive.entity?(t=this._primitive.entity.getMyPlacesTaskOptions(n.inData.requestorState.location),t.state.data.id=this._primitive.entity.id):i.data&&(t=ft.getMyPlacesTaskOptions(n.inData.requestState.data.title,n.inData.requestorState.location),t.state.action=n.inData.requestState.action,t.state.data.id=n.inData.requestState.collectionId);t&&(t.activateOptions={parentId:this._options.requestorId});this._buttonGroupViewModel.processCollectionsData(n,t)},o.prototype.show=function(t){var u,i=t,r,f;(i===null||i===void 0?void 0:i.preventDefault)&&i.preventDefault();r=t;f=(u=r===null||r===void 0?void 0:r.args)===null||u===void 0?void 0:u.currentTarget;o._parentElement=f?n(f):null;this._ignoreHideEventOnce=!1;this._isDirectionsPopOutVisible=!1;this._isCollectionsPopOutVisible=!1;this._isTravelPopOutVisible=!1;this._isNearbyPopOutVisible=!1;this.populatePrimitive(t);this._update(t);this.initializeCollections();this._setFocusOnFirstElement()},o.prototype.hide=function(){if(this._ignoreHideEventOnce){this._ignoreHideEventOnce=!1;return}if(this._secondaryMenuOpen){this._secondaryMenuOpen=!1;this._buttonGroupViewModel.hidePopout();return}this._primitiveManager&&this._primitiveManager.remove([this._primitiveManager.getManagedPrimitive("labelPin")]);this._primitive&&(window.clearTimeout(o._mouseoverDelayHandle),window.clearTimeout(o._copyToClipboardHandle),window.clearTimeout(o._focusDelayHandle),wi.hideOverlay(this._shell,this._primitive),this._reset())},o.prototype.dispose=function(){this._primitive&&this.hide();e._clearDisposables(this._events);e._clearDisposables(this._disposables);n(window).remove_event("click,touchend",this._hideTransientLensClickHandler);n(window).remove_event("keydown",this._hideTransientLensKeyDownHandler);this._categories=[];this._buttonGroupViewModel.dispose()},o.prototype.populatePrimitive=function(n){var l=this,s,e,o,h;this._primitive&&this._cleanup();var f=ii.createFrom(n.position),t=this._shell.getAffectedPrimitive(n),c="",i="";t&&t.geometryType===1&&(s=t.crs,e=t.geometry,f=new ii(s.toLatitude(e.x,e.y),s.toLongitude(e.x,e.y)),c=st.getDisplayName(t.entity),i=st.getYpid(t.entity),!i&&t.entity.getBusinesslistingid?i=t.entity.getBusinesslistingid():!i&&t.entity.id&&(i=t.entity.id),this._sourcePrimitive=t);o=new ou(c,"",null);i&&(o.id=i);t&&t.entity&&(o.interests=t.entity.interests,o.stayDuration=t.entity.stayDuration);this._primitive=new pi(f,o,null);this._primitive.bucket=null;this.updateMapQuadrant(f,null);this._reverseGeocoder&&!u.disableReverseGeocode&&(this._reverseGeocodingRequestId=this._reverseGeocoder.reverseGeocode(f.getPosition(),function(n){return l._processGeocodeResponse(n)}));h=this._buildLogData("C",{AN:"Show",CP:f,ID:this._primitive.entity.id,EP:"ContextMenu"});h&&r.invokeHandler("data-instrumentation",h)},o.prototype._cleanup=function(){this._primitive.entity.dispose()},o.prototype._update=function(n,t){this._primitive.mapTypeClass=o._getMapTypeClass(this._shell,this._mapQuadrant);this._getDirectionsProcessData(n,t);ct.isEditable&&this._getTravelProcessData(n,t)},o.prototype._updateEntityData=function(){var t=n("#transientLens");this._buttonGroupViewModel.setEntityData(this._primitive.entity,this._options);this._buttonGroupViewModel.setAddToRouteMode(t.select(".directionsAddToRoute"),!0)},o.prototype._buildDirectionsAction=function(n,t,r,u){if(this.actionList.indexOf(t)!==-1){var f=this._primitive.entity,e={AN:i[t],CP:n,ID:f.id,EP:"ContextMenu"},o=this._buildLogData("C",e);return this._buildActionEventHandlers(n,t,o,r,u)}return null},o.prototype._buildTravelMoveToAction=function(n,t){if(this.actionList.indexOf(t)!==-1){var r=this._primitive.entity,u={AN:i[t],CP:n,ID:r.id,EP:"ContextMenu"},f=this._buildLogData("C",u),e=d.L_OverlayEntity_MoveToDay;return this._buildActionEventHandlers(n,t,f,e,"addToItinerary moveTo")}return null},o.prototype._buildAddToItineraryAction=function(n,t,r){if(this.actionList.indexOf(t)!==-1){var u=this._primitive.entity,f={AN:i[t],CP:n,ID:u.id,EP:"ContextMenu"},e=this._buildLogData("C",f),o=r.data.title,s=r.processorId,h=d.L_OverlayEntity_AddToItineraries.replace("{0}",o);return this._buildActionEventHandlers(n,t,e,h,"addToItinerary",s)}return null},o.prototype._buildSaveToRecentAction=function(n,t,r){var f,e=window.$MicrosoftMaps8&&window.$MicrosoftMaps8.CloudGraphDataManager,s,h,v,y;if(l.useJsonApiForFavorites&&e&&e.Utilities&&!r.IsItinerary&&e.Utilities.isDefaultCollectionId((f=r.Collection)===null||f===void 0?void 0:f.id))return null;if(this.actionList.indexOf(t)!==-1){var p=this._primitive.entity,w={AN:i[t],CP:n,ID:p.id,EP:"ContextMenu"},c="",u="",o="",a=!1;return r.IsItinerary?(a=!0,r.IsOpenTask?(u=r.TaskTitle,c=r.TaskId):(s=r.Itinerary,u=s.getName(),o=s.collectionId)):(h=r.Collection,u=h.name,o=h.id),v=this._buildLogData("C",w),y=this._buildActionEventHandlers(n,t,v,u,"saveToRecent",c,o,a),y}return null},o.prototype._buildLocalSearchAction=function(n){return si.hideCoordinates?null:(this._primitive&&this._primitive.entity&&this._primitive.entity.isRecommendationEntity)?null:this._buildBasicActions(n,i.Search)},o.prototype.buildLocalDetailAction=function(){return null},o.prototype.buildNearbyAction=function(n){return this.actionList.indexOf(i.Nearby)!==-1?this._buildActionEventHandlers(n,i.Nearby,null):undefined},o.prototype._isCardInFocus=function(){return!1},o.prototype._buildBasicActions=function(n,t){if(this.actionList.indexOf(t)!==-1){var r=this._buildLogData("C",{AN:i[t],CP:n,ID:this._primitive.entity.id,EP:"ContextMenu"});return this._buildActionEventHandlers(n,t,r)}return null},o.prototype.buildEditActions=function(){return null},o.prototype._buildZoomAction=function(n){return this._sourcePrimitive?null:this._buildBasicActions(n,i.Zoom)},o.prototype.buildCoordinatesAction=function(n){var r=this,t;if(si.hideCoordinates)return null;if(this.actionList.indexOf(i.Coordinates)!==-1){var s=ii.normalizeLongitude(n.longitude),o=n.latitude.toLocaleString(u.dynamicProperties.market,{minimumFractionDigits:6,maximumFractionDigits:6})+", "+s.toLocaleString(u.dynamicProperties.market,{minimumFractionDigits:6,maximumFractionDigits:6}),f=void 0,e=void 0;return si.enableCopyLinkInContextMenu?(f=o,e="secTextLink"):(f=d.L_OverlayEntity_Coordinates,e="secText"),t=this._primitive.entity.getGenericAction(f,"coordinates",function(n){r._isKeyHandler(n)&&n.preventDefault&&n.preventDefault()}),t.showSecText=!0,t.secText=si.enableCopyLinkInContextMenu?d.L_OverlayEntity_Copy_Coordinates:o,t.secTextClass=e,t.secTextLinkHandler=si.enableCopyLinkInContextMenu?function(t){return r._copyToClipboardClickEventBuilder(t,n,r._primitive.entity.id)}:null,t}return null},o.prototype._buildMenuAction=function(){return null},o.prototype._processMouseOverEvent=function(n,t,r){var u=this,f,e,o,s,h,c,l,a;n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation();switch(r){case i.AddToRoute:this._directionsListCount>1&&!this._isDirectionsPopOutVisible&&b.checkDirectionsControl(function(){var n,r,f=u._buildLogData("F",{AN:i[i.AddToRoute],CP:t,ID:(n=u._primitive)===null||n===void 0?void 0:n.entity.id,EP:"ContextMenu"}),e=((r=u._primitive)===null||r===void 0?void 0:r.entity).getDirectionTaskOptions(t,"ContextMenu");u._directionsProcessData.inData.requestorState.instData=f;u._isDirectionsPopOutVisible=!0;u._isCollectionsPopOutVisible=!1;u._isTravelPopOutVisible=!1;u._isNearbyPopOutVisible=!1;u._secondaryMenuOpen=!0;u._buttonGroupViewModel.processDirectionsData(u._directionsProcessData,e)});break;case i.moveToAnotherDay:this._isTravelPopOutVisible||(h=this._buildLogData("F",{AN:i[r],CP:t,ID:(f=this._primitive)===null||f===void 0?void 0:f.entity.id,EP:"ContextMenu"}),this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!1,this._isTravelPopOutVisible=!0,this._isNearbyPopOutVisible=!1,this._secondaryMenuOpen=!0,this._processTravelEvent(n,t,h,r));break;case i.MoveTo:this._isCollectionsPopOutVisible||(this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!0,this._isTravelPopOutVisible=!1,this._isNearbyPopOutVisible=!1,this._secondaryMenuOpen=!0,c=this._buildLogData("C",{AN:i[i.MoveTo],CP:t,ID:(e=this._primitive)===null||e===void 0?void 0:e.entity.id,EP:"ContextMenu"}),this._processCollectionsEvent(n,t,c,!0,!0));break;case i.Nearby:this._isNearbyPopOutVisible||(this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!1,this._isTravelPopOutVisible=!1,this._isNearbyPopOutVisible=!0,this._secondaryMenuOpen=!0,l=((o=this._primitive)===null||o===void 0?void 0:o.mapTypeClass.indexOf("Dark"))!==-1,a=((s=this._primitive)===null||s===void 0?void 0:s.entity).getTitle(),this._buttonGroupViewModel.nearbyButtonClicked(n,t,this._categories,this._shell.getTemplateSelector(),l,a));break;default:this._hidePopOut(n)}},o.prototype._processMouseOutEvent=function(n){n&&n.preventDefault&&n.preventDefault();window.clearTimeout(o._mouseoverDelayHandle)},o.prototype._openCardButtonClicked=function(n,t){var e,l,a,o,v;n&&n.preventDefault();t&&r.invokeHandler("data-instrumentation",t);var u=this._sourcePrimitive&&this._sourcePrimitive.entity,s=st.getYpid(u),h=st.getTransitJson(u),c="data-task",i,f;s?(i={id:s,taskTitle:st.getDisplayName(u),entryPoint:"ContextMenu"},f="LocalDetailsTask"):h?(e=JSON.parse(h),e.stops&&e.stops.length&&(l=this._primitive.getLocation(),i={id:e.stops[0].id,title:e.stops[0].name,location:l},f="TransitStopTask")):st.isTransitEntity(u)&&(a=this._primitive.getLocation(),o=parseInt(u.id),o=isNaN(o)?0:o,i={id:o,title:u.title,location:a},f="TransitStopTask");i||(v=this._primitive.geometry.y+","+this._primitive.geometry.x,c="data-process",i={query:v,taskTitle:this._primitive.entity.getTitle(),entryPoint:"ContextMenu"},f="LocalSearchTask");this.hide();c==="data-task"?r.invokeHandler("data-task",{state:i,type:f}):r.invokeHandler("data-process",{requestState:i,type:f})},o.prototype.updateMapQuadrant=function(n,t,i){var e=this._shell.getRootElement().get_size(),u=e.width,o=t?new hf(t.pageX,t.pageY):vi.tryLocationToPoint(this._shell.getAzureMap(),n),f,r=o.x,s,h;f=i?this._isRtl?r-i<0:r+i>u:this._isRtl?r<u/2:r>u/2;s=o.y<e.height/2;h=s?f?tt.topRight:tt.TopLeft:f?tt.BottomRight:tt.BottomLeft;this._mapQuadrant=h},o.prototype._getVectorImage=function(){throw new Error("_getVectorImage");},o.prototype._buildLogData=function(n,t){return{logData:{feature:"CM",action:n,data:t}}},o.prototype.initializeCollections=function(){if(this.signInStateHandler.getIsSignedIn())r.invokeHandler("data-process",{requestorType:"TransientLens",type:"CollectionsTask",requestState:{action:4}})},o._getMapTypeClass=function(n,t){var i;switch(n.getAzureMap().getStyle().style){case"road":i="Light";break;case"hybrid":case"aerial":i="Dark";break;default:i="Light"}return i+(" "+tt[t])},o.prototype.buildOverlaySearchAction=function(n){var t=this,i=this._primitive.entity,u=this._sourcePrimitive&&this._sourcePrimitive.entity,r=function(i){t._isKeyHandler(i)&&(window.clearTimeout(o._mouseoverDelayHandle),t._openCardButtonClicked(i,n))};return u?i.getLocalListingAction(!1,r):i.getAddPushpinAction(!1,r)},o.prototype._updateOverlayPosition=function(t,i){var u=n("#transientLens"),b,k,v;if(u.length!==0){var d=u.select(".directionsPopOut"),h=u.select(".travelPopOut"),y=h.length,p=u.select(".collectionsPopOut"),g=u.select(".nearbyPopOut"),it=u.select("a.nearby").length>0,c=d.get_size().width,w=h.length&&h.get_size().width,l=p.get_size().width,a=g.get_size().width,rt=Math.max(c,l,a),ut=this._overwriteMapQuadrantUsingMenuWidth(rt,t,i),nt=50,r=u.get_size(),e,o,f,s;this._isRtl?(e=-c,o=-w,f=-l,s=-a):e=o=f=s=r.width;this._mapQuadrant===tt.TopRight||this._mapQuadrant===tt.BottomRight?this._isRtl?e=o=f=s=r.width*2-15:(e=15-c-r.width,y&&(o=15-w-r.width),f=15-l-r.width,s=15-a-r.width):ut||(this._isRtl?e=o=f=s=r.width-15:(e=15-c,y&&(o=15-w),f=15-l,s=15-a));b=u.select("a.nearby").get_relative_pos().y-20;k=u.select("a.savefavorite").get_relative_pos().y-20;(this._mapQuadrant===tt.BottomLeft||this._mapQuadrant===tt.BottomRight)&&(nt-=r.height- -6,b-=r.height,k-=r.height);this._updateContextMenuPosition(r,t,u,i);v=this._topAdjustment;d.set_style({top:nt+v+"px",left:e+"px"});y&&h.set_style({left:o+"px"});ct.isEditable&&!this.signInStateHandler.getIsSignedIn()?p.set_style({top:k+v+"px",left:f+"px"}):p.set_style({left:f+"px"});it&&g.set_style({top:b+v+"px",left:s+"px"})}},o.prototype._updateContextMenuPosition=function(n,t,i){var e=i.select(".transientLensActions"),u=-8,r,f;this._mapQuadrant===tt.TopRight?r=-n.width:this._mapQuadrant===tt.BottomLeft?u=t.args?-n.height- -16:-n.height+-8:this._mapQuadrant===tt.BottomRight&&(u=-n.height+-8,r=-n.width);this._isRtl&&r&&(r=-r);f=this._topAdjustment=this._getTopAdjustment(e,u);f!==0&&(u+=f);e.set_style({position:"relative",top:u,left:r});i.set_style({visibility:"visible"})},o.prototype._getTopAdjustment=function(n,t){var i=n.get_absolute_pos().y+t,r=0,u,f;return this._mapQuadrant===tt.TopLeft||this._mapQuadrant===tt.TopRight?(u=this._shell.getRootElement().get_size().height,f=i+n.get_size().height,f>u&&(r=u-f)):73>i&&(r=73-i),r},o.prototype._overwriteMapQuadrantUsingMenuWidth=function(t,i){var e=this._shell.getAzureMap(),s=this._primitive.getLocation(),r=n("#transientLens").get_size().width,u=this._mapQuadrant,h,c,f;return this.updateMapQuadrant(s,i.args?i.args:null,r),h=n("."+tt[u]),u!==this._mapQuadrant&&(h.swap_class(tt[u],tt[this._mapQuadrant]),this._primitive.mapTypeClass=o._getMapTypeClass(this._shell,this._mapQuadrant)),c=n(e.getMapContainer()).get_size(),f=vi.tryLocationToPoint(e,s).x,this._isRtl?f-r-t>0:f+r+t<c.width},o.prototype._populateActions=function(n){var t,w,ct,o,s,r,h,b,k,u,c,l,a,lt,v,g,nt,y,f,e,tt,it,rt,ut,ft,et,ot,p,st,ht;if(this._primitive.entity&&n){if(t=[],this._mostRecentlyUsedList){if(this._mostRecentlyUsedList.getLength()>0)for(w=this._mostRecentlyUsedList.getList(),r=0;r<w.length;r++)ct=w[r],o=this._buildSaveToRecentAction(n,i.saveToRecent,ct),o&&(r===0&&(o.cssClass+="Icon"),r===w.length-1&&(o.showSeparator=!0),t.push(o))}else if(this._travelProcessData)for(s=this._travelProcessData.outData,this._buttonGroupViewModel.openItineraryTaskInfo=s,r=0;r<s.length;r++)h=this._buildAddToItineraryAction(n,i.addToItinerary,s[r]),r===s.length-1&&h&&(h.showSeparator=!0),h&&t.push(h);b=this._buildDirectionsAction(n,i.DirectionsTo,d.L_OverlayEntity_DirectionsTo,"directionsTo");b&&t.push(b);k=this._buildDirectionsAction(n,i.DirectionsFrom,d.L_OverlayEntity_DirectionsFrom,"directionsFrom");k&&t.push(k);u=void 0;this._directionsProcessData&&(u=this._buildDirectionsAction(n,i.AddToRoute,d.L_OverlayEntity_AddToRoute,"directionsAddToRoute"),u&&(this._directionsListCount>1&&(u.showArrow=!0),t.push(u)));(b||k||u)&&(t[t.length-1].showSeparator=!0);c=this.buildNearbyAction(n);c&&(c.showSeparator=!0,c.showArrow=!0,t.push(c));l=this._buildTravelMoveToAction(n,i.moveToAnotherDay);l&&(l.showArrow=!0,l.showSeparator=!0,t.push(l));this._primitive.entity.isRecommendationEntity||(a=this._buildBasicActions(n,i.SaveWithTempCollection),a&&(a.showSeparator=!0,lt=this.signInStateHandler.getIsSignedIn(),a.showArrow=!1,t.push(a)));v=this._buildBasicActions(n,i.MoveTo);v&&(v.showSeparator=!0,v.showArrow=!0,t.push(v));g=this.buildEditActions(i.Edit);g&&t.push(g);nt=this.buildEditActions(i.editName);nt&&t.push(nt);y=this.buildEditActions(i.editDescription);y&&t.push(y);f=this.buildEditActions(i.deleteName);f&&t.push(f);e=this.buildEditActions(i.deleteDescription);e&&t.push(e);tt=this.buildEditActions(i.hideHomeWork);tt&&t.push(tt);it=this.buildEditActions(i.editHomeWork);it&&t.push(it);rt=this.buildEditActions(i.Remove);rt&&t.push(rt);f||e||!y?e?e.showSeparator=!0:f&&(f.showSeparator=!0):y.showSeparator=!0;ut=this._buildLocalSearchAction(n);ut&&t.push(ut);ft=this.buildLocalDetailAction(n);ft&&t.push(ft);et=this._buildBasicActions(n,i.Streetside);et&&at.showStreetside&&t.push(et);ot=this._buildBasicActions(n,i.Birdseye);ot&&t.push(ot);p=this._buildZoomAction(n);p&&t.push(p);st=this._buildBasicActions(n,i.Measure);st&&t.push(st);ht=this.buildCoordinatesAction(n);ht&&(p&&(p.showSeparator=!0),t.push(ht));this._primitive.entity.setActions(t)}},o.prototype._populateNearbyCategories=function(){var i,r,t,u,o,n;if(((i=li.contextMenuNearbyCategories)===null||i===void 0?void 0:i.length)>0){for(r=this._categories=[],t=0,u=li.contextMenuNearbyCategories;t<u.length;t++)o=u[t],n=o.split(":"),n&&n.length===2&&r.push({Name:n[0],Id:n[1]});e._isFeatureEnabled("transit")&&r.push({Name:f.L_Nearby_Transit,Id:du.nearbyTransitCategoryId})}},o.prototype._buildActionEventHandlers=function(n,t,r,u,f,e,s,h){var c=this,l=null,a=this._primitive.entity,v;switch(t){case i.Zoom:l=a.getZoomAction(!1,function(t){c._isKeyHandler(t)&&(window.clearTimeout(o._mouseoverDelayHandle),c._zoomButtonClicked(t,n,r))});v=this._shell.getAzureMap().getCamera().zoom;v<15?l.cssClass="zoomEnabled":v>=15&&(l.cssClass="zoomout",l.text=d.L_OverlayEntity_ZoomOut);break;case i.Measure:l=a.getGenericAction(d.L_OverlayEntity_Measure,"measure",function(t){c._isKeyHandler(t)&&(window.clearTimeout(o._mouseoverDelayHandle),c._measureActionClicked(t,n,r))});break;case i.SaveWithTempCollection:l=a.getMyPlacesAction(!1,function(t){if(c._isKeyHandler(t)){window.clearTimeout(o._mouseoverDelayHandle);var i=c.signInStateHandler.getIsSignedIn();c._processCollectionsEvent(t,n,r,!!i)}},!0);break;case i.MoveTo:l=a.getMyPlacesAction(!1,function(t){c._isKeyHandler(t)&&(window.clearTimeout(o._mouseoverDelayHandle),c._processCollectionsEvent(t,n,r,!0,!0))},!0,!0);break;case i.addToItinerary:case i.moveToAnotherDay:l=a.getGenericAction(u,f,function(i){c._isKeyHandler(i)&&(window.clearTimeout(o._mouseoverDelayHandle),c._processTravelEvent(i,n,r,t,e))});break;case i.saveToRecent:l=a.getGenericAction(u,f,function(t){c._isKeyHandler(t)&&(window.clearTimeout(o._mouseoverDelayHandle),c._processSaveToRecentEvent(t,n,r,e,s,h))});break;case i.Directions:case i.DirectionsTo:case i.DirectionsFrom:case i.AddToRoute:l=a.getGenericAction(u,f,function(i){c._isKeyHandler(i)&&(window.clearTimeout(o._mouseoverDelayHandle),c._processDirectionsEvent(i,n,r,t))});break;case i.Search:l=this.buildOverlaySearchAction(r);break;case i.Streetside:l=a.getStreetsideAction(!0,function(t){c._isKeyHandler(t)&&(window.clearTimeout(o._mouseoverDelayHandle),c._streetsideButtonClicked(t,n,r))});break;case i.Birdseye:l=a.getBirdseyeAction(!0,function(t){c._isKeyHandler(t)&&(window.clearTimeout(o._mouseoverDelayHandle),c._birdseyeButtonClicked(t,n,r))});break;case i.Nearby:l=a.getNearbyAction(!1,function(t){c._isKeyHandler(t)&&(window.clearTimeout(o._mouseoverDelayHandle),c._processMouseOverEvent(t,n,i.Nearby))});break;case i.Menu:default:return null}return this.addMouseHoverHandlers(l,n,t)},o.prototype.addMouseHoverHandlers=function(n,t,i){var r=this;return n?(n.mouseoverHandler=function(n){window.clearTimeout(o._mouseoverDelayHandle);o._mouseoverDelayHandle=a.setTimeout(function(){r._processMouseOverEvent(n,t,i)},350)},n.mouseoutHandler=function(n){return r._processMouseOutEvent(n)},n):null},o.prototype._isKeyHandler=function(n){var t=n;return t&&t.type==="keydown"&&t.keyCode!==13?(this._onKeyDown(n),!1):!0},o.prototype._processDirectionsEvent=function(n,t,u,f){var l=this,o,s,h,c,e;n&&n.preventDefault&&n.preventDefault();u&&r.invokeHandler("data-instrumentation",u);c=this._primitive.entity.getTitle();e=this._activeDirectionTaskId;switch(f){case i.DirectionsTo:o=2;s=e;h=e?"focus":"activate";break;case i.DirectionsFrom:o=1;s=e;h=e?"focus":"activate";break;case i.AddToRoute:if(this._directionsListCount===1)o=3,s=this._addToRouteDirectionTaskId,h="focus";else{if(this._isDirectionsPopOutVisible)return;this._processMouseOverEvent(n,t,f);return}break;default:throw new Error("Error action type");}b.checkDirectionsControl(function(){var n=ft.getDirectionTaskOptions(c,t,"ContextMenu",c,l._primitive.entity.id,o);n.id=s;n.action=h;l.hide();r.invokeHandler("data-task",n)})},o.prototype._processTravelEvent=function(t,u,f,e,o){var s,h,a;if(t&&t.preventDefault&&t.preventDefault(),f&&r.invokeHandler("data-instrumentation",f),e===i.addToItinerary)s=this._primitive.entity,h=void 0,s.getImageUrl()&&s.getImageUrl().length>0&&(h=s.getImageUrl()),a=ft.getItineraryAddItemOptions(s.getTitle(),u,s.id,h,o,s.categoryId,s.interests,s.stayDuration),r.invokeHandler("data-process",a),this.hide();else if(e===i.moveToAnotherDay){var c=n("#transientLens"),v=c.select(".transientLensActions"),y=c.select(".travelPopOut"),l,p=c.select(".addToItinerary");l=p.get_relative_pos().y-20;this._buttonGroupViewModel.travelMoveToButtonClicked(t,u,f,"ContextMenu");(this._mapQuadrant===tt.BottomLeft||this._mapQuadrant===tt.BottomRight)&&(l-=v.get_size().height+-6);y.set_style({top:l+this._topAdjustment+"px"})}},o.prototype._processSaveToRecentEvent=function(n,t,i,u,f,e){var o,s;n&&n.preventDefault&&n.preventDefault();i&&r.invokeHandler("data-instrumentation",i);o=this._primitive.entity;o.getImageUrl()&&o.getImageUrl().length>0&&(s=o.getImageUrl());var h=o,l=h.getDescription&&h.getDescription(),a=h.getAddress&&h.getAddress(),c;c=e?f&&!u?ft.getItineraryAddItemFromSaveOptions(o.getTitle(),t,o.id,s,f,o.categoryId,o.interests,o.stayDuration):ft.getItineraryAddItemOptions(o.getTitle(),t,o.id,s,u,o.categoryId,o.interests,o.stayDuration):ft.getSaveToCollectionOptions(o.getTitle(),t,f,o.id,l,a,s,o.categoryId);r.invokeHandler("data-process",c);this.hide()},o.prototype._processCollectionsEvent=function(t,i,r,u,f){var e=n("#transientLens"),c=e.select(".transientLensActions"),l=e.select(".collectionsPopOut"),o,s,h;u?(s=e.select(".saveas"),o=s.get_relative_pos().y-20,this._buttonGroupViewModel.collectionMenuButtonClicked(t,i,r,"ContextMenu",f)):(h=e.select(".savefavorite"),o=h.get_relative_pos().y-20,this._buttonGroupViewModel.collectionButtonClicked(t,i,r,"ContextMenu"));(this._mapQuadrant===tt.BottomLeft||this._mapQuadrant===tt.BottomRight)&&(o-=c.get_size().height+-6);l.set_style({top:o+this._topAdjustment+"px"})},o.prototype._reset=function(){this._reverseGeocodingRequestId&&wt.abortRequest(this._reverseGeocodingRequestId);this._primitive&&(this._directionsProcessData=null,this._activeDirectionTaskId=null,this._travelProcessData=null,this._directionsProcessed=!1,this._travelProcessed=!1,this._addToRouteDirectionTaskId=null,this._topAdjustment=0,this._cleanup(),this._primitive=null,this._sourcePrimitive=null,this.invalidateLayer.invoke())},o.prototype._hidePopOut=function(n){(this._isDirectionsPopOutVisible||this._isCollectionsPopOutVisible||this._isTravelPopOutVisible||this._isNearbyPopOutVisible)&&(n&&n.preventDefault&&n.preventDefault(),this._ignoreHideEventOnce=!0,this._isDirectionsPopOutVisible=!1,this._isCollectionsPopOutVisible=!1,this._isTravelPopOutVisible=!1,this._isNearbyPopOutVisible=!1,this._buttonGroupViewModel.hidePopout(),this._secondaryMenuOpen=!1,this._ignoreHideEventOnce=!1)},o.prototype._streetsideButtonClicked=function(n,t,i){n&&n.preventDefault();n&&n.stopPropagation();i&&r.invokeHandler("data-instrumentation",i);this._streetsideControl.activate({center:t.getPosition()})},o.prototype._birdseyeButtonClicked=function(n,t,i){n&&n.preventDefault();n&&n.stopPropagation();i&&r.invokeHandler("data-instrumentation",i);this._birdseyeControl.activate(t.getPosition())},o.prototype._measureActionClicked=function(n,t,i){n&&n.preventDefault();this.hide();i&&r.invokeHandler("data-instrumentation",i);var u={location:t},f={type:"MeasureMapTask",state:u};r.invokeHandler("data-task",f)},o.prototype._zoomButtonClicked=function(n,t,i){var u,f;n&&n.preventDefault();tu.logImprov||i&&r.invokeHandler("data-instrumentation",i);u=this._shell.getView().zoom;f=u;u<=9?f=10:u>=10&&u<15?f=15:u>=15&&(f=10);var o=this._shell.getAzureMap()._getMap(),s=o.getZoom(),h=tu.logImprov?function(){if(i){var n=i.logData.data,t=o.getBounds(),u=o.getZoom();n.BBOX=[t.getWest(),t.getSouth(),t.getEast(),t.getNorth()];n.USR=1;n.LOD=e.roundToInterval(u,.1);n.ZD=s<u?"ZoomIn":"ZoomOut";r.invokeHandler("data-instrumentation",i)}}:undefined;this._shell.setView({zoom:f,center:[t.longitude,t.latitude]},h);this.hide()},o.prototype._processGeocodeResponse=function(n){var i,t,u,r,f;(this._reverseGeocodingRequestId=null,i=this._primitive,i)&&(n&&n.success&&n.location&&n.addressList?t=n.addressList[0].formattedAddress:(u=i.geometry,t=e._formatLatLonString(u.y,u.x)),r=i.entity,r.getTitle()||r.setTitle(t),r.setAddress(t),this._primitiveManager||(this._primitiveManager=new Microsoft.Maps.BingMapStyle.PrimitiveManager(this._shell.getAzureMap()),this._disposables.push(this._primitiveManager)),f={geometry:{geometryType:1,x:n.location[0],y:n.location[1]},bucket:"334",id:"labelPin",state:2,isHoverEnabled:!1,title:t},this._primitiveManager.modifyLayerGroupCallback=this._adjustLabel,this._primitiveManager.add([f]))},o.prototype._isStreetsideAvailable=function(n){var i=this,t;n&&this._primitive&&(t=this._primitive.entity.getActions(),t.forEach(function(n,t){n.getCssClass&&n.getCssClass()==="streetside"&&i._primitive.entity.getActions()[t].setCssClass("streetsideEnabled")}))},o.prototype._isBirdseyeAvailable=function(n){var i=this,t;n&&this._primitive&&(t=this._primitive.entity.getActions(),t.some(function(n,t){var r=!1;return n.getCssClass&&n.getCssClass()==="birdseyeV2"&&(i._primitive.entity.getActions()[t].setCssClass("birdseyeV2Enabled"),r=!0),r}))},o.prototype._getDirectionsProcessData=function(n,t){this._directionsProcessed=!1;var i=this._primitive.getLocation(),u={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:"DirectionsTask",requestState:{action:0},requestorState:{location:i,args:n,preventInvalidate:t},useActiveTasks:!0};r.invokeHandler("data-process",u)},o.prototype._getTravelProcessData=function(n,t){this._travelProcessed=!1;var i=this._primitive.getLocation(),u={requestorType:this._options.requestorType,requestorId:this._options.requestorId,type:"ItineraryDetailsTask",requestState:{action:0},requestorState:{location:i,args:n,preventInvalidate:t},useActiveTasks:!0};r.invokeHandler("data-process",u)},o.prototype._onClick=function(t){t.target&&n(t.target.parentElement).has_class("ms-composite")||this.hide()},o.prototype._onKeyDown=function(t){var u,e;if(t.type==="keydown"){if(u=[13,27,32,37,39,61,65,66,72,79,82,107,109,173,187,189],u.indexOf(t.keyCode)>=0){this.hide();o._parentElement&&o._parentElement.length>0&&t.keyCode===27&&o._parentElement[0].focus();return}var r=document.activeElement,f=this._primitive&&wi.getOverlay()&&wi.getOverlay().getOverlayElement(),i=r&&f&&f.has(r)&&r.tagName&&r.tagName.toLowerCase()==="a"&&r.parentElement;if(t.keyCode===38)if(i&&i.previousElementSibling)n("a",i.previousElementSibling)[0].focus();else{this.hide();return}if(t.keyCode===40)if(i&&i.nextElementSibling)n("a",i.nextElementSibling)[0].focus();else{this.hide();return}t.keyCode===9&&(e=t,e.shiftKey?i&&!i.previousElementSibling&&this.hide():i&&!i.nextElementSibling&&this.hide())}},o.prototype._copyToClipboardClickEventBuilder=function(t,u){var s=document.querySelector("#transientLens .coordinates .actionText"),h=this._buildLogData("C",{AN:i[i.Coordinates],CP:u,ID:this._primitive.entity.id,EP:"ContextMenu"}),c,f,e;if(h&&r.invokeHandler("data-instrumentation",h),window.getSelection&&document.createRange&&si.enableAutoCopyToClipboard){f=document.createRange();f.selectNodeContents(s);window.getSelection().removeAllRanges();window.getSelection().addRange(f);try{c=document.execCommand("copy")}catch(l){}window.getSelection().removeAllRanges()}e=n("#transientLens .coordinates .secTextLink");e.swap_class("secTextLink","secText");c?(e.set_text(d.L_OverlayEntity_Copy_Succeeded),window.clearTimeout(o._copyToClipboardHandle),o._copyToClipboardHandle=a.setTimeout(function(){var t=n("#transientLens .coordinates .secText");t.swap_class("secText","secTextLink");t.set_text(d.L_OverlayEntity_Copy_Coordinates)},1e3)):(f=document.createRange(),f.selectNodeContents(s),window.getSelection().removeAllRanges(),window.getSelection().addRange(f),e.set_text("Ctrl + C"))},o.prototype._setFocusOnFirstElement=function(){window.clearTimeout(o._focusDelayHandle);o._focusDelayHandle=a.setTimeout(function(){var t=n(".transientLensActions li");t.length&&n("a",t[0])[0].focus()},100)},o}(ef),ur=function(t){function u(n,i,r){var u=t.call(this,n,null,i,r)||this;return u.updateActionList(),u.poiSelected=new s,u._buildMode=!1,u}return v(u,t),u.prototype.buildMenu=function(n,t,i){this._buildMode=!0;this._buildCallback=i;this.show({primitive:n,args:t})},u.prototype.showOverlay=function(){if(this._buildMode&&this._buildCallback){var i=n(this._controlTemplate.applyDataTemplate({primitive:this._primitive}));this._buildCallback(i)}else t.prototype.showOverlay.call(this);this._buildMode=!1;this._buildCallback=null},u.prototype.populatePrimitive=function(n){var u,i;if(this._primitive&&this._cleanup(),u=n.primitive||this._shell.getAffectedPrimitive(n),u&&u.geometryType&&u.geometryType!==1){t.prototype.populatePrimitive.call(this,n);return}var e=u.geometry,o=new ii(e.y,e.x),f=u.entity,r=null;f instanceof cr?(i=f,r=new ci(i.getTitle(),i.getDescription(),u.taskDisplayState,i.getMenuUrl(),i.getAddress(),i.getSelectedCategoryForIcon&&i.getSelectedCategoryForIcon()),r.setImageUrl(i.getImageUrl()),r.addressFields=i.addressFields,r.setSegmentTypes(i.getSegmentTypes()),r.setPrimaryCategoryName(i.getPrimaryCategoryName()),r.searchEntity=f):r=new ci(f.title,f.subtitle,u.taskDisplayState);r.id=f.id;r.isRecommendationEntity=!1;this._primitive=new pi(o,r,null);this.updateMapQuadrant(o,null);this._primitive.taskDisplayState=u.taskDisplayState},u.prototype.updateActionList=function(){this.actionList.push(i.OpenNewCard)},u.prototype._openCardButtonClicked=function(n){n&&n.preventDefault();var t={entryPoint:"ContextMenu",id:this._primitive.entity.id,flippingCard:!0,taskTitle:this._primitive.entity.getTitle(),selectedCategoryId:this._primitive.entity.categoryId};b._updateSearchTaskStateWithAdsData(t,this._primitive.entity.searchEntity);this.poiSelected.invoke(this._primitive);this.hide();r.invokeHandler("data-task",{type:"LocalDetailsTask",state:t,activateOptions:{parentId:this._options.requestorId}})},u.prototype._buildLocalSearchAction=function(n){var i=t.prototype._buildLocalSearchAction.call(this,n);return i&&(i.cssClass=this._isCardInFocus()?"flipcard":"flipcardEnabled"),i},u.prototype.buildLocalDetailAction=function(n){var u=this,t,r;return this.actionList.indexOf(i.OpenNewCard)!==-1||this._primitive&&this._primitive.entity&&this._primitive.entity.isRecommendationEntity?(t=this._buildLogData("C",{AN:i[i.OpenNewCard],CP:n,ID:this._primitive.entity.id,EP:"ContextMenu"}),r=this._primitive.entity.getLocalDetailsAction(!1,function(n){window.clearTimeout(lt._mouseoverDelayHandle);u.openNewCardButtonClicked(n,t)}),this.addMouseHoverHandlers(r,n,i.OpenNewCard)):null},u.prototype._buildZoomAction=function(n){return this._buildMode?null:t.prototype._buildZoomAction.call(this,n)},u.prototype.buildOverlaySearchAction=function(n){var i=this,t=this._primitive.entity;return t.id&&t.id.length>0?t.getLocalListingAction(!1,function(t){window.clearTimeout(lt._mouseoverDelayHandle);i._openCardButtonClicked(t,n)}):null},u.prototype.openNewCardButtonClicked=function(n){var t,i;n&&n.preventDefault();t={entryPoint:"ContextMenu",listingTaskId:this._options.requestorId,id:this._primitive.entity.id,openingNewCard:!0,taskTitle:this._primitive.entity.getTitle(),selectedCategoryId:this._primitive.entity.categoryId};b._updateSearchTaskStateWithAdsData(t,this._primitive.entity.searchEntity);i=this._primitive.taskDisplayState&&this._primitive.taskDisplayState.colorIndex;this.hide();r.invokeHandler("data-task",{type:"LocalDetailsTask",state:t,activateOptions:{taskColorIndex:i,groupName:this._options.requestorId}})},u}(lt),ks=function(t){function u(n,i,r){var u=t.call(this,n,i,r)||this;return u.editEvent=new s,u}return v(u,t),u.prototype.updateActionListWithMoveTo=function(){var t,n;if(this.signInStateHandler.getIsSignedIn()&&this.actionList){for(t=!1,n=0;n<this.actionList.length;n++)this.actionList[n]===i.MoveTo&&(t=!0);t||this.actionList.push(i.MoveTo)}},u.prototype.updateActionListWithEdits=function(){this.updateActionList();this.actionList.push(i.Edit)},u.prototype.updateActionListWithHomeWorkEdit=function(){this.actionList=[i.DirectionsTo,i.DirectionsFrom,i.AddToRoute,i.OpenNewCard,i.editHomeWork,i.hideHomeWork,i.Remove]},u.prototype.updateActionListForEvent=function(){this.actionList=[i.DirectionsTo,i.DirectionsFrom,i.AddToRoute,i.OpenNewCard]},u.prototype.updateActionList=function(){var n=this.actionList=[];ct.isEditable&&n.push(i.addToItinerary);n.push(i.DirectionsTo,i.DirectionsFrom,i.AddToRoute,i.OpenNewCard);this.signInStateHandler.getIsSignedIn()&&n.push(i.MoveTo);n.push(i.Remove)},u.prototype.openNewCardButtonClicked=function(n){var i;if(this.isNotEnterOrClickHandler(n)){n&&n.preventDefault();var t=this._primitive.entity,u=t.getTitle(),e="",f=t.getNickname();f&&Microsoft.Maps.ResourceManager.Collections&&f!==Microsoft.Maps.ResourceManager.Collections.L_HomeFavorite_Text&&f!==Microsoft.Maps.ResourceManager.Collections.L_WorkFavorite_Text&&(e=u,u=t.getNickname());i={entryPoint:"ContextMenu",listingTaskId:this._options.requestorId,id:t.id,openingNewCard:!0,taskTitle:u,originalName:e,selectedCategoryId:t.categoryId};i.hideBackButton=!0;!i.id&&this._primitive.geometry&&(i.query=this._primitive.geometry.y.toFixed(6)+", "+this._primitive.geometry.x.toFixed(6));this.hide();r.invokeHandler("data-task",{type:"LocalDetailsTask",state:i,activateOptions:{groupName:this._options.requestorId}})}},u.prototype.populatePrimitive=function(n){var t=n.primitive,c,l,u,o,f;if(t){this._primitive&&this._cleanup();this.collectionPrimitive=t;var s=t.geometry,a=new ii(s.y,s.x),i=t.entity,r=t.entity,h=i.getTitle(),e="";i.originalName?e=i.originalName:r.getOriginalName&&(e=r.getOriginalName());c=i.getDescription();l=i.getAddress();i.businesslistingid?u=i.businesslistingid:r.getBusinesslistingid&&(u=r.getBusinesslistingid(),u.indexOf("ypid:")===-1&&u.indexOf("sid:")===-1&&(u=""));i.photoUrl?o=i.photoUrl:r.getPhotoUrl&&(o=r.getPhotoUrl());f=new ci(e||h,c,t.taskDisplayState,null,l,t.entity.getSelectedCategoryForIcon&&t.entity.getSelectedCategoryForIcon());e&&f.setNickname(h);o&&f.setImageUrl(o);f.id=u;this._primitive=new pi(a,f,null);this.updateMapQuadrant(null,n.args);this._buildMode&&(this._primitive.taskDisplayState=t.taskDisplayState)}},u.prototype.buildEditActions=function(n){var u=this,t,r,f,e,o;if(this.actionList.indexOf(n)===-1)return null;t="";r=!1;switch(n){case i.Edit:t=d.L_EditEntityOption;r=!0;break;case i.editName:t=this.actionList.indexOf(i.deleteName)===-1?d.L_AddNickNameOption:d.L_EditNickNameOption;break;case i.editDescription:t=this.actionList.indexOf(i.deleteDescription)===-1?d.L_AddNoteOption:d.L_EditNoteOption;break;case i.Remove:t=d.L_DeleteEntityOption;r=!0;break;case i.deleteName:t=d.L_DeleteNickNameOption;break;case i.deleteDescription:t=d.L_DeleteNoteOption;break;case i.editHomeWork:t=d.L_EditHomeWorkOption;r=!0;break;case i.hideHomeWork:this.collectionPrimitive&&this.collectionPrimitive.entity.getIsHomeOrWork&&(f=this.collectionPrimitive,t=f.entity.getShowOnMap()?d.L_HideHomeWorkOption:d.L_DisplayHomeWorkOption)}return e=function(t){u.isNotEnterOrClickHandler(t)&&(window.clearTimeout(lt._mouseoverDelayHandle),u.editEvent.invoke(n),t.stopPropagation(),t.preventDefault(),u.hide(),u._collectionFocus())},o={text:t,cssClass:n===i.Remove?"remove":"edit",handler:e,mouseoverHandler:null,showSeparator:r,showSecText:!1,secText:null},o},u.prototype.isNotEnterOrClickHandler=function(n){var t=n;return!t.keyCode||t.keyCode===13?!0:!1},u.prototype._collectionFocus=function(){var f,i,t,r,u;lt._parentElement&&lt._parentElement.length>0&&(f=lt._parentElement,i=f.get_ancestor(2),i.length>0?i.has_class("homeContents")?(t=i.select(".bm_editHomeAddress"),t.length>0&&t.parent().get_style("display")!=="none"&&t.select("input")[0].focus()):i.has_class("workContents")?(t=i.select(".bm_editWorkAddress"),t.length>0&&t.parent().get_style("display")!=="none"&&t.select("input")[0].focus()):(r=n(".editEntryRow",i[0]),r.length>0&&r.get_style("display")!=="none"?(u=r.select("input"),u.length>0&&u[0].focus()):lt._parentElement[0].focus()):lt._parentElement[0].focus())},u}(ur),ds=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return v(t,n),t.prototype.updateActionList=function(){},t.prototype._isCardInFocus=function(){var n=this._primitive.entity.getTaskDisplayState();return n&&n.activationState&&n.activationState===1?!0:!1},t.prototype._openCardButtonClicked=function(n){(n&&n.preventDefault(),this._isCardInFocus())||(this.hide(),r.invokeHandler("data-task",{action:"focus",id:this._options.requestorId}))},t}(ur),gs=function(t){function u(n,i,r){var u=t.call(this,n,i,r)||this;return ct.isEditable&&(u._buttonGroupViewModel.isItineraryContextMenu=!0),u.editEvent=new s,u}return v(u,t),u.prototype.updateActionList=function(){ct.isEditable?this.actionList=[i.DirectionsTo,i.DirectionsFrom,i.AddToRoute,i.moveToAnotherDay,i.OpenNewCard]:t.prototype.updateActionList.call(this)},u.prototype.updateActionListWithEdits=function(n,t){this.updateActionList();ct.isEditable&&(this.actionList.push(i.editName),this.actionList.push(i.editDescription),n&&this.actionList.push(i.deleteName),t&&this.actionList.push(i.deleteDescription))},u.prototype.populatePrimitive=function(n){var i=n.primitive,r;if(i){this._primitive&&this._cleanup();var t=this.travelEntity=i.entity,f=i.geometry,s=new ii(f.y,f.x),e=t.getTitle(),o=t.originalName||"",h=t.getDescription(),c=t.getAddress(),u;t.imageUrl&&(u=t.imageUrl);r=new ci(o||e,h,i.taskDisplayState,null,c,t.getSelectedCategoryForIcon&&t.getSelectedCategoryForIcon());o&&r.setNickname(e);u&&r.setImageUrl(u);r.id=t.id;this._primitive=new pi(s,r,null);this.updateMapQuadrant(null,n.args);this._buildMode&&(this._primitive.taskDisplayState=i.taskDisplayState)}},u.prototype._updateEntityData=function(){if(ct.isEditable){var i=n("#transientLens");this._buttonGroupViewModel.setEntityData(this.travelEntity,this._options);this._buttonGroupViewModel.setAddToRouteMode(i.select(".directionsAddToRoute"),!0)}else t.prototype._updateEntityData.call(this)},u.prototype.processTravelData=function(n){var i;if(ct.isEditable){this._travelProcessed=!0;var r=n.inData.requestState&&n.inData.requestState.action,u=n.inData.requestorId,f=n.outData.length&&n.outData[0].days;r===2?(i=ft.getItineraryDayOptions(this.travelEntity,u,f),this._buttonGroupViewModel.processTravelMoveToData(n,i)):this.updateTransientLens(n.inData)}else t.prototype.processTravelData.call(this,n)},u.prototype.buildEditActions=function(n){var r=this,t,u,f,e;if(this.actionList.indexOf(n)===-1)return null;t="";u=!1;switch(n){case i.editName:t=this.actionList.indexOf(i.deleteName)===-1?d.L_AddNickNameOption:d.L_EditNickNameOption;break;case i.editDescription:t=this.actionList.indexOf(i.deleteDescription)===-1?d.L_AddNoteOption:d.L_EditNoteOption;break;case i.deleteName:t=d.L_DeleteNickNameOption;break;case i.deleteDescription:t=d.L_DeleteNoteOption}return f=function(t){window.clearTimeout(lt._mouseoverDelayHandle);r.editEvent.invoke(n);t.stopPropagation();t.preventDefault();r.hide()},e={text:t,cssClass:"edit",handler:f,mouseoverHandler:null,showSeparator:u,showSecText:!1,secText:null},e},u.prototype.openNewCardButtonClicked=function(n){var t,i,u;n&&n.preventDefault();t=this._primitive.entity;i={entryPoint:"ContextMenu",listingTaskId:this._options.requestorId,id:t.id,openingNewCard:!0,taskTitle:t.getNickname()||t.getTitle(),selectedCategoryId:this._primitive.entity.categoryId};t.getNickname()&&(i.originalName=t.getTitle());!i.id&&this._primitive.geometry&&(i.query=this._primitive.geometry.y.toFixed(6)+", "+this._primitive.geometry.x.toFixed(6));u=this._primitive.taskDisplayState&&this._primitive.taskDisplayState.colorIndex;this.hide();r.invokeHandler("data-task",{type:"LocalDetailsTask",state:i,activateOptions:{taskColorIndex:u,groupName:this._options.requestorId}})},u}(ur),nh=function(){function n(n,t){var i=this,r,u,f;this._events=[];this._shell=n;this.invalidated=new s;r=n.getAzureMap();u=function(n){return i._onContextMenuInvoked(n)};this._events.push(vt.add(r,"contextmenu",u));this._transientLensViewModel=t;t.setOptions({requestorType:"TransientLens"});f=function(){i.invalidated.invoke()};this._events.push(t.invalidateLayer.add(f))}return n.prototype.getPrimitives=function(n,t){var i=this._transientLensViewModel.getPrimitive();i?t&&t({primitives:[i]}):t&&t({primitives:[]})},n.prototype.getViewModel=function(){return this._transientLensViewModel},n.prototype.dispose=function(){this._shell=null;for(var n=this._events.length-1;n>=0;n--)this._events[n].dispose();this._events=[];this._transientLensViewModel.dispose()},n.prototype.processCallback=function(n){var t=this._transientLensViewModel;n&&n.inData&&n.processorType&&n.outData&&t&&(n.processorType==="DirectionsTask"&&n.inData.requestorState?t.processDirectionsData(n):n.processorType==="CollectionsTask"&&n.inData.requestorState?t.processCollectionsData(n):n.processorType==="ItineraryDetailsTask"&&n.inData.requestorState&&t.processTravelData(n))},n.prototype.hide=function(){this._transientLensViewModel.hide()},n.prototype._onContextMenuInvoked=function(n){if(!e._isSmallMapShownOnSerp()&&!e._isCommuteDashboardPage()){var t=this._transientLensViewModel;t.hide();t.show(n)}},n}(),i;(function(n){n[n.Search=1]="Search";n[n.Directions=2]="Directions";n[n.Streetside=3]="Streetside";n[n.Zoom=5]="Zoom";n[n.Menu=6]="Menu";n[n.DirectionsTo=7]="DirectionsTo";n[n.DirectionsFrom=8]="DirectionsFrom";n[n.AddToRoute=9]="AddToRoute";n[n.OpenNewCard=11]="OpenNewCard";n[n.Nearby=12]="Nearby";n[n.Coordinates=13]="Coordinates";n[n.SaveWithTempCollection=14]="SaveWithTempCollection";n[n.MoveTo=15]="MoveTo";n[n.Measure=16]="Measure";n[n.editName=17]="editName";n[n.editDescription=18]="editDescription";n[n.deleteName=19]="deleteName";n[n.deleteDescription=20]="deleteDescription";n[n.editHomeWork=21]="editHomeWork";n[n.Birdseye=22]="Birdseye";n[n.hideHomeWork=23]="hideHomeWork";n[n.addToItinerary=24]="addToItinerary";n[n.moveToAnotherDay=25]="moveToAnotherDay";n[n.saveToRecent=26]="saveToRecent";n[n.Remove=27]="Remove";n[n.Edit=28]="Edit"})(i||(i={}));var fr=function(t){function i(i,r,u,f,e,h,c,l,v,y){var b,p=t.call(this)||this,w=p._privates,k,d;return w.defineProperty("title"),w.defineProperty("signInTitle"),w.defineProperty("messageLines"),w.defineProperty("isFaded"),w.defineProperty("isHidden"),w.defineProperty("showClose"),w.defineProperty("showBeak"),w.defineProperty("isDark"),w.defineProperty("preLink"),w.defineProperty("link"),w.defineProperty("postLink"),w.defineProperty("linkUrl"),w.defineProperty("customCssOverride"),c?u&&u.length&&(p._linkMessage=u[0],p._parseLinkMessage(),p.setLinkUrl("#")):p.setMessageLines(u),p.setTitle(r),p.setShowClose(!0),p.setShowBeak(!1),p.setIsDark(h),p.setCustomCssOverride(y),p.resources=o,p.tipRemoved=new s,p.signedIn=new s,p.messageLinkClicked=new s,p.tipHovered=new s,p._autoFadeHandlers=[],k=p._createTemplate(l),p.setTemplate(k),p._tipElement=n(p.getRootElement()),d=function(){p._fadeTimeout&&window.clearTimeout(p._fadeTimeout);p._tipElement&&p.removeTip()},f||(i&&(b=p.disposables).push.apply(b,vt.handleUserActions(i.getAzureMap(),d,!0)),p._fadeTimeout=a.setTimeout(function(){p._tipElement&&p.fadeTip()},v?v:4e3)),e&&(p._windowClickEventHandler=function(n){if(p&&p.rendered){var i=n.target,t=p.getRootElement();t&&t.contains(i)||a.setTimeout(function(){p.removeTip()},1)}},a.setTimeout(function(){window.addEventListener("click",p._windowClickEventHandler)},1)),p}return v(i,t),i.prototype.fadeTip=function(){var n=this;this.setIsFaded(!0);a.setTimeout(function(){n.removeTip()},1e3)},i.prototype.removeTip=function(){this._tipElement&&this._tipElement.removeFromParent();this._tipElement=null;this.tipRemoved&&this.tipRemoved.invoke();this.dispose()},i.prototype.dispose=function(){window.removeEventListener("click",this._windowClickEventHandler);e._clearDisposables(this._autoFadeHandlers);t.prototype.dispose.call(this)},i.prototype._createTemplate=function(n){var t=this;return new it(n||de,{boolToDisplay:function(n){return t._boolToDisplay(n)},boolToNotDisplay:function(n){return t._boolToDisplay(!n)},boolToFadedClass:function(n){return t._boolToFadedClass(n)},nullToDisplayNone:function(n){return t._nullToDisplayNone(n)},closeClicked:function(n){n.preventDefault();t.removeTip()},onSignedIn:function(){t.signedIn&&t.signedIn.invoke();t.removeTip()},onTipHoverOver:function(n){n&&n.stopPropagation();n&&n.preventDefault();t.tipHovered&&t.tipHovered.invoke()},onTipHoverOut:function(n){n&&n.stopPropagation();n&&n.preventDefault()},onLinkClicked:function(n){n&&n.stopPropagation();t.getLinkUrl()==="#"&&n&&n.preventDefault();t.messageLinkClicked&&t.messageLinkClicked.invoke();t.removeTip()}})},i.prototype._boolToDisplay=function(n){return n?"":"none"},i.prototype._boolToFadedClass=function(n){var t=this.getCustomCssOverride();return"bm_tooltips"+(this.getIsDark()?" dark":"")+(n?" reminderHiddenFade":"")+(t?" "+t:"")},i.prototype._nullToDisplayNone=function(n){return n?"":"none"},i.prototype._parseLinkMessage=function(){var n=this._linkMessage,t,i,r;n&&(t=n.indexOf("<link>"),t!==-1?(i=n.slice(0,t),i&&this.setPreLink(i),n=n.substr(t).replace("<link>",""),t=n.indexOf("<\/link>"),r=n.slice(0,t),r&&this.setLink(r),n=n.substr(t).replace("<\/link>",""),n&&this.setPostLink(n)):this.setLink(n))},i}(kt),th=function(n){function t(t,i){var r=n.call(this,null,null,[i],!0,!0,!1,!0,be)||this;return r._privates.defineProperty("iconText",null,null,{defaultValue:t}),r.setShowClose(!1),r.setShowBeak(!0),r}return v(t,n),t}(fr),ih=function(t){function i(n,i,r,u){var f=this,s=[o.L_Tooltip_Itinerary_Saved_Text],e;return f=t.call(this,n,"",s,!1,!0,u)||this,f.separator=" "+String.fromCharCode(183)+" ",e=f._privates,e.defineProperty("name",null,null,{defaultValue:r}),e.defineProperty("showEditName",null,null,{defaultValue:!1}),f._relatedTaskId=i,f.setShowClose(!1),f.setShowBeak(!0),f}return v(i,t),i.prototype._createTemplate=function(){var n=this;return new it(ke,{boolToDisplay:function(t){return n._boolToDisplay(t)},boolToNotDisplay:function(t){return n._boolToDisplay(!t)},boolToFadedClass:function(t){return n._boolToFadedClass(t)},nullToDisplayNone:function(t){return n._nullToDisplayNone(t)},closeClicked:function(t){t.preventDefault();n.removeTip()},renameClicked:function(t){t.preventDefault();n._onRenameClick()},onKeyPressed:function(t){t.keyCode===13&&n._onSaveLinkClick()},onSaveLinkClick:function(t){t.preventDefault();n._onSaveLinkClick()}})},i.prototype._onRenameClick=function(){window.clearTimeout(this._fadeTimeout);e._clearDisposables(this._autoFadeHandlers);var t=n(".nameEditBox",this.getRootElement());t&&t.length&&(t[0].value=this.getName());this.setIsDark(!1);this.setShowEditName(!0);this.setShowClose(!0);window.removeEventListener("click",this._windowClickEventHandler)},i.prototype._onSaveLinkClick=function(){var t=n(".nameEditBox",this.getRootElement()),i=t&&t.length&&t[0].value,u,f;i&&(u={action:6,title:i},f={type:"ItineraryDetailsTask",requestState:u,taskId:this._relatedTaskId},r.invokeHandler("data-process",f));this.fadeTip()},i}(fr);h.ButtonGroupViewModel=bs;h.CalendarSync=uo;h.CollectionsPoiTransientLensViewModel=ks;h.DetailsPoiTransientLensViewModel=ds;h.MapsFeedback=so;h.FeedbackTask=oo;h.Flyover=wo;h.FiltersBarModuleViewModel=po;h.FiltersBarViewModel=vu;h.FiltersStatusBarViewModel=yu;h.FiltersBar=yo;h.FiltersBarItem=vo;h.FiltersBarItemData=ao;h.ItineraryPoiTransientLensViewModel=gs;h.Landmarks3D=pu;h.MobileSettingsPage=ko;h.Map3DFeedbackHandler=wu;h.PoiTransientLensViewModel=ur;h.RichEntityMapsInfobox=cs;h.SignInState=ui;h.TaskBar=ws;h.TabControlRequester=wr;h.TransientLens=nh;h.TransientLensViewModel=lt;di=h.CommonControls=h.CommonControls||{};di.ListDropdownViewModel=dt;di.PopOutButtonViewModel=ki;di.ServerSideAds=pr;di.TnAAds=ge;c.CommuteRewards=nt;c.ControlsContainer=cu;c.PrintManager=dr;c.TransientLensActions=i;c.UserTipControl=fr;c.SaveOnSerpConfirmationTip=th;c.SaveSuccessTipControl=ih}catch(uf){if(h&&h.logger)h.logger.logCriticalError(uf);else throw uf;}}.call(window)