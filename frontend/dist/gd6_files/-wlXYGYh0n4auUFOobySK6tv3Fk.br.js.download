var _ReportProblemUtils;(function(n){function l(t){n.submitObj=c(t);s(n.submitObj.submitModuleIntializedCompleteEvent)}function c(n){var r=new i,u=r.getFacts(n,"data-facts"),e,f;return t.isEmptyOrNull(u)||(r.setOriginalEntityFromBusinessDetails(u),t.isEmptyOrNull(u.FeedIds)||(r.submitParams.feedIds=u.FeedIds),e=[],t.isEmptyOrNull(u.IsDefinitiveEntity)||e.push({key:"1",value:u.IsDefinitiveEntity}),t.isEmptyOrNull(u.IsProtectedEntity)||e.push({key:"2",value:u.IsProtectedEntity}),r.submitParams.featureDataMap=e),f=r.getFacts(n,"data-ufacts"),t.isEmptyOrNull(f)||t.isEmptyOrNull(f.Puid)||(r.userData.userid=f.Puid,t.isEmptyOrNull(f.Email)||(r.userData.useremail=f.Email)),r.isSubmitModuleInitialized=!0,r}function a(r){var u=this;return new Promise(function(f,e){n.submitObj=new i;var o=n.submitObj.submitConfig.getBusinessDetailsUrl+r,h={callback:function(i,r){var o,c,h;if(!i)return e("RAUPAJAXCALLFAIL");try{return(o=JSON.parse(r.request.responseText),t.isEmptyOrNull(o))?e(""):(t.isEmptyOrNull(o)||(n.submitObj.setOriginalEntityFromBusinessDetails(o),t.isEmptyOrNull(o.FeedIds)||(n.submitObj.submitParams.feedIds=o.FeedIds),c=[],t.isEmptyOrNull(o.IsDefinitiveEntity)||c.push({key:"1",value:o.IsDefinitiveEntity}),t.isEmptyOrNull(o.IsProtectedEntity)||c.push({key:"2",value:o.IsProtectedEntity}),u.submitParams.featureDataMap=c,h=o.UDetails,t.isEmptyOrNull(h)||t.isEmptyOrNull(h.Puid)||(n.submitObj.userData.userid=h.Puid,t.isEmptyOrNull(h.Email)||(n.submitObj.userData.useremail=h.Email))),n.submitObj.isSubmitModuleInitialized=!0,s(n.submitObj.submitModuleIntializedCompleteEvent),f(n.submitObj.originalEntity))}catch(l){return e("RAUPEXCEPTION")}}};sj_ajax(o,h)})}function v(n){return n===undefined||n===null}function s(n){sj_evt.fire(n)}var t=n,h=function(){function n(){this.submissionUrlV1="/customerfeedback/queue/full/surf?ft=Page2.1&ct=SERP&cv=1.0&src=Local&id=";this.submissionUrlV2="/customerfeedback/queue/full/surf?ft=Page2.1&ct=SERP&cv=1.1&src=Local&id=";this.newSubmissionUrlV2="/customerfeedback/queue/full/submission";this.dsatFeedbackUrl="/feedback/submission";this.getBusinessDetailsUrl="/local/reportproblem/details/?lid=";this.source="Local";this.surfPartner="LocalBusinessFeedback";this.issue="Business Suggestion";this.singleEntity="SingleEntity";this.feedbackType="Page2.1";this.clientType="SERP";this.clientVersion="1.1";this.clientVersion2="1.2";this.newIdentifier="NEW";this.newBusinessProblem="new business";this.feedbackTypeDsat="DSAT"}return n}(),r,u,f,e,o,i;n.ReportProblemConfig=h;r=function(){function n(){this.Identifier={Identifier:""}}return n.prototype.setIdentifier=function(n){this.Identifier.Identifier=n},n.prototype.setGeoLocation=function(n){this.GeoLocation=n},n.prototype.setAddress=function(n){this.Address=n},n.prototype.setHoo=function(){this.HoursOfOperation=HoursOfOperation.inputHours.length>0?{Open24x7:!1,Hours:HoursOfOperation.inputHours}:undefined},n}();n.ReportProblemOriginalEntity=r;u=function(){function n(n,t,i,r,u){this.AddressLine=n;this.City=t;this.Subdivision=i;this.PostalCode=r;this.CountryCode=u}return n}();n.ReportProblemAddress=u;f=function(){function n(n,t){this.Latitude=n;this.Longitude=t}return n}();n.ReportProblemGeoLocation=f;e=function(){function n(){this.rapEntryPoint="";this.rapPartner="";this.feedIds="";this.featureDataMap=[];this.feedbackType=undefined}return n}();n.ReportProblemSubmitParams=e;o=function(){function n(){this.userid="";this.useremail="";this.showEmailDiv=!1;this.latitude="";this.longitude="";this.userLocationType="";this.userEmailRequested=!1}return n}();n.ReportProblemUserData=o;i=function(){function t(){this.userData=new o;this.submitParams=new e;this.originalEntity=new r;this.submitConfig=new h;this.rapDebugId=this.GUID();this.isSubmitModuleInitialized=!1;this.submitModuleIntializedCompleteEvent="submitModuleIntializedCompleteEvent"}return t.prototype.setNewLocationData=function(n){var t=ReportProblemMaps.getNewSuggestedLocation();t?(n.SuggestedEntity.GeoLocation={},n.SuggestedEntity.GeoLocation=t,n.SuggestedEntity.IsGeoLocationMarkedIncorrect=!0):n.SuggestedEntity.IsGeoLocationMarkedIncorrect=!1},t.prototype.setCommonData=function(n){this.userData.userid&&(n.Id=this.userData.userid);this.userData.useremail&&(n.EmailAddress=this.userData.useremail);this.userData.latitude&&(n.UserLatitude=this.userData.latitude);this.userData.longitude&&(n.UserLongitude=this.userData.longitude);this.userData.userLocationType&&(n.UserLocationType=this.userData.userLocationType);this.submitParams.feedIds&&(n.feedIds=this.submitParams.feedIds);this.submitParams.featureDataMap&&(n.featureDataMap=this.submitParams.featureDataMap);this.submitParams.primaryCategory&&(n.PrimaryCategory=this.submitParams.primaryCategory);this.submitParams.categories&&(n.Categories=this.submitParams.categories);this.submitParams.webResources&&(n.WebResources=this.submitParams.webResources);var t=_ge("userEmailCheckBox");n.UserEmailRequested=t&&t.checked||this.userData.userEmailRequested?!0:!1;n.ServerSideAPIEnabled=!0;n.Referrer=_d.referrer},t.prototype.setSuggestedEntityHooData=function(n,t){if(ReportProblemDynamicData.open24x7)n.SuggestedEntity.HoursOfOperation={Open24x7:!0},n.SuggestedEntity.HoursOfOperationComment=this.handleEscapeChar(t);else if(ReportProblemDynamicData.isEditingHours){var i=HoursOfOperation.getHoursForSubmission();isHooEmpty(i)||(n.SuggestedEntity.HoursOfOperation={Open24x7:!1,Hours:i},n.SuggestedEntity.HoursOfOperationComment=this.handleEscapeChar(t))}},t.prototype.isHooEmpty=function(n){var t=!0;for(var i in n)n[i].hours.length>0&&(t=!1);return t},t.prototype.submit=function(n,t,i,r,u,f){n.RapDebugId=this.rapDebugId;this.submitToSUrF(n,t,i,r,u,f);Log.Log("RapPublish","ReportAProblem.RapPublishToSurf","ClientInst",!0,"YPID",t,"RapDebugId",n.RapDebugId)},t.prototype.handleEscapeChar=function(n){return[{regex:/"/g,replace:'\\"'},{regex:/[\n]/g,replace:"\\n"}].forEach(function(t){n=n.replace(t.regex,t.replace)}),n},t.prototype.submitToSUrF=function(n,t,i,r,u,f){var e=new XMLHttpRequest,o=this.submitConfig.newSubmissionUrlV2;n.Identifier=t;n.FeedbackType=this.submitConfig.feedbackType;n.ClientType=i;n.ClientVersion=r;n.Source=this.submitConfig.source;n.UserSubmissionTime=(new Date).toUTCString();n.Issue=this.submitConfig.issue;n.ImpressionGuid=_G.IG;n.partner=this.submitConfig.surfPartner;u!=null&&u!=undefined&&u!=""&&(n.RapEntryPoint=u);f!=null&&f!=undefined&&f!=""&&(n.RapPartner=f);e.open("POST",o,!0);e.setRequestHeader("Content-Type","application/json; charset=UTF-8");e.send(this.SerializeToJson(n))},t.prototype.setOriginalEntity=function(n,t,i,r,e,o,s,h,c,l,a,v,y,p,w){var b,k;try{this.originalEntity.Name=t;this.originalEntity.AddressLines=s;b=new u(i,r,e,o,y);this.originalEntity.setAddress(b);this.originalEntity.PrimaryPhone=h;this.originalEntity.PrimaryWebsite=c;k=new f(a,v);this.originalEntity.setGeoLocation(k);this.originalEntity.IsClosed=l;this.originalEntity.setIdentifier(n);this.originalEntity.Segment=1;this.originalEntity.Market=p;this.setOriginalEntityHooData(w)}catch(d){}},t.prototype.setOriginalEntityFromBusinessDetails=function(n,t){t===void 0&&(t=null);t||(t=this.convertInputHours(n.StructuredHoursOfOperation));this.setOriginalEntity(n.BusinessId,n.BusinessName,n.Address,n.City,n.State,n.Zip,n.FullAddress,n.Phone,n.Website,n.IsClosed,n.Lat,n.Long,n.Country,n.Culture,t)},t.prototype.convertInputHours=function(n){var f,u,i,e,r,t;if(n!=null&&n!=undefined){f=[];for(u in n){i={};i.dayIndex=u.DayOfWeek;i.isOpen24Hr=u.IsOpen24Hours;e=[];for(r in u.OpenHours)t={},t.openHour=r.From.Hour,t.openMin=r.From.Minute,t.closeHour=r.To.Hour,t.closeMin=r.To.Minute,e.push(t);i.hours=e;f.push(i)}return f}return null},t.prototype.setOriginalEntityHooData=function(n){this.originalEntity.HoursOfOperation=n.length>0?{Open24x7:!1,Hours:n}:undefined},t.prototype.getOriginalEntity=function(){return n.submitObj.originalEntity},t.prototype.getFacts=function(n,t){var u=null,i=_ge(n),r;if(i!=undefined&&i!=null&&(r=i.getAttribute(t),r))try{u=JSON.parse(r)}catch(f){}return u},t.prototype.getRandomNumber=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},t.prototype.GUID=function(){return(this.getRandomNumber()+this.getRandomNumber()+this.getRandomNumber()+this.getRandomNumber()+this.getRandomNumber()+this.getRandomNumber()+this.getRandomNumber()+this.getRandomNumber()).toLowerCase()},t.prototype.SerializeToJson=function(n){var i=i||{};if(typeof i.stringify=="function")return i.stringify(n);var e=typeof n,r=n&&n.constructor==Array,u=[],f,t;if(e!="object"||n==null)return e=="string"?'"'+n+'"':String(n);for(f in n)t=n[f],t!=null&&t.constructor!=Function&&(r?u.push(this.SerializeToJson(t)):u.push('"'+f+'":'+this.SerializeToJson(t)));return(r?"[":"{")+String(u)+(r?"]":"}")},t}();n.ReportProblemSubmit=i;n.initSubmitData=l;n.getSubmitDataFromDiv=c;n.initOriginalEntity=a;n.isEmptyOrNull=v;n.fireSubmitModuleIntializedCompleteEvent=s})(_ReportProblemUtils||(_ReportProblemUtils={}));_w.ReportProblemUtils||(_w.ReportProblemUtils=_ReportProblemUtils);_w.ReportProblemUtils.fireSubmitModuleIntializedCompleteEvent("RAPUComplete")